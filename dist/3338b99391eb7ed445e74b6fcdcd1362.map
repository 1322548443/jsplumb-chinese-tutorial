{"version":3,"sources":["src/lib/jquery.jsPlumb-1.7.2.js"],"names":["Math","sgn","x","Vectors","subtract","v1","v2","y","dotProduct","square","v","sqrt","scale","s","maxRecursion","flatnessTolerance","pow","_distanceFromCurve","point","curve","candidates","w","_convertToBezier","degree","length","higherDegree","numSolutions","_findRoots","dist","t","i","_bezier","newDist","location","distance","_nearestPointOnCurve","td","c","d","cdTable","z","row","column","parseFloat","n","m","k","lb","max","ub","min","j","depth","left","right","left_count","right_count","left_t","right_t","_getCrossingCount","_isFlatEnough","_computeXIntercept","n_crossings","sign","old_sign","error","intercept_1","intercept_2","left_intercept","right_intercept","a","b","det","dInv","a1","b1","c1","a2","b2","c2","max_distance_above","max_distance_below","value","XLK","YLK","XNM","YNM","XMK","YMK","detInv","S","temp","_curveFunctionCache","_getCurveFunctions","order","fns","f_term","l_term","c_term","t_term","one_minus_t_term","_termFunc","terms","p","push","_pointOnPath","cc","_x","_y","_dist","p1","p2","_isPoint","_pointAlongPath","prev","tally","curLoc","direction","cur","abs","_length","_pointAlongPathFrom","_locationAlongPathFrom","_gradientAtPoint","slice","dy","dx","Infinity","atan","_gradientAtPointAlongPathFrom","_perpendicularToPathAt","_theta2","sin","cos","jsBezier","window","distanceFromCurve","gradientAtPoint","gradientAtPointAlongCurveFrom","nearestPointOnCurve","pointOnCurve","pointAlongCurveFrom","perpendicularToCurveAt","locationAlongCurveFrom","getLength","Biltong","_isa","Object","prototype","toString","call","_pointHelper","fn","_gradient","gradient","_p1","_p2","_normal","normal","_lineLength","lineLength","_quadrant","quadrant","_theta","theta","PI","_intersects","intersects","r1","r2","x1","x2","y1","y2","h","_encloses","encloses","allowSharedEdges","v3","v4","_segmentMultipliers","_inverseSegmentMultipliers","_pointOnLine","pointOnLine","fromPoint","toPoint","segmentMultiplier","_perpendicularLineTo","perpendicularLineTo","theta2","Sniff","android","navigator","userAgent","toLowerCase","indexOf","matchesSelector","el","selector","ctx","parentNode","possibles","querySelectorAll","_gel","document","getElementById","_t","e","srcElement","target","_d","l","splice","guid","_store","obj","event","g","__ta","__tauid","_unstore","__taExtra","_unbind","__taUnstore","_curryChildFilter","children","evt","split","_fn","apply","arguments","registerExtraFunction","newFn","DefaultHandler","isTouchDevice","touchMap","_bind","SmartClickHandler","__taSmartClicks","down","__tad","_pageLocation","up","__tau","click","_tapProfiles","touches","taps","TapHandler","clickThreshold","dblClickThreshold","isMouseDevice","__taTapHandler","tt","tap","dbltap","contextmenu","downSelectors","setTimeout","clearSingle","clearDouble","tc","_touchCount","eventId","meeHelper","type","__tamee","MouseEnterExitHandler","activeElements","over","mouseenter","mouseexit","out","relatedTarget","toElement","documentElement","touchstart","touchend","touchmove","ta_down","ta_up","ta_context_down","ta_context_up","iev","rv","appName","ua","re","RegExp","exec","$1","isIELT9","_genLoc","prefix","ts","_touches","_getTouch","clientX","scrollLeft","clientY","scrollTop","_screenLocation","_clientLocation","idx","item","changedTouches","targetTouches","originalFn","addEventListener","attachEvent","key","_each","_el","removeEventListener","detachEvent","_devNull","tagName","Mottle","params","self","mouseEnterExitHandler","tapHandler","_smartClicks","smartClicks","_doBind","remove","removeChild","on","_c","_e","_f","off","trigger","originalEvent","payload","eventToBind","pl","sl","cl","screenX","screenY","_decorate","_evt","eventGenerators","createTouch","initTouchEvent","createTouchList","initMouseEvent","createEvent","ite","evtName","dispatchEvent","createEventObject","eventType","eventName","fireEvent","consume","doNotPreventDefault","stopPropagation","returnValue","preventDefault","pageLocation","_isnum","_iss","_isb","_isnull","_iso","o","_isd","_isf","_ise","hasOwnProperty","pointHelper","root","exports","jsPlumbUtil","isArray","isString","isBoolean","isNull","isObject","isDate","isFunction","isEmpty","isNumber","clone","Date","getTime","merge","collations","cMap","ar","replace","inObj","path","q","term","lc","pos","str","array","match","last","_getArray","functionChain","successValue","failValue","populate","model","values","getValue","fromString","matches","val","substring","_one","r","convertStyle","ignoreAlpha","pad","hex","Number","pattern","parts","findWithFunction","f","_v","removeWithFunction","addWithFunction","list","hashFunction","addToList","map","insertAtStart","extend","child","parent","_protoFn","_makeFn","name","protoFn","_oneSet","uuid","random","logEnabled","log","console","msg","wrap","wrappedFunction","newFunction","returnOnThisValue","EventGenerator","_listeners","eventsSuspended","eventsToDieOn","bind","listener","fire","_gone","ret","shouldFireEvent","unbind","getListener","forEvent","setSuspendEvents","isSuspendEvents","cleanupListeners","cleanup","Function","oThis","TypeError","aArgs","Array","fToBind","fNOP","fBound","concat","ieVersion","test","oldIE","sizeElement","style","height","width","top","svgAvailable","SVGAngle","implementation","hasFeature","vmlAvailable","vml","undefined","body","appendChild","createElement","innerHTML","firstChild","behavior","adj","DragManager","_currentInstance","_draggables","_dlist","_delements","_elementsWithEndpoints","_draggablesForElements","register","id","getId","parentOffset","jsPlumbAdapter","getOffset","_oneLevel","startOffset","childNodes","nodeType","cEl","jsPlumb","getElementObject","cid","cOff","offset","updateOffsets","elId","domEl","getDOMElement","cel","endpointAdded","pid","pLoc","cLoc","endpointDeleted","endpoint","elementId","changeId","oldId","newId","getElementsForDraggable","elementRemoved","reset","dragEnded","ancestor","setParent","pId","current","getDragAncestor","de","aid","time","timeEnd","group","groupEnd","trim","_setClassName","cn","className","baseVal","_getClassName","_classManip","add","clazz","classesToAddOrRemove","curClasses","join","_classManipNew","classesToAdd","classesToRemove","classes","spec","headless","screenLocation","clientLocation","getAttribute","attName","setAttribute","appendToRoot","node","getRenderModes","isRenderModeAvailable","getDragManager","_jsPlumb","setRenderMode","mode","renderMode","addClass","hasClass","classList","contains","removeClass","updateClasses","toAdd","toRemove","setClass","setPosition","getPosition","prop","_instance","relativeToRoot","container","getContainer","offsetLeft","offsetTop","op","offsetParent","getPositionOnElement","zoom","box","getBoundingClientRect","docElem","offPar","pageYOffset","pageXOffset","clientTop","clientLeft","pst","psl","offsetWidth","offsetHeight","getAbsolutePosition","ss","setAbsolutePosition","xy","animateFrom","animateOptions","animate","_ju","_getOffset","_timestamp","_updateHoverStyle","component","paintStyle","hoverPaintStyle","mergedHoverStyle","fillStyle","events","eventFilters","_updateAttachedElements","state","timestamp","sourceElement","affectedElements","getAttachedElements","setHover","_splitType","_applyTypes","doNotRepaint","getDefaultType","getTypeDescriptor","types","instance","getType","applyType","repaint","jsPlumbUIComponent","idPrefix","parameters","paintStyleInUse","hover","beforeDetach","beforeDrop","overlayPlacements","hoverClass","Defaults","HoverClass","constructor","isDetachAllowed","connection","isDropAllowed","sourceId","targetId","scope","dropEndpoint","source","checkCondition","boundListeners","bindAListener","domListeners","setListenerComponent","_removeTypeCssHelper","typeIndex","typeId","cssClass","canvas","getParameter","setParameter","getParameters","setParameters","setType","clearTypes","reapplyTypes","hasType","addType","_cont","removeType","toggleType","setPaintStyle","setHoverPaintStyle","getPaintStyle","getHoverPaintStyle","destroy","isHover","ignoreAttachedElements","currentlyDragging","isHoverSuspended","method","isSuspendDrawing","recalc","_internalLabelOverlayId","_getOverlayIndex","overlays","_makeLabelOverlay","_params","labelStyle","mergedParams","Overlays","getRenderMode","Label","_processOverlay","_newOverlay","String","_calculateOverlaysToAdd","defaultKeys","defaultOverlayKeys","checkKey","unshift","OverlayCapableJsPlumbUIComponent","_overlays","label","loc","labelLocation","defaultLabelLocation","LabelStyle","removeAllOverlays","addOverlay","isConnectionBeingDragged","overlay","getOverlay","getOverlays","hideOverlay","hide","hideOverlays","showOverlay","show","showOverlays","overlayPositions","removeOverlay","overlayId","removeOverlays","moveParent","newParent","bgCanvas","isAppendedAtTopLevel","getLabel","lo","getLabelOverlay","setLabel","setLocation","setVisible","setAbsoluteOverlayPosition","getAbsoluteOverlayPosition","_jsPlumbInstanceIndex","getInstanceIndex","jsPlumbInstance","_defaults","Anchor","Anchors","ConnectionsDetachable","ConnectionOverlays","Connector","Container","DoNotThrowErrors","DragOptions","DropOptions","Endpoint","EndpointOverlays","Endpoints","EndpointStyle","EndpointStyles","EndpointHoverStyle","EndpointHoverStyles","HoverPaintStyle","color","LogEnabled","MaxConnections","PaintStyle","lineWidth","strokeStyle","ReattachConnections","RenderMode","Scope","_connectionTypes","_endpointTypes","_instanceIndex","_bb","_initialDefaults","_zoom","_info","_getId","setZoom","repaintEverything","getZoom","_container","setContainer","select","each","conn","selectEndpoints","ep","_oneDelegateHandler","jp","_oneDelegate","initialized","importDefaults","restoreDefaults","connections","endpointsByElement","endpointsByUUID","managedElements","offsets","offsetTimestamps","draggableStates","connectionBeingDragged","sizes","_suspendDrawing","_suspendedAt","DEFAULT_SCOPE","_curIdStamp","_idstamp","_appendElement","_draw","element","ui","clearEdits","repaintEls","dragManager","_updateOffset","anchorManager","redraw","_elementProxy","retVal","del","_getEndpoint","_initDraggableIfNecessary","isDraggable","dragOptions","_draggable","isDragSupported","isAlreadyDraggable","options","dragEvent","dragEvents","drag","stopEvent","stop","startEvent","start","_del","_ancestor","_noOffset","_ancestorOffset","_started","_manage","setHoverSuspended","elementDraggingClass","sourceElementDraggingClass","targetElementDraggingClass","setConnectionBeingDragged","canDrag","getUIPosition","draggable","disabled","initDraggable","_scopeMatch","e1","e2","s1","s2","_prepareConnectionParams","referenceParams","_p","sourceEndpoint","targetEndpoint","uuids","isFull","connectionType","connectorOverlays","connectorPointerEvents","_mergeOverrides","def","_addEndpoint","addEndpoint","anchor","anchors","endpoints","endpointStyles","endpointStyle","endpointHoverStyles","endpointHoverStyle","_oneElementDef","defs","newConnection","tid","tep","enabled","newEndpoint","uniqueEndpoint","_doNotDeleteOnDetach","_deleteOnDetach","sourceEndpointDefinitions","targetEndpointDefinitions","_newConnection","connectionFunc","ConnectionType","getDefaultConnectionType","_newEndpoint","finaliseConnection","_finaliseConnection","con","isDetachable","jpc","doInformAnchorManager","suspendedEndpoint","isTemporarySource","doNotFireConnectionEvent","eventArgs","endpointFunc","EndpointType","fireDetachEvent","_operation","func","ii","jj","_setDraggable","setElementDraggable","_setVisible","alsoChangeEndpoints","info","oidx","isVisible","_toggleDraggable","setDraggable","_toggleVisible","changeEndpoints","_getCachedData","doNotCreateIfNotFound","connectorClass","endpointClass","endpointConnectedClass","endpointFullClass","endpointDropAllowedClass","endpointDropForbiddenClass","overlayClass","draggingClass","endpointAnchorClassPrefix","hoverSourceClass","hoverTargetClass","dragSelectClass","Connectors","ConnectorRenderers","SVG","VML","results","inputs","_ensureContainer","myOffset","paint","anchorLoc","compute","wh","addEndpoints","properties","ele","stepFunction","animEvents","step","completeFunction","complete","revalidate","doAnimate","conditionName","connect","stTypes","epDefs","_set","_st","cId","sid","sep","oldEndpoint","evtParams","index","originalSourceId","newSourceId","originalTargetId","newTargetId","addConnection","makeEndpoint","detachFromConnection","fireMoveEvent","setSource","sourceChanged","setTarget","updateOtherEndpoint","deleteEndpoint","object","dontUpdateHover","deleteObject","deleteEveryEndpoint","_is","setSuspendDrawing","doFireEvent","connType","argIsConnection","connectionDetached","unregisterEndpoint","newEndpoints","detach","firstArgIsConnection","forceDetach","detachFrom","detachAllConnections","detachAll","detachEveryConnection","doWhileSuspended","result","endpointCount","connectionCount","deleteAttachedObjects","unravelConnection","unravelEndpoint","_setOperation","args","_getOperation","setter","getter","prepareList","input","doNotGetIds","filterList","missingIsFalse","getConnections","flat","getDefaultScope","scopes","sources","targets","_addOne","_curryEach","executor","_curryGet","_makeCommonSelectHandler","get","setters","getters","_makeConnectionSelectHandler","common","setDetachable","setReattach","setConnector","isReattach","_makeEndpointSelectHandler","setEnabled","setAnchor","isEnabled","noElementFilters","elements","either","sourceMatchExact","targetMatchExact","inner","_ep","noMatchSource","isSource","noMatchTarget","isTarget","getAllConnections","getEndpoint","getEndpoints","getDefaultEndpointType","Connection","appendElement","_hoverSuspended","_isAvailable","isSVGAvailable","isVMLAvailable","idstamp","connectorsInitialized","connectorTypes","rendererTypes","registerConnectorType","connector","candidate","can","_getContainerFromDefaults","manage","_unmanage","updateOffset","getSize","bottom","centerx","centery","init","_oneType","renderer","AnchorManager","makeAnchor","pp","_a","specimen","newAnchor","getOrientation","DynamicAnchor","anchorParams","orientation","makeAnchors","makeDynamicAnchor","anchorSelector","_setEndpointPaintStylesAndAnchor","epIndex","selectorFilter","negate","ok","sel","getSelector","makeTarget","targetScope","deleteEndpointsOnDetach","maxConnections","onMaxConnections","_doOne","elInfo","elid","proxyComponent","dropOptions","_def","_jsPlumbTarget","_drop","EndpointDropHandler","targetCount","full","onDrop","locked","positionFinder","dropPosition","elPosition","elSize","ap","constructorParams","dropEvent","drop","allowLoopback","canDrop","_drag","getDragElement","_jsPlumbRelatedElement","initDroppable","unmakeTarget","doNotClearArrays","destroyDroppable","makeSource","parentElement","idToRegisterAgainst","existingDrag","existingStop","endpointAddedButNoDragYet","anchorDef","oldAnchor","oldConnection","potentialParent","setElement","mouseDownListener","getOriginalEvent","which","button","filter","filterExclude","sourceCount","elxy","pelxy","tempEndpointParams","endpointWillMoveTo","finalEndpoint","_delTempEndpoint","setDragFilter","unmakeSource","unmakeEverySource","_getScope","_setScope","scopeChange","getScope","getSourceScope","getTargetScope","setScope","setSourceScope","setTargetScope","unmakeEveryTarget","_setEnabled","toggle","_first","toggleSourceEnabled","isSourceEnabled","setSourceEnabled","toggleTargetEnabled","isTargetEnabled","setTargetEnabled","ready","removeAllEndpoints","recurse","ebe","floatingConnections","clearFor","removeFloatingConnection","removeElement","_clearObject","_clearOverlayObject","clear","setDefaultScope","setId","doNotSetAttribute","sConns","tConns","setElementId","setReferenceElement","_conns","epIdx","setDebugLog","debugLog","repaintAfterwards","curVal","getSuspendedAt","doNotRepaintAfterwards","_wasSuspended","getCachedData","toggleVisible","toggleDraggable","addListener","recalculateOffsets","registerConnectionType","registerConnectionTypes","registerEndpointType","registerEndpointTypes","typeDescriptor","setIdChanged","_dom","_id","_pel","_pdom","_pid","getWidth","getHeight","o1","o2","names","getFloatingAnchorIndex","isFloating","getInstance","define","_makeConnectionDragHandler","placeholder","stopped","_ui","stopDrag","_makeDraggablePlaceholder","position","_makeFloatingEndpoint","referenceAnchor","referenceCanvas","floatingAnchor","FloatingAnchor","reference","typeParameters","findConnectionToUseForDynamicAnchor","elementWithPrecedence","findConnectionIndex","_fireMoveEvent","connectorStyle","connectorHoverStyle","connectorHoverClass","connectorTooltip","visible","floatingEndpoint","inPlaceCopy","connectionCost","connectionsDirected","currentAnchorClass","_updateAnchorClass","oldAnchorClass","getCssClass","continuousAnchorFactory","currentAnchor","anchorParamsToUse","internalHover","_transient","setEndpoint","rm","endpointArgs","tooltip","reattachConnections","reattach","connectionsDetachable","detachable","dragAllowedWhenFull","doNotCleanup","ignoreTarget","endpointBeingDeleted","connectionIndex","actuallyDetached","_forceDetach","getElement","parentId","curId","rehomeEndpoint","makeInPlaceCopy","getCurrentLocation","acc","inPlaceAnchor","hideOnDrag","connectorSelector","setStyle","anchorPoint","connectorPaintStyle","dimensions","isDynamic","oIdx","oId","oInfo","oOffset","oWH","txy","twh","tElement","draw","draggingInitialised","placeholderInfo","existingJpc","existingJpcParams","_dragHandler","defaultOpts","_continue","referenceEndpoint","ipcoel","ipco","canvasElement","parentAnchor","visibility","anchorIdx","dragScope","getDragScope","dropScope","getDropScope","setDragScope","suspendedElement","suspendedElementId","suspendedElementType","addFloatingConnection","getDropEvent","deleteConnectionNow","fe","_forceReattach","deleteAfterDragStop","_initDropTarget","forceInit","isTransient","isDropSupported","overEvent","outEvent","getDragObject","_jpc","bb","data","doNotChangeConnections","doNotNotifyOtherEndpoint","display","destroyDraggable","isConnectedTo","found","getConnectionCost","setConnectionCost","areConnectionsDirected","setConnectionsDirected","_elId","setDragAllowedWhenFull","allowed","equals","getUuid","computeAnchor","dhParams","redrop","_doContinue","continueFunction","aParam","originalSourceEndpoint","newSourceEndpoint","originalTargetEndpoint","newTargetEndpoint","_toDelete","dontContinueFunction","makeConnector","connectorName","connectorArgs","forComponent","_makeAnchor","previousConnection","editable","editorParams","lastPaintedAt","rettach","ConnectorOverlays","prepareEndpoint","eS","eT","setPath","myInfo","myWH","otherInfo","otherOffset","otherWH","initialTimestamp","cost","directed","_types","informEndpoints","getCost","setCost","isDirected","getConnector","connectorSpec","doNotChangeListenerComponent","swap","tId","sId","tIdx","sIdx","sourceInfo","targetInfo","sE","tE","sAnchorP","tAnchorP","resetBounds","sourcePos","targetPos","overlayExtents","minX","minY","maxX","maxY","outlineWidth","extents","xmin","bounds","ymin","xmax","ymax","existing","es","outlineColor","ehs","u","drawEndpoints","_amEndpoints","continuousAnchors","continuousAnchorLocations","userDefinedContinuousAnchorLocations","continuousAnchorOrientations","Orientation","HORIZONTAL","VERTICAL","DIAGONAL","IDENTITY","axes","connectionsByElementId","anchorLists","calculateOrientation","sd","sourceAnchor","targetAnchor","atan2","midpoints","dim","sf","tf","sort","sourceEdge","targetEdge","isContinuous","isEdgeSupported","placeAnchorsOnLine","desc","elementDimensions","elementPosition","horizontal","otherMultiplier","reverse","other","xp","yp","currySort","reverseAngles","leftSort","edgeSortFunctions","_sortHelper","_array","placeAnchors","_anchorLists","cd","sS","sO","placeSomeAnchors","unsortedConnections","isHorizontal","sc","_setAnchorLocation","anchorPos","weAreSource","weAreTarget","doRegisterTarget","registerConnection","otherIndex","otherEndpoint","otherAnchor","removeEndpointFromAnchorLists","eId","connInfo","removeConnection","getConnectionsFor","getEndpointsFor","_updateAnchorList","lists","aBoolean","otherElId","edgeId","connsToPaint","endpointsToPaint","exactIdx","firstMatchingElIdx","endpointId","listToAddTo","listToRemoveFrom","_continuousAnchorEdge","rIdx","insertIdx","oldTargetId","sIndex","tIndex","originalId","currentId","eps","offsetToUI","doNotRecalcEndpoint","endpointConnections","connectionsToPaint","anchorsToUpdate","orientationCache","sourceContinuous","targetContinuous","oKey","oKey2","getDefaultFace","fc","ContinuousAnchor","faces","clockwise","availableFaces","opposites","clockwiseOptions","antiClockwiseOptions","secondBest","lastChoice","verifyEdge","edge","clearUserDefinedLocation","setUserDefinedLocation","setCssClass","userDefinedLocation","lastReturnValue","ao","getUserDefinedLocation","_endpoint","ref","refCanvas","size","xDir","yDir","_lastResult","_convertAnchor","isSelective","addAnchor","getAnchors","_curAnchor","_curIndex","_lastAnchor","_distance","cx","cy","ax","ay","acx","acy","_anchorSelector","minIdx","minDist","udl","_curryAnchor","ox","oy","fnInit","DynamicAnchors","AutoDefault","_curryContinuousAnchor","Continuous","pf","AnchorPositionFinders","dp","gx","grid","gy","mx","floor","my","Perimeter","anchorCount","shape","Error","_circle","_path","segments","anchorsPerFace","_computeFace","fractionalLength","_shape","_rectangle","_shapes","points","tl","_rotate","amountInDegrees","da","rotation","Segments","AbstractSegment","findClosestPointOnPath","getBounds","Straight","_super","m2","_recalc","getGradient","getCoordinates","setCoordinates","coords","pointOnPath","absolute","_","pointAlongPathFrom","farAwayPoint","within","closest","_x1","_y1","fractionInSegment","Arc","_calcAngle","_calcAngleForLocation","segment","anticlockwise","sa","startAngle","endAngle","TWO_PI","ea","radius","ac","sweep","circumference","frac","VERY_SMALL_VALUE","gentleRound","ceil","angle","arcSpan","dir","startX","startY","Bezier","cp1x","cp1y","cp2x","cp2y","_translateLocation","_curve","AbstractComponent","AbstractConnector","totalLength","segmentProportions","segmentProportionalLengths","stub","sourceStub","targetStub","gap","sourceGap","targetGap","userProvidedSegments","edited","paintInfo","getPath","findSegmentForPoint","_s","_updateSegmentProportions","_findSegmentForLocation","inSegmentProportion","proportion","_addSegment","updateBounds","_clearSegments","setSegments","_segs","_prepareCompute","swapX","swapY","lw","so","to","oIndex","sx","sy","tx","ty","oProduct","xSpan","ySpan","startStubX","startStubY","endStubX","endStubY","isXGreaterThanStubTimes2","isYGreaterThanStubTimes2","opposite","perpendicular","orthogonal","sourceAxis","anchorOrientation","getSegments","segBounds","dumpSegmentsToConsole","seg","_compute","addSegment","prepareCompute","maxStub","maxGap","AbstractEndpoint","Dot","defaultOffset","defaultInnerRadius","Rectangle","DOMElementEndpoint","displayElements","getDisplayElements","appendDisplayElement","Image","_onload","onload","src","url","img","deleted","widthToUse","heightToUse","setImage","_img","margin","padding","outline","actuallyPaint","Blank","background","Triangle","AbstractOverlay","endpointLoc","endpointLocation","incrementLocation","amount","getLocation","Arrow","_jg","foldback","computeMaxSize","currentConnectionPaintStyle","hxy","mid","tail","cxy","parseInt","fromLoc","__","PlainArrow","Diamond","_getDimensions","forceRefresh","cachedDimensions","getDimensions","AbstractDOMOverlay","div","initialised","create","initiallyInvisible","webkitTransform","mozTransform","msTransform","oTransform","transform","absolutePosition","locToUse","minx","miny","clearCachedDimensions","containerExtents","Custom","GuideLines","head","tailLine","headLine","labelWidth","labelHeight","labelText","labelPadding","font","borderWidth","dStyle","borderStyle","border","update","lt","_getEventManager","_mottle","getEventManager","callback","Flowchart","midpoint","alwaysRespectStubs","userSuppliedSegments","lastx","lasty","lastOrientation","cornerRadius","lx","ly","sgnx","sgny","segLength","_cloneArray","updateMinMax","writeSegments","next","radiusToUse","sgnEqual","isEditable","getOriginalSegments","midx","midy","findClearedLine","mult","dimension","orientations","commonStubCalculator","axis","stubCalculators","pi","areInProximity","lineCalculators","oss","oes","sis","stubs","midLines","linesToEnd","startToEnd","startToMidToEnd","otherStubs","soIdx","toIdx","_so","_to","otherFlipped","stub1","stub2","segmentIndexes","startStub","otherStartStub","endStub","otherEndStub","extent","otherAxis","comparator","toUpperCase","_val","_last","_lastAxis","segs","axisIndex","end","Line","rectIntersect","xInt","yInt","xseg","yseg","_segment","_findControlPoint","proximityLimit","StateMachine","curviness","loopbackRadius","showLoopback","_sx","_sy","_tx","_ty","_midx","_midy","_controlPoint","_w","_h","loopback","majorAnchor","minorAnchor","getCurviness","sourceAnchorPosition","targetAnchorPosition","soo","too","sp","tp","_CP","_CP2","svgAttributeMap","STROKE_DASHARRAY","DASHSTYLE","LINEAR_GRADIENT","RADIAL_GRADIENT","DEFS","FILL","STOP","STROKE","STROKE_WIDTH","STYLE","NONE","JSPLUMB_GRADIENT","LINE_WIDTH","ns","svg","xhtml","_attr","attributes","_node","createElementNS","version","xmlns","_pos","_clearGradient","_updateGradient","uiComponent","gradientUnits","stops","styleToUse","stopColor","applyGradientTo","_applyStyles","forEach","_decodeFont","bits","_appendAtIndex","insertBefore","attr","SvgComponent","pointerEventsSpec","originalArgs","svgParams","useDivWrapper","SegmentRenderer","outlineStyle","outlineStrokeWidth","bgPath","laf","SvgEndpoint","strokeWidth","makeNode","updateNode","AbstractSvgArrowOverlay","superclass","makePath","stroke","fill","p1_1","p1_2","attachListeners","d1","d2","vmlAttributeMap","jsPlumbStylesheet","createStyleSheet","namespaces","ruleClasses","rule","addRule","_atts","atts","deferToJsPlumbContainer","zIndex","_conv","convertValue","_maybeSetOpacity","styleToWrite","styleToCheck","setOpacity","stroked","strokeColor","strokecolor","strokeweight","filled","fillColor","fillcolor","dashstyle","strokeNode","VmlComponent","opacityNodes","initOpacityNodes","opacity","doNotAppendToCanvas","VmlConnector","aa","coordsize","VmlEndpoint","getVml","pathType","makePosString","AbstractVmlArrowOverlay","$","_getElementObject","context","find","droppable","isPlumbedComponent","doNotRemoveHelper","helper","dontAdjustHelper","pageX","pageY","_offset","isDragFilterSupported","jQuery","_data"],"mappings":"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","file":"3338b99391eb7ed445e74b6fcdcd1362.map","sourcesContent":["/**\n* jsBezier-0.6\n*\n* Copyright (c) 2010 - 2013 Simon Porritt (simon.porritt@gmail.com)\n*\n* licensed under the MIT license.\n* \n* a set of Bezier curve functions that deal with Beziers, used by jsPlumb, and perhaps useful for other people.  These functions work with Bezier\n* curves of arbitrary degree.\n*\n* - functions are all in the 'jsBezier' namespace.  \n* \n* - all input points should be in the format {x:.., y:..}. all output points are in this format too.\n* \n* - all input curves should be in the format [ {x:.., y:..}, {x:.., y:..}, {x:.., y:..}, {x:.., y:..} ]\n* \n* - 'location' as used as an input here refers to a decimal in the range 0-1 inclusive, which indicates a point some proportion along the length\n* of the curve.  location as output has the same format and meaning.\n* \n* \n* Function List:\n* --------------\n* \n* distanceFromCurve(point, curve)\n* \n* \tCalculates the distance that the given point lies from the given Bezier.  Note that it is computed relative to the center of the Bezier,\n* so if you have stroked the curve with a wide pen you may wish to take that into account!  The distance returned is relative to the values \n* of the curve and the point - it will most likely be pixels.\n* \n* gradientAtPoint(curve, location)\n* \n* \tCalculates the gradient to the curve at the given location, as a decimal between 0 and 1 inclusive.\n*\n* gradientAtPointAlongCurveFrom (curve, location)\n*\n*\tCalculates the gradient at the point on the given curve that is 'distance' units from location. \n* \n* nearestPointOnCurve(point, curve) \n* \n*\tCalculates the nearest point to the given point on the given curve.  The return value of this is a JS object literal, containing both the\n*point's coordinates and also the 'location' of the point (see above), for example:  { point:{x:551,y:150}, location:0.263365 }.\n* \n* pointOnCurve(curve, location)\n* \n* \tCalculates the coordinates of the point on the given Bezier curve at the given location.  \n* \t\t\n* pointAlongCurveFrom(curve, location, distance)\n* \n* \tCalculates the coordinates of the point on the given curve that is 'distance' units from location.  'distance' should be in the same coordinate\n* space as that used to construct the Bezier curve.  For an HTML Canvas usage, for example, distance would be a measure of pixels.\n*\n* locationAlongCurveFrom(curve, location, distance)\n* \n* \tCalculates the location on the given curve that is 'distance' units from location.  'distance' should be in the same coordinate\n* space as that used to construct the Bezier curve.  For an HTML Canvas usage, for example, distance would be a measure of pixels.\n* \n* perpendicularToCurveAt(curve, location, length, distance)\n* \n* \tCalculates the perpendicular to the given curve at the given location.  length is the length of the line you wish for (it will be centered\n* on the point at 'location'). distance is optional, and allows you to specify a point along the path from the given location as the center of\n* the perpendicular returned.  The return value of this is an array of two points: [ {x:...,y:...}, {x:...,y:...} ].  \n*  \n* \n*/\n\n(function() {\n\t\n\tif(typeof Math.sgn == \"undefined\") {\n\t\tMath.sgn = function(x) { return x == 0 ? 0 : x > 0 ? 1 :-1; };\n\t}\n\t\n\tvar Vectors = {\n\t\t\tsubtract \t: \tfunction(v1, v2) { return {x:v1.x - v2.x, y:v1.y - v2.y }; },\n\t\t\tdotProduct\t: \tfunction(v1, v2) { return (v1.x * v2.x)  + (v1.y * v2.y); },\n\t\t\tsquare\t\t:\tfunction(v) { return Math.sqrt((v.x * v.x) + (v.y * v.y)); },\n\t\t\tscale\t\t:\tfunction(v, s) { return {x:v.x * s, y:v.y * s }; }\n\t\t},\n\t\t\n\t\tmaxRecursion = 64, \n\t\tflatnessTolerance = Math.pow(2.0,-maxRecursion-1);\n\n\t/**\n\t * Calculates the distance that the point lies from the curve.\n\t * \n\t * @param point a point in the form {x:567, y:3342}\n\t * @param curve a Bezier curve in the form [{x:..., y:...}, {x:..., y:...}, {x:..., y:...}, {x:..., y:...}].  note that this is currently\n\t * hardcoded to assume cubiz beziers, but would be better off supporting any degree. \n\t * @return a JS object literal containing location and distance, for example: {location:0.35, distance:10}.  Location is analogous to the location\n\t * argument you pass to the pointOnPath function: it is a ratio of distance travelled along the curve.  Distance is the distance in pixels from\n\t * the point to the curve. \n\t */\n\tvar _distanceFromCurve = function(point, curve) {\n\t\tvar candidates = [],     \n\t    \tw = _convertToBezier(point, curve),\n\t    \tdegree = curve.length - 1, higherDegree = (2 * degree) - 1,\n\t    \tnumSolutions = _findRoots(w, higherDegree, candidates, 0),\n\t\t\tv = Vectors.subtract(point, curve[0]), dist = Vectors.square(v), t = 0.0;\n\n\t    for (var i = 0; i < numSolutions; i++) {\n\t\t\tv = Vectors.subtract(point, _bezier(curve, degree, candidates[i], null, null));\n\t    \tvar newDist = Vectors.square(v);\n\t    \tif (newDist < dist) {\n\t            dist = newDist;\n\t        \tt = candidates[i];\n\t\t    }\n\t    }\n\t    v = Vectors.subtract(point, curve[degree]);\n\t\tnewDist = Vectors.square(v);\n\t    if (newDist < dist) {\n\t        dist = newDist;\n\t    \tt = 1.0;\n\t    }\n\t\treturn {location:t, distance:dist};\n\t};\n\t/**\n\t * finds the nearest point on the curve to the given point.\n\t */\n\tvar _nearestPointOnCurve = function(point, curve) {    \n\t\tvar td = _distanceFromCurve(point, curve);\n\t    return {point:_bezier(curve, curve.length - 1, td.location, null, null), location:td.location};\n\t};\n\tvar _convertToBezier = function(point, curve) {\n\t\tvar degree = curve.length - 1, higherDegree = (2 * degree) - 1,\n\t    \tc = [], d = [], cdTable = [], w = [],\n\t    \tz = [ [1.0, 0.6, 0.3, 0.1], [0.4, 0.6, 0.6, 0.4], [0.1, 0.3, 0.6, 1.0] ];\t\n\t    \t\n\t    for (var i = 0; i <= degree; i++) c[i] = Vectors.subtract(curve[i], point);\n\t    for (var i = 0; i <= degree - 1; i++) { \n\t\t\td[i] = Vectors.subtract(curve[i+1], curve[i]);\n\t\t\td[i] = Vectors.scale(d[i], 3.0);\n\t    }\n\t    for (var row = 0; row <= degree - 1; row++) {\n\t\t\tfor (var column = 0; column <= degree; column++) {\n\t\t\t\tif (!cdTable[row]) cdTable[row] = [];\n\t\t    \tcdTable[row][column] = Vectors.dotProduct(d[row], c[column]);\n\t\t\t}\n\t    }\n\t    for (i = 0; i <= higherDegree; i++) {\n\t\t\tif (!w[i]) w[i] = [];\n\t\t\tw[i].y = 0.0;\n\t\t\tw[i].x = parseFloat(i) / higherDegree;\n\t    }\n\t    var n = degree, m = degree-1;\n\t    for (var k = 0; k <= n + m; k++) {\n\t\t\tvar lb = Math.max(0, k - m),\n\t\t\t\tub = Math.min(k, n);\n\t\t\tfor (i = lb; i <= ub; i++) {\n\t\t    \tj = k - i;\n\t\t    \tw[i+j].y += cdTable[j][i] * z[j][i];\n\t\t\t}\n\t    }\n\t    return w;\n\t};\n\t/**\n\t * counts how many roots there are.\n\t */\n\tvar _findRoots = function(w, degree, t, depth) {  \n\t    var left = [], right = [],\t\n\t    \tleft_count, right_count,\t\n\t    \tleft_t = [], right_t = [];\n\t    \t\n\t    switch (_getCrossingCount(w, degree)) {\n\t       \tcase 0 : {\t\n\t       \t\treturn 0;\t\n\t       \t}\n\t       \tcase 1 : {\t\n\t       \t\tif (depth >= maxRecursion) {\n\t       \t\t\tt[0] = (w[0].x + w[degree].x) / 2.0;\n\t       \t\t\treturn 1;\n\t       \t\t}\n\t       \t\tif (_isFlatEnough(w, degree)) {\n\t       \t\t\tt[0] = _computeXIntercept(w, degree);\n\t       \t\t\treturn 1;\n\t       \t\t}\n\t       \t\tbreak;\n\t       \t}\n\t    }\n\t    _bezier(w, degree, 0.5, left, right);\n\t    left_count  = _findRoots(left,  degree, left_t, depth+1);\n\t    right_count = _findRoots(right, degree, right_t, depth+1);\n\t    for (var i = 0; i < left_count; i++) t[i] = left_t[i];\n\t    for (var i = 0; i < right_count; i++) t[i+left_count] = right_t[i];    \n\t\treturn (left_count+right_count);\n\t};\n\tvar _getCrossingCount = function(curve, degree) {\n\t    var n_crossings = 0, sign, old_sign;\t\t    \t\n\t    sign = old_sign = Math.sgn(curve[0].y);\n\t    for (var i = 1; i <= degree; i++) {\n\t\t\tsign = Math.sgn(curve[i].y);\n\t\t\tif (sign != old_sign) n_crossings++;\n\t\t\told_sign = sign;\n\t    }\n\t    return n_crossings;\n\t};\n\tvar _isFlatEnough = function(curve, degree) {\n\t    var  error,\n\t    \tintercept_1, intercept_2, left_intercept, right_intercept,\n\t    \ta, b, c, det, dInv, a1, b1, c1, a2, b2, c2;\n\t    a = curve[0].y - curve[degree].y;\n\t    b = curve[degree].x - curve[0].x;\n\t    c = curve[0].x * curve[degree].y - curve[degree].x * curve[0].y;\n\t\n\t    var max_distance_above = max_distance_below = 0.0;\n\t    \n\t    for (var i = 1; i < degree; i++) {\n\t        var value = a * curve[i].x + b * curve[i].y + c;       \n\t        if (value > max_distance_above)\n\t            max_distance_above = value;\n\t        else if (value < max_distance_below)\n\t        \tmax_distance_below = value;\n\t    }\n\t    \n\t    a1 = 0.0; b1 = 1.0; c1 = 0.0; a2 = a; b2 = b;\n\t    c2 = c - max_distance_above;\n\t    det = a1 * b2 - a2 * b1;\n\t    dInv = 1.0/det;\n\t    intercept_1 = (b1 * c2 - b2 * c1) * dInv;\n\t    a2 = a; b2 = b; c2 = c - max_distance_below;\n\t    det = a1 * b2 - a2 * b1;\n\t    dInv = 1.0/det;\n\t    intercept_2 = (b1 * c2 - b2 * c1) * dInv;\n\t    left_intercept = Math.min(intercept_1, intercept_2);\n\t    right_intercept = Math.max(intercept_1, intercept_2);\n\t    error = right_intercept - left_intercept;\n\t    return (error < flatnessTolerance)? 1 : 0;\n\t};\n\tvar _computeXIntercept = function(curve, degree) {\n\t    var XLK = 1.0, YLK = 0.0,\n\t    \tXNM = curve[degree].x - curve[0].x, YNM = curve[degree].y - curve[0].y,\n\t    \tXMK = curve[0].x - 0.0, YMK = curve[0].y - 0.0,\n\t    \tdet = XNM*YLK - YNM*XLK, detInv = 1.0/det,\n\t    \tS = (XNM*YMK - YNM*XMK) * detInv; \n\t    return 0.0 + XLK * S;\n\t};\n\tvar _bezier = function(curve, degree, t, left, right) {\n\t    var temp = [[]];\n\t    for (var j =0; j <= degree; j++) temp[0][j] = curve[j];\n\t    for (var i = 1; i <= degree; i++) {\t\n\t\t\tfor (var j =0 ; j <= degree - i; j++) {\n\t\t\t\tif (!temp[i]) temp[i] = [];\n\t\t\t\tif (!temp[i][j]) temp[i][j] = {};\n\t\t    \ttemp[i][j].x = (1.0 - t) * temp[i-1][j].x + t * temp[i-1][j+1].x;\n\t\t    \ttemp[i][j].y = (1.0 - t) * temp[i-1][j].y + t * temp[i-1][j+1].y;\n\t\t\t}\n\t    }    \n\t    if (left != null) \n\t    \tfor (j = 0; j <= degree; j++) left[j]  = temp[j][0];\n\t    if (right != null)\n\t\t\tfor (j = 0; j <= degree; j++) right[j] = temp[degree-j][j];\n\t    \n\t    return (temp[degree][0]);\n\t};\n\t\n\tvar _curveFunctionCache = {};\n\tvar _getCurveFunctions = function(order) {\n\t\tvar fns = _curveFunctionCache[order];\n\t\tif (!fns) {\n\t\t\tfns = [];\t\t\t\n\t\t\tvar f_term = function() { return function(t) { return Math.pow(t, order); }; },\n\t\t\t\tl_term = function() { return function(t) { return Math.pow((1-t), order); }; },\n\t\t\t\tc_term = function(c) { return function(t) { return c; }; },\n\t\t\t\tt_term = function() { return function(t) { return t; }; },\n\t\t\t\tone_minus_t_term = function() { return function(t) { return 1-t; }; },\n\t\t\t\t_termFunc = function(terms) {\n\t\t\t\t\treturn function(t) {\n\t\t\t\t\t\tvar p = 1;\n\t\t\t\t\t\tfor (var i = 0; i < terms.length; i++) p = p * terms[i](t);\n\t\t\t\t\t\treturn p;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\n\t\t\tfns.push(new f_term());  // first is t to the power of the curve order\t\t\n\t\t\tfor (var i = 1; i < order; i++) {\n\t\t\t\tvar terms = [new c_term(order)];\n\t\t\t\tfor (var j = 0 ; j < (order - i); j++) terms.push(new t_term());\n\t\t\t\tfor (var j = 0 ; j < i; j++) terms.push(new one_minus_t_term());\n\t\t\t\tfns.push(new _termFunc(terms));\n\t\t\t}\n\t\t\tfns.push(new l_term());  // last is (1-t) to the power of the curve order\n\t\t\n\t\t\t_curveFunctionCache[order] = fns;\n\t\t}\n\t\t\t\n\t\treturn fns;\n\t};\n\t\n\t\n\t/**\n\t * calculates a point on the curve, for a Bezier of arbitrary order.\n\t * @param curve an array of control points, eg [{x:10,y:20}, {x:50,y:50}, {x:100,y:100}, {x:120,y:100}].  For a cubic bezier this should have four points.\n\t * @param location a decimal indicating the distance along the curve the point should be located at.  this is the distance along the curve as it travels, taking the way it bends into account.  should be a number from 0 to 1, inclusive.\n\t */\n\tvar _pointOnPath = function(curve, location) {\t\t\n\t\tvar cc = _getCurveFunctions(curve.length - 1),\n\t\t\t_x = 0, _y = 0;\n\t\tfor (var i = 0; i < curve.length ; i++) {\n\t\t\t_x = _x + (curve[i].x * cc[i](location));\n\t\t\t_y = _y + (curve[i].y * cc[i](location));\n\t\t}\n\t\t\n\t\treturn {x:_x, y:_y};\n\t};\n\t\n\tvar _dist = function(p1,p2) {\n\t\treturn Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n\t};\n\n\tvar _isPoint = function(curve) {\n\t\treturn curve[0].x == curve[1].x && curve[0].y == curve[1].y;\n\t};\n\t\n\t/**\n\t * finds the point that is 'distance' along the path from 'location'.  this method returns both the x,y location of the point and also\n\t * its 'location' (proportion of travel along the path); the method below - _pointAlongPathFrom - calls this method and just returns the\n\t * point.\n\t */\n\tvar _pointAlongPath = function(curve, location, distance) {\n\n\t\tif (_isPoint(curve)) {\n\t\t\treturn {\n\t\t\t\tpoint:curve[0],\n\t\t\t\tlocation:location\n\t\t\t};\n\t\t}\n\n\t\tvar prev = _pointOnPath(curve, location), \n\t\t\ttally = 0, \n\t\t\tcurLoc = location, \n\t\t\tdirection = distance > 0 ? 1 : -1, \n\t\t\tcur = null;\n\t\t\t\n\t\twhile (tally < Math.abs(distance)) {\n\t\t\tcurLoc += (0.005 * direction);\n\t\t\tcur = _pointOnPath(curve, curLoc);\n\t\t\ttally += _dist(cur, prev);\t\n\t\t\tprev = cur;\n\t\t}\n\t\treturn {point:cur, location:curLoc};        \t\n\t};\n\t\n\tvar _length = function(curve) {\n\t\tif (_isPoint(curve)) return 0;\n\n\t\tvar prev = _pointOnPath(curve, 0),\n\t\t\ttally = 0,\n\t\t\tcurLoc = 0,\n\t\t\tdirection = 1,\n\t\t\tcur = null;\n\t\t\t\n\t\twhile (curLoc < 1) {\n\t\t\tcurLoc += (0.005 * direction);\n\t\t\tcur = _pointOnPath(curve, curLoc);\n\t\t\ttally += _dist(cur, prev);\t\n\t\t\tprev = cur;\n\t\t}\n\t\treturn tally;\n\t};\n\t\n\t/**\n\t * finds the point that is 'distance' along the path from 'location'.  \n\t */\n\tvar _pointAlongPathFrom = function(curve, location, distance) {\n\t\treturn _pointAlongPath(curve, location, distance).point;\n\t};\n\n\t/**\n\t * finds the location that is 'distance' along the path from 'location'.  \n\t */\n\tvar _locationAlongPathFrom = function(curve, location, distance) {\n\t\treturn _pointAlongPath(curve, location, distance).location;\n\t};\n\t\n\t/**\n\t * returns the gradient of the curve at the given location, which is a decimal between 0 and 1 inclusive.\n\t * \n\t * thanks // http://bimixual.org/AnimationLibrary/beziertangents.html\n\t */\n\tvar _gradientAtPoint = function(curve, location) {\n\t\tvar p1 = _pointOnPath(curve, location),\t\n\t\t\tp2 = _pointOnPath(curve.slice(0, curve.length - 1), location),\n\t\t\tdy = p2.y - p1.y, dx = p2.x - p1.x;\n\t\treturn dy == 0 ? Infinity : Math.atan(dy / dx);\t\t\n\t};\n\t\n\t/**\n\treturns the gradient of the curve at the point which is 'distance' from the given location.\n\tif this point is greater than location 1, the gradient at location 1 is returned.\n\tif this point is less than location 0, the gradient at location 0 is returned.\n\t*/\n\tvar _gradientAtPointAlongPathFrom = function(curve, location, distance) {\n\t\tvar p = _pointAlongPath(curve, location, distance);\n\t\tif (p.location > 1) p.location = 1;\n\t\tif (p.location < 0) p.location = 0;\t\t\n\t\treturn _gradientAtPoint(curve, p.location);\t\t\n\t};\n\n\t/**\n\t * calculates a line that is 'length' pixels long, perpendicular to, and centered on, the path at 'distance' pixels from the given location.\n\t * if distance is not supplied, the perpendicular for the given location is computed (ie. we set distance to zero).\n\t */\n\tvar _perpendicularToPathAt = function(curve, location, length, distance) {\n\t\tdistance = distance == null ? 0 : distance;\n\t\tvar p = _pointAlongPath(curve, location, distance),\n\t\t\tm = _gradientAtPoint(curve, p.location),\n\t\t\t_theta2 = Math.atan(-1 / m),\n\t\t\ty =  length / 2 * Math.sin(_theta2),\n\t\t\tx =  length / 2 * Math.cos(_theta2);\n\t\treturn [{x:p.point.x + x, y:p.point.y + y}, {x:p.point.x - x, y:p.point.y - y}];\n\t};\n\t\n\tvar jsBezier = window.jsBezier = {\n\t\tdistanceFromCurve : _distanceFromCurve,\n\t\tgradientAtPoint : _gradientAtPoint,\n\t\tgradientAtPointAlongCurveFrom : _gradientAtPointAlongPathFrom,\n\t\tnearestPointOnCurve : _nearestPointOnCurve,\n\t\tpointOnCurve : _pointOnPath,\t\t\n\t\tpointAlongCurveFrom : _pointAlongPathFrom,\n\t\tperpendicularToCurveAt : _perpendicularToPathAt,\n\t\tlocationAlongCurveFrom:_locationAlongPathFrom,\n\t\tgetLength:_length\n\t};\n})();\n\n/**\n * Biltong v0.2\n *\n * Various geometry functions written as part of jsPlumb and perhaps useful for others.\n *\n * Copyright (c) 2014 Simon Porritt\n *\n * Permission is hereby granted, free of charge, to any person\n * obtaining a copy of this software and associated documentation\n * files (the \"Software\"), to deal in the Software without\n * restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following\n * conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n;(function() {\n\n\t\n\t\"use strict\";\n\n\tvar Biltong = this.Biltong = {};\n\n\tvar _isa = function(a) { return Object.prototype.toString.call(a) === \"[object Array]\"; },\n\t\t_pointHelper = function(p1, p2, fn) {\n\t\t    p1 = _isa(p1) ? p1 : [p1.x, p1.y];\n\t\t    p2 = _isa(p2) ? p2 : [p2.x, p2.y];    \n\t\t    return fn(p1, p2);\n\t\t},\n\t\t/**\n\t\t* @name Biltong.gradient\n\t\t* @function\n\t\t* @desc Calculates the gradient of a line between the two points.\n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Float} The gradient of a line between the two points.\n\t\t*/\n\t\t_gradient = Biltong.gradient = function(p1, p2) {\n\t\t    return _pointHelper(p1, p2, function(_p1, _p2) { \n\t\t        if (_p2[0] == _p1[0])\n\t\t            return _p2[1] > _p1[1] ? Infinity : -Infinity;\n\t\t        else if (_p2[1] == _p1[1]) \n\t\t            return _p2[0] > _p1[0] ? 0 : -0;\n\t\t        else \n\t\t            return (_p2[1] - _p1[1]) / (_p2[0] - _p1[0]); \n\t\t    });\t\t\n\t\t},\n\t\t/**\n\t\t* @name Biltong.normal\n\t\t* @function\n\t\t* @desc Calculates the gradient of a normal to a line between the two points.\n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Float} The gradient of a normal to a line between the two points.\n\t\t*/\n\t\t_normal = Biltong.normal = function(p1, p2) {\n\t\t    return -1 / _gradient(p1, p2);\n\t\t},\n\t\t/**\n\t\t* @name Biltong.lineLength\n\t\t* @function\n\t\t* @desc Calculates the length of a line between the two points.\n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Float} The length of a line between the two points.\n\t\t*/\n\t\t_lineLength = Biltong.lineLength = function(p1, p2) {\n\t\t    return _pointHelper(p1, p2, function(_p1, _p2) {\n\t\t        return Math.sqrt(Math.pow(_p2[1] - _p1[1], 2) + Math.pow(_p2[0] - _p1[0], 2));\t\t\t\n\t\t    });\n\t\t},\n\t\t/**\n\t\t* @name Biltong.quadrant\n\t\t* @function\n\t\t* @desc Calculates the quadrant in which the angle between the two points lies. \n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Integer} The quadrant - 1 for upper right, 2 for lower right, 3 for lower left, 4 for upper left.\n\t\t*/\n\t\t_quadrant = Biltong.quadrant = function(p1, p2) {\n\t\t    return _pointHelper(p1, p2, function(_p1, _p2) {\n\t\t        if (_p2[0] > _p1[0]) {\n\t\t            return (_p2[1] > _p1[1]) ? 2 : 1;\n\t\t        }\n\t\t        else if (_p2[0] == _p1[0]) {\n\t\t            return _p2[1] > _p1[1] ? 2 : 1;    \n\t\t        }\n\t\t        else {\n\t\t            return (_p2[1] > _p1[1]) ? 3 : 4;\n\t\t        }\n\t\t    });\n\t\t},\n\t\t/**\n\t\t* @name Biltong.theta\n\t\t* @function\n\t\t* @desc Calculates the angle between the two points. \n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Float} The angle between the two points.\n\t\t*/\n\t\t_theta = Biltong.theta = function(p1, p2) {\n\t\t    return _pointHelper(p1, p2, function(_p1, _p2) {\n\t\t        var m = _gradient(_p1, _p2),\n\t\t            t = Math.atan(m),\n\t\t            s = _quadrant(_p1, _p2);\n\t\t        if ((s == 4 || s== 3)) t += Math.PI;\n\t\t        if (t < 0) t += (2 * Math.PI);\n\t\t    \n\t\t        return t;\n\t\t    });\n\t\t},\n\t\t/**\n\t\t* @name Biltong.intersects\n\t\t* @function\n\t\t* @desc Calculates whether or not the two rectangles intersect.\n\t\t* @param {Rectangle} r1 First rectangle, as a js object in the form `{x:.., y:.., w:.., h:..}`\n\t\t* @param {Rectangle} r2 Second rectangle, as a js object in the form `{x:.., y:.., w:.., h:..}`\n\t\t* @return {Boolean} True if the rectangles intersect, false otherwise.\n\t\t*/\n\t\t_intersects = Biltong.intersects = function(r1, r2) {\n\t\t    var x1 = r1.x, x2 = r1.x + r1.w, y1 = r1.y, y2 = r1.y + r1.h,\n\t\t        a1 = r2.x, a2 = r2.x + r2.w, b1 = r2.y, b2 = r2.y + r2.h;\n\t\t\n\t\t\treturn  ( (x1 <= a1 && a1 <= x2) && (y1 <= b1 && b1 <= y2) ) ||\n\t\t\t        ( (x1 <= a2 && a2 <= x2) && (y1 <= b1 && b1 <= y2) ) ||\n\t\t\t        ( (x1 <= a1 && a1 <= x2) && (y1 <= b2 && b2 <= y2) ) ||\n\t\t\t        ( (x1 <= a2 && a1 <= x2) && (y1 <= b2 && b2 <= y2) ) ||\t\n\t\t\t        ( (a1 <= x1 && x1 <= a2) && (b1 <= y1 && y1 <= b2) ) ||\n\t\t\t        ( (a1 <= x2 && x2 <= a2) && (b1 <= y1 && y1 <= b2) ) ||\n\t\t\t        ( (a1 <= x1 && x1 <= a2) && (b1 <= y2 && y2 <= b2) ) ||\n\t\t\t        ( (a1 <= x2 && x1 <= a2) && (b1 <= y2 && y2 <= b2) );\n\t\t},\n\t\t/**\n\t\t* @name Biltong.encloses\n\t\t* @function\n\t\t* @desc Calculates whether or not r2 is completely enclosed by r1.\n\t\t* @param {Rectangle} r1 First rectangle, as a js object in the form `{x:.., y:.., w:.., h:..}`\n\t\t* @param {Rectangle} r2 Second rectangle, as a js object in the form `{x:.., y:.., w:.., h:..}`\n\t\t* @param {Boolean} [allowSharedEdges=false] If true, the concept of enclosure allows for one or more edges to be shared by the two rectangles.\n\t\t* @return {Boolean} True if r1 encloses r2, false otherwise.\n\t\t*/\n\t\t_encloses = Biltong.encloses = function(r1, r2, allowSharedEdges) {\n\t\t\tvar x1 = r1.x, x2 = r1.x + r1.w, y1 = r1.y, y2 = r1.y + r1.h,\n\t\t        a1 = r2.x, a2 = r2.x + r2.w, b1 = r2.y, b2 = r2.y + r2.h,\n\t\t\t\tc = function(v1, v2, v3, v4) { return allowSharedEdges ? v1 <= v2 && v3>= v4 : v1 < v2 && v3 > v4; };\n\t\t\t\t\n\t\t\treturn c(x1,a1,x2,a2) && c(y1,b1,y2,b2);\n\t\t},\n\t\t_segmentMultipliers = [null, [1, -1], [1, 1], [-1, 1], [-1, -1] ],\n\t\t_inverseSegmentMultipliers = [null, [-1, -1], [-1, 1], [1, 1], [1, -1] ],\n\t\t/**\n\t\t* @name Biltong.pointOnLine\n\t\t* @function\n\t\t* @desc Calculates a point on the line from `fromPoint` to `toPoint` that is `distance` units along the length of the line.\n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Point} Point on the line, in the form `{ x:..., y:... }`.\n\t\t*/\n\t\t_pointOnLine = Biltong.pointOnLine = function(fromPoint, toPoint, distance) {\n\t\t    var m = _gradient(fromPoint, toPoint),\n\t\t        s = _quadrant(fromPoint, toPoint),\n\t\t        segmentMultiplier = distance > 0 ? _segmentMultipliers[s] : _inverseSegmentMultipliers[s],\n\t\t        theta = Math.atan(m),\n\t\t        y = Math.abs(distance * Math.sin(theta)) * segmentMultiplier[1],\n\t\t        x =  Math.abs(distance * Math.cos(theta)) * segmentMultiplier[0];\n\t\t    return { x:fromPoint.x + x, y:fromPoint.y + y };\n\t\t},\n\t\t/**\n\t\t* @name Biltong.perpendicularLineTo\n\t\t* @function\n\t\t* @desc Calculates a line of length `length` that is perpendicular to the line from `fromPoint` to `toPoint` and passes through `toPoint`.\n\t\t* @param {Point} p1 First point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @param {Point} p2 Second point, either as a 2 entry array or object with `left` and `top` properties.\n\t\t* @return {Line} Perpendicular line, in the form `[ { x:..., y:... }, { x:..., y:... } ]`.\n\t\t*/        \n\t\t_perpendicularLineTo = Biltong.perpendicularLineTo = function(fromPoint, toPoint, length) {\n\t\t    var m = _gradient(fromPoint, toPoint),\n\t\t        theta2 = Math.atan(-1 / m),\n\t\t        y =  length / 2 * Math.sin(theta2),\n\t\t        x =  length / 2 * Math.cos(theta2);\n\t\t    return [{x:toPoint.x + x, y:toPoint.y + y}, {x:toPoint.x - x, y:toPoint.y - y}];\n\t\t};\t\n}).call(this);\n;(function() {\n\n\t\"use strict\";\n\n\tvar Sniff = {\n\t\tandroid:navigator.userAgent.toLowerCase().indexOf(\"android\") > -1\n\t};\n\n\tvar matchesSelector = function(el, selector, ctx) {\n\t\t\tctx = ctx || el.parentNode;\n\t\t\tvar possibles = ctx.querySelectorAll(selector);\n\t\t\tfor (var i = 0; i < possibles.length; i++) {\n\t\t\t\tif (possibles[i] === el) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t_gel = function(el) { return typeof el == \"string\" ? document.getElementById(el) : el; },\n\t\t_t = function(e) { return e.srcElement || e.target; },\n\t\t_d = function(l, fn) {\n\t\t\tfor (var i = 0, j = l.length; i < j; i++) {\n\t\t\t\tif (l[i] == fn) break;\n\t\t\t}\n\t\t\tif (i < l.length) l.splice(i, 1);\n\t\t},\n\t\tguid = 1,\n\t\t//\n\t\t// this function generates a guid for every handler, sets it on the handler, then adds\n\t\t// it to the associated object's map of handlers for the given event. this is what enables us \n\t\t// to unbind all events of some type, or all events (the second of which can be requested by the user, \n\t\t// but it also used by Mottle when an element is removed.)\n\t\t_store = function(obj, event, fn) {\n\t\t\tvar g = guid++;\n\t\t\tobj.__ta = obj.__ta || {};\n\t\t\tobj.__ta[event] = obj.__ta[event] || {};\n\t\t\t// store each handler with a unique guid.\n\t\t\tobj.__ta[event][g] = fn;\n\t\t\t// set the guid on the handler.\n\t\t\tfn.__tauid = g;\n\t\t\treturn g;\n\t\t},\n\t\t_unstore = function(obj, event, fn) {\n\t\t\tobj.__ta && obj.__ta[event] && delete obj.__ta[event][fn.__tauid];\n\t\t\t// a handler might have attached extra functions, so we unbind those too.\n\t\t\tif (fn.__taExtra) {\n\t\t\t\tfor (var i = 0; i < fn.__taExtra.length; i++) {\n\t\t\t\t\t_unbind(obj, fn.__taExtra[i][0], fn.__taExtra[i][1]);\n\t\t\t\t}\n\t\t\t\tfn.__taExtra.length = 0;\n\t\t\t}\n\t\t\t// a handler might have attached an unstore callback\n\t\t\tfn.__taUnstore && fn.__taUnstore();\n\t\t},\n\t\t_curryChildFilter = function(children, obj, fn, evt) {\n\t\t\tif (children == null) return fn;\n\t\t\telse {\n\t\t\t\tvar c = children.split(\",\"),\n\t\t\t\t\t_fn = function(e) {\n\t\t\t\t\t\t_fn.__tauid = fn.__tauid;\n\t\t\t\t\t\tvar t = _t(e);\n\t\t\t\t\t\tfor (var i = 0; i < c.length; i++) {\n\t\t\t\t\t\t\tif (matchesSelector(t, c[i], obj)) {\n\t\t\t\t\t\t\t\tfn.apply(t, arguments);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\tregisterExtraFunction(fn, evt, _fn);\n\t\t\t\treturn _fn;\n\t\t\t}\n\t\t},\n\t\t//\n\t\t// registers an 'extra' function on some event listener function we were given - a function that we\n\t\t// created and bound to the element as part of our housekeeping, and which we want to unbind and remove\n\t\t// whenever the given function is unbound.\n\t\tregisterExtraFunction = function(fn, evt, newFn) {\n\t\t\tfn.__taExtra = fn.__taExtra || [];\n\t\t\tfn.__taExtra.push([evt, newFn]);\n\t\t},\n\t\tDefaultHandler = function(obj, evt, fn, children) {\n\t\t\t// TODO: this was here originally because i wanted to handle devices that are both touch AND mouse. however this can cause certain of the helper\n\t\t\t// functions to be bound twice, as - for example - on a nexus 4, both a mouse event and a touch event are fired.  the use case i had in mind\n\t\t\t// was a device such as an Asus touch pad thing, which has a touch pad but can also be controlled with a mouse.\n\t\t\t//if (isMouseDevice)\n\t\t\t//\t_bind(obj, evt, _curryChildFilter(children, obj, fn, evt), fn);\n\t\t\t\n\t\t\tif (isTouchDevice && touchMap[evt]) {\n\t\t\t\t_bind(obj, touchMap[evt], _curryChildFilter(children, obj, fn, touchMap[evt]), fn);\n\t\t\t}\n\t\t\telse\n\t\t\t\t_bind(obj, evt, _curryChildFilter(children, obj, fn, evt), fn);\n\t\t},\n\t\tSmartClickHandler = function(obj, evt, fn, children) {\n\t\t\tif (obj.__taSmartClicks == null) {\n\t\t\t\tvar down = function(e) { obj.__tad = _pageLocation(e); },\n\t\t\t\t\tup = function(e) { obj.__tau = _pageLocation(e); },\n\t\t\t\t\tclick = function(e) {\n\t\t\t\t\t\tif (obj.__tad && obj.__tau && obj.__tad[0] === obj.__tau[0] && obj.__tad[1] === obj.__tau[1]) {\n\t\t\t\t\t\t\tfor (var i = 0; i < obj.__taSmartClicks.length; i++)\n\t\t\t\t\t\t\t\tobj.__taSmartClicks[i].apply(_t(e), [ e ]);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\tDefaultHandler(obj, \"mousedown\", down, children);\n\t\t\t\tDefaultHandler(obj, \"mouseup\", up, children);\n\t\t\t\tDefaultHandler(obj, \"click\", click, children);\n\t\t\t\tobj.__taSmartClicks = [];\n\t\t\t}\n\t\t\t\n\t\t\t// store in the list of callbacks\n\t\t\tobj.__taSmartClicks.push(fn);\n\t\t\t// the unstore function removes this function from the object's listener list for this type.\n\t\t\tfn.__taUnstore = function() {\n\t\t\t\t_d(obj.__taSmartClicks, fn);\n\t\t\t};\n\t\t},\n\t\t_tapProfiles = {\n\t\t\t\"tap\":{touches:1, taps:1},\n\t\t\t\"dbltap\":{touches:1, taps:2},\n\t\t\t\"contextmenu\":{touches:2, taps:1}\n\t\t},\n\t\tTapHandler = function(clickThreshold, dblClickThreshold) {\n\t\t\treturn function(obj, evt, fn, children) {\n\t\t\t\t// if event is contextmenu, for devices which are mouse only, we want to\n\t\t\t\t// use the default bind. \n\t\t\t\tif (evt == \"contextmenu\" && isMouseDevice)\n\t\t\t\t\tDefaultHandler(obj, evt, fn, children);\n\t\t\t\telse {\n                    // the issue here is that this down handler gets registered only for the\n                    // child nodes in the first registration. in fact it should be registered with\n                    // no child selector and then on down we should cycle through the regustered\n                    // functions to see if one of them matches. on mouseup we should execute ALL of\n                    // the functions whose children are either null or match the element.\n\t\t\t\t\tif (obj.__taTapHandler == null) {\n\t\t\t\t\t\tvar tt = obj.__taTapHandler = {\n\t\t\t\t\t\t\ttap:[],\n\t\t\t\t\t\t\tdbltap:[],\n\t\t\t\t\t\t\tcontextmenu:[],\n\t\t\t\t\t\t\tdown:false,\n\t\t\t\t\t\t\ttaps:0,\n                            downSelectors:[]\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar down = function(e) {\n                                var target = e.srcElement || e.target;\n                                for (var i = 0; i < tt.downSelectors.length; i++) {\n                                    if (tt.downSelectors[i] == null || matchesSelector(target, tt.downSelectors[i], obj)) {\n                                        tt.down = true;\n                                        setTimeout(clearSingle, clickThreshold);\n                                        setTimeout(clearDouble, dblClickThreshold);\n                                        break; // we only need one match on mousedown\n                                    }\n                                }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tup = function(e) {\n\t\t\t\t\t\t\t\tif (tt.down) {\n                                    var target = e.srcElement || e.target;\n\t\t\t\t\t\t\t\t\ttt.taps++;\n\t\t\t\t\t\t\t\t\tvar tc = _touchCount(e);\n\t\t\t\t\t\t\t\t\tfor (var eventId in _tapProfiles) {\n\t\t\t\t\t\t\t\t\t\tvar p = _tapProfiles[eventId];\n\t\t\t\t\t\t\t\t\t\tif (p.touches === tc && (p.taps === 1 || p.taps === tt.taps)) {\n\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < tt[eventId].length; i++) {\n                                                if (tt[eventId][i][1] == null || matchesSelector(target, tt[eventId][i][1], obj))\n\t\t\t\t\t\t\t\t\t\t\t\t    tt[eventId][i][0].apply(_t(e), [ e ]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclearSingle = function() {\n\t\t\t\t\t\t\t\ttt.down = false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclearDouble = function() {\n\t\t\t\t\t\t\t\ttt.taps = 0;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tDefaultHandler(obj, \"mousedown\", down/*, children*/);\n\t\t\t\t\t\tDefaultHandler(obj, \"mouseup\", up/*, children*/);\n\t\t\t\t\t}\n                    // add this child selector (it can be null, that's fine).\n                    obj.__taTapHandler.downSelectors.push(children);\n\n\t\t\t\t\tobj.__taTapHandler[evt].push([fn, children]);\n\t\t\t\t\t// the unstore function removes this function from the object's listener list for this type.\n\t\t\t\t\tfn.__taUnstore = function() {\n\t\t\t\t\t\t_d(obj.__taTapHandler[evt], fn);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tmeeHelper = function(type, evt, obj, target) {\n\t\t\tfor (var i in obj.__tamee[type]) {\n\t\t\t\tobj.__tamee[type][i].apply(target, [ evt ]);\n\t\t\t}\n\t\t},\n\t\tMouseEnterExitHandler = function() {\n\t\t\tvar activeElements = [];\n\t\t\treturn function(obj, evt, fn, children) {\n\t\t\t\tif (!obj.__tamee) {\n\t\t\t\t\t// __tamee holds a flag saying whether the mouse is currently \"in\" the element, and a list of\n\t\t\t\t\t// both mouseenter and mouseexit functions.\n\t\t\t\t\tobj.__tamee = { over:false, mouseenter:[], mouseexit:[] };\n\t\t\t\t\t// register over and out functions\n\t\t\t\t\tvar over = function(e) {\n\t\t\t\t\t\t\tvar t = _t(e);\n\t\t\t\t\t\t\tif ( (children== null && (t == obj && !obj.__tamee.over)) || (matchesSelector(t, children, obj) && (t.__tamee == null || !t.__tamee.over)) ) {\n\t\t\t\t\t\t\t\tmeeHelper(\"mouseenter\", e, obj, t);\n\t\t\t\t\t\t\t\tt.__tamee = t.__tamee || {};\n\t\t\t\t\t\t\t\tt.__tamee.over = true;\n\t\t\t\t\t\t\t\tactiveElements.push(t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tout = function(e) {\n\t\t\t\t\t\t\tvar t = _t(e);\n\t\t\t\t\t\t\t// is the current target one of the activeElements? and is the \n\t\t\t\t\t\t\t// related target NOT a descendant of it?\n\t\t\t\t\t\t\tfor (var i = 0; i < activeElements.length; i++) {\n\t\t\t\t\t\t\t\tif (t == activeElements[i] && !matchesSelector((e.relatedTarget || e.toElement), \"*\", t)) {\n\t\t\t\t\t\t\t\t\tt.__tamee.over = false;\n\t\t\t\t\t\t\t\t\tactiveElements.splice(i, 1);\n\t\t\t\t\t\t\t\t\tmeeHelper(\"mouseexit\", e, obj, t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t_bind(obj, \"mouseover\", _curryChildFilter(children, obj, over, \"mouseover\"), over);\n\t\t\t\t\t_bind(obj, \"mouseout\", _curryChildFilter(children, obj, out, \"mouseout\"), out);\n\t\t\t\t}\n\n\t\t\t\tfn.__taUnstore = function() {\n\t\t\t\t\tdelete obj.__tamee[evt][fn.__tauid];\n\t\t\t\t};\n\n\t\t\t\t_store(obj, evt, fn);\n\t\t\t\tobj.__tamee[evt][fn.__tauid] = fn;\n\t\t\t};\n\t\t},\n\t\tisTouchDevice = \"ontouchstart\" in document.documentElement,\n\t\tisMouseDevice = \"onmousedown\" in document.documentElement,\n\t\ttouchMap = { \"mousedown\":\"touchstart\", \"mouseup\":\"touchend\", \"mousemove\":\"touchmove\" },\n\t\ttouchstart=\"touchstart\",touchend=\"touchend\",touchmove=\"touchmove\",\n\t\tta_down = \"__MottleDown\", ta_up = \"__MottleUp\", \n\t\tta_context_down = \"__MottleContextDown\", ta_context_up = \"__MottleContextUp\",\n\t\tiev = (function() {\n\t\t\tvar rv = -1; \n\t\t\tif (navigator.appName == 'Microsoft Internet Explorer') {\n\t\t\t\tvar ua = navigator.userAgent,\n\t\t\t\t\tre = new RegExp(\"MSIE ([0-9]{1,}[\\.0-9]{0,})\");\n\t\t\t\tif (re.exec(ua) != null)\n\t\t\t\t\trv = parseFloat(RegExp.$1);\n\t\t\t}\n\t\t\treturn rv;\n\t\t})(),\n\t\tisIELT9 = iev > -1 && iev < 9, \n\t\t_genLoc = function(e, prefix) {\n\t\t\tif (e == null) return [ 0, 0 ];\n\t\t\tvar ts = _touches(e), t = _getTouch(ts, 0);\n\t\t\treturn [t[prefix + \"X\"], t[prefix + \"Y\"]];\n\t\t},\n\t\t_pageLocation = function(e) {\n\t\t\tif (e == null) return [ 0, 0 ];\n\t\t\tif (isIELT9) {\n\t\t\t\treturn [ e.clientX + document.documentElement.scrollLeft, e.clientY + document.documentElement.scrollTop ];\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _genLoc(e, \"page\");\n\t\t\t}\n\t\t},\n\t\t_screenLocation = function(e) {\n\t\t\treturn _genLoc(e, \"screen\");\n\t\t},\n\t\t_clientLocation = function(e) {\n\t\t\treturn _genLoc(e, \"client\");\n\t\t},\n\t\t_getTouch = function(touches, idx) { return touches.item ? touches.item(idx) : touches[idx]; },\n\t\t_touches = function(e) {\n\t\t\treturn e.touches && e.touches.length > 0 ? e.touches : \n\t\t\t\t   e.changedTouches && e.changedTouches.length > 0 ? e.changedTouches :\n\t\t\t\t   e.targetTouches && e.targetTouches.length > 0 ? e.targetTouches :\n\t\t\t\t   [ e ];\n\t\t},\n\t\t_touchCount = function(e) { return _touches(e).length; },\n\t\t//http://www.quirksmode.org/blog/archives/2005/10/_and_the_winner_1.html\n\t\t_bind = function( obj, type, fn, originalFn) {\n\t\t\t_store(obj, type, fn);\n\t\t\toriginalFn.__tauid = fn.__tauid;\n\t\t\tif (obj.addEventListener)\n\t\t\t\tobj.addEventListener( type, fn, false );\n\t\t\telse if (obj.attachEvent) {\n\t\t\t\tvar key = type + fn.__tauid;\n\t\t\t\tobj[\"e\" + key] = fn;\n\t\t\t\t// TODO look at replacing with .call(..)\n\t\t\t\tobj[key] = function() { \n\t\t\t\t\tobj[\"e\"+key] && obj[\"e\"+key]( window.event ); \n\t\t\t\t};\n\t\t\t\tobj.attachEvent( \"on\"+type, obj[key] );\n\t\t\t}\n\t\t},\n\t\t_unbind = function( obj, type, fn) {\n\t\t\tif (fn == null) return;\n\t\t\t_each(obj, function() {\n\t\t\t\tvar _el = _gel(this);\n\t\t\t\t_unstore(_el, type, fn);\n\t\t\t\t// it has been bound if there is a tauid. otherwise it was not bound and we can ignore it.\n\t\t\t\tif (fn.__tauid != null) {\n\t\t\t\t\tif (_el.removeEventListener)\n\t\t\t\t\t\t_el.removeEventListener( type, fn, false );\n\t\t\t\t\telse if (this.detachEvent) {\n\t\t\t\t\t\tvar key = type + fn.__tauid;\n\t\t\t\t\t\t_el[key] && _el.detachEvent( \"on\"+type, _el[key] );\n\t\t\t\t\t\t_el[key] = null;\n\t\t\t\t\t\t_el[\"e\"+key] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t_devNull = function() {},\n\t\t_each = function(obj, fn) {\n\t\t\tif (obj == null) return;\n\t\t\t// if a list (or list-like), use it. if a string, get a list \n\t\t\t// by running the string through querySelectorAll. else, assume \n\t\t\t// it's an Element.\n\t\t\tobj = (typeof obj !== \"string\") && (obj.tagName == null && obj.length != null) ? obj : typeof obj === \"string\" ? document.querySelectorAll(obj) : [ obj ];\n\t\t\tfor (var i = 0; i < obj.length; i++)\n\t\t\t\tfn.apply(obj[i]);\n\t\t};\n\n\t/**\n\t* Event handler.  Offers support for abstracting out the differences\n\t* between touch and mouse devices, plus \"smart click\" functionality\n\t* (don't fire click if the mouse has moved betweeb mousedown and mouseup),\n\t* and synthesized click/tap events.\n\t* @class Mottle\n\t* @constructor\n\t* @param {Object} params Constructor params\n\t* @param {Integer} [params.clickThreshold=150] Threshold, in milliseconds beyond which a touchstart followed by a touchend is not considered to be a click.\n\t* @param {Integer} [params.dblClickThreshold=350] Threshold, in milliseconds beyond which two successive tap events are not considered to be a click.\n\t* @param {Boolean} [params.smartClicks=false] If true, won't fire click events if the mouse has moved between mousedown and mouseup. Note that this functionality\n\t* requires that Mottle consume the mousedown event, and so may not be viable in all use cases.\n\t*/\n\tthis.Mottle = function(params) {\n\t\tparams = params || {};\n\t\tvar self = this, \n\t\t\tclickThreshold = params.clickThreshold || 150,\n\t\t\tdblClickThreshold = params.dblClickThreshold || 350,\n\t\t\tmouseEnterExitHandler = new MouseEnterExitHandler(),\n\t\t\ttapHandler = new TapHandler(clickThreshold, dblClickThreshold),\n\t\t\t_smartClicks = params.smartClicks,\n\t\t\t_doBind = function(obj, evt, fn, children) {\n\t\t\t\tif (fn == null) return;\n\t\t\t\t_each(obj, function() {\n\t\t\t\t\tvar _el = _gel(this);\n\t\t\t\t\tif (_smartClicks && evt === \"click\")\n\t\t\t\t\t\tSmartClickHandler(_el, evt, fn, children);\n\t\t\t\t\telse if (evt === \"tap\" || evt === \"dbltap\" || evt === \"contextmenu\") {\n\t\t\t\t\t\ttapHandler(_el, evt, fn, children);\n\t\t\t\t\t}\n\t\t\t\t\telse if (evt === \"mouseenter\" || evt == \"mouseexit\")\n\t\t\t\t\t\tmouseEnterExitHandler(_el, evt, fn, children);\n\t\t\t\t\telse \n\t\t\t\t\t\tDefaultHandler(_el, evt, fn, children);\n\t\t\t\t});\n\t\t\t};\n\n\t\t/**\n\t\t* Removes an element from the DOM, and unregisters all event handlers for it. You should use this\n\t\t* to ensure you don't leak memory.\n\t\t* @method remove\n\t\t* @param {String|Element} el Element, or id of the element, to remove.\n\t\t* @return {Mottle} The current Mottle instance; you can chain this method.\n\t\t*/\n\t\tthis.remove = function(el) {\n\t\t\t_each(el, function() {\n\t\t\t\tvar _el = _gel(this);\n\t\t\t\tif (_el.__ta) {\n\t\t\t\t\tfor (var evt in _el.__ta) {\n\t\t\t\t\t\tfor (var h in _el.__ta[evt]) {\n\t\t\t\t\t\t\t_unbind(_el, evt, _el.__ta[evt][h]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_el.parentNode && _el.parentNode.removeChild(_el);\n\t\t\t});\n\t\t\treturn this;\n\t\t};\n\n\t\t/**\n\t\t* Register an event handler, optionally as a delegate for some set of descendant elements. Note\n\t\t* that this method takes either 3 or 4 arguments - if you supply 3 arguments it is assumed you have \n\t\t* omitted the `children` parameter, and that the event handler should be bound directly to the given element.\n\t\t* @method on\n\t\t* @param {Element[]|Element|String} el Either an Element, or a CSS spec for a list of elements, or an array of Elements.\n\t\t* @param {String} [children] Comma-delimited list of selectors identifying allowed children.\n\t\t* @param {String} event Event ID.\n\t\t* @param {Function} fn Event handler function.\n\t\t* @return {Mottle} The current Mottle instance; you can chain this method.\n\t\t*/\n\t\tthis.on = function(el, event, children, fn) {\n\t\t\tvar _el = arguments[0],\n\t\t\t\t_c = arguments.length == 4 ? arguments[2] : null,\n\t\t\t\t_e = arguments[1],\n\t\t\t\t_f = arguments[arguments.length - 1];\n\n\t\t\t_doBind(_el, _e, _f, _c);\n\t\t\treturn this;\n\t\t};\t\n\n\t\t/**\n\t\t* Cancel delegate event handling for the given function. Note that unlike with 'on' you do not supply\n\t\t* a list of child selectors here: it removes event delegation from all of the child selectors for which the\n\t\t* given function was registered (if any).\n\t\t* @method off\n\t\t* @param {Element[]|Element|String} el Element - or ID of element - from which to remove event listener.\n\t\t* @param {String} event Event ID.\n\t\t* @param {Function} fn Event handler function.\n\t\t* @return {Mottle} The current Mottle instance; you can chain this method.\n\t\t*/\n\t\tthis.off = function(el, evt, fn) {\n\t\t\t_unbind(el, evt, fn);\n\t\t\treturn this;\n\t\t};\n\n\t\t/**\n\t\t* Triggers some event for a given element.\n\t\t* @method trigger\n\t\t* @param {Element} el Element for which to trigger the event.\n\t\t* @param {String} event Event ID.\n\t\t* @param {Event} originalEvent The original event. Should be optional of course, but currently is not, due\n\t\t* to the jsPlumb use case that caused this method to be added.\n\t\t* @param {Object} [payload] Optional object to set as `payload` on the generated event; useful for message passing.\n\t\t* @return {Mottle} The current Mottle instance; you can chain this method.\n\t\t*/\n\t\tthis.trigger = function(el, event, originalEvent, payload) {\n\t\t\tvar eventToBind = (isTouchDevice && touchMap[event]) ? touchMap[event] : event;\n\t\t\tvar pl = _pageLocation(originalEvent), sl = _screenLocation(originalEvent), cl = _clientLocation(originalEvent);\n\t\t\t_each(el, function() {\n\t\t\t\tvar _el = _gel(this), evt;\n\t\t\t\toriginalEvent = originalEvent || {\n\t\t\t\t\tscreenX:sl[0],\n\t\t\t\t\tscreenY:sl[1],\n\t\t\t\t\tclientX:cl[0],\n\t\t\t\t\tclientY:cl[1]\n\t\t\t\t};\n\n\t\t\t\tvar _decorate = function(_evt) {\n\t\t\t\t\tif (payload) _evt.payload = payload;\n\t\t\t\t};\n\n\t\t\t\tvar eventGenerators = {\n\t\t\t\t\t\"TouchEvent\":function(evt) {\n\t\t\t\t\t\tvar t = document.createTouch(window, _el, 0, pl[0], pl[1], \n\t\t\t\t\t\t\t\t\tsl[0], sl[1],\n\t\t\t\t\t\t\t\t\tcl[0], cl[1],\n\t\t\t\t\t\t\t\t\t0,0,0,0);\n\n\t\t\t\t\t\tevt.initTouchEvent(eventToBind, true, true, window, 0, \n\t\t\t\t\t\t\tsl[0], sl[1],\n\t\t\t\t\t\t\tcl[0], cl[1],\n\t\t\t\t\t\t\tfalse, false, false, false, document.createTouchList(t));\n\t\t\t\t\t},\n\t\t\t\t\t\"MouseEvents\":function(evt) {\n\t\t\t\t\t\tevt.initMouseEvent(eventToBind, true, true, window, 0,\n\t\t\t\t\t\t\tsl[0], sl[1],\n\t\t\t\t\t\t\tcl[0], cl[1],\n\t\t\t\t\t\t\tfalse, false, false, false, 1, _el);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (Sniff.android) {\n\t\t\t\t\t\t\t// Android's touch events are not standard.\n\t\t\t\t\t\t\tvar t = document.createTouch(window, _el, 0, pl[0], pl[1], \n\t\t\t\t\t\t\t\t\t\tsl[0], sl[1],\n\t\t\t\t\t\t\t\t\t\tcl[0], cl[1],\n\t\t\t\t\t\t\t\t\t\t0,0,0,0);\n\n\t\t\t\t\t\t\tevt.touches = evt.targetTouches = evt.changedTouches = document.createTouchList(t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (document.createEvent) {\n\t\t\t\t\tvar ite = (isTouchDevice && touchMap[event] && !Sniff.android), evtName = ite ? \"TouchEvent\" : \"MouseEvents\";\n\t\t\t\t\tevt = document.createEvent(evtName);\n\t\t\t\t\teventGenerators[evtName](evt);\n\t\t\t\t\t_decorate(evt);\n\t\t\t\t\t_el.dispatchEvent(evt);\n\t\t\t\t}\n\t\t\t\telse if (document.createEventObject) {\n\t\t\t\t\tevt = document.createEventObject();\n\t\t\t\t\tevt.eventType = evt.eventName = eventToBind;\n\t\t\t\t\tevt.screenX = sl[0];\n\t\t\t\t\tevt.screenY = sl[1];\n\t\t\t\t\tevt.clientX = cl[0];\n\t\t\t\t\tevt.clientY = cl[1];\n\t\t\t\t\t_decorate(evt);\n\t\t\t\t\t_el.fireEvent('on' + eventToBind, evt);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/**\n\t* Static method to assist in 'consuming' an element: uses `stopPropagation` where available, or sets `e.returnValue=false` where it is not.\n\t* @method Mottle.consume\n\t* @param {Event} e Event to consume\n\t* @param {Boolean} [doNotPreventDefault=false] If true, does not call `preventDefault()` on the event.\n\t*/\n\tMottle.consume = function(e, doNotPreventDefault) {\n\t\tif (e.stopPropagation)\n\t\t\te.stopPropagation();\n\t\telse \n\t\t\te.returnValue = false;\n\n\t\tif (!doNotPreventDefault && e.preventDefault)\n\t\t\t e.preventDefault();\n\t};\n\n\t/**\n\t* Gets the page location corresponding to the given event. For touch events this means get the page location of the first touch.\n\t* @method Mottle.pageLocation\n\t* @param {Event} e Event to get page location for.\n\t* @return {Integer[]} [left, top] for the given event.\n\t*/\n\tMottle.pageLocation = _pageLocation;\n\n}).call(this);\n\n/*\n * jsPlumb\n *\n * Title:jsPlumb 1.7.2\n *\n * Provides a way to visually connect elements on an HTML page, using SVG or VML.\n *\n * This file contains utility functions that run in both browsers and headless.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n *\n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n *\n * Dual licensed under the MIT and GPL2 licenses.\n */\n\n;(function() {\n\n  var _isa = function(a) { return Object.prototype.toString.call(a) === \"[object Array]\"; },\n      _isnum = function(n) { return Object.prototype.toString.call(n) === \"[object Number]\"; },\n      _iss = function(s) { return typeof s === \"string\"; },\n      _isb = function(s) { return typeof s === \"boolean\"; },\n      _isnull = function(s) { return s == null; },\n      _iso = function(o) { return o == null ? false : Object.prototype.toString.call(o) === \"[object Object]\"; },\n      _isd = function(o) { return Object.prototype.toString.call(o) === \"[object Date]\"; },\n      _isf = function(o) { return Object.prototype.toString.call(o) === \"[object Function]\"; },\n      _ise = function(o) {\n          for (var i in o) { if (o.hasOwnProperty(i)) return false; }\n          return true;\n      },\n      pointHelper = function(p1, p2, fn) {\n          p1 = _isa(p1) ? p1 : [p1.x, p1.y];\n          p2 = _isa(p2) ? p2 : [p2.x, p2.y];\n          return fn(p1, p2);\n      };\n\n  var root = this;\n  var exports = root.jsPlumbUtil = {\n        isArray : _isa,\n        isString : _iss,\n        isBoolean: _isb,\n        isNull : _isnull,\n        isObject : _iso,\n        isDate : _isd,\n        isFunction: _isf,\n        isEmpty:_ise,\n        isNumber:_isnum,\n        clone : function(a) {\n            if (_iss(a)) return \"\" + a;\n            else if (_isb(a)) return !!a;\n            else if (_isd(a)) return new Date(a.getTime());\n            else if (_isf(a)) return a;\n            else if (_isa(a)) {\n                var b = [];\n                for (var i = 0; i < a.length; i++)\n                    b.push(this.clone(a[i]));\n                return b;\n            }\n            else if (_iso(a)) {\n                var c = {};\n                for (var j in a)\n                    c[j] = this.clone(a[j]);\n                return c;\n            }\n            else return a;\n        },\n        merge : function(a, b, collations) {\n            // first change the collations array - if present - into a lookup table, because its faster.\n            var cMap = {}, ar, i;\n            collations = collations || [];\n            for (i = 0; i < collations.length; i++)\n                cMap[collations[i]] = true;\n\n            var c = this.clone(a);\n            for (i in b) {\n                if (c[i] == null)\n                    c[i] = b[i];\n                else if (_iss(b[i]) || _isb(b[i])) {\n                    if (!cMap[i]) c[i] = b[i]; // if we dont want to collate, just copy it in.\n                    else {\n                        ar = [];\n                        // if c's object is also an array we can keep its values.\n                        ar.push.apply(ar, _isa(c[i]) ? c[i] :  [ c[i] ] );\n                        ar.push.apply(ar, _isa(b[i]) ? b[i] :  [ b[i] ] );\n                        c[i] = ar;\n                    }\n                }\n                else {\n                    if (_isa(b[i])) {\n                        ar = [];\n                        // if c's object is also an array we can keep its values.\n                        if (_isa(c[i])) ar.push.apply(ar, c[i]);\n                        ar.push.apply(ar, b[i]);\n                        c[i] = ar;\n                    }\n                    else if(_iso(b[i])) {\n                        // overwite c's value with an object if it is not already one.\n                        if (!_iso(c[i]))\n                            c[i] = {};\n                        for (var j in b[i])\n                            c[i][j] = b[i][j];\n                    }\n                }\n            }\n            return c;\n        },\n        replace:function(inObj, path, value) {\n            if (inObj == null) return;\n            var q = inObj, t = q;\n            path.replace(/([^\\.])+/g, function(term, lc, pos, str) {\n                var array = term.match(/([^\\[0-9]+){1}(\\[)([0-9+])/),\n                    last = pos + term.length >= str.length,\n                    _getArray = function() {\n                        return t[array[1]] || (function() {  t[array[1]] = []; return t[array[1]]; })();\n                    };\n\n                if (last) {\n                    // set term = value on current t, creating term as array if necessary.\n                    if (array)\n                        _getArray()[array[3]] = value;\n                    else\n                        t[term] = value;\n                }\n                else {\n                    // set to current t[term], creating t[term] if necessary.\n                    if (array) {\n                        var a = _getArray();\n                        t = a[array[3]] || (function() { a[array[3]] = {}; return a[array[3]]; })();\n                    }\n                    else\n                        t = t[term] || (function() { t[term] = {}; return t[term]; })();\n                }\n            });\n\n            return inObj;\n        },\n        //\n        // chain a list of functions, supplied by [ object, method name, args ], and return on the first\n        // one that returns the failValue. if none return the failValue, return the successValue.\n        //\n        functionChain : function(successValue, failValue, fns) {\n            for (var i = 0; i < fns.length; i++) {\n                var o = fns[i][0][fns[i][1]].apply(fns[i][0], fns[i][2]);\n                if (o === failValue) {\n                    return o;\n                }\n            }\n            return successValue;\n        },\n        // take the given model and expand out any parameters.\n        populate : function(model, values) {\n            // for a string, see if it has parameter matches, and if so, try to make the substitutions.\n            var getValue = function(fromString) {\n                    var matches = fromString.match(/(\\${.*?})/g);\n                    if (matches != null) {\n                        for (var i = 0; i < matches.length; i++) {\n                            var val = values[matches[i].substring(2, matches[i].length - 1)] || \"\";\n                            if (val != null) {\n                                fromString = fromString.replace(matches[i], val);\n                            }\n                        }\n                    }\n                    return fromString;\n                },\n                // process one entry.\n                _one = function(d) {\n                    if (d != null) {\n                        if (_iss(d)) {\n                            return getValue(d);\n                        }\n                        else if (_isa(d)) {\n                            var r = [];\n                            for (var i = 0; i < d.length; i++)\n                                r.push(_one(d[i]));\n                            return r;\n                        }\n                        else if (_iso(d)) {\n                            var s = {};\n                            for (var j in d) {\n                                s[j] = _one(d[j]);\n                            }\n                            return s;\n                        }\n                        else {\n                            return d;\n                        }\n                    }\n                };\n\n            return _one(model);\n        },\n        convertStyle : function(s, ignoreAlpha) {\n            // TODO: jsPlumb should support a separate 'opacity' style member.\n            if (\"transparent\" === s) return s;\n            var o = s,\n                pad = function(n) { return n.length == 1 ? \"0\" + n : n; },\n                hex = function(k) { return pad(Number(k).toString(16)); },\n                pattern = /(rgb[a]?\\()(.*)(\\))/;\n            if (s.match(pattern)) {\n                var parts = s.match(pattern)[2].split(\",\");\n                o = \"#\" + hex(parts[0]) + hex(parts[1]) + hex(parts[2]);\n                if (!ignoreAlpha && parts.length == 4)\n                    o = o + hex(parts[3]);\n            }\n            return o;\n        },\n        findWithFunction : function(a, f) {\n            if (a)\n                for (var i = 0; i < a.length; i++) if (f(a[i])) return i;\n            return -1;\n          },\n\t\tindexOf : function(l, v) {\n\t\t\treturn l.indexOf ? l.indexOf(v) : exports.findWithFunction(l, function(_v) { return _v == v; });\n\t\t},\n\t\tremoveWithFunction : function(a, f) {\n\t\t\tvar idx = exports.findWithFunction(a, f);\n\t\t\tif (idx > -1) a.splice(idx, 1);\n\t\t\treturn idx != -1;\n\t\t},\n\t\tremove : function(l, v) {\n\t\t\tvar idx = exports.indexOf(l, v);\n\t\t\tif (idx > -1) l.splice(idx, 1);\n\t\t\treturn idx != -1;\n\t\t},\n        // TODO support insert index\n        addWithFunction : function(list, item, hashFunction) {\n            if (exports.findWithFunction(list, hashFunction) == -1) list.push(item);\n        },\n        addToList : function(map, key, value, insertAtStart) {\n            var l = map[key];\n            if (l == null) {\n                l = [];\n\t\t\t\t        map[key] = l;\n            }\n            l[insertAtStart ? \"unshift\" : \"push\"](value);\n            return l;\n        },\n        //\n        // extends the given obj (which can be an array) with the given constructor function, prototype functions, and\n        // class members, any of which may be null.\n        //\n        extend : function(child, parent, _protoFn) {\n\t\t\t       var i;\n            parent = _isa(parent) ? parent : [ parent ];\n\n            for (i = 0; i < parent.length; i++) {\n                for (var j in parent[i].prototype) {\n                    if(parent[i].prototype.hasOwnProperty(j)) {\n                        child.prototype[j] = parent[i].prototype[j];\n                    }\n                }\n            }\n\n            var _makeFn = function(name, protoFn) {\n                return function() {\n                    for (i = 0; i < parent.length; i++) {\n                        if (parent[i].prototype[name])\n                            parent[i].prototype[name].apply(this, arguments);\n                    }\n                    return protoFn.apply(this, arguments);\n                };\n            };\n\n\t\t\tvar _oneSet = function(fns) {\n\t\t\t\tfor (var k in fns) {\n\t\t\t\t\tchild.prototype[k] = _makeFn(k, fns[k]);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (arguments.length > 2) {\n\t\t\t\tfor (i = 2; i < arguments.length; i++)\n\t\t\t\t\t_oneSet(arguments[i]);\n\t\t\t}\n\n            return child;\n        },\n        uuid : function() {\n            return ('xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n                return v.toString(16);\n            }));\n        },\n        logEnabled : true,\n        log : function() {\n            if (exports.logEnabled && typeof console != \"undefined\") {\n                try {\n                    var msg = arguments[arguments.length - 1];\n                    console.log(msg);\n                }\n                catch (e) {}\n            }\n        },\n\n        /**\n        * Wraps one function with another, creating a placeholder for the\n        * wrapped function if it was null. this is used to wrap the various\n        * drag/drop event functions - to allow jsPlumb to be notified of\n        * important lifecycle events without imposing itself on the user's\n        * drag/drop functionality.\n        * @method jsPlumbUtil.wrap\n        * @param {Function} wrappedFunction original function to wrap; may be null.\n        * @param {Function} newFunction function to wrap the original with.\n        * @param {Object} [returnOnThisValue] Optional. Indicates that the wrappedFunction should\n        * not be executed if the newFunction returns a value matching 'returnOnThisValue'.\n        * note that this is a simple comparison and only works for primitives right now.\n        */\n        wrap : function(wrappedFunction, newFunction, returnOnThisValue) {\n            wrappedFunction = wrappedFunction || function() { };\n            newFunction = newFunction || function() { };\n            return function() {\n                var r = null;\n                try {\n                    r = newFunction.apply(this, arguments);\n                } catch (e) {\n                    exports.log(\"jsPlumb function failed : \" + e);\n                }\n                if (returnOnThisValue == null || (r !== returnOnThisValue)) {\n                    try {\n                        r = wrappedFunction.apply(this, arguments);\n                    } catch (e) {\n                        exports.log(\"wrapped function failed : \" + e);\n                    }\n                }\n                return r;\n            };\n        }\n    };\n\n  exports.EventGenerator = function() {\n\t\tvar _listeners = {},\n\t\t\teventsSuspended = false,\n\t\t\t// this is a list of events that should re-throw any errors that occur during their dispatch. it is current private.\n\t\t\teventsToDieOn = { \"ready\":true };\n\n\t\tthis.bind = function(event, listener, insertAtStart) {\n\t\t\texports.addToList(_listeners, event, listener, insertAtStart);\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.fire = function(event, value, originalEvent) {\n\t\t\tif (!eventsSuspended && _listeners[event]) {\n\t\t\t\tvar l = _listeners[event].length, i = 0, _gone = false, ret = null;\n\t\t\t\tif (!this.shouldFireEvent || this.shouldFireEvent(event, value, originalEvent)) {\n\t\t\t\t\twhile (!_gone && i < l && ret !== false) {\n\t\t\t\t\t\t// doing it this way rather than catching and then possibly re-throwing means that an error propagated by this\n\t\t\t\t\t\t// method will have the whole call stack available in the debugger.\n\t\t\t\t\t\tif (eventsToDieOn[event])\n\t\t\t\t\t\t\t_listeners[event][i].apply(this, [ value, originalEvent]);\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tret = _listeners[event][i].apply(this, [ value, originalEvent ]);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\texports.log(\"jsPlumb: fire failed for event \" + event + \" : \" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (_listeners == null || _listeners[event] == null)\n\t\t\t\t\t\t\t_gone = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.unbind = function(event) {\n\t\t\tif (event)\n\t\t\t\tdelete _listeners[event];\n\t\t\telse {\n\t\t\t\t_listeners = {};\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.getListener = function(forEvent) { return _listeners[forEvent]; };\n\t\tthis.setSuspendEvents = function(val) { eventsSuspended = val; };\n\t\tthis.isSuspendEvents = function() { return eventsSuspended; };\n\t\tthis.cleanupListeners = function() {\n\t\t\tfor (var i in _listeners) {\n\t\t\t\t_listeners[i] = null;\n\t\t\t}\n\t\t};\n\t};\n\n\texports.EventGenerator.prototype = {\n\t\tcleanup:function() {\n\t\t\tthis.cleanupListeners();\n\t\t}\n\t};\n\n    // thanks MDC\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FFunction%2Fbind\n    if (!Function.prototype.bind) {\n      Function.prototype.bind = function (oThis) {\n        if (typeof this !== \"function\") {\n          // closest thing possible to the ECMAScript 5 internal IsCallable function\n          throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n        }\n\n        var aArgs = Array.prototype.slice.call(arguments, 1),\n            fToBind = this,\n            fNOP = function () {},\n            fBound = function () {\n              return fToBind.apply(this instanceof fNOP && oThis ? this : oThis,\n                                   aArgs.concat(Array.prototype.slice.call(arguments)));\n            };\n\n        fNOP.prototype = this.prototype;\n        fBound.prototype = new fNOP();\n\n        return fBound;\n      };\n    }\n\n}).call(this);\n\n/*\n * jsPlumb\n *\n * Title:jsPlumb 1.7.2\n *\n * Provides a way to visually connect elements on an HTML page, using SVG or VML.\n *\n * This file contains utility functions that run browsers only.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n *\n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n *\n * Dual licensed under the MIT and GPL2 licenses.\n */\n ;(function() {\n\n  \"use strict\";\n\n   var root = this;\n   var exports = root.jsPlumbUtil;\n\n   exports.ieVersion = /MSIE\\s([\\d.]+)/.test(navigator.userAgent) ? (new Number(RegExp.$1)) : -1;\n\n   exports.oldIE = exports.ieVersion > -1 && exports.ieVersion < 9;\n\n   exports.matchesSelector = function(el, selector, ctx) {\n       ctx = ctx || el.parentNode;\n       var possibles = ctx.querySelectorAll(selector);\n       for (var i = 0; i < possibles.length; i++) {\n           if (possibles[i] === el)\n               return true;\n       }\n       return false;\n   };\n\n   exports.consume = function(e, doNotPreventDefault) {\n       if (e.stopPropagation)\n           e.stopPropagation();\n       else\n           e.returnValue = false;\n\n       if (!doNotPreventDefault && e.preventDefault)\n            e.preventDefault();\n   };\n\n   /*\n    * Function: sizeElement\n    * Helper to size and position an element. You would typically use\n    * this when writing your own Connector or Endpoint implementation.\n    *\n    * Parameters:\n    *  x - [int] x position for the element origin\n    *  y - [int] y position for the element origin\n    *  w - [int] width of the element\n    *  h - [int] height of the element\n    *\n    */\n   exports.sizeElement = function(el, x, y, w, h) {\n       if (el) {\n           el.style.height = h + \"px\";\n           el.height = h;\n           el.style.width = w + \"px\";\n           el.width = w;\n           el.style.left = x + \"px\";\n           el.style.top = y + \"px\";\n       }\n   };\n\n\n }).call(this);\n\n/*\n * jsPlumb\n *\n * Title:jsPlumb 1.7.2\n *\n * Provides a way to visually connect elements on an HTML page, using SVG or VML.\n *\n * This file contains the base functionality for DOM type adapters.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n *\n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n *\n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n\n  var root = this;\n\n\tvar svgAvailable = !!window.SVGAngle || document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\"),\n\t\tvmlAvailable = function() {\n\t        if (vmlAvailable.vml === undefined) {\n\t            var a = document.body.appendChild(document.createElement('div'));\n\t        \ta.innerHTML = '<v:shape id=\"vml_flag1\" adj=\"1\" />';\n\t        \tvar b = a.firstChild;\n\t        \tif (b != null && b.style != null) {\n\t            \tb.style.behavior = \"url(#default#VML)\";\n\t            \tvmlAvailable.vml = b ? typeof b.adj == \"object\": true;\n\t            }\n\t            else\n\t            \tvmlAvailable.vml = false;\n\t        \ta.parentNode.removeChild(a);\n\t        }\n\t        return vmlAvailable.vml;\n\t\t},\n\t\t// TODO: remove this once we remove all library adapter versions and have only vanilla jsplumb: this functionality\n\t\t// comes from Mottle.\n\t\tiev = (function() {\n\t\t\tvar rv = -1;\n\t\t\tif (navigator.appName == 'Microsoft Internet Explorer') {\n\t\t\t\tvar ua = navigator.userAgent,\n\t\t\t\t\tre = new RegExp(\"MSIE ([0-9]{1,}[\\.0-9]{0,})\");\n\t\t\t\tif (re.exec(ua) != null)\n\t\t\t\t\trv = parseFloat(RegExp.$1);\n\t\t\t}\n\t\t\treturn rv;\n\t\t})(),\n\t\tisIELT9 = iev > -1 && iev < 9,\n\t\t_genLoc = function(e, prefix) {\n\t\t\tif (e == null) return [ 0, 0 ];\n\t\t\tvar ts = _touches(e), t = _getTouch(ts, 0);\n\t\t\treturn [t[prefix + \"X\"], t[prefix + \"Y\"]];\n\t\t},\n\t\t_pageLocation = function(e) {\n\t\t\tif (e == null) return [ 0, 0 ];\n\t\t\tif (isIELT9) {\n\t\t\t\treturn [ e.clientX + document.documentElement.scrollLeft, e.clientY + document.documentElement.scrollTop ];\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _genLoc(e, \"page\");\n\t\t\t}\n\t\t},\n\t\t_screenLocation = function(e) {\n\t\t\treturn _genLoc(e, \"screen\");\n\t\t},\n\t\t_clientLocation = function(e) {\n\t\t\treturn _genLoc(e, \"client\");\n\t\t},\n\t\t_getTouch = function(touches, idx) { return touches.item ? touches.item(idx) : touches[idx]; },\n\t\t_touches = function(e) {\n\t\t\treturn e.touches && e.touches.length > 0 ? e.touches :\n\t\t\t\t   e.changedTouches && e.changedTouches.length > 0 ? e.changedTouches :\n\t\t\t\t   e.targetTouches && e.targetTouches.length > 0 ? e.targetTouches :\n\t\t\t\t   [ e ];\n\t\t};\n\n    /**\n\t\tManages dragging for some instance of jsPlumb.\n\t*/\n\tvar DragManager = function(_currentInstance) {\n\t\tvar _draggables = {}, _dlist = [], _delements = {}, _elementsWithEndpoints = {},\n\t\t\t// elementids mapped to the draggable to which they belong.\n\t\t\t_draggablesForElements = {};\n\n        /**\n            register some element as draggable.  right now the drag init stuff is done elsewhere, and it is\n            possible that will continue to be the case.\n        */\n\t\tthis.register = function(el) {\n            var id = _currentInstance.getId(el),\n                parentOffset = jsPlumbAdapter.getOffset(el, _currentInstance);\n\n            if (!_draggables[id]) {\n                _draggables[id] = el;\n                _dlist.push(el);\n                _delements[id] = {};\n            }\n\n\t\t\t// look for child elements that have endpoints and register them against this draggable.\n\t\t\tvar _oneLevel = function(p, startOffset) {\n\t\t\t\tif (p) {\n\t\t\t\t\tfor (var i = 0; i < p.childNodes.length; i++) {\n\t\t\t\t\t\tif (p.childNodes[i].nodeType != 3 && p.childNodes[i].nodeType != 8) {\n\t\t\t\t\t\t\tvar cEl = jsPlumb.getElementObject(p.childNodes[i]),\n\t\t\t\t\t\t\t\tcid = _currentInstance.getId(p.childNodes[i], null, true);\n\t\t\t\t\t\t\tif (cid && _elementsWithEndpoints[cid] && _elementsWithEndpoints[cid] > 0) {\n\t\t\t\t\t\t\t\tvar cOff = jsPlumbAdapter.getOffset(cEl, _currentInstance);\n\t\t\t\t\t\t\t\t_delements[id][cid] = {\n\t\t\t\t\t\t\t\t\tid:cid,\n\t\t\t\t\t\t\t\t\toffset:{\n\t\t\t\t\t\t\t\t\t\tleft:cOff.left - parentOffset.left,\n\t\t\t\t\t\t\t\t\t\ttop:cOff.top - parentOffset.top\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t_draggablesForElements[cid] = id;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t_oneLevel(p.childNodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t_oneLevel(el);\n\t\t};\n\n\t\t// refresh the offsets for child elements of this element.\n\t\tthis.updateOffsets = function(elId) {\n\t\t\tif (elId != null) {\n\t\t\t\tvar domEl = jsPlumb.getDOMElement(elId),\n\t\t\t\t\tid = _currentInstance.getId(domEl),\n\t\t\t\t\tchildren = _delements[id],\n\t\t\t\t\tparentOffset = jsPlumbAdapter.getOffset(domEl, _currentInstance);\n\n\t\t\t\tif (children) {\n\t\t\t\t\tfor (var i in children) {\n\t\t\t\t\t\tvar cel = jsPlumb.getElementObject(i),\n\t\t\t\t\t\t\tcOff = jsPlumbAdapter.getOffset(cel, _currentInstance);\n\n\t\t\t\t\t\t_delements[id][i] = {\n\t\t\t\t\t\t\tid:i,\n\t\t\t\t\t\t\toffset:{\n\t\t\t\t\t\t\t\tleft:cOff.left - parentOffset.left,\n\t\t\t\t\t\t\t\ttop:cOff.top - parentOffset.top\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t_draggablesForElements[i] = id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t\tnotification that an endpoint was added to the given el.  we go up from that el's parent\n\t\t\tnode, looking for a parent that has been registered as a draggable. if we find one, we add this\n\t\t\tel to that parent's list of elements to update on drag (if it is not there already)\n\t\t*/\n\t\tthis.endpointAdded = function(el, id) {\n\n            id = id || _currentInstance.getId(el);\n\n\t\t\tvar b = document.body,\n\t\t\t\tp = el.parentNode;\n\n\t\t\t_elementsWithEndpoints[id] = _elementsWithEndpoints[id] ? _elementsWithEndpoints[id] + 1 : 1;\n\n\t\t\twhile (p != null && p != b) {\n\t\t\t\tvar pid = _currentInstance.getId(p, null, true);\n\t\t\t\tif (pid && _draggables[pid]) {\n\t\t\t\t\tvar pLoc = jsPlumbAdapter.getOffset(p, _currentInstance);\n\n\t\t\t\t\tif (_delements[pid][id] == null) {\n                        var cLoc = jsPlumbAdapter.getOffset(el, _currentInstance);\n\t\t\t\t\t\t_delements[pid][id] = {\n\t\t\t\t\t\t\tid:id,\n\t\t\t\t\t\t\toffset:{\n\t\t\t\t\t\t\t\tleft:cLoc.left - pLoc.left,\n\t\t\t\t\t\t\t\ttop:cLoc.top - pLoc.top\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t_draggablesForElements[id] = pid;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tp = p.parentNode;\n\t\t\t}\n\t\t};\n\n\t\tthis.endpointDeleted = function(endpoint) {\n\t\t\tif (_elementsWithEndpoints[endpoint.elementId]) {\n\t\t\t\t_elementsWithEndpoints[endpoint.elementId]--;\n\t\t\t\tif (_elementsWithEndpoints[endpoint.elementId] <= 0) {\n\t\t\t\t\tfor (var i in _delements) {\n\t\t\t\t\t\tif (_delements[i]) {\n                            delete _delements[i][endpoint.elementId];\n                            delete _draggablesForElements[endpoint.elementId];\n                        }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.changeId = function(oldId, newId) {\n\t\t\t_delements[newId] = _delements[oldId];\n\t\t\t_delements[oldId] = {};\n\t\t\t_draggablesForElements[newId] = _draggablesForElements[oldId];\n\t\t\t_draggablesForElements[oldId] = null;\n\t\t};\n\n\t\tthis.getElementsForDraggable = function(id) {\n\t\t\treturn _delements[id];\n\t\t};\n\n\t\tthis.elementRemoved = function(elementId) {\n\t\t\tvar elId = _draggablesForElements[elementId];\n\t\t\tif (elId) {\n\t\t\t\tdelete _delements[elId][elementId];\n\t\t\t\tdelete _draggablesForElements[elementId];\n\t\t\t}\n\t\t};\n\n\t\tthis.reset = function() {\n\t\t\t_draggables = {};\n\t\t\t_dlist = [];\n\t\t\t_delements = {};\n\t\t\t_elementsWithEndpoints = {};\n\t\t};\n\n\t\t//\n\t\t// notification drag ended. We check automatically if need to update some\n\t\t// ancestor's offsets.\n\t\t//\n\t\tthis.dragEnded = function(el) {\n\t\t\tvar id = _currentInstance.getId(el),\n\t\t\t\tancestor = _draggablesForElements[id];\n\n\t\t\tif (ancestor) this.updateOffsets(ancestor);\n\t\t};\n\n\t\tthis.setParent = function(el, elId, p, pId) {\n\t\t\tvar current = _draggablesForElements[elId];\n\t\t\tif (current) {\n\t\t\t\tif (!_delements[pId])\n\t\t\t\t\t_delements[pId] = {};\n\t\t\t\t_delements[pId][elId] = _delements[current][elId];\n\t\t\t\tdelete _delements[current][elId];\n\t\t\t\tvar pLoc = jsPlumbAdapter.getOffset(p, _currentInstance),\n\t\t\t\t\tcLoc = jsPlumbAdapter.getOffset(el, _currentInstance);\n\t\t\t\t_delements[pId][elId].offset = {\n\t\t\t\t\tleft:cLoc.left - pLoc.left,\n\t\t\t\t\ttop:cLoc.top - pLoc.top\n\t\t\t\t};\n\t\t\t\t_draggablesForElements[elId] = pId;\n\t\t\t}\n\t\t};\n\n\t\tthis.getDragAncestor = function(el) {\n\t\t\tvar de = jsPlumb.getDOMElement(el),\n\t\t\t\tid = _currentInstance.getId(de),\n\t\t\t\taid = _draggablesForElements[id];\n\n\t\t\tif (aid) \n\t\t\t\treturn jsPlumb.getDOMElement(aid);\n\t\t\telse\n\t\t\t\treturn null;\n\t\t};\n\n\t};\n\n    // for those browsers that dont have it.  they still don't have it! but at least they won't crash.\n\tif (!window.console)\n\t\twindow.console = { time:function(){}, timeEnd:function(){}, group:function(){}, groupEnd:function(){}, log:function(){} };\n\n\n\t// TODO: katavorio default helper uses this stuff.  should i extract to a support lib?\n\tvar trim = function(str) {\n\t\t\treturn str == null ? null : (str.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, ''));\n\t\t},\n\t\t_setClassName = function(el, cn) {\n\t\t\tcn = trim(cn);\n\t\t\tif (typeof el.className.baseVal != \"undefined\")  // SVG\n\t\t\t\tel.className.baseVal = cn;\n\t\t\telse\n\t\t\t\tel.className = cn;\n\t\t},\n\t\t_getClassName = function(el) {\n\t\t\treturn (typeof el.className.baseVal == \"undefined\") ? el.className : el.className.baseVal;\n\t\t},\n\t\t_classManip = function(el, add, clazz) {\n\n\t\t\t// TODO if classList exists, use it.\n\n\t\t\tvar classesToAddOrRemove = jsPlumbUtil.isArray(clazz) ? clazz : clazz.split(/\\s+/),\n\t\t\t\tclassName = _getClassName(el),\n\t\t\t\tcurClasses = className.split(/\\s+/);\n\n\t\t\tfor (var i = 0; i < classesToAddOrRemove.length; i++) {\n\t\t\t\tif (add) {\n\t\t\t\t\tif (jsPlumbUtil.indexOf(curClasses, classesToAddOrRemove[i]) == -1)\n\t\t\t\t\t\tcurClasses.push(classesToAddOrRemove[i]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar idx = jsPlumbUtil.indexOf(curClasses, classesToAddOrRemove[i]);\n\t\t\t\t\tif (idx != -1)\n\t\t\t\t\t\tcurClasses.splice(idx, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t_setClassName(el, curClasses.join(\" \"));\n\t\t},\n        _classManipNew = function(el, classesToAdd, classesToRemove) {\n\n            // TODO if classList exists, use it.\n\n            classesToAdd = classesToAdd == null ? [] : jsPlumbUtil.isArray(classesToAdd) ? classesToAdd : classesToAdd.split(/\\s+/);\n            classesToRemove= classesToRemove== null ? [] : jsPlumbUtil.isArray(classesToRemove) ? classesToRemove: classesToRemove.split(/\\s+/);\n\n            var className = _getClassName(el),\n                curClasses = className.split(/\\s+/);\n\n            var _oneSet = function(add, classes) {\n                for (var i = 0; i < classes.length; i++) {\n                    if (add) {\n                        if (jsPlumbUtil.indexOf(curClasses, classes[i]) == -1)\n                            curClasses.push(classes[i]);\n                    }\n                    else {\n                        var idx = jsPlumbUtil.indexOf(curClasses, classes[i]);\n                        if (idx != -1)\n                            curClasses.splice(idx, 1);\n                    }\n                }\n            };\n\n            _oneSet(true, classesToAdd);\n            _oneSet(false, classesToRemove);\n\n            _setClassName(el, curClasses.join(\" \"));\n        },\n\t\t_each = function(spec, fn) {\n\t\t\tif (spec == null) return;\n\t\t\tif (typeof spec === \"string\")\n\t\t\t\tfn(jsPlumb.getDOMElement(spec));\n\t\t\telse if (spec.length != null) {\n\t\t\t\tfor (var i = 0; i < spec.length; i++)\n\t\t\t\t\tfn(jsPlumb.getDOMElement(spec[i]));\n\t\t\t}\n\t\t\telse\n\t\t\t\tfn(spec); // assume it's an element.\n\t\t};\n\n    window.jsPlumbAdapter = {\n\n        headless:false,\n\n        pageLocation:_pageLocation,\n        screenLocation:_screenLocation,\n        clientLocation:_clientLocation,\n\n        getAttribute:function(el, attName) {\n        \treturn el.getAttribute(attName);\n        },\n\n        setAttribute:function(el, a, v) {\n        \tel.setAttribute(a, v);\n        },\n\n        appendToRoot : function(node) {\n            document.body.appendChild(node);\n        },\n        getRenderModes : function() {\n            return [ \"svg\", \"vml\" ];\n        },\n        isRenderModeAvailable : function(m) {\n            return {\n                \"svg\":svgAvailable,\n                \"vml\":vmlAvailable()\n            }[m];\n        },\n        getDragManager : function(_jsPlumb) {\n            return new DragManager(_jsPlumb);\n        },\n        setRenderMode : function(mode) {\n            var renderMode;\n\n            if (mode) {\n\t\t\t\tmode = mode.toLowerCase();\n\n                var svgAvailable = this.isRenderModeAvailable(\"svg\"),\n                    vmlAvailable = this.isRenderModeAvailable(\"vml\");\n\n                // now test we actually have the capability to do this.\n                if (mode === \"svg\") {\n                    if (svgAvailable) renderMode = \"svg\";\n                    else if (vmlAvailable) renderMode = \"vml\";\n                }\n                else if (vmlAvailable) renderMode = \"vml\";\n            }\n\n\t\t\treturn renderMode;\n        },\n\t\taddClass:function(el, clazz) {\n\t\t\t_each(el, function(e) {\n\t\t\t\t_classManipNew(e, clazz);\n\t\t\t});\n\t\t},\n\t\thasClass:function(el, clazz) {\n\t\t\tel = jsPlumb.getDOMElement(el);\n\t\t\tif (el.classList) return el.classList.contains(clazz);\n\t\t\telse {\n\t\t\t\treturn _getClassName(el).indexOf(clazz) != -1;\n\t\t\t}\n\t\t},\n\t\tremoveClass:function(el, clazz) {\n\t\t\t_each(el, function(e) {\n\t\t\t\t_classManipNew(e, null, clazz);\n\t\t\t});\n\t\t},\n        updateClasses:function(el, toAdd, toRemove) {\n            _each(el, function(e) {\n                _classManipNew(e, toAdd, toRemove);\n            });\n        },\n\t\tsetClass:function(el, clazz) {\n\t\t\t_each(el, function(e) {\n\t\t\t\t_setClassName(e, clazz);\n\t\t\t});\n\t\t},\n\t\tsetPosition:function(el, p) {\n\t\t\tel.style.left = p.left + \"px\";\n\t\t\tel.style.top = p.top + \"px\";\n\t\t},\n\t\tgetPosition:function(el) {\n\t\t\tvar _one = function(prop) {\n\t\t\t\tvar v = el.style[prop];\n\t\t\t\treturn v ? v.substring(0, v.length - 2) : 0;\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tleft:_one(\"left\"),\n\t\t\t\ttop:_one(\"top\")\n\t\t\t};\n\t\t},\n\t\tgetOffset:function(el, _instance, relativeToRoot) {\n\t\t\tel = jsPlumb.getDOMElement(el);\n\t\t\tvar container = _instance.getContainer();\n\t\t\tvar l = el.offsetLeft, t = el.offsetTop, op = (relativeToRoot  || (container != null && el.offsetParent != container)) ?  el.offsetParent : null;\n\t\t\twhile (op != null) {\n\t\t\t\tl += op.offsetLeft;\n\t\t\t\tt += op.offsetTop;\n\t\t\t\top = relativeToRoot ? op.offsetParent :\n\t\t\t\t\top.offsetParent == container ? null : op.offsetParent;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tleft:l, top:t\n\t\t\t};\n\t\t},\n\t\t//\n\t\t// return x+y proportion of the given element's size corresponding to the location of the given event.\n\t\t//\n    getPositionOnElement:function(evt, el, zoom) {\n      var box = typeof el.getBoundingClientRect !== \"undefined\" ? el.getBoundingClientRect() : { left:0, top:0, width:0, height:0 },\n\t\t\t\t  body = document.body,\n    \t\t\tdocElem = document.documentElement,\n    \t\t\toffPar = el.offsetParent,\n    \t\t\tscrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop,\n\t\t\t\t  scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft,\n\t\t\t\t  clientTop = docElem.clientTop || body.clientTop || 0,\n\t\t\t\t  clientLeft = docElem.clientLeft || body.clientLeft || 0,\n\t\t\t\t  pst = 0,//offPar ? offPar.scrollTop : 0,\n\t\t\t\t  psl = 0,//offPar ? offPar.scrollLeft : 0,\n\t\t\t\t  top  = box.top +  scrollTop - clientTop + (pst * zoom),\n\t\t\t\t  left = box.left + scrollLeft - clientLeft + (psl * zoom),\n\t\t\t\t  cl = jsPlumbAdapter.pageLocation(evt),\n\t\t\t\t  w = box.width || (el.offsetWidth * zoom),\n\t\t\t\t  h = box.height || (el.offsetHeight * zoom),\n\t\t\t\t  x = (cl[0] - left) / w,\n\t\t\t\t  y = (cl[1] - top) / h;\n\n\t\t\t return [ x, y ];\n     },\n\n     /**\n    * Gets the absolute position of some element as read from the left/top properties in its style.\n    * @method getAbsolutePosition\n    * @param {Element} el The element to retrieve the absolute coordinates from. **Note** this is a DOM element, not a selector from the underlying library.\n    * @return [Float, Float] [left, top] pixel values.\n    */\n    getAbsolutePosition : function(el) {\n        var _one = function(s) {\n            var ss = el.style[s];\n            if (ss) return parseFloat(ss.substring(0, ss.length - 2));\n        };\n        return [ _one(\"left\"), _one(\"top\") ];\n    },\n\n    /**\n    * Sets the absolute position of some element by setting the left/top properties in its style.\n    * @method setAbsolutePosition\n    * @param {Element} el The element to set the absolute coordinates on. **Note** this is a DOM element, not a selector from the underlying library.\n    * @param {Float[]} xy x and y coordinates\n\t  * @param {Float[]} [animateFrom] Optional previous xy to animate from.\n    */\n    setAbsolutePosition : function(el, xy, animateFrom, animateOptions) {\n\t\t  if (animateFrom) {\n\t\t\t     root.jsPlumb.animate(el, {\n\t\t\t\t     left: \"+=\" + (xy[0] - animateFrom[0]),\n\t\t\t\t     top: \"+=\" + (xy[1] - animateFrom[1])\n\t\t\t     }, animateOptions);\n\t\t  }\n\t\t  else {\n\t\t\t  el.style.left = xy[0] + \"px\";\n\t\t\t  el.style.top = xy[1] + \"px\";\n\t\t  }\n    }\n\n\n\n\n    };\n\n}).call(this);\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the core code.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n\t\n\t\"use strict\";\n\t\t\t\n    var _ju = jsPlumbUtil,\n    \t_getOffset = function(el, _instance, relativeToRoot) {\n            return jsPlumbAdapter.getOffset(el, _instance, relativeToRoot);\n        },\n\t\t\n\t\t/**\n\t\t * creates a timestamp, using milliseconds since 1970, but as a string.\n\t\t */\n\t\t_timestamp = function() { return \"\" + (new Date()).getTime(); },\n\n\t\t// helper method to update the hover style whenever it, or paintStyle, changes.\n\t\t// we use paintStyle as the foundation and merge hoverPaintStyle over the\n\t\t// top.\n\t\t_updateHoverStyle = function(component) {\n\t\t\tif (component._jsPlumb.paintStyle && component._jsPlumb.hoverPaintStyle) {\n\t\t\t\tvar mergedHoverStyle = {};\n\t\t\t\tjsPlumb.extend(mergedHoverStyle, component._jsPlumb.paintStyle);\n\t\t\t\tjsPlumb.extend(mergedHoverStyle, component._jsPlumb.hoverPaintStyle);\n\t\t\t\tdelete component._jsPlumb.hoverPaintStyle;\n\t\t\t\t// we want the fillStyle of paintStyle to override a gradient, if possible.\n\t\t\t\tif (mergedHoverStyle.gradient && component._jsPlumb.paintStyle.fillStyle)\n\t\t\t\t\tdelete mergedHoverStyle.gradient;\n\t\t\t\tcomponent._jsPlumb.hoverPaintStyle = mergedHoverStyle;\n\t\t\t}\n\t\t},\t\t\n\t\t//events = [ \"click\", \"dblclick\", \"mouseenter\", \"mouseout\", \"mousemove\", \"mousedown\", \"mouseup\", \"contextmenu\" ],\n        events = [ \"click\", \"dblclick\", \"mouseover\", \"mouseout\", \"mousemove\", \"mousedown\", \"mouseup\", \"contextmenu\" ],\n\t\teventFilters = { \"mouseout\":\"mouseleave\", \"mouseexit\":\"mouseleave\" },\n\t\t_updateAttachedElements = function(component, state, timestamp, sourceElement) {\n\t\t\tvar affectedElements = component.getAttachedElements();\n\t\t\tif (affectedElements) {\n\t\t\t\tfor (var i = 0, j = affectedElements.length; i < j; i++) {\n\t\t\t\t\tif (!sourceElement || sourceElement != affectedElements[i])\n\t\t\t\t\t\taffectedElements[i].setHover(state, true, timestamp);\t\t\t// tell the attached elements not to inform their own attached elements.\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t_splitType = function(t) { return t == null ? null : t.split(\" \"); },\t\t\n\t\t_applyTypes = function(component, params, doNotRepaint) {\n\t\t\tif (component.getDefaultType) {\n\t\t\t\tvar td = component.getTypeDescriptor();\n\t\t\t\t\t\n\t\t\t\tvar o = _ju.merge({}, component.getDefaultType());\n\t\t\t\tfor (var i = 0, j = component._jsPlumb.types.length; i < j; i++)\n\t\t\t\t\to = _ju.merge(o, component._jsPlumb.instance.getType(component._jsPlumb.types[i], td), [ \"cssClass\" ]);\n\t\t\t\t\t\n\t\t\t\tif (params) {\n\t\t\t\t\to = _ju.populate(o, params);\n\t\t\t\t}\n\t\t\t\n\t\t\t\tcomponent.applyType(o, doNotRepaint);\t\t\t\t\t\n\t\t\t\tif (!doNotRepaint) component.repaint();\n\t\t\t}\n\t\t},\t\t\n\n// ------------------------------ BEGIN jsPlumbUIComponent --------------------------------------------\n\n\t\tjsPlumbUIComponent = window.jsPlumbUIComponent = function(params) {\n\n\t\t\tjsPlumbUtil.EventGenerator.apply(this, arguments);\n\n\t\t\tvar self = this, \n\t\t\t\ta = arguments, \t\t\t\t \t\t\t\t\n\t\t\t\tidPrefix = self.idPrefix,\n\t\t\t\tid = idPrefix + (new Date()).getTime();\n\n\t\t\tthis._jsPlumb = { \n\t\t\t\tinstance: params._jsPlumb,\n\t\t\t\tparameters:params.parameters || {},\n\t\t\t\tpaintStyle:null,\n\t\t\t\thoverPaintStyle:null,\n\t\t\t\tpaintStyleInUse:null,\n\t\t\t\thover:false,\n\t\t\t\tbeforeDetach:params.beforeDetach,\n\t\t\t\tbeforeDrop:params.beforeDrop,\n\t\t\t\toverlayPlacements : [],\n\t\t\t\thoverClass: params.hoverClass || params._jsPlumb.Defaults.HoverClass,\n\t\t\t\ttypes:[]\n\t\t\t};\n\n\t\t\tthis.getId = function() { return id; };\t\n\t\t\t\n\t\t\t// all components can generate events\n\t\t\t\n\t\t\tif (params.events) {\n\t\t\t\tfor (var i in params.events)\n\t\t\t\t\tself.bind(i, params.events[i]);\n\t\t\t}\n\n\t\t\t// all components get this clone function.\n\t\t\t// TODO issue 116 showed a problem with this - it seems 'a' that is in\n\t\t\t// the clone function's scope is shared by all invocations of it, the classic\n\t\t\t// JS closure problem.  for now, jsPlumb does a version of this inline where \n\t\t\t// it used to call clone.  but it would be nice to find some time to look\n\t\t\t// further at this.\n\t\t\tthis.clone = function() {\n\t\t\t\tvar o = {};//new Object();\n\t\t\t\tthis.constructor.apply(o, a);\n\t\t\t\treturn o;\n\t\t\t}.bind(this);\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t// user can supply a beforeDetach callback, which will be executed before a detach\n\t\t\t// is performed; returning false prevents the detach.\t\t\t\n\t\t\tthis.isDetachAllowed = function(connection) {\n\t\t\t\tvar r = true;\n\t\t\t\tif (this._jsPlumb.beforeDetach) {\n\t\t\t\t\ttry { \n\t\t\t\t\t\tr = this._jsPlumb.beforeDetach(connection); \n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) { _ju.log(\"jsPlumb: beforeDetach callback failed\", e); }\n\t\t\t\t}\n\t\t\t\treturn r;\n\t\t\t};\n\t\t\t\n\t\t\t// user can supply a beforeDrop callback, which will be executed before a dropped\n\t\t\t// connection is confirmed. user can return false to reject connection.\t\t\t\n\t\t\tthis.isDropAllowed = function(sourceId, targetId, scope, connection, dropEndpoint, source, target) {\n\t\t\t\t\tvar r = this._jsPlumb.instance.checkCondition(\"beforeDrop\", { \n\t\t\t\t\t\tsourceId:sourceId, \n\t\t\t\t\t\ttargetId:targetId, \n\t\t\t\t\t\tscope:scope,\n\t\t\t\t\t\tconnection:connection,\n\t\t\t\t\t\tdropEndpoint:dropEndpoint,\n\t\t\t\t\t\tsource:source, target:target\n\t\t\t\t\t});\n\t\t\t\t\tif (this._jsPlumb.beforeDrop) {\n\t\t\t\t\t\ttry { \n\t\t\t\t\t\t\tr = this._jsPlumb.beforeDrop({ \n\t\t\t\t\t\t\t\tsourceId:sourceId, \n\t\t\t\t\t\t\t\ttargetId:targetId, \n\t\t\t\t\t\t\t\tscope:scope, \n\t\t\t\t\t\t\t\tconnection:connection,\n\t\t\t\t\t\t\t\tdropEndpoint:dropEndpoint,\n\t\t\t\t\t\t\t\tsource:source, target:target\n\t\t\t\t\t\t\t}); \n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) { _ju.log(\"jsPlumb: beforeDrop callback failed\", e); }\n\t\t\t\t\t}\n\t\t\t\t\treturn r;\n\t\t\t\t};\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t    var boundListeners = [],\n\t\t    \tbindAListener = function(obj, type, fn) {\n\t\t\t    \tboundListeners.push([obj, type, fn]);\n\t\t\t    \tobj.bind(type, fn);\n\t\t\t    },\n\t\t    \tdomListeners = [];\n\n\t\t\t// sets the component associated with listener events. for instance, an overlay delegates\n\t\t\t// its events back to a connector. but if the connector is swapped on the underlying connection,\n\t\t\t// then this component must be changed. This is called by setConnector in the Connection class.\n\t\t\tthis.setListenerComponent = function(c) {\n\t\t\t\tfor (var i = 0; i < domListeners.length; i++)\n\t\t\t\t\tdomListeners[i][3] = c;\n\t\t\t};\n\n\n\n\t\t    \n\t\t};\n\n\t\tvar _removeTypeCssHelper = function(component, typeIndex) {\n\t\t\tvar typeId = component._jsPlumb.types[typeIndex],\n\t\t\t\ttype = component._jsPlumb.instance.getType(typeId, component.getTypeDescriptor());\n\n\t\t\tif (type != null) {\n\n\t\t\t\tif (type.cssClass && component.canvas)\n\t\t\t\t\tcomponent._jsPlumb.instance.removeClass(component.canvas, type.cssClass);\n\t\t\t}\n\t\t};\n\n\t\tjsPlumbUtil.extend(jsPlumbUIComponent, jsPlumbUtil.EventGenerator, {\n\t\t\t\n\t\t\tgetParameter : function(name) { \n\t\t\t\treturn this._jsPlumb.parameters[name]; \n\t\t\t},\n\t\t\t\n\t\t\tsetParameter : function(name, value) { \n\t\t\t\tthis._jsPlumb.parameters[name] = value; \n\t\t\t},\n\t\t\t\n\t\t\tgetParameters : function() { \n\t\t\t\treturn this._jsPlumb.parameters; \n\t\t\t},\t\t\t\n\t\t\t\n\t\t\tsetParameters : function(p) { \n\t\t\t\tthis._jsPlumb.parameters = p; \n\t\t\t},\t\t\t\n\t\t\t\n\t\t\taddClass : function(clazz) {\n\t\t\t    jsPlumbAdapter.addClass(this.canvas, clazz);\n\t\t\t},\n\t\t\t\t\t\t\n\t\t\tremoveClass : function(clazz) {\n\t\t\t    jsPlumbAdapter.removeClass(this.canvas, clazz);\n\t\t\t},\n\n            updateClasses : function(classesToAdd, classesToRemove) {\n                jsPlumbAdapter.updateClasses(this.canvas, classesToAdd, classesToRemove);\n            },\n\t\t\t\n\t\t\tsetType : function(typeId, params, doNotRepaint) {\t\n\t\t\t\tthis.clearTypes();\t\t\t\n\t\t\t\tthis._jsPlumb.types = _splitType(typeId) || [];\n\t\t\t\t_applyTypes(this, params, doNotRepaint);\t\t\t\t\t\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tgetType : function() {\n\t\t\t\treturn this._jsPlumb.types;\n\t\t\t},\n\t\t\t\n\t\t\treapplyTypes : function(params, doNotRepaint) {\n\t\t\t\t_applyTypes(this, params, doNotRepaint);\n\t\t\t},\n\t\t\t\n\t\t\thasType : function(typeId) {\n\t\t\t\treturn jsPlumbUtil.indexOf(this._jsPlumb.types, typeId) != -1;\n\t\t\t},\n\t\t\t\n\t\t\taddType : function(typeId, params, doNotRepaint) {\n\t\t\t\tvar t = _splitType(typeId), _cont = false;\n\t\t\t\tif (t != null) {\n\t\t\t\t\tfor (var i = 0, j = t.length; i < j; i++) {\n\t\t\t\t\t\tif (!this.hasType(t[i])) {\n\t\t\t\t\t\t\tthis._jsPlumb.types.push(t[i]);\n\t\t\t\t\t\t\t_cont = true;\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (_cont) _applyTypes(this, params, doNotRepaint);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tremoveType : function(typeId, doNotRepaint) {\n\t\t\t\tvar t = _splitType(typeId), _cont = false, _one = function(tt) {\n\t\t\t\t\t\tvar idx = _ju.indexOf(this._jsPlumb.types, tt);\n\t\t\t\t\t\tif (idx != -1) {\n\t\t\t\t\t\t\t// remove css class if necessary\n\t\t\t\t\t\t\t_removeTypeCssHelper(this, idx);\n\t\t\t\t\t\t\tthis._jsPlumb.types.splice(idx, 1);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}.bind(this);\n\t\t\t\t\n\t\t\t\tif (t != null) {\n\t\t\t\t\tfor (var i = 0,j = t.length; i < j; i++) {\n\t\t\t\t\t\t_cont = _one(t[i]) || _cont;\n\t\t\t\t\t}\n\t\t\t\t\tif (_cont) _applyTypes(this, null, doNotRepaint);\n\t\t\t\t}\n\t\t\t},\n\t\t\tclearTypes : function(doNotRepaint) {\n\t\t\t\tvar i = this._jsPlumb.types.length;\n\t\t\t\tfor (var j = 0; j < i; j++) {\n\t\t\t\t\t_removeTypeCssHelper(this, 0);\n\t\t\t\t\tthis._jsPlumb.types.splice(0, 1);\n\t\t\t\t}\n\t\t\t\t_applyTypes(this, {}, doNotRepaint);\n\t\t\t},\n\t\t\t\n\t\t\ttoggleType : function(typeId, params, doNotRepaint) {\n\t\t\t\tvar t = _splitType(typeId);\n\t\t\t\tif (t != null) {\n\t\t\t\t\tfor (var i = 0, j = t.length; i < j; i++) {\n\t\t\t\t\t\tvar idx = jsPlumbUtil.indexOf(this._jsPlumb.types, t[i]);\n\t\t\t\t\t\tif (idx != -1) {\n\t\t\t\t\t\t\t_removeTypeCssHelper(this, idx);\n\t\t\t\t\t\t\tthis._jsPlumb.types.splice(idx, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthis._jsPlumb.types.push(t[i]);\n\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t_applyTypes(this, params, doNotRepaint);\n\t\t\t\t}\n\t\t\t},\n\t\t\tapplyType : function(t, doNotRepaint) {\n\t\t\t\tthis.setPaintStyle(t.paintStyle, doNotRepaint);\t\t\t\t\n\t\t\t\tthis.setHoverPaintStyle(t.hoverPaintStyle, doNotRepaint);\n\t\t\t\tif (t.parameters){\n\t\t\t\t\tfor (var i in t.parameters)\n\t\t\t\t\t\tthis.setParameter(i, t.parameters[i]);\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetPaintStyle : function(style, doNotRepaint) {\n//\t\t    \tthis._jsPlumb.paintStyle = jsPlumb.extend({}, style);\n// TODO figure out if we want components to clone paintStyle so as not to share it.\n\t\t\t\tthis._jsPlumb.paintStyle = style;\n\t\t    \tthis._jsPlumb.paintStyleInUse = this._jsPlumb.paintStyle;\n\t\t    \t_updateHoverStyle(this);\n\t\t    \tif (!doNotRepaint) this.repaint();\n\t\t    },\n\t\t    getPaintStyle : function() {\n\t\t    \treturn this._jsPlumb.paintStyle;\n\t\t    },\n\t\t    setHoverPaintStyle : function(style, doNotRepaint) {\t\t    \t\n\t\t    \t//this._jsPlumb.hoverPaintStyle = jsPlumb.extend({}, style);\n// TODO figure out if we want components to clone paintStyle so as not to share it.\t\t    \t\n\t\t    \tthis._jsPlumb.hoverPaintStyle = style;\n\t\t    \t_updateHoverStyle(this);\n\t\t    \tif (!doNotRepaint) this.repaint();\n\t\t    },\n\t\t    getHoverPaintStyle : function() {\n\t\t    \treturn this._jsPlumb.hoverPaintStyle;\n\t\t    },\n\t\t\tdestroy:function() {\n\t\t\t\tthis.cleanupListeners(); // this is on EventGenerator\n\t\t\t\tthis.clone = null;\n\t\t\t\tthis._jsPlumb = null;\n\t\t\t},\n\t\t\t\n\t\t\tisHover : function() { return this._jsPlumb.hover; },\n\t\t\t\n\t\t\tsetHover : function(hover, ignoreAttachedElements, timestamp) {\n\t\t\t\t// while dragging, we ignore these events.  this keeps the UI from flashing and\n\t\t    \t// swishing and whatevering.\n\t\t\t\tif (this._jsPlumb && !this._jsPlumb.instance.currentlyDragging && !this._jsPlumb.instance.isHoverSuspended()) {\n\t\t    \n\t\t\t    \tthis._jsPlumb.hover = hover;\n                        \n                    if (this.canvas != null) {\n                        if (this._jsPlumb.instance.hoverClass != null) {\n                        \tvar method = hover ? \"addClass\" : \"removeClass\";\n\t\t\t\t\t\t\tthis._jsPlumb.instance[method](this.canvas, this._jsPlumb.instance.hoverClass);\n                        }\n                        if (this._jsPlumb.hoverClass != null) {\n\t\t\t\t\t\t\tthis._jsPlumb.instance[method](this.canvas, this._jsPlumb.hoverClass);\n                        }\n                    }\n\t\t   \t\t \tif (this._jsPlumb.hoverPaintStyle != null) {\n\t\t\t\t\t\tthis._jsPlumb.paintStyleInUse = hover ? this._jsPlumb.hoverPaintStyle : this._jsPlumb.paintStyle;\n\t\t\t\t\t\tif (!this._jsPlumb.instance.isSuspendDrawing()) {\n\t\t\t\t\t\t\ttimestamp = timestamp || _timestamp();\n\t\t\t\t\t\t\tthis.repaint({timestamp:timestamp, recalc:false});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// get the list of other affected elements, if supported by this component.\n\t\t\t\t\t// for a connection, its the endpoints.  for an endpoint, its the connections! surprise.\n\t\t\t\t\tif (this.getAttachedElements && !ignoreAttachedElements)\n\t\t\t\t\t\t_updateAttachedElements(this, hover, _timestamp(), this);\n\t\t\t\t}\n\t\t    }\n\t\t});\n\n// ------------------------------ END jsPlumbUIComponent --------------------------------------------\n\n// ------------------------------ BEGIN OverlayCapablejsPlumbUIComponent --------------------------------------------\n\n\t\tvar _internalLabelOverlayId = \"__label\",\n\t\t\t// helper to get the index of some overlay\n\t\t\t_getOverlayIndex = function(component, id) {\n\t\t\t\tvar idx = -1;\n\t\t\t\tfor (var i = 0, j = component._jsPlumb.overlays.length; i < j; i++) {\n\t\t\t\t\tif (id === component._jsPlumb.overlays[i].id) {\n\t\t\t\t\t\tidx = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn idx;\n\t\t\t},\n\t\t\t// this is a shortcut helper method to let people add a label as\n\t\t\t// overlay.\n\t\t\t_makeLabelOverlay = function(component, params) {\n\n\t\t\t\tvar _params = {\n\t\t\t\t\tcssClass:params.cssClass,\n\t\t\t\t\tlabelStyle : component.labelStyle,\n\t\t\t\t\tid:_internalLabelOverlayId,\n\t\t\t\t\tcomponent:component,\n\t\t\t\t\t_jsPlumb:component._jsPlumb.instance  // TODO not necessary, since the instance can be accessed through the component.\n\t\t\t\t},\n\t\t\t\tmergedParams = jsPlumb.extend(_params, params);\n\n\t\t\t\treturn new jsPlumb.Overlays[component._jsPlumb.instance.getRenderMode()].Label( mergedParams );\n\t\t\t},\n\t\t\t_processOverlay = function(component, o) {\n\t\t\t\tvar _newOverlay = null;\n\t\t\t\tif (_ju.isArray(o)) {\t// this is for the shorthand [\"Arrow\", { width:50 }] syntax\n\t\t\t\t\t// there's also a three arg version:\n\t\t\t\t\t// [\"Arrow\", { width:50 }, {location:0.7}] \n\t\t\t\t\t// which merges the 3rd arg into the 2nd.\n\t\t\t\t\tvar type = o[0], \n\t\t\t\t\t\t// make a copy of the object so as not to mess up anyone else's reference...\n\t\t\t\t\t\tp = jsPlumb.extend({component:component, _jsPlumb:component._jsPlumb.instance}, o[1]);\n\t\t\t\t\tif (o.length == 3) jsPlumb.extend(p, o[2]);\n\t\t\t\t\t_newOverlay = new jsPlumb.Overlays[component._jsPlumb.instance.getRenderMode()][type](p);\n\t\t\t\t} else if (o.constructor == String) {\n\t\t\t\t\t_newOverlay = new jsPlumb.Overlays[component._jsPlumb.instance.getRenderMode()][o]({component:component, _jsPlumb:component._jsPlumb.instance});\n\t\t\t\t} else {\n\t\t\t\t\t_newOverlay = o;\n\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\tcomponent._jsPlumb.overlays.push(_newOverlay);\n\t\t\t},\n\t\t\t_calculateOverlaysToAdd = function(component, params) {\n\t\t\t\tvar defaultKeys = component.defaultOverlayKeys || [], o = params.overlays,\n\t\t\t\t\tcheckKey = function(k) {\n\t\t\t\t\t\treturn component._jsPlumb.instance.Defaults[k] || jsPlumb.Defaults[k] || [];\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (!o) o = [];\n\n\t\t\t\tfor (var i = 0, j = defaultKeys.length; i < j; i++)\n\t\t\t\t\to.unshift.apply(o, checkKey(defaultKeys[i]));\n\t\t\t\t\n\t\t\t\treturn o;\n\t\t\t},\t\t\n\t\t\tOverlayCapableJsPlumbUIComponent = window.OverlayCapableJsPlumbUIComponent = function(params) {\n\n\t\t\t\tjsPlumbUIComponent.apply(this, arguments);\n\t\t\t\tthis._jsPlumb.overlays = [];\t\t\t\n\n\t\t\t\tvar _overlays = _calculateOverlaysToAdd(this, params);\n\t\t\t\tif (_overlays) {\n\t\t\t\t\tfor (var i = 0, j = _overlays.length; i < j; i++) {\n\t\t\t\t\t\t_processOverlay(this, _overlays[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (params.label) {\n\t\t\t\t\tvar loc = params.labelLocation || this.defaultLabelLocation || 0.5,\n\t\t\t\t\t\tlabelStyle = params.labelStyle || this._jsPlumb.instance.Defaults.LabelStyle;\n\n\t\t\t\t\tthis._jsPlumb.overlays.push(_makeLabelOverlay(this, {\n\t\t\t\t\t\tlabel:params.label,\n\t\t\t\t\t\tlocation:loc,\n\t\t\t\t\t\tlabelStyle:labelStyle\n\t\t\t\t\t}));\n\t\t\t\t}\t\t\n\n\t\t\t\tthis.setListenerComponent = function(c) {\n\t\t\t\t\tif (this._jsPlumb) {\n\t\t\t\t\t\tfor (var i = 0; i < this._jsPlumb.overlays.length; i++)\n\t\t\t\t\t\t\tthis._jsPlumb.overlays[i].setListenerComponent(c);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\n\t\tjsPlumbUtil.extend(OverlayCapableJsPlumbUIComponent, jsPlumbUIComponent, {\n\t\t\tapplyType : function(t, doNotRepaint) {\t\t\t\n\t\t\t\tthis.removeAllOverlays(doNotRepaint);\n\t\t\t\tif (t.overlays) {\n\t\t\t\t\tfor (var i = 0, j = t.overlays.length; i < j; i++)\n\t\t\t\t\t\tthis.addOverlay(t.overlays[i], true);\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetHover : function(hover, ignoreAttachedElements) {\n\t\t\t\tif (this._jsPlumb && !this._jsPlumb.instance.isConnectionBeingDragged()) {\n\t                for (var i = 0, j = this._jsPlumb.overlays.length; i < j; i++) {\n\t\t\t\t\t\tthis._jsPlumb.overlays[i][hover ? \"addClass\":\"removeClass\"](this._jsPlumb.instance.hoverClass);\n\t\t\t\t\t}\n\t\t\t\t}\n            },\n            addOverlay : function(overlay, doNotRepaint) { \n\t\t\t\t_processOverlay(this, overlay); \n\t\t\t\tif (!doNotRepaint) this.repaint();\n\t\t\t},\n\t\t\tgetOverlay : function(id) {\n\t\t\t\tvar idx = _getOverlayIndex(this, id);\n\t\t\t\treturn idx >= 0 ? this._jsPlumb.overlays[idx] : null;\n\t\t\t},\t\t\t\n\t\t\tgetOverlays : function() {\n\t\t\t\treturn this._jsPlumb.overlays;\n\t\t\t},\t\t\t\n\t\t\thideOverlay : function(id) {\n\t\t\t\tvar o = this.getOverlay(id);\n\t\t\t\tif (o) o.hide();\n\t\t\t},\n\t\t\thideOverlays : function() {\n\t\t\t\tfor (var i = 0, j = this._jsPlumb.overlays.length; i < j; i++)\n\t\t\t\t\tthis._jsPlumb.overlays[i].hide();\n\t\t\t},\n\t\t\tshowOverlay : function(id) {\n\t\t\t\tvar o = this.getOverlay(id);\n\t\t\t\tif (o) o.show();\n\t\t\t},\n\t\t\tshowOverlays : function() {\n\t\t\t\tfor (var i = 0, j = this._jsPlumb.overlays.length; i < j; i++)\n\t\t\t\t\tthis._jsPlumb.overlays[i].show();\n\t\t\t},\n\t\t\tremoveAllOverlays : function(doNotRepaint) {\n\t\t\t\tfor (var i = 0, j = this._jsPlumb.overlays.length; i < j; i++) {\n\t\t\t\t\tif (this._jsPlumb.overlays[i].cleanup) this._jsPlumb.overlays[i].cleanup();\n\t\t\t\t}\n\n\t\t\t\tthis._jsPlumb.overlays.splice(0, this._jsPlumb.overlays.length);\n\t\t\t\tthis._jsPlumb.overlayPositions = null;\n\t\t\t\tif (!doNotRepaint)\n\t\t\t\t\tthis.repaint();\n\t\t\t},\n\t\t\tremoveOverlay : function(overlayId) {\n\t\t\t\tvar idx = _getOverlayIndex(this, overlayId);\n\t\t\t\tif (idx != -1) {\n\t\t\t\t\tvar o = this._jsPlumb.overlays[idx];\n\t\t\t\t\tif (o.cleanup) o.cleanup();\n\t\t\t\t\tthis._jsPlumb.overlays.splice(idx, 1);\n\t\t\t\t\tif (this._jsPlumb.overlayPositions)  \n\t\t\t\t\t\tdelete this._jsPlumb.overlayPositions[overlayId];\n\t\t\t\t}\n\t\t\t},\n\t\t\tremoveOverlays : function() {\n\t\t\t\tfor (var i = 0, j = arguments.length; i < j; i++)\n\t\t\t\t\tthis.removeOverlay(arguments[i]);\n\t\t\t},\n\t\t\tmoveParent:function(newParent) {\n\t\t\t\tif (this.bgCanvas) {\n\t\t\t\t    this.bgCanvas.parentNode.removeChild(this.bgCanvas);\n\t\t\t\t    newParent.appendChild(this.bgCanvas);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.canvas.parentNode.removeChild(this.canvas);\n\t\t\t\tnewParent.appendChild(this.canvas);\n\n\t\t\t\tfor (var i = 0; i < this._jsPlumb.overlays.length; i++) {\n\t\t\t\t    if (this._jsPlumb.overlays[i].isAppendedAtTopLevel) {\n\t\t\t\t        this._jsPlumb.overlays[i].canvas.parentNode.removeChild(this._jsPlumb.overlays[i].canvas);\n\t\t\t\t        newParent.appendChild(this._jsPlumb.overlays[i].canvas);  \n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetLabel : function() {\n\t\t\t\tvar lo = this.getOverlay(_internalLabelOverlayId);\n\t\t\t\treturn lo != null ? lo.getLabel() : null;\n\t\t\t},\t\t\n\t\t\tgetLabelOverlay : function() {\n\t\t\t\treturn this.getOverlay(_internalLabelOverlayId);\n\t\t\t},\n\t\t\tsetLabel : function(l) {\n\t\t\t\tvar lo = this.getOverlay(_internalLabelOverlayId);\n\t\t\t\tif (!lo) {\n\t\t\t\t\tvar params = l.constructor == String || l.constructor == Function ? { label:l } : l;\n\t\t\t\t\tlo = _makeLabelOverlay(this, params);\t\n\t\t\t\t\tthis._jsPlumb.overlays.push(lo);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (l.constructor == String || l.constructor == Function) lo.setLabel(l);\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (l.label) lo.setLabel(l.label);\n\t\t\t\t\t\tif (l.location) lo.setLocation(l.location);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!this._jsPlumb.instance.isSuspendDrawing()) \n\t\t\t\t\tthis.repaint();\n\t\t\t},\n\t\t\tcleanup:function() {\n\t\t\t\tfor (var i = 0; i < this._jsPlumb.overlays.length; i++) {\n\t\t\t\t\tthis._jsPlumb.overlays[i].cleanup();\n\t\t\t\t\tthis._jsPlumb.overlays[i].destroy();\n\t\t\t\t}\n\t\t\t\tthis._jsPlumb.overlays.length = 0;\n\t\t\t\tthis._jsPlumb.overlayPositions = null;\n\t\t\t},\n\t\t\tsetVisible:function(v) {\n\t\t\t\tthis[v ? \"showOverlays\" : \"hideOverlays\"]();\n\t\t\t},\n\t\t\tsetAbsoluteOverlayPosition:function(overlay, xy) {\n\t\t\t\tthis._jsPlumb.overlayPositions = this._jsPlumb.overlayPositions || {};\n\t\t\t\tthis._jsPlumb.overlayPositions[overlay.id] = xy;\n\t\t\t},\n\t\t\tgetAbsoluteOverlayPosition:function(overlay) {\n\t\t\t\treturn this._jsPlumb.overlayPositions ? this._jsPlumb.overlayPositions[overlay.id] : null;\n\t\t\t}\n\t\t});\t\t\n\n// ------------------------------ END OverlayCapablejsPlumbUIComponent --------------------------------------------\n\t\t\n\t\tvar _jsPlumbInstanceIndex = 0,\n\t\t\tgetInstanceIndex = function() {\n\t\t\t\tvar i = _jsPlumbInstanceIndex + 1;\n\t\t\t\t_jsPlumbInstanceIndex++;\n\t\t\t\treturn i;\n\t\t\t};\n\n\t\tvar jsPlumbInstance = window.jsPlumbInstance = function(_defaults) {\n\t\t\t\t\n\t\t\tthis.Defaults = {\n\t\t\t\tAnchor : \"Bottom\",\n\t\t\t\tAnchors : [ null, null ],\n\t            ConnectionsDetachable : true,\n\t            ConnectionOverlays : [ ],\n\t            Connector : \"Bezier\",\n\t\t\t\tContainer : null,\n\t\t\t\tDoNotThrowErrors:false,\n\t\t\t\tDragOptions : { },\n\t\t\t\tDropOptions : { },\n\t\t\t\tEndpoint : \"Dot\",\n\t\t\t\tEndpointOverlays : [ ],\n\t\t\t\tEndpoints : [ null, null ],\n\t\t\t\tEndpointStyle : { fillStyle : \"#456\" },\n\t\t\t\tEndpointStyles : [ null, null ],\n\t\t\t\tEndpointHoverStyle : null,\n\t\t\t\tEndpointHoverStyles : [ null, null ],\n\t\t\t\tHoverPaintStyle : null,\n\t\t\t\tLabelStyle : { color : \"black\" },\n\t\t\t\tLogEnabled : false,\n\t\t\t\tOverlays : [ ],\n\t\t\t\tMaxConnections : 1, \n\t\t\t\tPaintStyle : { lineWidth : 4, strokeStyle : \"#456\" },\n\t\t\t\tReattachConnections:false,\n\t\t\t\tRenderMode : \"svg\",\n\t\t\t\tScope : \"jsPlumb_DefaultScope\"\n\t\t\t};\n\t\t\tif (_defaults) jsPlumb.extend(this.Defaults, _defaults);\n\t\t\n\t\t\tthis.logEnabled = this.Defaults.LogEnabled;\n\t\t\tthis._connectionTypes = {};\n\t\t\tthis._endpointTypes = {};\n\n\t\t\tjsPlumbUtil.EventGenerator.apply(this);\n\n\t\t\tvar _currentInstance = this,\n\t\t\t\t_instanceIndex = getInstanceIndex(),\n\t\t\t\t_bb = _currentInstance.bind,\n\t\t\t\t_initialDefaults = {},\n\t            _zoom = 1,\n\t            _info = function(el) {\n\t            \tvar _el = _currentInstance.getDOMElement(el);\t\n\t            \treturn { el:_el, id:(jsPlumbUtil.isString(el) && _el == null) ? el : _getId(_el) };\n\t            };\n            \n\t        this.getInstanceIndex = function() { return _instanceIndex; };\n\n        \tthis.setZoom = function(z, repaintEverything) {\n        \t\tif (!jsPlumbUtil.oldIE) {\n\t            \t_zoom = z;\n\t\t\t\t\t_currentInstance.fire(\"zoom\", _zoom);\n\t            \tif (repaintEverything) _currentInstance.repaintEverything();\n\t            }\n\t            return !jsPlumbUtil.oldIE;\n\n        \t};\n        \tthis.getZoom = function() { return _zoom; };\n                        \n\t\t\tfor (var i in this.Defaults)\n\t\t\t\t_initialDefaults[i] = this.Defaults[i];\n\n\t\t\tvar _container;\n\t\t\tthis.setContainer = function(c) {\n\n                // TODO if a _container already exists, unbind delegations from it\n\n\t\t\t\tc = this.getDOMElement(c);\n\t\t\t\tthis.select().each(function(conn) {\n\t\t\t\t\tconn.moveParent(c);\n\t\t\t\t});\n\t\t\t\tthis.selectEndpoints().each(function(ep) {\n\t\t\t\t\tep.moveParent(c);\n\t\t\t\t});\n\t\t\t\t_container = c;\n\n                var _oneDelegateHandler = function(id, e) {\n                    var t = e.srcElement || e.target,\n                        jp = (t && t.parentNode ? t.parentNode._jsPlumb : null) || (t ? t._jsPlumb : null) || (t && t.parentNode && t.parentNode.parentNode ? t.parentNode.parentNode._jsPlumb : null);\n                    if (jp) {\n                        jp.fire(id, jp, e);\n                        // jsplumb also fires every event coming from components\n                        _currentInstance.fire(id, jp, e);\n                    }\n                };\n\n                // delegate one event on the container to jsplumb elements. it might be possible to\n                // abstract this out: each of endpoint, connection and overlay could register themselves with\n                // jsplumb as \"component types\" or whatever, and provide a suitable selector. this would be\n                // done by the renderer (although admittedly from 2.0 onwards we're not supporting vml anymore)\n                var _oneDelegate = function(id) {\n                    // connections.\n                    _currentInstance.on(_container, id, \"._jsPlumb_connector, ._jsPlumb_connector > *\", function(e) { _oneDelegateHandler(id, e); });\n                    // endpoints. note they can have an enclosing div, or not.\n                    _currentInstance.on(_container, id, \"._jsPlumb_endpoint, ._jsPlumb_endpoint > *, ._jsPlumb_endpoint svg *\", function(e) { _oneDelegateHandler(id, e); });\n                    // overlays\n                    _currentInstance.on(_container, id, \"._jsPlumb_overlay, ._jsPlumb_overlay *\", function(e) { _oneDelegateHandler(id, e); });\n                };\n\n                for (var i = 0; i < events.length; i++)\n                    _oneDelegate(events[i]);\n\n\t\t\t};\n\t\t\tthis.getContainer = function() {\n\t\t\t\treturn _container;\n\t\t\t};\n\t\t\t\n\t\t\tthis.bind = function(event, fn) {\t\t\n\t\t\t\tif (\"ready\" === event && initialized) fn();\n\t\t\t\telse _bb.apply(_currentInstance,[event, fn]);\n\t\t\t};\n\n\t\t\t_currentInstance.importDefaults = function(d) {\n\t\t\t\tfor (var i in d) {\n\t\t\t\t\t_currentInstance.Defaults[i] = d[i];\n\t\t\t\t}\n\t\t\t\tif (d.Container)\n\t\t\t\t\t_currentInstance.setContainer(d.Container);\n\n\t\t\t\treturn _currentInstance;\n\t\t\t};\t\t\n\t\t\t\n\t\t\t_currentInstance.restoreDefaults = function() {\n\t\t\t\t_currentInstance.Defaults = jsPlumb.extend({}, _initialDefaults);\n\t\t\t\treturn _currentInstance;\n\t\t\t};\n\n            //_currentInstance.floatingConnections = {};ctions = {};\n\t\t\n\t\t    var log = null,\n\t\t        initialized = false,\n\t\t        // TODO remove from window scope       \n\t\t        connections = [],\n\t\t        // map of element id -> endpoint lists. an element can have an arbitrary\n\t\t        // number of endpoints on it, and not all of them have to be connected\n\t\t        // to anything.         \n\t\t        endpointsByElement = {},\n\t\t        endpointsByUUID = {},\n                // SP new\n                managedElements = {},\n\t\t        offsets = {},\n\t\t        offsetTimestamps = {},\n\n\t\t        draggableStates = {},\t\t\n\t\t        connectionBeingDragged = false,\n\t\t        sizes = [],\n\t\t        _suspendDrawing = false,\n\t\t        _suspendedAt = null,\n\t\t        DEFAULT_SCOPE = this.Defaults.Scope,\n\t\t        renderMode = null,  // will be set in init()\t\t\n\t\t        _curIdStamp = 1,\n\t\t        _idstamp = function() { return \"\" + _curIdStamp++; },\t\t\t\t\t\t\t\n\t\t\n\t\t\t\t//\n\t\t\t\t// appends an element to some other element, which is calculated as follows:\n\t\t\t\t// \n\t\t\t\t// 1. if Container exists, use that element.\n\t\t\t\t// 2. if the 'parent' parameter exists, use that.\n\t\t\t\t// 3. otherwise just use the root element (for DOM usage, the document body).\n\t\t\t\t// \n\t\t\t\t//\n\t\t\t\t_appendElement = function(el, parent) {\n\t\t\t\t\tif (_container)\n\t\t\t\t\t\t_container.appendChild(el);\n\t\t\t\t\telse if (!parent)\n\t\t\t\t\t\tthis.appendToRoot(el);\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.getDOMElement(parent).appendChild(el);\n                }.bind(this),\n\n\t\t\t//\n\t\t\t// Draws an endpoint and its connections. this is the main entry point into drawing connections as well\n\t\t\t// as endpoints, since jsPlumb is endpoint-centric under the hood.\n\t\t\t// \n\t\t\t// @param element element to draw (of type library specific element object)\n\t\t\t// @param ui UI object from current library's event system. optional.\n\t\t\t// @param timestamp timestamp for this paint cycle. used to speed things up a little by cutting down the amount of offset calculations we do.\n\t\t\t// @param clearEdits defaults to false; indicates that mouse edits for connectors should be cleared\n\t\t\t///\n\t\t\t_draw = function(element, ui, timestamp, clearEdits) {\n\n\t\t\t\t// TODO is it correct to filter by headless at this top level? how would a headless adapter ever repaint?\n\t            if (!jsPlumbAdapter.headless && !_suspendDrawing) {\n\t\t\t\t    var id = _getId(element),\n\t\t\t\t    \trepaintEls = _currentInstance.dragManager.getElementsForDraggable(id);\t\t\t    \n\n\t\t\t\t    if (timestamp == null) timestamp = _timestamp();\n\n\t\t\t\t    // update the offset of everything _before_ we try to draw anything.\n\t\t\t\t    var o = _updateOffset( { elId : id, offset : ui, recalc : false, timestamp : timestamp });\n\n\t\t\t        if (repaintEls) {\n\t\t\t    \t    for (var i in repaintEls) {\n\t\t\t    \t    \t// TODO this seems to cause a lag, but we provide the offset, so in theory it \n\t\t\t    \t    \t// should not.  is the timestamp failing?\n\t\t\t\t    \t\t_updateOffset( { \n\t\t\t\t    \t\t\telId : repaintEls[i].id, \n\t\t\t\t    \t\t\toffset : {\n\t\t\t\t\t\t\t\t\tleft:o.o.left + repaintEls[i].offset.left,\n\t\t\t\t\t    \t\t\ttop:o.o.top + repaintEls[i].offset.top\n\t\t\t\t\t    \t\t}, \n\t\t\t\t    \t\t\trecalc : false, \n\t\t\t\t    \t\t\ttimestamp : timestamp \n\t\t\t\t    \t\t});\n\t\t\t\t    \t}\n\t\t\t\t    }\t\n\n\t\t\t\t    _currentInstance.anchorManager.redraw(id, ui, timestamp, null, clearEdits);\n\t\t\t\t    \n\t\t\t\t    if (repaintEls) {\n\t\t\t\t\t    for (var j in repaintEls) {\n\t\t\t\t\t\t\t_currentInstance.anchorManager.redraw(repaintEls[j].id, ui, timestamp, repaintEls[j].offset, clearEdits, true);\t\t\t    \t\n\t\t\t\t\t    }\n\t\t\t\t\t}\t\t\n\t            }\n\t\t\t},\n\n\t\t\t//\n\t\t\t// executes the given function against the given element if the first\n\t\t\t// argument is an object, or the list of elements, if the first argument\n\t\t\t// is a list. the function passed in takes (element, elementId) as\n\t\t\t// arguments.\n\t\t\t//\n\t\t\t_elementProxy = function(element, fn) {\n\t\t\t\tvar retVal = null, el, id, del;\n\t\t\t\tif (_ju.isArray(element)) {\n\t\t\t\t\tretVal = [];\n\t\t\t\t\tfor ( var i = 0, j = element.length; i < j; i++) {\n\t\t\t\t\t\tel = _currentInstance.getElementObject(element[i]);\n\t\t\t\t\t\tdel = _currentInstance.getDOMElement(el);\n\t\t\t\t\t\tid = _currentInstance.getAttribute(del, \"id\");\n\t\t\t\t\t\tretVal.push(fn.apply(_currentInstance, [del, id])); // append return values to what we will return\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tel = _currentInstance.getDOMElement(element);\n\t\t\t\t\tid = _currentInstance.getId(el);\n\t\t\t\t\tretVal = fn.apply(_currentInstance, [el, id]);\n\t\t\t\t}\n\t\t\t\treturn retVal;\n\t\t\t},\t\t\t\t\n\n\t\t\t//\n\t\t\t// gets an Endpoint by uuid.\n\t\t\t//\n\t\t\t_getEndpoint = function(uuid) { return endpointsByUUID[uuid]; },\n\n\t\t/**\n\t\t * inits a draggable if it's not already initialised.\n\t\t * TODO: somehow abstract this to the adapter, because the concept of \"draggable\" has no\n\t\t * place on the server.\n\t\t */\n\t\t_initDraggableIfNecessary = function(element, isDraggable, dragOptions, id) {\n\t\t\t// TODO move to DragManager?\n\t\t\tif (!jsPlumbAdapter.headless) {\n\t\t\t\tvar _draggable = isDraggable == null ? false : isDraggable;\n\t\t\t\tif (_draggable) {\n\t\t\t\t\tif (jsPlumb.isDragSupported(element, _currentInstance) && !jsPlumb.isAlreadyDraggable(element, _currentInstance)) {\n\t\t\t\t\t\tvar options = dragOptions || _currentInstance.Defaults.DragOptions;\n\t\t\t\t\t\toptions = jsPlumb.extend( {}, options); // make a copy.\n\t\t\t\t\t\tvar dragEvent = jsPlumb.dragEvents.drag,\n\t\t\t\t\t\t\tstopEvent = jsPlumb.dragEvents.stop,\n\t\t\t\t\t\t\tstartEvent = jsPlumb.dragEvents.start,\n\t\t\t\t\t\t\t_del = _currentInstance.getDOMElement(element),\n\t\t\t\t\t\t\t_ancestor = _currentInstance.dragManager.getDragAncestor(_del),\n\t\t\t\t\t\t\t_noOffset = {left:0, top:0},\n\t\t\t\t\t\t\t_ancestorOffset = _noOffset,\n\t\t\t\t\t\t\t_started = false;\n\n                        _manage(id, element);\n\n\t\t\t\t\t\toptions[startEvent] = _ju.wrap(options[startEvent], function() {\n\t\t\t\t\t\t\t_ancestorOffset = _ancestor != null ? jsPlumbAdapter.getOffset(_ancestor, _currentInstance) : _noOffset;\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_currentInstance.setHoverSuspended(true);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_currentInstance.select({source:element}).addClass(_currentInstance.elementDraggingClass + \" \" + _currentInstance.sourceElementDraggingClass, true);\n\t\t\t\t\t\t\t_currentInstance.select({target:element}).addClass(_currentInstance.elementDraggingClass + \" \" + _currentInstance.targetElementDraggingClass, true);\n\t\t\t\t\t\t\t_currentInstance.setConnectionBeingDragged(true);\n\t\t\t\t\t\t\tif (options.canDrag) return dragOptions.canDrag();\n\t\t\t\t\t\t}, false);\n\t\n\t\t\t\t\t\toptions[dragEvent] = _ju.wrap(options[dragEvent], function() {\n\t\t\t\t\t\t\t// TODO: here we could actually use getDragObject, and then compute it ourselves,\n\t\t\t\t\t\t\t// since every adapter does the same thing. but i'm not sure why YUI's getDragObject\n\t\t\t\t\t\t\t// differs from getUIPosition so much\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar ui = _currentInstance.getUIPosition(arguments, _currentInstance.getZoom());\n\t\t\t\t\t\t\t// adjust by ancestor offset if there is one: this is for the case that a draggable\n\t\t\t\t\t\t\t// is contained inside some other element that is not the Container.\n\t\t\t\t\t\t\tui.left += _ancestorOffset.left;\n\t\t\t\t\t\t\tui.top += _ancestorOffset.top;\t\n\t\t\t\t\t\t\t_draw(element, ui, null, true);\n\t\t\t\t\t\t\tif (_started) _currentInstance.addClass(element, \"jsPlumb_dragged\");\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_started = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\toptions[stopEvent] = _ju.wrap(options[stopEvent], function() {\n\t\t\t\t\t\t\tvar ui = _currentInstance.getUIPosition(arguments, _currentInstance.getZoom(), true);\n\t\t\t\t\t\t\t_draw(element, ui);\n\t\t\t\t\t\t\t_started = false;\n\t\t\t\t\t\t\t_currentInstance.removeClass(element, \"jsPlumb_dragged\");\n\t\t\t\t\t\t\t_currentInstance.setHoverSuspended(false);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_currentInstance.select({source:element}).removeClass(_currentInstance.elementDraggingClass + \" \" + _currentInstance.sourceElementDraggingClass, true);\n\t\t\t\t\t\t\t_currentInstance.select({target:element}).removeClass(_currentInstance.elementDraggingClass + \" \" + _currentInstance.targetElementDraggingClass, true);\n\t\t\t\t\t\t\t_currentInstance.setConnectionBeingDragged(false);\n\t\t\t\t\t\t\t_currentInstance.dragManager.dragEnded(element);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar elId = _getId(element); // need ID\n\t\t\t\t\t\tdraggableStates[elId] = true;  \n\t\t\t\t\t\tvar draggable = draggableStates[elId];\n\t\t\t\t\t\toptions.disabled = draggable == null ? false : !draggable;\n\t\t\t\t\t\t_currentInstance.initDraggable(element, options);\n\t\t\t\t\t\t_currentInstance.dragManager.register(element);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n        _scopeMatch = function(e1, e2) {\n            var s1 = e1.scope.split(/\\s/), s2 = e2.scope.split(/\\s/);\n            for (var i = 0; i < s1.length; i++)\n                for (var j = 0; j < s2.length; j++)\n                    if (s2[j] == s1[i]) return true;\n\n            return false;\n        },\n\t\t\n\t\t/*\n\t\t* prepares a final params object that can be passed to _newConnection, taking into account defaults, events, etc.\n\t\t*/\n\t\t_prepareConnectionParams = function(params, referenceParams) {\n\t\t\tvar _p = jsPlumb.extend( { }, params);\n\t\t\tif (referenceParams) jsPlumb.extend(_p, referenceParams);\n\t\t\t\n\t\t\t// hotwire endpoints passed as source or target to sourceEndpoint/targetEndpoint, respectively.\n\t\t\tif (_p.source) {\n\t\t\t\tif (_p.source.endpoint) \n\t\t\t\t\t_p.sourceEndpoint = _p.source;\n\t\t\t\telse\n\t\t\t\t\t_p.source = _currentInstance.getDOMElement(_p.source);\n\t\t\t}\n\t\t\tif (_p.target) {\n\t\t\t\tif (_p.target.endpoint) \n\t\t\t\t\t_p.targetEndpoint = _p.target;\n\t\t\t\telse\n\t\t\t\t\t_p.target = _currentInstance.getDOMElement(_p.target);\n\t\t\t}\n\t\t\t\n\t\t\t// test for endpoint uuids to connect\n\t\t\tif (params.uuids) {\n\t\t\t\t_p.sourceEndpoint = _getEndpoint(params.uuids[0]);\n\t\t\t\t_p.targetEndpoint = _getEndpoint(params.uuids[1]);\n\t\t\t}\t\t\t\t\t\t\n\n\t\t\t// now ensure that if we do have Endpoints already, they're not full.\n\t\t\t// source:\n\t\t\tif (_p.sourceEndpoint && _p.sourceEndpoint.isFull()) {\n\t\t\t\t_ju.log(_currentInstance, \"could not add connection; source endpoint is full\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// target:\n\t\t\tif (_p.targetEndpoint && _p.targetEndpoint.isFull()) {\n\t\t\t\t_ju.log(_currentInstance, \"could not add connection; target endpoint is full\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t// if source endpoint mandates connection type and nothing specified in our params, use it.\n\t\t\tif (!_p.type && _p.sourceEndpoint)\n\t\t\t\t_p.type = _p.sourceEndpoint.connectionType;\n\t\t\t\n\t\t\t// copy in any connectorOverlays that were specified on the source endpoint.\n\t\t\t// it doesnt copy target endpoint overlays.  i'm not sure if we want it to or not.\n\t\t\tif (_p.sourceEndpoint && _p.sourceEndpoint.connectorOverlays) {\n\t\t\t\t_p.overlays = _p.overlays || [];\n\t\t\t\tfor (var i = 0, j = _p.sourceEndpoint.connectorOverlays.length; i < j; i++) {\n\t\t\t\t\t_p.overlays.push(_p.sourceEndpoint.connectorOverlays[i]);\n\t\t\t\t}\n\t\t\t}\t\t\n            \n            // pointer events\n            if (!_p[\"pointer-events\"] && _p.sourceEndpoint && _p.sourceEndpoint.connectorPointerEvents)\n                _p[\"pointer-events\"] = _p.sourceEndpoint.connectorPointerEvents;\n\n            var _mergeOverrides = function(def, values) {\n            \tvar m = jsPlumb.extend({}, def);\n            \tfor (var i in values) {\n            \t\tif (values[i]) m[i] = values[i];\n            \t}\n            \treturn m;\n            };\n\n            var _addEndpoint = function(el, def, idx) {\n            \treturn _currentInstance.addEndpoint(el, _mergeOverrides(def, {\n            \t\tanchor:_p.anchors ? _p.anchors[idx] : _p.anchor,\n            \t\tendpoint:_p.endpoints ? _p.endpoints[idx] : _p.endpoint,\n            \t\tpaintStyle:_p.endpointStyles ? _p.endpointStyles[idx] : _p.endpointStyle,\n            \t\thoverPaintStyle:_p.endpointHoverStyles ? _p.endpointHoverStyles[idx] : _p.endpointHoverStyle\n            \t}));\n            };\n\t\t\t\t\t\t\t\t\t\n\t\t\t// check for makeSource/makeTarget specs.\n\n            var _oneElementDef = function(type, idx, defs) {\n                if (_p[type] && !_p[type].endpoint && !_p[type + \"Endpoint\"] && !_p.newConnection) {\n                    var tid = _getId(_p[type]), tep = defs[tid];\n\n                    if (tep) {\n                        // if not enabled, return.\n                        if (!tep.enabled) return false;\n\n                        var newEndpoint = tep.endpoint != null && tep.endpoint._jsPlumb ? tep.endpoint : _addEndpoint(_p[type], tep.def, idx);\n                        if (tep.uniqueEndpoint) tep.endpoint = newEndpoint;\n                        if (newEndpoint.isFull()) return false;\n                        _p[type + \"Endpoint\"] = newEndpoint;\n                        newEndpoint._doNotDeleteOnDetach = false; // reset.\n                        newEndpoint._deleteOnDetach = true;\n                    }\n                }\n            };\n\n            if (_oneElementDef(\"source\", 0, this.sourceEndpointDefinitions) === false) return;\n            if (_oneElementDef(\"target\", 1, this.targetEndpointDefinitions) === false) return;\n\n            // last, ensure scopes match\n            if (_p.sourceEndpoint && _p.targetEndpoint)\n                if (!_scopeMatch(_p.sourceEndpoint, _p.targetEndpoint)) _p = null;\n\t\t\t\n\t\t\treturn _p;\n\t\t}.bind(_currentInstance),\n\t\t\n\t\t_newConnection = function(params) {\n\t\t\tvar connectionFunc = _currentInstance.Defaults.ConnectionType || _currentInstance.getDefaultConnectionType();\n\t\t\t\n\t\t\tparams._jsPlumb = _currentInstance;\n            params.newConnection = _newConnection;\n            params.newEndpoint = _newEndpoint;\n            params.endpointsByUUID = endpointsByUUID;             \n            params.endpointsByElement = endpointsByElement;  \n            params.finaliseConnection = _finaliseConnection;\n\t\t\tvar con = new connectionFunc(params);\n\t\t\tcon.id = \"con_\" + _idstamp();\n\n            // if the connection is draggable, then maybe we need to tell the target endpoint to init the\n            // dragging code. it won't run again if it already configured to be draggable.\n            if (con.isDetachable()) {\n            \tcon.endpoints[0].initDraggable();\n            \tcon.endpoints[1].initDraggable();\n            }\n\n\t\t\treturn con;\n\t\t},\n\t\t\n\t\t//\n\t\t// adds the connection to the backing model, fires an event if necessary and then redraws\n\t\t//\n\t\t_finaliseConnection = _currentInstance.finaliseConnection = function(jpc, params, originalEvent, doInformAnchorManager) {\n            params = params || {};\n\t\t\t// add to list of connections (by scope).\n            if (!jpc.suspendedEndpoint)\n\t\t\t    connections.push(jpc);\n\n\t\t\t// turn off isTemporarySource on the source endpoint (only viable on first draw)\n\t\t\tjpc.endpoints[0].isTemporarySource = false;\n\t\t\t\n            // always inform the anchor manager\n            // except that if jpc has a suspended endpoint it's not true to say the\n            // connection is new; it has just (possibly) moved. the question is whether\n            // to make that call here or in the anchor manager.  i think perhaps here.\n            if (jpc.suspendedEndpoint == null || doInformAnchorManager)\n            \t_currentInstance.anchorManager.newConnection(jpc);\n\n\t\t\t// force a paint\n\t\t\t_draw(jpc.source);\n\t\t\t\n\t\t\t// fire an event\n\t\t\tif (!params.doNotFireConnectionEvent && params.fireEvent !== false) {\n\t\t\t\n\t\t\t\tvar eventArgs = {\n\t\t\t\t\tconnection:jpc,\n\t\t\t\t\tsource : jpc.source, target : jpc.target,\n\t\t\t\t\tsourceId : jpc.sourceId, targetId : jpc.targetId,\n\t\t\t\t\tsourceEndpoint : jpc.endpoints[0], targetEndpoint : jpc.endpoints[1]\n\t\t\t\t};\n\t\t\t\n\t\t\t\t_currentInstance.fire(\"connection\", eventArgs, originalEvent);\n\t\t\t}\n\t\t},\n\n\t\t/*\n\t\t\tfactory method to prepare a new endpoint.  this should always be used instead of creating Endpoints\n\t\t\tmanually, since this method attaches event listeners and an id.\n\t\t*/\n\t\t_newEndpoint = function(params, id) {\n            var endpointFunc = _currentInstance.Defaults.EndpointType || jsPlumb.Endpoint;\n            var _p = jsPlumb.extend({}, params);\n            _p._jsPlumb = _currentInstance;\n            _p.newConnection = _newConnection;\n            _p.newEndpoint = _newEndpoint;\n            _p.endpointsByUUID = endpointsByUUID;\n            _p.endpointsByElement = endpointsByElement;\n            _p.fireDetachEvent = fireDetachEvent;\n            _p.elementId = id || _getId(_p.source);\n            var ep = new endpointFunc(_p);\n            ep.id = \"ep_\" + _idstamp();\n            _manage(_p.elementId, _p.source);\n            if (!jsPlumbAdapter.headless)\n                _currentInstance.dragManager.endpointAdded(_p.source, id);\n\n\t\t\treturn ep;\n\t\t},\n\t\t\n\t\t/*\n\t\t * performs the given function operation on all the connections found\n\t\t * for the given element id; this means we find all the endpoints for\n\t\t * the given element, and then for each endpoint find the connectors\n\t\t * connected to it. then we pass each connection in to the given\n\t\t * function.\t\t \n\t\t */\n\t\t_operation = function(elId, func, endpointFunc) {\n\t\t\tvar endpoints = endpointsByElement[elId];\n\t\t\tif (endpoints && endpoints.length) {\n\t\t\t\tfor ( var i = 0, ii = endpoints.length; i < ii; i++) {\n\t\t\t\t\tfor ( var j = 0, jj = endpoints[i].connections.length; j < jj; j++) {\n\t\t\t\t\t\tvar retVal = func(endpoints[i].connections[j]);\n\t\t\t\t\t\t// if the function passed in returns true, we exit.\n\t\t\t\t\t\t// most functions return false.\n\t\t\t\t\t\tif (retVal) return;\n\t\t\t\t\t}\n\t\t\t\t\tif (endpointFunc) endpointFunc(endpoints[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\t\n\t\t\n\t\t_setDraggable = function(element, draggable) {\n\t\t\treturn _elementProxy(element, function(el, id) {\n\t\t\t\tdraggableStates[id] = draggable;\n\t\t\t\tif (this.isDragSupported(el)) {\n\t\t\t\t\tthis.setElementDraggable(el, draggable);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/*\n\t\t * private method to do the business of hiding/showing.\n\t\t * \n\t\t * @param el\n\t\t *            either Id of the element in question or a library specific\n\t\t *            object for the element.\n\t\t * @param state\n\t\t *            String specifying a value for the css 'display' property\n\t\t *            ('block' or 'none').\n\t\t */\n\t\t_setVisible = function(el, state, alsoChangeEndpoints) {\n\t\t\tstate = state === \"block\";\n\t\t\tvar endpointFunc = null;\n\t\t\tif (alsoChangeEndpoints) {\n\t\t\t\tif (state) endpointFunc = function(ep) {\n\t\t\t\t\tep.setVisible(true, true, true);\n\t\t\t\t};\n\t\t\t\telse endpointFunc = function(ep) {\n\t\t\t\t\tep.setVisible(false, true, true);\n\t\t\t\t};\n\t\t\t}\n\t\t\tvar info = _info(el);\n\t\t\t_operation(info.id, function(jpc) {\n\t\t\t\tif (state && alsoChangeEndpoints) {\t\t\n\t\t\t\t\t// this test is necessary because this functionality is new, and i wanted to maintain backwards compatibility.\n\t\t\t\t\t// this block will only set a connection to be visible if the other endpoint in the connection is also visible.\n\t\t\t\t\tvar oidx = jpc.sourceId === info.id ? 1 : 0;\n\t\t\t\t\tif (jpc.endpoints[oidx].isVisible()) jpc.setVisible(true);\n\t\t\t\t}\n\t\t\t\telse  // the default behaviour for show, and what always happens for hide, is to just set the visibility without getting clever.\n\t\t\t\t\tjpc.setVisible(state);\n\t\t\t}, endpointFunc);\n\t\t},\n\t\t/*\n\t\t * toggles the draggable state of the given element(s).\n\t\t * el is either an id, or an element object, or a list of ids/element objects.\n\t\t */\n\t\t_toggleDraggable = function(el) {\n\t\t\treturn _elementProxy(el, function(el, elId) {\n\t\t\t\tvar state = draggableStates[elId] == null ? false : draggableStates[elId];\n\t\t\t\tstate = !state;\n\t\t\t\tdraggableStates[elId] = state;\n\t\t\t\tthis.setDraggable(el, state);\n\t\t\t\treturn state;\n            }.bind(this));\n\t\t},\n\t\t/**\n\t\t * private method to do the business of toggling hiding/showing.\n\t\t */\n\t\t_toggleVisible = function(elId, changeEndpoints) {\n\t\t\tvar endpointFunc = null;\n\t\t\tif (changeEndpoints) {\n\t\t\t\tendpointFunc = function(ep) {\n\t\t\t\t\tvar state = ep.isVisible();\n\t\t\t\t\tep.setVisible(!state);\n\t\t\t\t};\n\t\t\t}\n\t\t\t_operation(elId, function(jpc) {\n\t\t\t\tvar state = jpc.isVisible();\n\t\t\t\tjpc.setVisible(!state);\t\t\t\t\n\t\t\t}, endpointFunc);\n\t\t\t// todo this should call _elementProxy, and pass in the\n\t\t\t// _operation(elId, f) call as a function. cos _toggleDraggable does\n\t\t\t// that.\n\t\t},\n\n\t\t// TODO comparison performance\n\t\t_getCachedData = function(elId) {\n\t\t\tvar o = offsets[elId];\n\t\t\tif (!o) \n                return _updateOffset({elId:elId});\n\t\t\telse\n                return {o:o, s:sizes[elId]};\n\t\t},\n\n\t\t/**\n\t\t * gets an id for the given element, creating and setting one if\n\t\t * necessary.  the id is of the form\n\t\t *\n\t\t *\tjsPlumb_<instance index>_<index in instance>\n\t\t *\n\t\t * where \"index in instance\" is a monotonically increasing integer that starts at 0,\n\t\t * for each instance.  this method is used not only to assign ids to elements that do not\n\t\t * have them but also to connections and endpoints.\n\t\t */\n\t\t_getId = function(element, uuid, doNotCreateIfNotFound) {\n\t\t\tif (jsPlumbUtil.isString(element)) return element;\t\t\t\n\t\t\tif (element == null) return null;\t\t\t\n\t\t\tvar id = _currentInstance.getAttribute(element, \"id\");\n\t\t\tif (!id || id === \"undefined\") {\n\t\t\t\t// check if fixed uuid parameter is given\n\t\t\t\tif (arguments.length == 2 && arguments[1] !== undefined)\n\t\t\t\t\tid = uuid;\n\t\t\t\telse if (arguments.length == 1 || (arguments.length == 3 && !arguments[2]))\n\t\t\t\t\tid = \"jsPlumb_\" + _instanceIndex + \"_\" + _idstamp();\n\t\t\t\t\n                if (!doNotCreateIfNotFound) _currentInstance.setAttribute(element, \"id\", id);\n\t\t\t}\n\t\t\treturn id;\n\t\t};\n\n\t\tthis.setConnectionBeingDragged = function(v) {\n\t\t\tconnectionBeingDragged = v;\n\t\t};\n\t\tthis.isConnectionBeingDragged = function() {\n\t\t\treturn connectionBeingDragged;\n\t\t};\n    \n\t\tthis.connectorClass = \"_jsPlumb_connector\";            \t\t\n\t\tthis.hoverClass = \"_jsPlumb_hover\";            \t\t\n\t\tthis.endpointClass = \"_jsPlumb_endpoint\";\t\t\n\t\tthis.endpointConnectedClass = \"_jsPlumb_endpoint_connected\";\t\t\n\t\tthis.endpointFullClass = \"_jsPlumb_endpoint_full\";\t\t\n\t\tthis.endpointDropAllowedClass = \"_jsPlumb_endpoint_drop_allowed\";\t\t\n\t\tthis.endpointDropForbiddenClass = \"_jsPlumb_endpoint_drop_forbidden\";\t\t\n\t\tthis.overlayClass = \"_jsPlumb_overlay\";\t\t\t\t\n\t\tthis.draggingClass = \"_jsPlumb_dragging\";\t\t\n\t\tthis.elementDraggingClass = \"_jsPlumb_element_dragging\";\t\t\t\n\t\tthis.sourceElementDraggingClass = \"_jsPlumb_source_element_dragging\";\n\t\tthis.targetElementDraggingClass = \"_jsPlumb_target_element_dragging\";\n\t\tthis.endpointAnchorClassPrefix = \"_jsPlumb_endpoint_anchor\";\n\t\tthis.hoverSourceClass = \"_jsPlumb_source_hover\";\t\n\t\tthis.hoverTargetClass = \"_jsPlumb_target_hover\";\n\t\tthis.dragSelectClass = \"_jsPlumb_drag_select\";\n\n\t\tthis.Anchors = {};\t\t\n\t\tthis.Connectors = {  \"svg\":{}, \"vml\":{} };\t\t\t\t\n\t\tthis.Endpoints = { \"svg\":{}, \"vml\":{} };\n\t\tthis.Overlays = { \"svg\":{}, \"vml\":{}};\t\t\n\t\tthis.ConnectorRenderers = {};\t\t\t\t\n\t\tthis.SVG = \"svg\";\n\t\tthis.VML = \"vml\";\t\t\t\t\n\n// --------------------------- jsPlumbInstance public API ---------------------------------------------------------\n\n\n        this.addEndpoint = function(el, params, referenceParams) {\n            referenceParams = referenceParams || {};\n            var p = jsPlumb.extend({}, referenceParams);\n            jsPlumb.extend(p, params);\n            p.endpoint = p.endpoint || _currentInstance.Defaults.Endpoint;\n            p.paintStyle = p.paintStyle || _currentInstance.Defaults.EndpointStyle;\n\n            var results = [],\n                inputs = (_ju.isArray(el) || (el.length != null && !_ju.isString(el))) ? el : [ el ];\n\n            for (var i = 0, j = inputs.length; i < j; i++) {\n                p.source = _currentInstance.getDOMElement(inputs[i]);\n                _ensureContainer(p.source);\n\n                var id = _getId(p.source), e = _newEndpoint(p, id);\n\n                // SP new. here we have introduced a class-wide element manager, which is responsible\n                // for getting object dimensions and width/height, and for updating these values only\n                // when necessary (after a drag, or on a forced refresh call).\n                var myOffset = _manage(id, p.source).info.o;\n                _ju.addToList(endpointsByElement, id, e);\n\n                if (!_suspendDrawing) {\n                    e.paint({\n                        anchorLoc: e.anchor.compute({ xy: [ myOffset.left, myOffset.top ], wh: sizes[id], element: e, timestamp: _suspendedAt }),\n                        timestamp: _suspendedAt\n                    });\n                }\n\n                results.push(e);\n                e._doNotDeleteOnDetach = true; // mark this as being added via addEndpoint.\n            }\n\n            return results.length == 1 ? results[0] : results;\n        };\n\n\t\tthis.addEndpoints = function(el, endpoints, referenceParams) {\n\t\t\tvar results = [];\n\t\t\tfor ( var i = 0, j = endpoints.length; i < j; i++) {\n\t\t\t\tvar e = _currentInstance.addEndpoint(el, endpoints[i], referenceParams);\n\t\t\t\tif (_ju.isArray(e))\n\t\t\t\t\tArray.prototype.push.apply(results, e);\n\t\t\t\telse results.push(e);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\t\t\n\t\tthis.animate = function(el, properties, options) {\n\t\t\toptions = options || {};\n\t\t\tvar ele = _currentInstance.getElementObject(el),\n\t\t\t\tdel = _currentInstance.getDOMElement(el),\n\t\t\t\tid = _getId(del),\n\t\t\t\tstepFunction = jsPlumb.animEvents.step,\n\t\t\t\tcompleteFunction = jsPlumb.animEvents.complete;\n\n\t\t\toptions[stepFunction] = _ju.wrap(options[stepFunction], function() {\n\t\t\t\t_currentInstance.revalidate(id);\n\t\t\t});\n\n\t\t\t// onComplete repaints, just to make sure everything looks good at the end of the animation.\n\t\t\toptions[completeFunction] = _ju.wrap(options[completeFunction], function() {\n\t\t\t\t_currentInstance.revalidate(id);\n\t\t\t});\n\n\t\t\t_currentInstance.doAnimate(ele, properties, options);\n\t\t};\n\t\t\n\t\t/**\n\t\t* checks for a listener for the given condition, executing it if found, passing in the given value.\n\t\t* condition listeners would have been attached using \"bind\" (which is, you could argue, now overloaded, since\n\t\t* firing click events etc is a bit different to what this does).  i thought about adding a \"bindCondition\"\n\t\t* or something, but decided against it, for the sake of simplicity. jsPlumb will never fire one of these\n\t\t* condition events anyway.\n\t\t*/\n\t\tthis.checkCondition = function(conditionName, value) {\n\t\t\tvar l = _currentInstance.getListener(conditionName),\n\t\t\t\tr = true;\n\t\t\t\t\n\t\t\tif (l && l.length > 0) {\n\t\t\t\ttry {\n\t\t\t\t\tfor (var i = 0, j = l.length; i < j; i++) {\n\t\t\t\t\t\tr = r && l[i](value); \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e) { \n\t\t\t\t\t_ju.log(_currentInstance, \"cannot check condition [\" + conditionName + \"]\" + e); \n\t\t\t\t}\n\t\t\t}\n\t\t\treturn r;\n\t\t};\n\t\t\n\t\tthis.connect = function(params, referenceParams) {\n\t\t\t// prepare a final set of parameters to create connection with\n\t\t\tvar _p = _prepareConnectionParams(params, referenceParams), jpc;\n\t\t\t// TODO probably a nicer return value if the connection was not made.  _prepareConnectionParams\n\t\t\t// will return null (and log something) if either endpoint was full.  what would be nicer is to \n\t\t\t// create a dedicated 'error' object.\n\t\t\tif (_p) {\n                if (_p.source == null && _p.sourceEndpoint == null) {\n                    jsPlumbUtil.log(\"Cannot establish connection - source does not exist\");\n                    return;\n                }\n                if (_p.target == null && _p.targetEndpoint == null) {\n                    jsPlumbUtil.log(\"Cannot establish connection - target does not exist\");\n                    return;\n                }\n\t\t\t\t_ensureContainer(_p.source);\n\t\t\t\t// create the connection.  it is not yet registered \n\t\t\t\tjpc = _newConnection(_p);\n\t\t\t\t// now add it the model, fire an event, and redraw\n\t\t\t\t_finaliseConnection(jpc, _p);\t\t\t\t\t\t\t\t\t\t\n\t\t\t}\n\t\t\treturn jpc;\n\t\t};\t\t\n\t\t\n\t\tvar stTypes = [\n\t\t\t{ el:\"source\", elId:\"sourceId\", epDefs:\"sourceEndpointDefinitions\" },\n\t\t\t{ el:\"target\", elId:\"targetId\", epDefs:\"targetEndpointDefinitions\" }\n\t\t];\n\t\t\n\t\tvar _set = function(c, el, idx, doNotRepaint) {\n\t\t\tvar ep, _st = stTypes[idx], cId = c[_st.elId], cEl = c[_st.el], sid, sep,\n\t\t\t\toldEndpoint = c.endpoints[idx];\n\t\t\t\n\t\t\tvar evtParams = {\n\t\t\t\tindex:idx,\n\t\t\t\toriginalSourceId:idx === 0 ? cId : c.sourceId,\n\t\t\t\tnewSourceId:c.sourceId,\n\t\t\t\toriginalTargetId:idx == 1 ? cId : c.targetId,\n\t\t\t\tnewTargetId:c.targetId,\n\t\t\t\tconnection:c\n\t\t\t};\n\n\t\t\tif (el.constructor == jsPlumb.Endpoint) { // TODO here match the current endpoint class; users can change it {\n\t\t\t\tep = el;\n\t\t\t\tep.addConnection(c);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsid = _getId(el);\n\t\t\t\tsep = this[_st.epDefs][sid];\n\n\t\t\t\tif (sid === c[_st.elId]) \n\t\t\t\t\tep = null;  // dont change source/target if the element is already the one given.\n\t\t\t\telse if (sep) {\n\t\t\t\t\tif (!sep.enabled) return;\n\t\t\t\t\tep = sep.endpoint != null && sep.endpoint._jsPlumb ? sep.endpoint : this.addEndpoint(el, sep.def);\n\t\t\t\t\tif (sep.uniqueEndpoint) sep.endpoint = ep;\n\t\t\t\t\tep._doNotDeleteOnDetach = false;\n\t\t\t\t\tep._deleteOnDetach = true;\n\t\t\t\t\tep.addConnection(c);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tep = c.makeEndpoint(idx === 0, el, sid);\n\t\t\t\t\tep._doNotDeleteOnDetach = false;\n\t\t\t\t\tep._deleteOnDetach = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (ep != null) {\n\t\t\t\toldEndpoint.detachFromConnection(c);\n\t\t\t\tc.endpoints[idx] = ep;\n\t\t\t\tc[_st.el] = ep.element;\n\t\t\t\tc[_st.elId] = ep.elementId;\t\t\t\n\t\t\t\tevtParams[idx === 0 ? \"newSourceId\" : \"newTargetId\"] = ep.elementId;\n\n\t\t\t\tfireMoveEvent(evtParams);\n\t\t\t\t\n\t\t\t\tif (!doNotRepaint)\n\t\t\t\t\tc.repaint();\n\t\t\t}\n\n\t\t\treturn evtParams;\n\t\t\t\n\t\t}.bind(this);\n\n\t\tthis.setSource = function(connection, el, doNotRepaint) { \n\t\t\tvar p = _set(connection, el, 0, doNotRepaint); \n\t\t\tthis.anchorManager.sourceChanged(p.originalSourceId, p.newSourceId, connection);\n\t\t};\n\t\tthis.setTarget = function(connection, el, doNotRepaint) { \n\t\t\tvar p = _set(connection, el, 1, doNotRepaint); \n\t\t\tthis.anchorManager.updateOtherEndpoint(p.originalSourceId, p.originalTargetId, p.newTargetId, connection);\n\t\t};\n\t\t\n\t\tthis.deleteEndpoint = function(object, dontUpdateHover) {\n\t\t\tvar endpoint = (typeof object === \"string\") ? endpointsByUUID[object] : object;\n\t\t\tif (endpoint) {\t\t\n\t\t\t\t_currentInstance.deleteObject({ endpoint:endpoint, dontUpdateHover:dontUpdateHover });\n\t\t\t}\n\t\t\treturn _currentInstance;\n\t\t};\t\t\n\t\t\n\t\tthis.deleteEveryEndpoint = function() {\n\t\t\tvar _is = _currentInstance.setSuspendDrawing(true);\n\t\t\tfor ( var id in endpointsByElement) {\n\t\t\t\tvar endpoints = endpointsByElement[id];\n\t\t\t\tif (endpoints && endpoints.length) {\n\t\t\t\t\tfor ( var i = 0, j = endpoints.length; i < j; i++) {\n                        _currentInstance.deleteEndpoint(endpoints[i], true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tendpointsByElement = {};\n            // SP new\n            managedElements = {};\n\t\t\tendpointsByUUID = {};\n\t\t\t_currentInstance.anchorManager.reset();\n\t\t\t_currentInstance.dragManager.reset();\t\t\t\t\t\t\t\n\t\t\tif(!_is) _currentInstance.setSuspendDrawing(false);\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\tvar fireDetachEvent = function(jpc, doFireEvent, originalEvent) {\n            // may have been given a connection, or in special cases, an object\n            var connType =  _currentInstance.Defaults.ConnectionType || _currentInstance.getDefaultConnectionType(),\n                argIsConnection = jpc.constructor == connType,\n                params = argIsConnection ? {\n                    connection:jpc,\n\t\t\t\t    source : jpc.source, target : jpc.target,\n\t\t\t\t    sourceId : jpc.sourceId, targetId : jpc.targetId,\n\t\t\t\t    sourceEndpoint : jpc.endpoints[0], targetEndpoint : jpc.endpoints[1]\n                } : jpc;\n\n\t\t\tif (doFireEvent)\n\t\t\t\t_currentInstance.fire(\"connectionDetached\", params, originalEvent);\n\t\t\t\n            _currentInstance.anchorManager.connectionDetached(params);\n\t\t};\t\n\n\t\tvar fireMoveEvent = _currentInstance.fireMoveEvent = function(params, evt) {\n\t\t\t_currentInstance.fire(\"connectionMoved\", params, evt);\n\t\t};\n\n\t\tthis.unregisterEndpoint = function(endpoint) {\n\t\t\t//if (endpoint._jsPlumb == null) return;\n\t\t\tif (endpoint._jsPlumb.uuid) endpointsByUUID[endpoint._jsPlumb.uuid] = null;\t\t\t\t\n\t\t\t_currentInstance.anchorManager.deleteEndpoint(endpoint);\t\t\t\n\t\t\t// TODO at least replace this with a removeWithFunction call.\t\t\t\n\t\t\tfor (var e in endpointsByElement) {\n\t\t\t\tvar endpoints = endpointsByElement[e];\n\t\t\t\tif (endpoints) {\n\t\t\t\t\tvar newEndpoints = [];\n\t\t\t\t\tfor (var i = 0, j = endpoints.length; i < j; i++)\n\t\t\t\t\t\tif (endpoints[i] != endpoint) newEndpoints.push(endpoints[i]);\n\t\t\t\t\t\n\t\t\t\t\tendpointsByElement[e] = newEndpoints;\n\t\t\t\t}\n\t\t\t\tif(endpointsByElement[e].length <1){\n\t\t\t\t\tdelete endpointsByElement[e];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\t\t\n\t\tthis.detach = function() {\n\n            if (arguments.length === 0) return;\n            var connType =  _currentInstance.Defaults.ConnectionType || _currentInstance.getDefaultConnectionType(),\n                firstArgIsConnection = arguments[0].constructor == connType,\n                params = arguments.length == 2 ? firstArgIsConnection ? (arguments[1] || {}) : arguments[0] : arguments[0],\n                fireEvent = (params.fireEvent !== false),\n                forceDetach = params.forceDetach,\n                conn = firstArgIsConnection ? arguments[0] : params.connection;\n                                                    \n\t\t\t\tif (conn) {             \n                    if (forceDetach || jsPlumbUtil.functionChain(true, false, [\n                            [ conn.endpoints[0], \"isDetachAllowed\", [ conn ] ],    \n                            [ conn.endpoints[1], \"isDetachAllowed\", [ conn ] ],\n                            [ conn, \"isDetachAllowed\", [ conn ] ],\n                            [ _currentInstance, \"checkCondition\", [ \"beforeDetach\", conn ] ] ])) {\n                        \n                        conn.endpoints[0].detach(conn, false, true, fireEvent); \n                    }\n                }\n                else {\n\t\t\t\t\tvar _p = jsPlumb.extend( {}, params); // a backwards compatibility hack: source should be thought of as 'params' in this case.\n\t\t\t\t\t// test for endpoint uuids to detach\n\t\t\t\t\tif (_p.uuids) {\n\t\t\t\t\t\t_getEndpoint(_p.uuids[0]).detachFrom(_getEndpoint(_p.uuids[1]), fireEvent);\n\t\t\t\t\t} else if (_p.sourceEndpoint && _p.targetEndpoint) {\n\t\t\t\t\t\t_p.sourceEndpoint.detachFrom(_p.targetEndpoint);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar sourceId = _getId(_currentInstance.getDOMElement(_p.source)),\n\t\t\t\t\t\t    targetId = _getId(_currentInstance.getDOMElement(_p.target));\n\t\t\t\t\t\t_operation(sourceId, function(jpc) {\n\t\t\t\t\t\t    if ((jpc.sourceId == sourceId && jpc.targetId == targetId) || (jpc.targetId == sourceId && jpc.sourceId == targetId)) {\n\t\t\t\t\t\t\t    if (_currentInstance.checkCondition(\"beforeDetach\", jpc)) {\n                                    jpc.endpoints[0].detach(jpc, false, true, fireEvent);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t};\n\n\t\tthis.detachAllConnections = function(el, params) {\n            params = params || {};\n            el = _currentInstance.getDOMElement(el);\n\t\t\tvar id = _getId(el),\n                endpoints = endpointsByElement[id];\n\t\t\tif (endpoints && endpoints.length) {\n\t\t\t\tfor ( var i = 0, j = endpoints.length; i < j; i++) {\n\t\t\t\t\tendpoints[i].detachAll(params.fireEvent !== false);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\tthis.detachEveryConnection = function(params) {\n            params = params || {};\n            _currentInstance.doWhileSuspended(function() {\n\t\t\t\tfor ( var id in endpointsByElement) {\n\t\t\t\t\tvar endpoints = endpointsByElement[id];\n\t\t\t\t\tif (endpoints && endpoints.length) {\n\t\t\t\t\t\tfor ( var i = 0, j = endpoints.length; i < j; i++) {\n\t\t\t\t\t\t\tendpoints[i].detachAll(params.fireEvent !== false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconnections.length = 0;\n\t\t\t});\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\t/// not public.  but of course its exposed. how to change this.\n\t\tthis.deleteObject = function(params) {\n\t\t\tvar result = {\n\t\t\t\t\tendpoints : {}, \n\t\t\t\t\tconnections : {},\n\t\t\t\t\tendpointCount:0,\n\t\t\t\t\tconnectionCount:0\n\t\t\t\t},\n\t\t\t\tfireEvent = params.fireEvent !== false,\n\t\t\t\tdeleteAttachedObjects = params.deleteAttachedObjects !== false;\n\n\t\t\tvar unravelConnection = function(connection) {\n\t\t\t\tif(connection != null && result.connections[connection.id] == null) {\n\t\t\t\t\tif (!params.dontUpdateHover && connection._jsPlumb != null) connection.setHover(false);\n\t\t\t\t\tresult.connections[connection.id] = connection;\n\t\t\t\t\tresult.connectionCount++;\n\t\t\t\t\tif (deleteAttachedObjects) {\n\t\t\t\t\t\tfor (var j = 0; j < connection.endpoints.length; j++) {\n\t\t\t\t\t\t\tif (connection.endpoints[j]._deleteOnDetach)\n\t\t\t\t\t\t\t\tunravelEndpoint(connection.endpoints[j]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar unravelEndpoint = function(endpoint) {\n\t\t\t\tif(endpoint != null && result.endpoints[endpoint.id] == null) {\n\t\t\t\t\tif (!params.dontUpdateHover && endpoint._jsPlumb != null) endpoint.setHover(false);\n\t\t\t\t\tresult.endpoints[endpoint.id] = endpoint;\n\t\t\t\t\tresult.endpointCount++;\n\n\t\t\t\t\tif (deleteAttachedObjects) {\n\t\t\t\t\t\tfor (var i = 0; i < endpoint.connections.length; i++) {\n\t\t\t\t\t\t\tvar c = endpoint.connections[i];\n\t\t\t\t\t\t\tunravelConnection(c);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (params.connection) \n\t\t\t\tunravelConnection(params.connection);\n\t\t\telse unravelEndpoint(params.endpoint);\n\n\t\t\t// loop through connections\n\t\t\tfor (var i in result.connections) {\n\t\t\t\tvar c = result.connections[i];\n\t\t\t\tif (c._jsPlumb) {\n\t\t\t\t\tjsPlumbUtil.removeWithFunction(connections, function(_c) {\n\t\t\t\t\t\treturn c.id == _c.id;\n\t\t\t\t\t});\n\t\t\t\t\tfireDetachEvent(c, fireEvent, params.originalEvent);\n\t\t\t\t\t\n\t\t\t\t\tc.endpoints[0].detachFromConnection(c);\n\t\t\t\t\tc.endpoints[1].detachFromConnection(c);\n\t\t\t\t\t// sp was ere\n\t\t\t\t\tc.cleanup();\n\t\t\t\t\tc.destroy();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop through endpoints\n\t\t\tfor (var j in result.endpoints) {\n\t\t\t\tvar e = result.endpoints[j];\t\n\t\t\t\tif (e._jsPlumb) {\n\t\t\t\t\t_currentInstance.unregisterEndpoint(e);\n\t\t\t\t\t// FIRE some endpoint deleted event?\n\t\t\t\t\te.cleanup();\n\t\t\t\t\te.destroy();\n\t\t\t\t}\n\t\t\t}\t\n\n\t\t\treturn result;\n\t\t};\n \n\t\tthis.draggable = function(el, options) {\n\t\t\tvar i,j,info;\n\t\t\t// allows for array or jquery selector\n\t\t\tif (typeof el == 'object' && el.length) {\n\t\t\t\tfor (i = 0, j = el.length; i < j; i++) {\n\t\t\t\t\tinfo = _info(el[i]);\n\t\t\t\t\tif (info.el) _initDraggableIfNecessary(info.el, true, options, info.id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\t\t\t\t\n\t\t\t\t//ele = _currentInstance.getDOMElement(el);\n                info = _info(el);\n\t\t\t\tif (info.el) _initDraggableIfNecessary(info.el, true, options, info.id);\n\t\t\t}\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\t// helpers for select/selectEndpoints\n\t\tvar _setOperation = function(list, func, args, selector) {\n\t\t\t\tfor (var i = 0, j = list.length; i < j; i++) {\n\t\t\t\t\tlist[i][func].apply(list[i], args);\n\t\t\t\t}\t\n\t\t\t\treturn selector(list);\n\t\t\t},\n\t\t\t_getOperation = function(list, func, args) {\n\t\t\t\tvar out = [];\n\t\t\t\tfor (var i = 0, j = list.length; i < j; i++) {\n\t\t\t\t\tout.push([ list[i][func].apply(list[i], args), list[i] ]);\n\t\t\t\t}\t\n\t\t\t\treturn out;\n\t\t\t},\n\t\t\tsetter = function(list, func, selector) {\n\t\t\t\treturn function() {\n\t\t\t\t\treturn _setOperation(list, func, arguments, selector);\n\t\t\t\t};\n\t\t\t},\n\t\t\tgetter = function(list, func) {\n\t\t\t\treturn function() {\n\t\t\t\t\treturn _getOperation(list, func, arguments);\n\t\t\t\t};\t\n\t\t\t},\n\t\t\tprepareList = function(input, doNotGetIds) {\n\t\t\t\tvar r = [];\n\t\t\t\tif (input) {\n\t\t\t\t\tif (typeof input == 'string') {\n\t\t\t\t\t\tif (input === \"*\") return input;\n\t\t\t\t\t\tr.push(input);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (doNotGetIds) r = input;\n\t\t\t\t\t\telse { \n\t\t\t\t\t\t\tif (input.length) {\n\t\t\t\t\t\t\t\tfor (var i = 0, j = input.length; i < j; i++)\n\t\t\t\t\t\t\t\t\tr.push(_info(input[i]).id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tr.push(_info(input).id);\n\t\t\t\t\t\t}\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn r;\n\t\t\t},\n\t\t\tfilterList = function(list, value, missingIsFalse) {\n\t\t\t\tif (list === \"*\") return true;\n\t\t\t\treturn list.length > 0 ? jsPlumbUtil.indexOf(list, value) != -1 : !missingIsFalse;\n\t\t\t};\n\n\t\t// get some connections, specifying source/target/scope\n\t\tthis.getConnections = function(options, flat) {\n\t\t\tif (!options) {\n\t\t\t\toptions = {};\n\t\t\t} else if (options.constructor == String) {\n\t\t\t\toptions = { \"scope\": options };\n\t\t\t}\n\t\t\tvar scope = options.scope || _currentInstance.getDefaultScope(),\n\t\t\t\tscopes = prepareList(scope, true),\n\t\t\t\tsources = prepareList(options.source),\n\t\t\t\ttargets = prepareList(options.target),\t\t\t\n\t\t\t\tresults = (!flat && scopes.length > 1) ? {} : [],\n\t\t\t\t_addOne = function(scope, obj) {\n\t\t\t\t\tif (!flat && scopes.length > 1) {\n\t\t\t\t\t\tvar ss = results[scope];\n\t\t\t\t\t\tif (ss == null) {\n\t\t\t\t\t\t\tss = results[scope] = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tss.push(obj);\n\t\t\t\t\t} else results.push(obj);\n\t\t\t\t};\n\t\t\t\n\t\t\tfor ( var j = 0, jj = connections.length; j < jj; j++) {\n\t\t\t\tvar c = connections[j];\n\t\t\t\tif (filterList(scopes, c.scope) && filterList(sources, c.sourceId) && filterList(targets, c.targetId))\n\t\t\t\t\t_addOne(c.scope, c);\n\t\t\t}\n\t\t\t\n\t\t\treturn results;\n\t\t};\n\t\t\n\t\tvar _curryEach = function(list, executor) {\n\t\t\t\treturn function(f) {\n\t\t\t\t\tfor (var i = 0, ii = list.length; i < ii; i++) {\n\t\t\t\t\t\tf(list[i]);\n\t\t\t\t\t}\n\t\t\t\t\treturn executor(list);\n\t\t\t\t};\t\t\n\t\t\t},\n\t\t\t_curryGet = function(list) {\n\t\t\t\treturn function(idx) {\n\t\t\t\t\treturn list[idx];\n\t\t\t\t};\n\t\t\t};\n\t\t\t\n\t\tvar _makeCommonSelectHandler = function(list, executor) {\n            var out = {\n                    length:list.length,\n\t\t\t\t    each:_curryEach(list, executor),\n\t\t\t\t    get:_curryGet(list)\n                },\n                setters = [\"setHover\", \"removeAllOverlays\", \"setLabel\", \"addClass\", \"addOverlay\", \"removeOverlay\", \n                           \"removeOverlays\", \"showOverlay\", \"hideOverlay\", \"showOverlays\", \"hideOverlays\", \"setPaintStyle\",\n                           \"setHoverPaintStyle\", \"setSuspendEvents\", \"setParameter\", \"setParameters\", \"setVisible\", \n                           \"repaint\", \"addType\", \"toggleType\", \"removeType\", \"removeClass\", \"setType\", \"bind\", \"unbind\" ],\n                \n                getters = [\"getLabel\", \"getOverlay\", \"isHover\", \"getParameter\", \"getParameters\", \"getPaintStyle\",\n                           \"getHoverPaintStyle\", \"isVisible\", \"hasType\", \"getType\", \"isSuspendEvents\" ],\n                i, ii;\n            \n            for (i = 0, ii = setters.length; i < ii; i++)\n                out[setters[i]] = setter(list, setters[i], executor);\n            \n            for (i = 0, ii = getters.length; i < ii; i++)\n                out[getters[i]] = getter(list, getters[i]);       \n            \n            return out;\n\t\t};\n\t\t\n\t\tvar\t_makeConnectionSelectHandler = function(list) {\n\t\t\tvar common = _makeCommonSelectHandler(list, _makeConnectionSelectHandler);\n\t\t\treturn jsPlumb.extend(common, {\n\t\t\t\t// setters\n\t\t\t\tsetDetachable:setter(list, \"setDetachable\", _makeConnectionSelectHandler),\n\t\t\t\tsetReattach:setter(list, \"setReattach\", _makeConnectionSelectHandler),\n\t\t\t\tsetConnector:setter(list, \"setConnector\", _makeConnectionSelectHandler),\t\t\t\n\t\t\t\tdetach:function() {\n\t\t\t\t\tfor (var i = 0, ii = list.length; i < ii; i++)\n\t\t\t\t\t\t_currentInstance.detach(list[i]);\n\t\t\t\t},\t\t\t\t\n\t\t\t\t// getters\n\t\t\t\tisDetachable:getter(list, \"isDetachable\"),\n\t\t\t\tisReattach:getter(list, \"isReattach\")\n\t\t\t});\n\t\t};\n\t\t\n\t\tvar\t_makeEndpointSelectHandler = function(list) {\n\t\t\tvar common = _makeCommonSelectHandler(list, _makeEndpointSelectHandler);\n\t\t\treturn jsPlumb.extend(common, {\n\t\t\t\tsetEnabled:setter(list, \"setEnabled\", _makeEndpointSelectHandler),\t\t\t\t\n\t\t\t\tsetAnchor:setter(list, \"setAnchor\", _makeEndpointSelectHandler),\n\t\t\t\tisEnabled:getter(list, \"isEnabled\"),\n\t\t\t\tdetachAll:function() {\n\t\t\t\t\tfor (var i = 0, ii = list.length; i < ii; i++)\n\t\t\t\t\t\tlist[i].detachAll();\n\t\t\t\t},\n\t\t\t\t\"remove\":function() {\n\t\t\t\t\tfor (var i = 0, ii = list.length; i < ii; i++)\n\t\t\t\t\t\t_currentInstance.deleteObject({endpoint:list[i]});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\t\n\n\t\tthis.select = function(params) {\n\t\t\tparams = params || {};\n\t\t\tparams.scope = params.scope || \"*\";\n\t\t\treturn _makeConnectionSelectHandler(params.connections || _currentInstance.getConnections(params, true));\t\t\t\t\t\t\t\n\t\t};\t\t\n\n\t\tthis.selectEndpoints = function(params) {\n\t\t\tparams = params || {};\n\t\t\tparams.scope = params.scope || \"*\";\n\t\t\tvar noElementFilters = !params.element && !params.source && !params.target,\t\t\t\n\t\t\t\telements = noElementFilters ? \"*\" : prepareList(params.element),\n\t\t\t\tsources = noElementFilters ? \"*\" : prepareList(params.source),\n\t\t\t\ttargets = noElementFilters ? \"*\" : prepareList(params.target),\n\t\t\t\tscopes = prepareList(params.scope, true);\n\t\t\t\n\t\t\tvar ep = [];\n\t\t\t\n\t\t\tfor (var el in endpointsByElement) {\n\t\t\t\tvar either = filterList(elements, el, true),\n\t\t\t\t\tsource = filterList(sources, el, true),\n\t\t\t\t\tsourceMatchExact = sources != \"*\",\n\t\t\t\t\ttarget = filterList(targets, el, true),\n\t\t\t\t\ttargetMatchExact = targets != \"*\"; \n\t\t\t\t\t\n\t\t\t\t// if they requested 'either' then just match scope. otherwise if they requested 'source' (not as a wildcard) then we have to match only endpoints that have isSource set to to true, and the same thing with isTarget.  \n\t\t\t\tif ( either || source  || target ) {\n\t\t\t\t\tinner:\n\t\t\t\t\tfor (var i = 0, ii = endpointsByElement[el].length; i < ii; i++) {\n\t\t\t\t\t\tvar _ep = endpointsByElement[el][i];\n\t\t\t\t\t\tif (filterList(scopes, _ep.scope, true)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar noMatchSource = (sourceMatchExact && sources.length > 0 && !_ep.isSource),\n\t\t\t\t\t\t\t\tnoMatchTarget = (targetMatchExact && targets.length > 0 && !_ep.isTarget);\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (noMatchSource || noMatchTarget)\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t  continue inner; \n\t\t\t\t\t\t\t \t\t\t\t\t\t\t\n\t\t\t\t\t\t\tep.push(_ep);\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\treturn _makeEndpointSelectHandler(ep);\n\t\t};\n\n\t\t// get all connections managed by the instance of jsplumb.\n\t\tthis.getAllConnections = function() { return connections; };\n\t\tthis.getDefaultScope = function() { return DEFAULT_SCOPE; };\n\t\t// get an endpoint by uuid.\n\t\tthis.getEndpoint = _getEndpoint;\t\t\t\t\n\t\t// get endpoints for some element.\n\t\tthis.getEndpoints = function(el) { return endpointsByElement[_info(el).id]; };\t\t\n\t\t// gets the default endpoint type. used when subclassing. see wiki.\n\t\tthis.getDefaultEndpointType = function() { return jsPlumb.Endpoint; };\t\t\n\t\t// gets the default connection type. used when subclassing.  see wiki.\n\t\tthis.getDefaultConnectionType = function() { return jsPlumb.Connection; };\n\t\t/*\n\t\t * Gets an element's id, creating one if necessary. really only exposed\n\t\t * for the lib-specific functionality to access; would be better to pass\n\t\t * the current instance into the lib-specific code (even though this is\n\t\t * a static call. i just don't want to expose it to the public API).\n\t\t */\n\t\tthis.getId = _getId;\n\t\tthis.getOffset = function(id) { \n\t\t\treturn _updateOffset({elId:id}).o;\n\t\t};\n\t\t\n\t\tthis.appendElement = _appendElement;\n\t\t\n\t\tvar _hoverSuspended = false;\n\t\tthis.isHoverSuspended = function() { return _hoverSuspended; };\n\t\tthis.setHoverSuspended = function(s) { _hoverSuspended = s; };\n\n\t\tvar _isAvailable = function(m) {\n\t\t\treturn function() {\n\t\t\t\treturn jsPlumbAdapter.isRenderModeAvailable(m);\n\t\t\t};\n\t\t};\n\n\t\tthis.isSVGAvailable = _isAvailable(\"svg\");\n\t\tthis.isVMLAvailable = _isAvailable(\"vml\");\n\n\t\t// set an element's connections to be hidden\n\t\tthis.hide = function(el, changeEndpoints) {\n\t\t\t_setVisible(el, \"none\", changeEndpoints);\n\t\t\treturn _currentInstance;\n\t\t};\n\t\t\n\t\t// exposed for other objects to use to get a unique id.\n\t\tthis.idstamp = _idstamp;\n\n\t\tthis.connectorsInitialized = false;\n\t\tvar connectorTypes = [], rendererTypes = [\"svg\", \"vml\"];\n\t\tthis.registerConnectorType = function(connector, name) {\n\t\t\tconnectorTypes.push([connector, name]);\n\t\t};\n\t\t\n\t\t// ensure that, if the current container exists, it is a DOM element and not a selector.\n\t\t// if it does not exist and `candidate` is supplied, the offset parent of that element will be set as the Container.\n\t\t// this is used to do a better default behaviour for the case that the user has not set a container:\n\t\t// addEndpoint, makeSource, makeTarget and connect all call this method with the offsetParent of the \n\t\t// element in question (for connect it is the source element). So if no container is set, it is inferred\n\t\t// to be the offsetParent of the first element the user tries to connect.\n\t\tvar _ensureContainer = function(candidate) {\n\t\t\tif (!_container && candidate) {\n\t\t\t\tvar can = _currentInstance.getDOMElement(candidate);\t\t\t\t\n                \t\tif (can.offsetParent) _currentInstance.setContainer(can.offsetParent);\n\t\t\t}\n\t\t};\n\n\t\tvar _getContainerFromDefaults = function() {\n\t\t\tif (_currentInstance.Defaults.Container)\n                \t  _currentInstance.setContainer(_currentInstance.Defaults.Container);\n\t\t};\n\n        // check if a given element is managed or not. if not, add to our map. if drawing is not suspended then\n        // we'll also stash its dimensions; otherwise we'll do this in a lazy way through updateOffset.\n            // TODO make sure we add a test that this tracks a setId call.\n        var _manage = _currentInstance.manage = function(id, element) {\n            if (!managedElements[id]) {\n                managedElements[id] = {\n                    el:element,\n                    endpoints:[],\n                    connections:[]\n                };\n\n                managedElements[id].info = _updateOffset({ elId: id, timestamp: _suspendedAt });\n\n             /*   if (!_suspendDrawing) {\n                    managedElements[id].info = _updateOffset({ elId: id, timestamp: _suspendedAt });\n                }*/\n            }\n\n            return managedElements[id];\n        };\n\n        var _unmanage = function(id) {\n            delete managedElements[id];\n        };\n\n        /**\n         * updates the offset and size for a given element, and stores the\n         * values. if 'offset' is not null we use that (it would have been\n         * passed in from a drag call) because it's faster; but if it is null,\n         * or if 'recalc' is true in order to force a recalculation, we get the current values.\n         */\n        var _updateOffset = this.updateOffset = function(params) {\n\n            var timestamp = params.timestamp, recalc = params.recalc, offset = params.offset, elId = params.elId, s;\n            if (_suspendDrawing && !timestamp) timestamp = _suspendedAt;\n            if (!recalc) {\n                if (timestamp && timestamp === offsetTimestamps[elId]) {\n                    return {o:params.offset || offsets[elId], s:sizes[elId]};\n                }\n            }\n            if (recalc || (!offset && offsets[elId] == null)) { // if forced repaint or no offset available, we recalculate.\n\n                // get the current size and offset, and store them\n                s = managedElements[elId] ? managedElements[elId].el : null;\n                if (s != null) {\n                    sizes[elId] = _currentInstance.getSize(s);\n                    offsets[elId] = _getOffset(s, _currentInstance);\n                    offsetTimestamps[elId] = timestamp;\n                }\n            } else {\n                offsets[elId] = offset || offsets[elId];\n                if (sizes[elId] == null) {\n                    //s = document.getElementById(elId);\n                    s = managedElements[elId].el;\n                    if (s != null) sizes[elId] = _currentInstance.getSize(s);\n                }\n                offsetTimestamps[elId] = timestamp;\n            }\n\n            if(offsets[elId] && !offsets[elId].right) {\n                offsets[elId].right = offsets[elId].left + sizes[elId][0];\n                offsets[elId].bottom = offsets[elId].top + sizes[elId][1];\n                offsets[elId].width = sizes[elId][0];\n                offsets[elId].height = sizes[elId][1];\n                offsets[elId].centerx = offsets[elId].left + (offsets[elId].width / 2);\n                offsets[elId].centery = offsets[elId].top + (offsets[elId].height / 2);\n            }\n\n            return {o:offsets[elId], s:sizes[elId]};\n        };\n\t\t\n\t\t/**\n\t\t * callback from the current library to tell us to prepare ourselves (attach\n\t\t * mouse listeners etc; can't do that until the library has provided a bind method)\t\t \n\t\t */\n\t\tthis.init = function() {\n\t\t\tvar _oneType = function(renderer, name, fn) {\n\t\t\t\tjsPlumb.Connectors[renderer][name] = function() {\n\t\t\t\t\tfn.apply(this, arguments);\n\t\t\t\t\tjsPlumb.ConnectorRenderers[renderer].apply(this, arguments);\t\t\n\t\t\t\t};\n\t\t\t\tjsPlumbUtil.extend(jsPlumb.Connectors[renderer][name], [ fn, jsPlumb.ConnectorRenderers[renderer]]);\n\t\t\t};\n\n\t\t\tif (!jsPlumb.connectorsInitialized) {\n\t\t\t\tfor (var i = 0; i < connectorTypes.length; i++) {\n\t\t\t\t\tfor (var j = 0; j < rendererTypes.length; j++) {\n\t\t\t\t\t\t_oneType(rendererTypes[j], connectorTypes[i][1], connectorTypes[i][0]);\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\tjsPlumb.connectorsInitialized = true;\n\t\t\t}\n\t\t\t\n\t\t\tif (!initialized) {                \n\t\t\t\t_getContainerFromDefaults();\t\n                _currentInstance.anchorManager = new jsPlumb.AnchorManager({jsPlumbInstance:_currentInstance});                \n\t\t\t\t_currentInstance.setRenderMode(_currentInstance.Defaults.RenderMode);  // calling the method forces the capability logic to be run.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tinitialized = true;\n\t\t\t\t_currentInstance.fire(\"ready\", _currentInstance);\n\t\t\t}\n\t\t}.bind(this);\t\t\n\t\t\n\t\tthis.log = log;\n\t\tthis.jsPlumbUIComponent = jsPlumbUIComponent;\t\t\n\n\t\t/*\n\t\t * Creates an anchor with the given params.\n\t\t * \n\t\t * \n\t\t * Returns: The newly created Anchor.\n\t\t * Throws: an error if a named anchor was not found.\n\t\t */\n\t\tthis.makeAnchor = function() {\n\t\t\tvar pp, _a = function(t, p) {\n\t\t\t\tif (jsPlumb.Anchors[t]) return new jsPlumb.Anchors[t](p);\n\t\t\t\tif (!_currentInstance.Defaults.DoNotThrowErrors)\n\t\t\t\t\tthrow { msg:\"jsPlumb: unknown anchor type '\" + t + \"'\" };\n\t\t\t};\n\t\t\tif (arguments.length === 0) return null;\n\t\t\tvar specimen = arguments[0], elementId = arguments[1], jsPlumbInstance = arguments[2], newAnchor = null;\t\t\t\n\t\t\t// if it appears to be an anchor already...\n\t\t\tif (specimen.compute && specimen.getOrientation) return specimen;  //TODO hazy here about whether it should be added or is already added somehow.\n\t\t\t// is it the name of an anchor type?\n\t\t\telse if (typeof specimen == \"string\") {\n\t\t\t\tnewAnchor = _a(arguments[0], {elementId:elementId, jsPlumbInstance:_currentInstance});\n\t\t\t}\n\t\t\t// is it an array? it will be one of:\n\t\t\t// \t\tan array of [spec, params] - this defines a single anchor, which may be dynamic, but has parameters.\n\t\t\t//\t\tan array of arrays - this defines some dynamic anchors\n\t\t\t//\t\tan array of numbers - this defines a single anchor.\t\t\t\t\n\t\t\telse if (_ju.isArray(specimen)) {\n\t\t\t\tif (_ju.isArray(specimen[0]) || _ju.isString(specimen[0])) {\n\t\t\t\t\t// if [spec, params] format\n\t\t\t\t\tif (specimen.length == 2 && _ju.isObject(specimen[1])) {\n\t\t\t\t\t\t// if first arg is a string, its a named anchor with params\n\t\t\t\t\t\tif (_ju.isString(specimen[0])) {\n\t\t\t\t\t\t\tpp = jsPlumb.extend({elementId:elementId, jsPlumbInstance:_currentInstance}, specimen[1]);\n\t\t\t\t\t\t\tnewAnchor = _a(specimen[0], pp);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// otherwise first arg is array, second is params. we treat as a dynamic anchor, which is fine\n\t\t\t\t\t\t// even if the first arg has only one entry. you could argue all anchors should be implicitly dynamic in fact.\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpp = jsPlumb.extend({elementId:elementId, jsPlumbInstance:_currentInstance, anchors:specimen[0]}, specimen[1]);\n\t\t\t\t\t\t\tnewAnchor = new jsPlumb.DynamicAnchor(pp);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tnewAnchor = new jsPlumb.DynamicAnchor({anchors:specimen, selector:null, elementId:elementId, jsPlumbInstance:_currentInstance});\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar anchorParams = {\n\t\t\t\t\t\tx:specimen[0], y:specimen[1],\n\t\t\t\t\t\torientation : (specimen.length >= 4) ? [ specimen[2], specimen[3] ] : [0,0],\n\t\t\t\t\t\toffsets : (specimen.length >= 6) ? [ specimen[4], specimen[5] ] : [ 0, 0 ],\n\t\t\t\t\t\telementId:elementId,\n                        jsPlumbInstance:_currentInstance,\n                        cssClass:specimen.length == 7 ? specimen[6] : null\n\t\t\t\t\t};\t\t\t\t\t\t\n\t\t\t\t\tnewAnchor = new jsPlumb.Anchor(anchorParams);\n\t\t\t\t\tnewAnchor.clone = function() { return new jsPlumb.Anchor(anchorParams); };\t\t\t\t\t\t \t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (!newAnchor.id) newAnchor.id = \"anchor_\" + _idstamp();\n\t\t\treturn newAnchor;\n\t\t};\n\n\t\t/**\n\t\t * makes a list of anchors from the given list of types or coords, eg\n\t\t * [\"TopCenter\", \"RightMiddle\", \"BottomCenter\", [0, 1, -1, -1] ]\n\t\t */\n\t\tthis.makeAnchors = function(types, elementId, jsPlumbInstance) {\n\t\t\tvar r = [];\n\t\t\tfor ( var i = 0, ii = types.length; i < ii; i++) {\n\t\t\t\tif (typeof types[i] == \"string\")\n\t\t\t\t\tr.push(jsPlumb.Anchors[types[i]]({elementId:elementId, jsPlumbInstance:jsPlumbInstance}));\n\t\t\t\telse if (_ju.isArray(types[i]))\n\t\t\t\t\tr.push(_currentInstance.makeAnchor(types[i], elementId, jsPlumbInstance));\n\t\t\t}\n\t\t\treturn r;\n\t\t};\n\n\t\t/**\n\t\t * Makes a dynamic anchor from the given list of anchors (which may be in shorthand notation as strings or dimension arrays, or Anchor\n\t\t * objects themselves) and the given, optional, anchorSelector function (jsPlumb uses a default if this is not provided; most people will\n\t\t * not need to provide this - i think). \n\t\t */\n\t\tthis.makeDynamicAnchor = function(anchors, anchorSelector) {\n\t\t\treturn new jsPlumb.DynamicAnchor({anchors:anchors, selector:anchorSelector, elementId:null, jsPlumbInstance:_currentInstance});\n\t\t};\n\t\t\n// --------------------- makeSource/makeTarget ---------------------------------------------- \n\t\t\n\t\tthis.targetEndpointDefinitions = {};\n\t\tvar _setEndpointPaintStylesAndAnchor = function(ep, epIndex, _instance) {\n\t\t\t\tep.paintStyle = ep.paintStyle ||\n\t\t\t\t \t\t\t\t_instance.Defaults.EndpointStyles[epIndex] ||\n\t                            _instance.Defaults.EndpointStyle;\n\t\t\t\t\t\t\t\t\n\t\t\t\tep.hoverPaintStyle = ep.hoverPaintStyle ||\n\t                           _instance.Defaults.EndpointHoverStyles[epIndex] ||\n\t                           _instance.Defaults.EndpointHoverStyle;                            \n\n\t\t\t\tep.anchor = ep.anchor ||\n\t                      \t_instance.Defaults.Anchors[epIndex] ||\n\t                      \t_instance.Defaults.Anchor;\n\t\t\t\t\t\n\t\t\t\tep.endpoint = ep.endpoint ||\n\t\t\t\t\t\t\t  _instance.Defaults.Endpoints[epIndex] ||\n\t\t\t\t\t\t\t  _instance.Defaults.Endpoint;\n\t\t\t};\n\t\t\t\n\t\t\t// TODO put all the source stuff inside one parent, keyed by id.\n\t\t\tthis.sourceEndpointDefinitions = {};\n\t\t\t\n\t\t\tvar selectorFilter = function(evt, _el, selector, _instance, negate) {\n                var t = evt.target || evt.srcElement, ok = false, \n                    sel = _instance.getSelector(_el, selector);\n                for (var j = 0; j < sel.length; j++) {\n                    if (sel[j] == t) {\n                        ok = true;\n                        break;\n                    }\n                }\n                return negate ? !ok : ok;\n\t        };\n\n\n        //this.\n\n\t\t// see API docs\n\t\tthis.makeTarget = function(el, params, referenceParams) {\n\n\t\t\t// put jsplumb ref into params without altering the params passed in\n\t\t\tvar p = jsPlumb.extend({_jsPlumb:this}, referenceParams);\n\t\t\tjsPlumb.extend(p, params);\n\n\t\t\t// calculate appropriate paint styles and anchor from the params given\n\t\t\t_setEndpointPaintStylesAndAnchor(p, 1, this);\n\n\t\t\tvar targetScope = p.scope || _currentInstance.Defaults.Scope,\n\t\t\t\tdeleteEndpointsOnDetach = !(p.deleteEndpointsOnDetach === false),\n\t\t\t\tmaxConnections = p.maxConnections || -1,\n\t\t\t\tonMaxConnections = p.onMaxConnections,\n\n\t\t\t\t_doOne = function(el) {\n\t\t\t\t\t\n\t\t\t\t\t// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,\n\t\t\t\t\t// and use the endpoint definition if found.\n\t\t\t\t\t// decode the info for this element (id and element)\n\t\t\t\t\tvar elInfo = _info(el), \n\t\t\t\t\t\telid = elInfo.id,\n\t\t\t\t\t\tproxyComponent = new jsPlumbUIComponent(p),\n\t\t\t\t\t\tdropOptions = jsPlumb.extend({}, p.dropOptions || {});\n\n\t\t\t\t\t_ensureContainer(elid);\n\n\t\t\t\t\t// store the definitions keyed against the element id.\n\t\t\t\t\t// TODO why not just store inside the element itself?\n                    var _def = {\n                        def:p,\n                        uniqueEndpoint:p.uniqueEndpoint,\n                        maxConnections:maxConnections,\n                        enabled:true\n                    };\n                    elInfo.el._jsPlumbTarget = _def;\n\n\t\t\t\t\tthis.targetEndpointDefinitions[elid] = _def;\n\n\n                    var _drop = p._jsPlumb.EndpointDropHandler({\n                        //endpoint:_ep,\n                        jsPlumb: _currentInstance,\n                        enabled:function() {\n                            return elInfo.el._jsPlumbTarget.enabled;\n                        },\n                        isFull:function(originalEvent) {\n                            var targetCount = _currentInstance.select({target:elid}).length;\n                            var def = elInfo.el._jsPlumbTarget;\n                            var full = def.maxConnections > 0 && targetCount >= def.maxConnections;\n                            if (full && onMaxConnections) {\n                                // TODO here we still have the id of the floating element, not the\n                                // actual target.\n                                onMaxConnections({\n                                    element:elInfo.el,\n                                    connection:jpc\n                                }, originalEvent);\n                            }\n                            return full;\n                        },\n                        element:elInfo.el,\n                        elementId:elid,\n                        isSource:false,\n                        isTarget:true,\n                        addClass:function(clazz) {\n                            //_ep.addClass(clazz)\n                            _currentInstance.addClass(elInfo.el, clazz);\n                        },\n                        removeClass:function(clazz) {\n                            //_ep.removeClass(clazz)\n                            _currentInstance.removeClass(elInfo.el, clazz);\n                        },\n                        onDrop:function(jpc) {\n                            var source = jpc.endpoints[0];\n                            source.anchor.locked = false;\n                        },\n                        isDropAllowed:function() {\n                            return proxyComponent.isDropAllowed.apply(proxyComponent, arguments);\n                        },\n                        getEndpoint:function(jpc) {\n                            // make a new Endpoint for the target, or get it from the cache if uniqueEndpoint\n                            // is set.\n                            var _el = _currentInstance.getElementObject(elInfo.el),\n                                def = elInfo.el._jsPlumbTarget,\n                                newEndpoint = def.endpoint;\n\n                            // if no cached endpoint, or there was one but it has been cleaned up\n                            // (ie. detached), then create a new one.\n                            if (newEndpoint == null || newEndpoint._jsPlumb == null)\n                                newEndpoint = _currentInstance.addEndpoint(_el, p);\n\n                            if (p.uniqueEndpoint) def.endpoint = newEndpoint;  // may of course just store what it just pulled out. that's ok.\n                            // TODO test options to makeTarget to see if we should do this?\n                            newEndpoint._doNotDeleteOnDetach = false; // reset.\n                            newEndpoint._deleteOnDetach = true;\n\n                            // if connection is detachable, init the new endpoint to be draggable, to support that happening.\n                            if (jpc.isDetachable())\n                                newEndpoint.initDraggable();\n\n                            // if the anchor has a 'positionFinder' set, then delegate to that function to find\n                            // out where to locate the anchor.\n                            if (newEndpoint.anchor.positionFinder != null) {\n                                var dropPosition = _currentInstance.getUIPosition(arguments, this.getZoom()),\n                                    elPosition = _getOffset(_el, this),\n                                    elSize = _currentInstance.getSize(_el),\n                                    ap = newEndpoint.anchor.positionFinder(dropPosition, elPosition, elSize, newEndpoint.anchor.constructorParams);\n                                newEndpoint.anchor.x = ap[0];\n                                newEndpoint.anchor.y = ap[1];\n                                // now figure an orientation for it..kind of hard to know what to do actually. probably the best thing i can do is to\n                                // support specifying an orientation in the anchor's spec. if one is not supplied then i will make the orientation\n                                // be what will cause the most natural link to the source: it will be pointing at the source, but it needs to be\n                                // specified in one axis only, and so how to make that choice? i think i will use whichever axis is the one in which\n                                // the target is furthest away from the source.\n                            }\n\n                            return newEndpoint;\n                        }\n                    });\n\t\t\t\t\t\n\t\t\t\t\t// wrap drop events as needed and initialise droppable\n\t\t\t\t\tvar dropEvent = jsPlumb.dragEvents.drop;\n\t\t\t\t\tdropOptions.scope = dropOptions.scope || targetScope;\n\t\t\t\t\tdropOptions[dropEvent] = _ju.wrap(dropOptions[dropEvent], _drop);\n\t\t\t\t\t// vanilla jsplumb only\n\t\t\t\t\tif (p.allowLoopback === false) {\n\t\t\t\t\t\tdropOptions.canDrop = function(_drag) {\n\t\t\t\t\t\t\tvar de = _drag.getDragElement()._jsPlumbRelatedElement;\n\t\t\t\t\t\t\treturn de != elInfo.el;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tthis.initDroppable(this.getElementObject(elInfo.el), dropOptions, \"internal\");\n\t\t\t\t}.bind(this);\n\n\t\t\t// make an array if only given one element\n\t\t\tvar inputs = el.length && el.constructor != String ? el : [ el ];\n\t\t\t\t\t\t\n\t\t\t// register each one in the list.\n\t\t\tfor (var i = 0, ii = inputs.length; i < ii; i++) {\t\t\t\t\t\t\t\n\t\t\t\t_doOne(inputs[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\n\t\t// see api docs\n\t\tthis.unmakeTarget = function(el, doNotClearArrays) {\n\t\t\tvar info = _info(el);\n\n\t\t\tjsPlumb.destroyDroppable(info.el);\n\t\t\t// TODO this is not an exhaustive unmake of a target, since it does not remove the droppable stuff from\n\t\t\t// the element.  the effect will be to prevent it from behaving as a target, but it's not completely purged.\n\t\t\tif (!doNotClearArrays) {\n\t\t\t\tdelete this.targetEndpointDefinitions[info.id];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\t\t\t\t\t\t\n\n\t    // see api docs\n\t\tthis.makeSource = function(el, params, referenceParams) {\n\t\t\tvar p = jsPlumb.extend({}, referenceParams);\n\t\t\tjsPlumb.extend(p, params);\n\t\t\t_setEndpointPaintStylesAndAnchor(p, 0, this);\n\t\t\tvar maxConnections = p.maxConnections || 1,\n\t\t\t\tonMaxConnections = p.onMaxConnections,\n\t\t\t\t_doOne = function(elInfo) {\n\t\t\t\t\t// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,\n\t\t\t\t\t// and use the endpoint definition if found.\n\t\t\t\t\tvar elid = elInfo.id,\n\t\t\t\t\t\t_el = this.getElementObject(elInfo.el),\n\t\t\t\t\t\t_del = this.getDOMElement(_el),\n\t\t\t\t\t\tparentElement = function() {\n\t\t\t\t\t\t\treturn p.parent == null ? null : p.parent === \"parent\" ? elInfo.el.parentNode : _currentInstance.getDOMElement(p.parent);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tidToRegisterAgainst = p.parent != null ? this.getId(parentElement()) : elid;\n\n\t\t\t\t\t_ensureContainer(idToRegisterAgainst);\n\t\t\t\t\t\n\t\t\t\t\tthis.sourceEndpointDefinitions[idToRegisterAgainst] = {\n\t\t\t\t\t\tdef:p,\n\t\t\t\t\t\tuniqueEndpoint:p.uniqueEndpoint,\n\t\t\t\t\t\tmaxConnections:maxConnections,\n\t\t\t\t\t\tenabled:true\n\t\t\t\t\t};\n\t\t\t\t\tvar stopEvent = jsPlumb.dragEvents.stop,\n\t\t\t\t\t\tdragEvent = jsPlumb.dragEvents.drag,\n\t\t\t\t\t\tdragOptions = jsPlumb.extend({ }, p.dragOptions || {}),\n\t\t\t\t\t\texistingDrag = dragOptions.drag,\n\t\t\t\t\t\texistingStop = dragOptions.stop,\n\t\t\t\t\t\tep = null,\n\t\t\t\t\t\tendpointAddedButNoDragYet = false;\n\n\t\t\t\t\t// set scope if its not set in dragOptions but was passed in in params\n\t\t\t\t\tdragOptions.scope = dragOptions.scope || p.scope;\n\n\t\t\t\t\tdragOptions[dragEvent] = _ju.wrap(dragOptions[dragEvent], function() {\n\t\t\t\t\t\tif (existingDrag) existingDrag.apply(this, arguments);\n\t\t\t\t\t\tendpointAddedButNoDragYet = false;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tdragOptions[stopEvent] = _ju.wrap(dragOptions[stopEvent], function() { \n\n\t\t\t\t\t\tif (existingStop) existingStop.apply(this, arguments);\n\t                    this.currentlyDragging = false;\n\t\t\t\t\t\tif (ep._jsPlumb != null) { // if not cleaned up...\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// reset the anchor to the anchor that was initially provided. the one we were using to drag\n\t\t\t\t\t\t\t// the connection was just a placeholder that was located at the place the user pressed the\n\t\t\t\t\t\t\t// mouse button to initiate the drag.\n\t\t\t\t\t\t\tvar anchorDef = p.anchor || this.Defaults.Anchor,\n\t\t\t\t\t\t\t\toldAnchor = ep.anchor,\n\t\t\t\t\t\t\t\toldConnection = ep.connections[0],\n\t\t\t\t\t\t\t\tnewAnchor = this.makeAnchor(anchorDef, elid, this),\n\t\t\t\t\t\t\t\t_el = ep.element;\n\n\t\t\t\t\t\t\t// if the anchor has a 'positionFinder' set, then delegate to that function to find\n\t\t\t\t\t\t\t// out where to locate the anchor. issue 117.\n\t\t\t\t\t\t\tif (newAnchor.positionFinder != null) {\n\t\t\t\t\t\t\t\tvar elPosition = _getOffset(_el, this),\n\t\t\t\t\t\t\t\t\telSize = this.getSize(_el),\n\t\t\t\t\t\t\t\t\tdropPosition = { left:elPosition.left + (oldAnchor.x * elSize[0]), top:elPosition.top + (oldAnchor.y * elSize[1]) },\n\t\t\t\t\t\t\t\t\tap = newAnchor.positionFinder(dropPosition, elPosition, elSize, newAnchor.constructorParams);\n\n\t\t\t\t\t\t\t\tnewAnchor.x = ap[0];\n\t\t\t\t\t\t\t\tnewAnchor.y = ap[1];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tep.setAnchor(newAnchor, true);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (p.parent) {\n\t\t\t\t\t\t\t\tvar parent = parentElement();\n\t\t\t\t\t\t\t\tif (parent) {\t\n\t\t\t\t\t\t\t\t\tvar potentialParent = p.container || _container;\n\t\t\t\t\t\t\t\t\tep.setElement(parent, potentialParent);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tep.repaint();\n\t\t\t\t\t\t\tthis.repaint(ep.elementId);\n\t\t\t\t\t\t\tthis.repaint(oldConnection.targetId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this));\n\t\t\t\t\t\n\t\t\t\t\t// when the user presses the mouse, add an Endpoint, if we are enabled.\n\t\t\t\t\tvar mouseDownListener = function(e) {\n\t\t\t\t\t\tvar evt = this.getOriginalEvent(e);\n                        // on right mouse button, abort.\n                        if (e.which === 3 || e.button === 2) return;\n\n\t\t\t\t\t\tvar def = this.sourceEndpointDefinitions[idToRegisterAgainst];\n\t\t\t\t\t\telid = this.getId(this.getDOMElement(_el)); // elid might have changed since this method was called to configure the element.\n\t\t\t\t\t\t\n\t\t\t\t\t\t// if disabled, return.\n\t\t\t\t\t\tif (!def.enabled) return;\n\t                    \n\t                    // if a filter was given, run it, and return if it says no.\n\t\t\t\t\t\tif (p.filter) {\n\t\t\t\t\t\t\tvar r = jsPlumbUtil.isString(p.filter) ? selectorFilter(evt, _el, p.filter, this, p.filterExclude) : p.filter(evt, _el);\n\t\t\t\t\t\t\tif (r === false) return;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// if maxConnections reached\n\t\t\t\t\t\tvar sourceCount = this.select({source:idToRegisterAgainst}).length;\n\t\t\t\t\t\tif (def.maxConnections >= 0 && (def.uniqueEndpoint && sourceCount >= def.maxConnections)) {\n\t\t\t\t\t\t\tif (onMaxConnections) {\n\t\t\t\t\t\t\t\tonMaxConnections({\n\t\t\t\t\t\t\t\t\telement:_el,\n\t\t\t\t\t\t\t\t\tmaxConnections:maxConnections\n\t\t\t\t\t\t\t\t}, e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// find the position on the element at which the mouse was pressed; this is where the endpoint \n\t\t\t\t\t\t// will be located.\n\t\t\t\t\t\tvar elxy = jsPlumbAdapter.getPositionOnElement(evt, _del, _zoom), pelxy = elxy;\n\n\t\t\t\t\t\t// we need to override the anchor in here, and force 'isSource', but we don't want to mess with\n\t\t\t\t\t\t// the params passed in, because after a connection is established we're going to reset the endpoint\n\t\t\t\t\t\t// to have the anchor we were given.\n\t\t\t\t\t\tvar tempEndpointParams = {};\n\t\t\t\t\t\tjsPlumb.extend(tempEndpointParams, p);\n\t\t\t\t\t\ttempEndpointParams.isTemporarySource = true;\n\t\t\t\t\t\ttempEndpointParams.anchor = [ elxy[0], elxy[1] , 0,0];\n\t\t\t\t\t\ttempEndpointParams.dragOptions = dragOptions;\n\n\t\t\t\t\t\tep = this.addEndpoint(elid, tempEndpointParams);\n\t\t\t\t\t\tendpointAddedButNoDragYet = true;\n\t\t\t\t\t\tep.endpointWillMoveTo = p.parent ? parentElement() : null;\n\n                        // if unique endpoint and it's already been created, push it onto the endpoint we create. at the end\n                        // of a successful connection we'll switch to that endpoint.\n                        //if (def.uniqueEndpoint && def.endpoint) ep.finalEndpoint = def.endpoint;\n                        if (def.uniqueEndpoint) {\n                            if (!def.endpoint)\n                                def.endpoint = ep;\n                            else\n                                ep.finalEndpoint = def.endpoint;\n                        }\n\n\t\t\t\t\t\t// TODO test options to makeSource to see if we should do this?\n\t\t\t\t\t\tep._doNotDeleteOnDetach = false; // reset.\n\t\t\t\t\t\tep._deleteOnDetach = true;\n\n\t                    var _delTempEndpoint = function() {\n\t\t\t\t\t\t\t// this mouseup event is fired only if no dragging occurred, by jquery and yui, but for mootools\n\t\t\t\t\t\t\t// it is fired even if dragging has occurred, in which case we would blow away a perfectly\n\t\t\t\t\t\t\t// legitimate endpoint, were it not for this check.  the flag is set after adding an\n\t\t\t\t\t\t\t// endpoint and cleared in a drag listener we set in the dragOptions above.\n                            _currentInstance.off(ep.canvas, \"mouseup\",  _delTempEndpoint);\n                            _currentInstance.off(_el, \"mouseup\", _delTempEndpoint);\n\t\t\t\t\t\t\tif(endpointAddedButNoDragYet) {\n\t\t\t\t\t\t\t\t endpointAddedButNoDragYet = false;\n\t\t\t\t\t\t\t\t_currentInstance.deleteEndpoint(ep);\n\t                        }\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t_currentInstance.on(ep.canvas, \"mouseup\", _delTempEndpoint);\n\t                    _currentInstance.on(_el, \"mouseup\", _delTempEndpoint);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// and then trigger its mousedown event, which will kick off a drag, which will start dragging\n\t\t\t\t\t\t// a new connection from this endpoint.\n\t\t\t\t\t\t_currentInstance.trigger(ep.canvas, \"mousedown\", e);\n\n\t\t\t\t\t\tjsPlumbUtil.consume(e);\n\t\t\t\t\t\t\n\t\t\t\t\t}.bind(this);\n\t               \n\t                this.on(_el, \"mousedown\", mouseDownListener);\n\t                this.sourceEndpointDefinitions[idToRegisterAgainst].trigger = mouseDownListener;\n\n\t                // lastly, if a filter was provided, set it as a dragFilter on the element,\n\t                // to prevent the element drag function from kicking in when we want to\n\t                // drag a new connection\n\t                if (p.filter && jsPlumbUtil.isString(p.filter)) {\n\t                \t_currentInstance.setDragFilter(_el, p.filter);\n\t                }\n\t\t\t\t}.bind(this);\n\t\t\t\n\t\t\tvar inputs = el.length && el.constructor != String ? el : [ el ];\n\t\t\tfor (var i = 0, ii = inputs.length; i < ii; i++) {\n\t\t\t\t_doOne(_info(inputs[i]));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\t\n\t\t// see api docs\t\t\n\t\tthis.unmakeSource = function(el, doNotClearArrays) {\n\t\t\tvar info = _info(el),\n\t\t\t\tmouseDownListener = this.sourceEndpointDefinitions[info.id].trigger;\n\t\t\t\n\t\t\tif (mouseDownListener) \n\t\t\t\t_currentInstance.off(info.el, \"mousedown\", mouseDownListener);\n\n\t\t\tif (!doNotClearArrays) {\n\t\t\t\tdelete this.sourceEndpointDefinitions[info.id];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\n\t\t// see api docs\n\t\tthis.unmakeEverySource = function() {\n\t\t\tfor (var i in this.sourceEndpointDefinitions)\n\t\t\t\t_currentInstance.unmakeSource(i, true);\n\n\t\t\tthis.sourceEndpointDefinitions = {};\n\t\t\treturn this;\n\t\t};\n\n        var _getScope = function(el, types) {\n            types = jsPlumbUtil.isArray(types) ? types : [ types ];\n            var id = _getId(el);\n            for (var i = 0; i < types.length; i++) {\n                var def = this[types[i]][id];\n                if (def) return def.def.scope || this.Defaults.Scope;\n            }\n        }.bind(this);\n\n        var _setScope = function(el, scope, types) {\n            types = jsPlumbUtil.isArray(types) ? types : [ types ];\n            var id = _getId(el);\n            for (var i = 0; i < types.length; i++) {\n                var def = this[types[i]][id];\n                if (def) {\n                    def.def.scope = scope;\n                    if (this.scopeChange != null) this.scopeChange(el, id, endpointsByElement[id], scope, types[i]);\n                }\n            }\n\n        }.bind(this);\n\n        this.getScope = function(el, scope) { return _getScope(el, [ \"sourceEndpointDefinitions\", \"targetEndpointDefinitions\" ]); };\n        this.getSourceScope = function(el) { return _getScope(el, \"sourceEndpointDefinitions\"); };\n        this.getTargetScope = function(el) { return _getScope(el, \"targetEndpointDefinitions\"); };\n        this.setScope = function(el, scope) { _setScope(el, scope, [ \"sourceEndpointDefinitions\", \"targetEndpointDefinitions\" ]); };\n        this.setSourceScope = function(el, scope) { _setScope(el, scope, \"sourceEndpointDefinitions\"); };\n        this.setTargetScope = function(el, scope) { _setScope(el, scope, \"targetEndpointDefinitions\"); };\n\t\t\n\t\t// see api docs\n\t\tthis.unmakeEveryTarget = function() {\n\t\t\tfor (var i in this.targetEndpointDefinitions)\n\t\t\t\t_currentInstance.unmakeTarget(i, true);\n\t\t\t\n\t\t\tthis.targetEndpointDefinitions = {};\n\t\t\treturn this;\n\t\t};\n\n\t\t// does the work of setting a source enabled or disabled.\n\t\tvar _setEnabled = function(type, el, state, toggle) {\n\t\t\tvar a = type == \"source\" ? this.sourceEndpointDefinitions : this.targetEndpointDefinitions;\n\n\t\t\tif (_ju.isString(el)) a[el].enabled = toggle ? !a[el].enabled : state;\n\t\t\telse if (el.length) {\t\t\t\t\n\t\t\t\tfor (var i = 0, ii = el.length; i < ii; i++) {\n\t\t\t\t\tvar info = _info(el[i]);\n\t\t\t\t\tif (a[info.id])\n\t\t\t\t\t\ta[info.id].enabled = toggle ? !a[info.id].enabled : state;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t// otherwise a DOM element\n\t\t\telse {\n\t\t\t\tvar id = _info(el).id;\n\t\t\t\ta[id].enabled = toggle ? !a[id].enabled : state;\n\t\t\t}\n\t\t\treturn this;\n\t\t}.bind(this);\n\t\t\n\t\tvar _first = function(el, fn) {\n\t\t\tif (_ju.isString(el) || !el.length)\n\t\t\t\treturn fn.apply(this, [ el ]);\n\t\t\telse if (el.length) \n\t\t\t\treturn fn.apply(this, [ el[0] ]);\n\t\t\t\t\n\t\t}.bind(this);\n\n\t\tthis.toggleSourceEnabled = function(el) {\n\t\t\t_setEnabled(\"source\", el, null, true);\n\t\t\treturn this.isSourceEnabled(el);\n\t\t};\n\n\t\tthis.setSourceEnabled = function(el, state) { return _setEnabled(\"source\", el, state); };\n\t\tthis.isSource = function(el) { \n\t\t\treturn _first(el, function(_el) { \n\t\t\t\treturn this.sourceEndpointDefinitions[_info(_el).id] != null; \n            }.bind(this));\n\t\t};\n\t\tthis.isSourceEnabled = function(el) { \n\t\t\treturn _first(el, function(_el) {\n\t\t\t\tvar sep = this.sourceEndpointDefinitions[_info(_el).id];\n\t\t\t\treturn sep && sep.enabled === true;\n            }.bind(this));\n\t\t};\n\n\t\tthis.toggleTargetEnabled = function(el) {\n\t\t\t_setEnabled(\"target\", el, null, true);\n\t\t\treturn this.isTargetEnabled(el);\n\t\t};\n\t\t\n\t\tthis.isTarget = function(el) { \n\t\t\treturn _first(el, function(_el) {\n\t\t\t\treturn this.targetEndpointDefinitions[_info(_el).id] != null; \n            }.bind(this));\n\t\t};\n\t\tthis.isTargetEnabled = function(el) { \n\t\t\treturn _first(el, function(_el) {\n\t\t\t\tvar tep = this.targetEndpointDefinitions[_info(_el).id];\n\t\t\t\treturn tep && tep.enabled === true;\n            }.bind(this));\n\t\t};\n\t\tthis.setTargetEnabled = function(el, state) { return _setEnabled(\"target\", el, state); };\n\n// --------------------- end makeSource/makeTarget ---------------------------------------------- \t\t\t\t\n\t\t\t\t\n\t\tthis.ready = function(fn) {\n\t\t\t_currentInstance.bind(\"ready\", fn);\n\t\t};\n\n\t\t// repaint some element's endpoints and connections\n\t\tthis.repaint = function(el, ui, timestamp) {\n\t\t\t// support both lists...\n\t\t\tif (typeof el == 'object' && el.length)\n\t\t\t\tfor ( var i = 0, ii = el.length; i < ii; i++) {\n\t\t\t\t\t_draw(el[i], ui, timestamp);\n\t\t\t\t}\n\t\t\telse // ...and single strings.\n\t\t\t\t_draw(el, ui, timestamp);\n\t\t\t\t\n\t\t\treturn _currentInstance;\n\t\t};\n\n        this.revalidate = function(el) {\n            var elId = _currentInstance.getId(el);\n            _currentInstance.updateOffset( { elId : elId, recalc : true } );\n            return _currentInstance.repaint(el);\n        };\n\n\t\t// repaint every endpoint and connection.\n\t\tthis.repaintEverything = function(clearEdits) {\t\n\t\t\t// TODO this timestamp causes continuous anchors to not repaint properly.\n\t\t\t// fix this. do not just take out the timestamp. it runs a lot faster with \n\t\t\t// the timestamp included.\n\t\t\t//var timestamp = null;\n\t\t\tvar timestamp = _timestamp(), elId;\n\n            for (elId in endpointsByElement) {\n                _currentInstance.updateOffset( { elId : elId, recalc : true, timestamp:timestamp } );\n            }\n\n\t\t\tfor (elId in endpointsByElement) {\n\t\t\t\t_draw(elId, null, timestamp, clearEdits);\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.removeAllEndpoints = function(el, recurse) {\n            var _one = function(_el) {\n                var info = _info(_el),\n                    ebe = endpointsByElement[info.id],\n                    i, ii;\n\n                if (ebe) {\n                    for ( i = 0, ii = ebe.length; i < ii; i++) \n                        _currentInstance.deleteEndpoint(ebe[i]);\n                }\n                delete endpointsByElement[info.id];\n                \n                if (recurse) {\n                    if (info.el && info.el.nodeType != 3 && info.el.nodeType != 8 ) {\n                        for ( i = 0, ii = info.el.childNodes.length; i < ii; i++) {\n                            _one(info.el.childNodes[i]);\n                        }\n                    }\n                }\n                \n            };\n            _one(el);\n\t\t\treturn this;\n\t\t};\n                    \n        /**\n        * Remove the given element, including cleaning up all endpoints registered for it.\n        * This is exposed in the public API but also used internally by jsPlumb when removing the\n        * element associated with a connection drag.\n        */\n        this.remove = function(el, doNotRepaint) {\n        \tvar info = _info(el);        \t\n            _currentInstance.doWhileSuspended(function() {\n            \t_currentInstance.removeAllEndpoints(info.id, true);\n            \t_currentInstance.dragManager.elementRemoved(info.id);\n            \tdelete _currentInstance.floatingConnections[info.id];\n            \t_currentInstance.anchorManager.clearFor(info.id);\t\t\t\t\t\t\n            \t_currentInstance.anchorManager.removeFloatingConnection(info.id);\n            }, doNotRepaint === false);\n            _unmanage(info.id);\n            if (info.el){\n                _currentInstance.removeElement(info.el);\n                info.el._jsPlumb = null;\n            }\n\t\t\treturn _currentInstance;\n        };\n\t\t\n\t\tthis.reset = function() {\n            _currentInstance.setSuspendEvents(true);\n\t\t\t_currentInstance.deleteEveryEndpoint();\n            _currentInstance.unbind();\n\t\t\tthis.targetEndpointDefinitions = {};\n\t\t\tthis.sourceEndpointDefinitions = {};\n\t\t\tconnections.length = 0;\n            _currentInstance.setSuspendEvents(false);\n\t\t};\n\n        var _clearObject = function(obj) {\n            if(obj.canvas && obj.canvas.parentNode)\n                   obj.canvas.parentNode.removeChild(obj.canvas);\n            obj.cleanup();\n            obj.destroy();\n        };\n\n        var _clearOverlayObject = function(obj) {\n            _clearObject(obj);\n        };\n\n        this.clear = function() {\n            _currentInstance.select().each(_clearOverlayObject);\n            _currentInstance.selectEndpoints().each(_clearOverlayObject);\n\n            endpointsByElement = {};\n            endpointsByUUID = {};\n        };\n\n\t\tthis.setDefaultScope = function(scope) {\n\t\t\tDEFAULT_SCOPE = scope;\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\t// sets whether or not some element should be currently draggable.\n\t\tthis.setDraggable = _setDraggable;\n\n\t\t// sets the id of some element, changing whatever we need to to keep track.\n\t\tthis.setId = function(el, newId, doNotSetAttribute) {\n\t\t\t// \n\t\t\tvar id;\n\n\t\t\tif (jsPlumbUtil.isString(el)) {\n\t\t\t\tid = el;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tel = this.getDOMElement(el);\n\t\t\t\tid = this.getId(el);\n\t\t\t}\n\n\t\t\tvar sConns = this.getConnections({source:id, scope:'*'}, true),\n\t\t\t\ttConns = this.getConnections({target:id, scope:'*'}, true);\n\n\t\t\tnewId = \"\" + newId;\n\n\t\t\tif (!doNotSetAttribute) {\n\t\t\t\tel = this.getDOMElement(id);\n\t\t\t\tthis.setAttribute(el, \"id\", newId);\n\t\t\t}\n\t\t\telse\n\t\t\t\tel = this.getDOMElement(newId);\n\n\t\t\tendpointsByElement[newId] = endpointsByElement[id] || [];\n\t\t\tfor (var i = 0, ii = endpointsByElement[newId].length; i < ii; i++) {\n\t\t\t\tendpointsByElement[newId][i].setElementId(newId);\n\t\t\t\tendpointsByElement[newId][i].setReferenceElement(el);\n\t\t\t}\n\t\t\tdelete endpointsByElement[id];\n\n\t\t\tthis.anchorManager.changeId(id, newId);\n\t\t\tif (this.dragManager) this.dragManager.changeId(id, newId);\n            managedElements[newId] = managedElements[id];\n            delete managedElements[id];\n\n\t\t\tvar _conns = function(list, epIdx, type) {\n\t\t\t\tfor (var i = 0, ii = list.length; i < ii; i++) {\n\t\t\t\t\tlist[i].endpoints[epIdx].setElementId(newId);\n\t\t\t\t\tlist[i].endpoints[epIdx].setReferenceElement(el);\n\t\t\t\t\tlist[i][type + \"Id\"] = newId;\n\t\t\t\t\tlist[i][type] = el;\n\t\t\t\t}\n\t\t\t};\n\t\t\t_conns(sConns, 0, \"source\");\n\t\t\t_conns(tConns, 1, \"target\");\n\n\t\t\tthis.repaint(newId);\n\t\t};\n\n\t\tthis.setDebugLog = function(debugLog) {\n\t\t\tlog = debugLog;\n\t\t};\n\n\t\tthis.setSuspendDrawing = function(val, repaintAfterwards) {\n\t\t\tvar curVal = _suspendDrawing;\n\t\t    _suspendDrawing = val;\n\t\t\t\tif (val) _suspendedAt = new Date().getTime(); else _suspendedAt = null;\n\t\t    if (repaintAfterwards) this.repaintEverything();\n\t\t    return curVal;\n\t\t};\n\n        // returns whether or not drawing is currently suspended.\n\t\tthis.isSuspendDrawing = function() {\n\t\t\treturn _suspendDrawing;\n\t\t};\n\n        // return timestamp for when drawing was suspended.\n        this.getSuspendedAt = function() { return _suspendedAt; };\n\n        this.doWhileSuspended = function(fn, doNotRepaintAfterwards) {\n        \tvar _wasSuspended = this.isSuspendDrawing();\n        \tif (!_wasSuspended)\n\t\t\t\tthis.setSuspendDrawing(true);\n\t\t\ttry {\n\t\t\t\tfn();\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\t_ju.log(\"Function run while suspended failed\", e);\n\t\t\t}\n\t\t\tif (!_wasSuspended)\n\t\t\t\tthis.setSuspendDrawing(false, !doNotRepaintAfterwards);\n\t\t};\n\n\t\tthis.getOffset = function(elId) { return offsets[elId]; };\n\t\tthis.getCachedData = _getCachedData;\n\t\tthis.timestamp = _timestamp;\n\t\tthis.setRenderMode = function(mode) {\n\t\t\tif (mode !== jsPlumb.SVG && mode !== jsPlumb.VML) throw new TypeError(\"Render mode [\" + mode + \"] not supported\");\n\t\t\trenderMode = jsPlumbAdapter.setRenderMode(mode);\n\t\t\treturn renderMode;\n\t\t};\n\t\tthis.getRenderMode = function() { return renderMode; };\n\t\tthis.show = function(el, changeEndpoints) {\n\t\t\t_setVisible(el, \"block\", changeEndpoints);\n\t\t\treturn _currentInstance;\n\t\t};\n\n\t\t// TODO: update this method to return the current state.\n\t\tthis.toggleVisible = _toggleVisible;\n\t\tthis.toggleDraggable = _toggleDraggable;\n\t\tthis.addListener = this.bind;\n\n\t\tif (!jsPlumbAdapter.headless) {\n\t\t\t_currentInstance.dragManager = jsPlumbAdapter.getDragManager(_currentInstance);\n\t\t\t_currentInstance.recalculateOffsets = _currentInstance.dragManager.updateOffsets;\n\t\t}\n\t};\n\n    jsPlumbUtil.extend(jsPlumbInstance, jsPlumbUtil.EventGenerator, {\n    \tsetAttribute : function(el, a, v) {\n    \t\tthis.setAttribute(el, a, v);\n    \t},\n    \tgetAttribute : function(el, a) {\n    \t\treturn this.getAttribute(jsPlumb.getDOMElement(el), a);\n    \t},    \t\n    \tregisterConnectionType : function(id, type) {\n    \t\tthis._connectionTypes[id] = jsPlumb.extend({}, type);\n    \t},    \t\n    \tregisterConnectionTypes : function(types) {\n    \t\tfor (var i in types)\n    \t\t\tthis._connectionTypes[i] = jsPlumb.extend({}, types[i]);\n    \t},\n    \tregisterEndpointType : function(id, type) {\n    \t\tthis._endpointTypes[id] = jsPlumb.extend({}, type);\n    \t},    \t\n    \tregisterEndpointTypes : function(types) {\n    \t\tfor (var i in types)\n    \t\t\tthis._endpointTypes[i] = jsPlumb.extend({}, types[i]);\n    \t},    \t\n    \tgetType : function(id, typeDescriptor) {\n    \t\treturn typeDescriptor ===  \"connection\" ? this._connectionTypes[id] : this._endpointTypes[id];\n    \t},\n    \tsetIdChanged : function(oldId, newId) {\n    \t\tthis.setId(oldId, newId, true);\n    \t},\n    \t// set parent: change the parent for some node and update all the registrations we need to.\n    \tsetParent : function(el, newParent) {\n    \t\tvar _el = this.getElementObject(el),\n    \t\t\t_dom = this.getDOMElement(_el),\n    \t\t\t_id = this.getId(_dom),\n    \t\t\t_pel = this.getElementObject(newParent),\n    \t\t\t_pdom = this.getDOMElement(_pel),\n    \t\t\t_pid = this.getId(_pdom);\n\n    \t\t_dom.parentNode.removeChild(_dom);\n    \t\t_pdom.appendChild(_dom);\n    \t\tthis.dragManager.setParent(_el, _id, _pel, _pid);\n    \t},\n\t\t/**\n\t\t * gets the size for the element, in an array : [ width, height ].\n\t\t */\n\t\tgetSize : function(el) {\n\t\t\treturn [ el.offsetWidth, el.offsetHeight ];\n\t\t},\n\t\tgetWidth : function(el) {\n\t\t\treturn el.offsetWidth;\n\t\t},\n\t\tgetHeight : function(el) {\n\t\t\treturn el.offsetHeight;\n\t\t},\n\t\textend : function(o1, o2, names) {\n\t\t\tvar i;\n\t\t\tif (names) {\n\t\t\t\tfor (i = 0; i < names.length; i++)\n\t\t\t\t\to1[names[i]] = o2[names[i]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tfor (i in o2) o1[i] = o2[i];\n\t\t\treturn o1;\n\t\t},\n        floatingConnections:{},\n        getFloatingAnchorIndex : function(jpc) {\n            return jpc.endpoints[0].isFloating() ? 0 : 1;\n        }\n    }, jsPlumbAdapter);\n\n// --------------------- static instance + AMD registration -------------------------------------------\t\n\t\n// create static instance and assign to window if window exists.\t\n\tvar jsPlumb = new jsPlumbInstance();\n\t// register on window if defined (lets us run on server)\n\tif (typeof window != 'undefined') window.jsPlumb = jsPlumb;\t\n\t// add 'getInstance' method to static instance\n\tjsPlumb.getInstance = function(_defaults) {\n\t\tvar j = new jsPlumbInstance(_defaults);\n\t\tj.init();\n\t\treturn j;\n\t};\n// maybe register static instance as an AMD module, and getInstance method too.\n\tif ( typeof define === \"function\") {\n\t\tdefine( \"jsplumb\", [], function () { return jsPlumb; } );\n\t\tdefine( \"jsplumbinstance\", [], function () { return jsPlumb.getInstance(); } );\n\t}\n // CommonJS \n\tif (typeof exports !== 'undefined') {\n      exports.jsPlumb = jsPlumb;\n  \t}\n\t\n\t\n// --------------------- end static instance + AMD registration -------------------------------------------\t\t\n\t\n})();\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the code for Endpoints.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n    \n    \"use strict\";\n        \n    // create the drag handler for a connection\n    var _makeConnectionDragHandler = function(placeholder, _jsPlumb) {\n        var stopped = false;\n        return {\n            drag : function() {\n                if (stopped) {\n                    stopped = false;\n                    return true;\n                }\n                var _ui = jsPlumb.getUIPosition(arguments, _jsPlumb.getZoom());\n        \n                if (placeholder.element) {\n                    jsPlumbAdapter.setPosition(placeholder.element, _ui);                    \n                    _jsPlumb.repaint(placeholder.element, _ui);\n                }\n            },\n            stopDrag : function() {\n                stopped = true;\n            }\n        };\n    };\n        \n    // creates a placeholder div for dragging purposes, adds it to the DOM, and pre-computes its offset.    \n    var _makeDraggablePlaceholder = function(placeholder, _jsPlumb) {\n        var n = document.createElement(\"div\");\n        n.style.position = \"absolute\";\n        var parent = _jsPlumb.getContainer() || document.body;\n        parent.appendChild(n);\n        var id = _jsPlumb.getId(n);\n        //_jsPlumb.updateOffset( { elId : id });\n        _jsPlumb.manage( id, n );\n        // create and assign an id, and initialize the offset.\n        placeholder.id = id;\n        placeholder.element = n;\n    };\n    \n    // create a floating endpoint (for drag connections)\n    var _makeFloatingEndpoint = function(paintStyle, referenceAnchor, endpoint, referenceCanvas, sourceElement, _jsPlumb, _newEndpoint, scope) {\n        var floatingAnchor = new jsPlumb.FloatingAnchor( { reference : referenceAnchor, referenceCanvas : referenceCanvas, jsPlumbInstance:_jsPlumb });\n        //setting the scope here should not be the way to fix that mootools issue.  it should be fixed by not\n        // adding the floating endpoint as a droppable.  that makes more sense anyway!\n        return _newEndpoint({ paintStyle : paintStyle, endpoint : endpoint, anchor : floatingAnchor, source : sourceElement, scope:scope });\n    };\n\n    var typeParameters = [ \"connectorStyle\", \"connectorHoverStyle\", \"connectorOverlays\",\n                \"connector\", \"connectionType\", \"connectorClass\", \"connectorHoverClass\" ];\n\n    // a helper function that tries to find a connection to the given element, and returns it if so. if elementWithPrecedence is null,\n    // or no connection to it is found, we return the first connection in our list.\n    var findConnectionToUseForDynamicAnchor = function(ep, elementWithPrecedence) {\n        var idx = 0;\n        if (elementWithPrecedence != null) {\n            for (var i = 0; i < ep.connections.length; i++) {\n                if (ep.connections[i].sourceId == elementWithPrecedence || ep.connections[i].targetId == elementWithPrecedence) {\n                    idx = i;\n                    break;\n                }\n            }\n        }\n        \n        return ep.connections[idx];\n    };\n\n    var findConnectionIndex = function(conn, ep) {\n        return jsPlumbUtil.findWithFunction(ep.connections, function(c) { return c.id == conn.id; });\n    };\n\n    jsPlumb.Endpoint = function(params) {\n        var _jsPlumb = params._jsPlumb,\n            _gel = jsPlumb.getElementObject,            \n            _ju = jsPlumbUtil,            \n            _newConnection = params.newConnection,\n            _newEndpoint = params.newEndpoint,\n            _finaliseConnection = params.finaliseConnection,\n            _fireMoveEvent = params.fireMoveEvent;\n        \n        this.idPrefix = \"_jsplumb_e_\";\t\t\t\n        this.defaultLabelLocation = [ 0.5, 0.5 ];\n        this.defaultOverlayKeys = [\"Overlays\", \"EndpointOverlays\"];\n        OverlayCapableJsPlumbUIComponent.apply(this, arguments);        \n        \n// TYPE\t\t\n                \n        this.getDefaultType = function() {\t\t\t\t\t\t\t\t\n            return {\n                parameters:{},\n                scope:null,\n                maxConnections:this._jsPlumb.instance.Defaults.MaxConnections,\n                paintStyle:this._jsPlumb.instance.Defaults.EndpointStyle || jsPlumb.Defaults.EndpointStyle,\n                endpoint:this._jsPlumb.instance.Defaults.Endpoint || jsPlumb.Defaults.Endpoint,\n                hoverPaintStyle:this._jsPlumb.instance.Defaults.EndpointHoverStyle || jsPlumb.Defaults.EndpointHoverStyle,\t\t\t\t\n                overlays:this._jsPlumb.instance.Defaults.EndpointOverlays || jsPlumb.Defaults.EndpointOverlays,\n                connectorStyle:params.connectorStyle,\t\t\t\t\n                connectorHoverStyle:params.connectorHoverStyle,\n                connectorClass:params.connectorClass,\n                connectorHoverClass:params.connectorHoverClass,\n                connectorOverlays:params.connectorOverlays,\n                connector:params.connector,\n                connectorTooltip:params.connectorTooltip\n            };\n        };\n        \t\t\t\n// END TYPE\n            \n        this._jsPlumb.enabled = !(params.enabled === false);\n        this._jsPlumb.visible = true;        \n        this.element = jsPlumb.getDOMElement(params.source);  \n        this._jsPlumb.uuid = params.uuid;\n        this._jsPlumb.floatingEndpoint = null;  \n        var inPlaceCopy = null;\n        if (this._jsPlumb.uuid) params.endpointsByUUID[this._jsPlumb.uuid] = this;\n        this.elementId = params.elementId;\n        \n        this._jsPlumb.connectionCost = params.connectionCost;\n        this._jsPlumb.connectionsDirected = params.connectionsDirected;        \n        this._jsPlumb.currentAnchorClass = \"\";\n        this._jsPlumb.events = {};\n            \n        var  _updateAnchorClass = function() {\n            // stash old, get new\n            var oldAnchorClass = this._jsPlumb.currentAnchorClass;\n            this._jsPlumb.currentAnchorClass = this.anchor.getCssClass();\n            // add and remove at the same time to reduce the number of reflows.\n            jsPlumbAdapter.updateClasses(this.element, _jsPlumb.endpointAnchorClassPrefix + \"_\" + this._jsPlumb.currentAnchorClass, _jsPlumb.endpointAnchorClassPrefix + \"_\" + oldAnchorClass);\n            this.updateClasses(_jsPlumb.endpointAnchorClassPrefix + \"_\" + this._jsPlumb.currentAnchorClass, _jsPlumb.endpointAnchorClassPrefix + \"_\" + oldAnchorClass);\n        }.bind(this);\n        \n        this.setAnchor = function(anchorParams, doNotRepaint) {\n            this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId);\n            this.anchor = this._jsPlumb.instance.makeAnchor(anchorParams, this.elementId, _jsPlumb);\n            _updateAnchorClass();\n            this.anchor.bind(\"anchorChanged\", function(currentAnchor) {\n                this.fire(\"anchorChanged\", {endpoint:this, anchor:currentAnchor});\n                _updateAnchorClass();\n            }.bind(this));\n            if (!doNotRepaint)\n                this._jsPlumb.instance.repaint(this.elementId);\n            return this;\n        };\n\n        var anchorParamsToUse = params.anchor ? params.anchor : params.anchors ? params.anchors : (_jsPlumb.Defaults.Anchor || \"Top\");\n        this.setAnchor(anchorParamsToUse, true);\n\n        var internalHover = function(state) {\n          if (this.connections.length > 0) {\n              for (var i = 0; i < this.connections.length; i++)\n                  this.connections[i].setHover(state, false);\n          }\n          else\n            this.setHover(state);\n        }.bind(this);\n\n        this.bind(\"mouseover\", function() { internalHover(true); });\n        this.bind(\"mouseout\", function() { internalHover(false); });\n            \n        // ANCHOR MANAGER\n        if (!params._transient) // in place copies, for example, are transient.  they will never need to be retrieved during a paint cycle, because they dont move, and then they are deleted.\n            this._jsPlumb.instance.anchorManager.add(this, this.elementId);\n        \n        this.setEndpoint = function(ep) {\n\n            if (this.endpoint != null) {\n                this.endpoint.cleanup();\n                this.endpoint.destroy();\n            }\n\n            var _e = function(t, p) {\n                var rm = _jsPlumb.getRenderMode();\n                if (jsPlumb.Endpoints[rm][t]) return new jsPlumb.Endpoints[rm][t](p);\n                if (!_jsPlumb.Defaults.DoNotThrowErrors)\n                    throw { msg:\"jsPlumb: unknown endpoint type '\" + t + \"'\" };\n            };            \n\n            var endpointArgs = {\n                _jsPlumb:this._jsPlumb.instance,\n                cssClass:params.cssClass,\n                container:params.container,\n                tooltip:params.tooltip,\n                connectorTooltip:params.connectorTooltip,\n                endpoint:this\n            };\n\n            if (_ju.isString(ep)) \n                this.endpoint = _e(ep, endpointArgs);\n            else if (_ju.isArray(ep)) {\n                endpointArgs = _ju.merge(ep[1], endpointArgs);\n                this.endpoint = _e(ep[0], endpointArgs);\n            }\n            else {\n                this.endpoint = ep.clone();\n            }\n\n            // assign a clone function using a copy of endpointArgs. this is used when a drag starts: the endpoint that was dragged is cloned,\n            // and the clone is left in its place while the original one goes off on a magical journey. \n            // the copy is to get around a closure problem, in which endpointArgs ends up getting shared by\n            // the whole world.\n            //var argsForClone = jsPlumb.extend({}, endpointArgs);\n            this.endpoint.clone = function() {\n                // TODO this, and the code above, can be refactored to be more dry.\n                if (_ju.isString(ep)) \n                    return _e(ep, endpointArgs);\n                else if (_ju.isArray(ep)) {\n                    endpointArgs = _ju.merge(ep[1], endpointArgs);\n                    return _e(ep[0], endpointArgs);\n                }\n            }.bind(this);\n\n            this.type = this.endpoint.type;\n        };\n         \n        this.setEndpoint(params.endpoint || _jsPlumb.Defaults.Endpoint || jsPlumb.Defaults.Endpoint || \"Dot\");\n\n        this.setPaintStyle(params.endpointStyle || params.paintStyle || params.style || _jsPlumb.Defaults.EndpointStyle || jsPlumb.Defaults.EndpointStyle, true);\n        this.setHoverPaintStyle(params.endpointHoverStyle || params.hoverPaintStyle || _jsPlumb.Defaults.EndpointHoverStyle || jsPlumb.Defaults.EndpointHoverStyle, true);\n        this._jsPlumb.paintStyleInUse = this.getPaintStyle();\n\n        jsPlumb.extend(this, params, typeParameters);\n\n        this.isSource = params.isSource || false;\n        this.isTemporarySource = params.isTemporarySource || false;\n        this.isTarget = params.isTarget || false;        \n        this._jsPlumb.maxConnections = params.maxConnections || _jsPlumb.Defaults.MaxConnections; // maximum number of connections this endpoint can be the source of.                \n        this.canvas = this.endpoint.canvas;\n        this.canvas._jsPlumb = this;\n\n        // add anchor class (need to do this on construction because we set anchor first)\n        this.addClass(_jsPlumb.endpointAnchorClassPrefix + \"_\" + this._jsPlumb.currentAnchorClass);\t\n        jsPlumbAdapter.addClass(this.element, _jsPlumb.endpointAnchorClassPrefix + \"_\" + this._jsPlumb.currentAnchorClass);\n\n        this.connections = params.connections || [];\n        this.connectorPointerEvents = params[\"connector-pointer-events\"];\n        \n        this.scope = params.scope || _jsPlumb.getDefaultScope();        \n        this.timestamp = null;\n        this.reattachConnections = params.reattach || _jsPlumb.Defaults.ReattachConnections;\n        this.connectionsDetachable = _jsPlumb.Defaults.ConnectionsDetachable;\n        if (params.connectionsDetachable === false || params.detachable === false)\n            this.connectionsDetachable = false;\n        this.dragAllowedWhenFull = params.dragAllowedWhenFull !== false;\n        \n        if (params.onMaxConnections)\n            this.bind(\"maxConnections\", params.onMaxConnections);        \n        \n        //\n        // add a connection. not part of public API.\n        //\n        this.addConnection = function(connection) {\n            this.connections.push(connection);                  \n            this[(this.connections.length > 0 ? \"add\" : \"remove\") + \"Class\"](_jsPlumb.endpointConnectedClass);       \n            this[(this.isFull() ? \"add\" : \"remove\") + \"Class\"](_jsPlumb.endpointFullClass); \n        };\t\n\n        this.detachFromConnection = function(connection, idx, doNotCleanup) {\n            idx = idx == null ? findConnectionIndex(connection, this) : idx;\n            if (idx >= 0) {\n                this.connections.splice(idx, 1);\n                this[(this.connections.length > 0 ? \"add\" : \"remove\") + \"Class\"](_jsPlumb.endpointConnectedClass);       \n                this[(this.isFull() ? \"add\" : \"remove\") + \"Class\"](_jsPlumb.endpointFullClass);\n            }\n            \n            if (!doNotCleanup && this._deleteOnDetach && this.connections.length === 0) {\n                _jsPlumb.deleteObject({\n                    endpoint:this,\n                    fireEvent:false,\n                    deleteAttachedObjects:false\n                });\n            }\n        };\n\n        this.detach = function(connection, ignoreTarget, forceDetach, fireEvent, originalEvent, endpointBeingDeleted, connectionIndex) {\n\n            var idx = connectionIndex == null ? findConnectionIndex(connection, this) : connectionIndex,\n                actuallyDetached = false;\n                fireEvent = (fireEvent !== false);\n\n            if (idx >= 0) {\t\t                \n\n                if (forceDetach || connection._forceDetach || (connection.isDetachable() && connection.isDetachAllowed(connection) && this.isDetachAllowed(connection) && _jsPlumb.checkCondition(\"beforeDetach\", connection) )) {\n\n                    _jsPlumb.deleteObject({\n                        connection:connection, \n                        fireEvent:(!ignoreTarget && fireEvent), \n                        originalEvent:originalEvent,\n                        deleteAttachedObjects:false\n                    });\n                    actuallyDetached = true;                       \n                }\n            }\n            return actuallyDetached;\n        };\t\n\n        this.detachAll = function(fireEvent, originalEvent) {\n            while (this.connections.length > 0) {\n                // TODO this could pass the index in to the detach method to save some time (index will always be zero in this while loop)\n                this.detach(this.connections[0], false, true, fireEvent !== false, originalEvent, this, 0);\n            }\n            return this;\n        };                \n        this.detachFrom = function(targetEndpoint, fireEvent, originalEvent) {\n            var c = [];\n            for ( var i = 0; i < this.connections.length; i++) {\n                if (this.connections[i].endpoints[1] == targetEndpoint || this.connections[i].endpoints[0] == targetEndpoint) {\n                    c.push(this.connections[i]);\n                }\n            }\n            for ( var j = 0; j < c.length; j++) {\n                this.detach(c[j], false, true, fireEvent, originalEvent);\t\t\t\t\n            }\n            return this;\n        };\t        \n        \n        this.getElement = function() {\n            return this.element;\n        };\t\t\n                 \n        this.setElement = function(el) {\n            var parentId = this._jsPlumb.instance.getId(el),\n                curId = this.elementId;\n            // remove the endpoint from the list for the current endpoint's element\n            _ju.removeWithFunction(params.endpointsByElement[this.elementId], function(e) {\n                return e.id == this.id;\n            }.bind(this));\n            this.element = jsPlumb.getDOMElement(el);\n            this.elementId = _jsPlumb.getId(this.element);                         \n            _jsPlumb.anchorManager.rehomeEndpoint(this, curId, this.element);\n            _jsPlumb.dragManager.endpointAdded(this.element);            \n            _ju.addToList(params.endpointsByElement, parentId, this);            \n            return this;\n        };\n                \n        /**\n         * private but must be exposed.\n         */\n        this.makeInPlaceCopy = function() {\n            var loc = this.anchor.getCurrentLocation({element:this}),\n                o = this.anchor.getOrientation(this),\n                acc = this.anchor.getCssClass(),\n                inPlaceAnchor = {\n                    bind:function() { },\n                    compute:function() { return [ loc[0], loc[1] ]; },\n                    getCurrentLocation : function() { return [ loc[0], loc[1] ]; },\n                    getOrientation:function() { return o; },\n                    getCssClass:function() { return acc; }\n                };\n\n            return _newEndpoint( { \n                dropOptions:params.dropOptions,\n                anchor : inPlaceAnchor, \n                source : this.element, \n                paintStyle : this.getPaintStyle(), \n                endpoint : params.hideOnDrag ? \"Blank\" : this.endpoint,\n                _transient:true,\n                scope:this.scope\n            });\n        };\n        \n        /**\n         * returns a connection from the pool; used when dragging starts.  just gets the head of the array if it can.\n         */\n        this.connectorSelector = function() {\n            var candidate = this.connections[0];\n            if (this.isTarget && candidate) return candidate;\n            else {\n                return (this.connections.length < this._jsPlumb.maxConnections) || this._jsPlumb.maxConnections == -1 ? null : candidate;\n            }\n        };        \n        \n        this.setStyle = this.setPaintStyle;        \n        \n        this.paint = function(params) {\n            params = params || {};\n            var timestamp = params.timestamp, recalc = !(params.recalc === false);\t\t\t\t\t\t\t\t\n            if (!timestamp || this.timestamp !== timestamp) {\t\t\t\t\t\t\n\n                var info = _jsPlumb.updateOffset({ elId:this.elementId, timestamp:timestamp });\n\n                var xy = params.offset ? params.offset.o : info.o;\n                if(xy != null) {\n                    var ap = params.anchorPoint,connectorPaintStyle = params.connectorPaintStyle;\n                    if (ap == null) {\n                        var wh = params.dimensions || info.s,                       \n                            anchorParams = { xy : [ xy.left, xy.top ], wh : wh, element : this, timestamp : timestamp };\n                        if (recalc && this.anchor.isDynamic && this.connections.length > 0) {\n                            var c = findConnectionToUseForDynamicAnchor(this, params.elementWithPrecedence),\n                                oIdx = c.endpoints[0] == this ? 1 : 0,\n                                oId = oIdx === 0 ? c.sourceId : c.targetId,\n                                oInfo = _jsPlumb.getCachedData(oId),\n                                oOffset = oInfo.o, oWH = oInfo.s;\n                            anchorParams.txy = [ oOffset.left, oOffset.top ];\n                            anchorParams.twh = oWH;\n                            anchorParams.tElement = c.endpoints[oIdx];\n                        }\n                        ap = this.anchor.compute(anchorParams);\n                    }\n                                        \n                    this.endpoint.compute(ap, this.anchor.getOrientation(this), this._jsPlumb.paintStyleInUse, connectorPaintStyle || this.paintStyleInUse);\n                    this.endpoint.paint(this._jsPlumb.paintStyleInUse, this.anchor);\t\t\t\t\t\n                    this.timestamp = timestamp;\n\n                    // paint overlays\n                    for ( var i = 0; i < this._jsPlumb.overlays.length; i++) {\n                        var o = this._jsPlumb.overlays[i];\n                        if (o.isVisible()) { \n                            this._jsPlumb.overlayPlacements[i] = o.draw(this.endpoint, this._jsPlumb.paintStyleInUse);\n                            o.paint(this._jsPlumb.overlayPlacements[i]);    \n                        }\n                    }\n                }\n            }\n        };\n\n        this.repaint = this.paint; \n\n        var draggingInitialised = false;\n        this.initDraggable = function() {\n\n            // is this a connection source? we make it draggable and have the\n            // drag listener maintain a connection with a floating endpoint.\n            if (!draggingInitialised && jsPlumb.isDragSupported(this.element)) {\n                var placeholderInfo = { id:null, element:null },\n                    jpc = null,\n                    existingJpc = false,\n                    existingJpcParams = null,\n                    _dragHandler = _makeConnectionDragHandler(placeholderInfo, _jsPlumb),\n                    dragOptions = params.dragOptions || {},\n                    defaultOpts = {},\n                    startEvent = jsPlumb.dragEvents.start,\n                    stopEvent = jsPlumb.dragEvents.stop,\n                    dragEvent = jsPlumb.dragEvents.drag;\n\n                var start = function() {    \n                // drag might have started on an endpoint that is not actually a source, but which has\n                // one or more connections.\n                    jpc = this.connectorSelector();\n                    var _continue = true;\n                    // if not enabled, return\n                    if (!this.isEnabled()) _continue = false;\n                    // if no connection and we're not a source - or temporarily a source, as is the case with makeSource - return.\n                    if (jpc == null && !this.isSource && !this.isTemporarySource) _continue = false;\n                    // otherwise if we're full and not allowed to drag, also return false.\n                    if (this.isSource && this.isFull() && !this.dragAllowedWhenFull) _continue = false;\n                    // if the connection was setup as not detachable or one of its endpoints\n                    // was setup as connectionsDetachable = false, or Defaults.ConnectionsDetachable\n                    // is set to false...\n                    if (jpc != null && !jpc.isDetachable()) _continue = false;\n\n                    if (_continue === false) {\n                        // this is for mootools and yui. returning false from this causes jquery to stop drag.\n                        // the events are wrapped in both mootools and yui anyway, but i don't think returning\n                        // false from the start callback would stop a drag.\n                        if (_jsPlumb.stopDrag) _jsPlumb.stopDrag(this.canvas);\n                        _dragHandler.stopDrag();\n                        return false;\n                    }\n\n                    // clear hover for all connections for this endpoint before continuing.\n                    for (var i = 0; i < this.connections.length; i++)\n                        this.connections[i].setHover(false);\n\n                    this.addClass(\"endpointDrag\");\n                    _jsPlumb.setConnectionBeingDragged(true);\n\n                    // if we're not full but there was a connection, make it null. we'll create a new one.\n                    if (jpc && !this.isFull() && this.isSource) jpc = null;\n\n                    _jsPlumb.updateOffset( { elId : this.elementId });\n                    inPlaceCopy = this.makeInPlaceCopy();\n                    inPlaceCopy.referenceEndpoint = this;\n                    inPlaceCopy.paint();                                                                \n                    \n                    _makeDraggablePlaceholder(placeholderInfo, _jsPlumb);\n                    \n                    // set the offset of this div to be where 'inPlaceCopy' is, to start with.\n                    // TODO merge this code with the code in both Anchor and FloatingAnchor, because it\n                    // does the same stuff.\n                    var ipcoel = _gel(inPlaceCopy.canvas),\n                        ipco = jsPlumbAdapter.getOffset(ipcoel, this._jsPlumb.instance),                        \n                        canvasElement = _gel(this.canvas);                               \n                        \n                    jsPlumbAdapter.setPosition(placeholderInfo.element, ipco);\n                    \n                    // when using makeSource and a parent, we first draw the source anchor on the source element, then\n                    // move it to the parent.  note that this happens after drawing the placeholder for the\n                    // first time.\n                    if (this.parentAnchor) this.anchor = _jsPlumb.makeAnchor(this.parentAnchor, this.elementId, _jsPlumb);\n                    \n                    // store the id of the dragging div and the source element. the drop function will pick these up.                   \n                    _jsPlumb.setAttribute(this.canvas, \"dragId\", placeholderInfo.id);\n                    _jsPlumb.setAttribute(this.canvas, \"elId\", this.elementId);\n\n                    this._jsPlumb.floatingEndpoint = _makeFloatingEndpoint(this.getPaintStyle(), this.anchor, this.endpoint, this.canvas, placeholderInfo.element, _jsPlumb, _newEndpoint, this.scope);\n                    // TODO we should not know about DOM here. make the library adapter do this (or the \n                        // dom adapter)\n                    this.canvas.style.visibility = \"hidden\";            \n                    \n                    if (jpc == null) {                                                                                                                                                         \n                        this.anchor.locked = true;\n                        this.setHover(false, false);                        \n                        // create a connection. one end is this endpoint, the other is a floating endpoint.                    \n                        jpc = _newConnection({\n                            sourceEndpoint : this,\n                            targetEndpoint : this._jsPlumb.floatingEndpoint,\n                            source : this.endpointWillMoveTo || this.element,  // for makeSource with parent option.  ensure source element is represented correctly.\n                            target : placeholderInfo.element,\n                            anchors : [ this.anchor, this._jsPlumb.floatingEndpoint.anchor ],\n                            paintStyle : params.connectorStyle, // this can be null. Connection will use the default.\n                            hoverPaintStyle:params.connectorHoverStyle,\n                            connector : params.connector, // this can also be null. Connection will use the default.\n                            overlays : params.connectorOverlays,\n                            type:this.connectionType,\n                            cssClass:this.connectorClass,\n                            hoverClass:this.connectorHoverClass\n                        });\n                        //jpc.pending = true; // mark this connection as not having been established.\n                        jpc.addClass(_jsPlumb.draggingClass);\n                        this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass);\n                        // fire an event that informs that a connection is being dragged\n                        _jsPlumb.fire(\"connectionDrag\", jpc);\n\n                    } else {\n                        existingJpc = true;\n                        jpc.setHover(false);\n                        // new anchor idx\n                        var anchorIdx = jpc.endpoints[0].id == this.id ? 0 : 1;\n                        this.detachFromConnection(jpc, null, true);                         // detach from the connection while dragging is occurring. but dont cleanup automatically.\n                                                \n                        // store the original scope (issue 57)\n                        var dragScope = _jsPlumb.getDragScope(canvasElement);\n                        _jsPlumb.setAttribute(this.canvas, \"originalScope\", dragScope);\n                        // now we want to get this endpoint's DROP scope, and set it for now: we can only be dropped on drop zones\n                        // that have our drop scope (issue 57).\n                        var dropScope = _jsPlumb.getDropScope(canvasElement);\n                        _jsPlumb.setDragScope(canvasElement, dropScope);\n                        //*/\n\n                        // fire an event that informs that a connection is being dragged. we do this before\n                        // replacing the original target with the floating element info.\n                        _jsPlumb.fire(\"connectionDrag\", jpc);\n                \n                        // now we replace ourselves with the temporary div we created above:\n                        if (anchorIdx === 0) {\n                            existingJpcParams = [ jpc.source, jpc.sourceId, canvasElement, dragScope ];\n                            jpc.source = placeholderInfo.element;\n                            jpc.sourceId = placeholderInfo.id;\n                        } else {\n                            existingJpcParams = [ jpc.target, jpc.targetId, canvasElement, dragScope ];\n                            jpc.target = placeholderInfo.element;\n                            jpc.targetId = placeholderInfo.id;\n                        }\n\n                        // lock the other endpoint; if it is dynamic it will not move while the drag is occurring.\n                        jpc.endpoints[anchorIdx === 0 ? 1 : 0].anchor.locked = true;\n                        // store the original endpoint and assign the new floating endpoint for the drag.\n                        jpc.suspendedEndpoint = jpc.endpoints[anchorIdx];\n                        \n                        // PROVIDE THE SUSPENDED ELEMENT, BE IT A SOURCE OR TARGET (ISSUE 39)\n                        jpc.suspendedElement = jpc.endpoints[anchorIdx].getElement();\n                        jpc.suspendedElementId = jpc.endpoints[anchorIdx].elementId;\n                        jpc.suspendedElementType = anchorIdx === 0 ? \"source\" : \"target\";\n                        \n                        jpc.suspendedEndpoint.setHover(false);\n                        this._jsPlumb.floatingEndpoint.referenceEndpoint = jpc.suspendedEndpoint;\n                        jpc.endpoints[anchorIdx] = this._jsPlumb.floatingEndpoint;\n\n                        jpc.addClass(_jsPlumb.draggingClass);\n                        this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass);                    \n                    }\n                \n                    // register it and register connection on it.\n                    _jsPlumb.floatingConnections[placeholderInfo.id] = jpc;\n                    _jsPlumb.anchorManager.addFloatingConnection(placeholderInfo.id, jpc);               \n                    // only register for the target endpoint; we will not be dragging the source at any time\n                    // before this connection is either discarded or made into a permanent connection.\n                    _ju.addToList(params.endpointsByElement, placeholderInfo.id, this._jsPlumb.floatingEndpoint);\n                    // tell jsplumb about it\n                    _jsPlumb.currentlyDragging = true;\n                }.bind(this);\n\n                var stop = function() {\n                    _jsPlumb.setConnectionBeingDragged(false);\n                    // if no endpoints, jpc already cleaned up.\n                    if (jpc && jpc.endpoints != null) {\n                        // get the actual drop event (decode from library args to stop function)\n                        var originalEvent = _jsPlumb.getDropEvent(arguments);\n                        // unlock the other endpoint (if it is dynamic, it would have been locked at drag start)\n                        var idx = _jsPlumb.getFloatingAnchorIndex(jpc);\n                        jpc.endpoints[idx === 0 ? 1 : 0].anchor.locked = false;\n                        // TODO: Dont want to know about css classes inside jsplumb, ideally.\n                        jpc.removeClass(_jsPlumb.draggingClass);\n\n                        // if we have the floating endpoint then the connection has not been dropped\n                        // on another endpoint.  If it is a new connection we throw it away. If it is an\n                        // existing connection we check to see if we should reattach it, throwing it away\n                        // if not.\n                        if (this._jsPlumb && (jpc.deleteConnectionNow || jpc.endpoints[idx] == this._jsPlumb.floatingEndpoint)) {\n                            // 6a. if the connection was an existing one...\n                            if (existingJpc && jpc.suspendedEndpoint) {\n                                // fix for issue35, thanks Sylvain Gizard: when firing the detach event make sure the\n                                // floating endpoint has been replaced.\n                                if (idx === 0) {\n                                    jpc.source = existingJpcParams[0];\n                                    jpc.sourceId = existingJpcParams[1];\n                                } else {\n                                    jpc.target = existingJpcParams[0];\n                                    jpc.targetId = existingJpcParams[1];\n                                }\n\n                                var fe = this._jsPlumb.floatingEndpoint; // store for later removal.\n                                // restore the original scope (issue 57)\n                                _jsPlumb.setDragScope(existingJpcParams[2], existingJpcParams[3]);\n                                jpc.endpoints[idx] = jpc.suspendedEndpoint;\n                                // IF the connection should be reattached, or the other endpoint refuses detach, then\n                                // reset the connection to its original state\n                                if (jpc.isReattach() || jpc._forceReattach || jpc._forceDetach || !jpc.endpoints[idx === 0 ? 1 : 0].detach(jpc, false, false, true, originalEvent)) {\n                                    jpc.setHover(false);\n                                    jpc._forceDetach = null;\n                                    jpc._forceReattach = null;\n                                    this._jsPlumb.floatingEndpoint.detachFromConnection(jpc);\n                                    jpc.suspendedEndpoint.addConnection(jpc);\n                                    _jsPlumb.repaint(existingJpcParams[1]);\n                                }\n                                else\n                                    _jsPlumb.deleteObject({endpoint:fe});\n                            }\n                        }\n\n                        // remove the element associated with the floating endpoint\n                        // (and its associated floating endpoint and visual artefacts)\n                        _jsPlumb.remove(placeholderInfo.element, false);\n                        // remove the inplace copy\n                        _jsPlumb.deleteObject({endpoint:inPlaceCopy});\n\n                        // makeTargets sets this flag, to tell us we have been replaced and should delete ourself.\n                        if (this.deleteAfterDragStop) {\n                            _jsPlumb.deleteObject({endpoint:this});\n                        }\n                        else {\n                            if (this._jsPlumb) {\n                                this._jsPlumb.floatingEndpoint = null;\n                                // repaint this endpoint.\n                                // make our canvas visible (TODO: hand off to library; we should not know about DOM)\n                                this.canvas.style.visibility = \"visible\";\n                                // unlock our anchor\n                                this.anchor.locked = false;\n                                this.paint({recalc:false});\n                            }\n                        }\n\n                        // although the connection is no longer valid, there are use cases where this is useful.\n                        _jsPlumb.fire(\"connectionDragStop\", jpc, originalEvent);\n\n                        // tell jsplumb that dragging is finished.\n                        _jsPlumb.currentlyDragging = false;\n\n                        jpc = null;\n                    }\n\n                }.bind(this);\n\n                dragOptions = jsPlumb.extend(defaultOpts, dragOptions);\n                dragOptions.scope = this.scope || dragOptions.scope;\n                dragOptions[startEvent] = _ju.wrap(dragOptions[startEvent], start, false);\n                // extracted drag handler function so can be used by makeSource\n                dragOptions[dragEvent] = _ju.wrap(dragOptions[dragEvent], _dragHandler.drag);\n                dragOptions[stopEvent] = _ju.wrap(dragOptions[stopEvent], stop);\n\n                dragOptions.canDrag = function() {\n                    return this.isSource || this.isTemporarySource || (this.isTarget && this.connections.length > 0);\n                }.bind(this);\n\n                _jsPlumb.initDraggable(this.canvas, dragOptions, \"internal\");\n\n                this.canvas._jsPlumbRelatedElement = this.element;\n\n                draggingInitialised = true;\n            }\n        };\n\n        // if marked as source or target at create time, init the dragging.\n        if (this.isSource || this.isTarget || this.isTemporarySource)\n            this.initDraggable();\n\n\n        // pulled this out into a function so we can reuse it for the inPlaceCopy canvas; you can now drop detached connections\n        // back onto the endpoint you detached it from.\n        var _initDropTarget = function(canvas, forceInit, isTransient, endpoint) {\n\n            if ((this.isTarget || forceInit) && jsPlumb.isDropSupported(this.element)) {\n                var dropOptions = params.dropOptions || _jsPlumb.Defaults.DropOptions || jsPlumb.Defaults.DropOptions;\n                dropOptions = jsPlumb.extend( {}, dropOptions);\n                dropOptions.scope = dropOptions.scope || this.scope;\n                var dropEvent = jsPlumb.dragEvents.drop,\n                    overEvent = jsPlumb.dragEvents.over,\n                    outEvent = jsPlumb.dragEvents.out,\n                    _ep = this,\n                    drop = _jsPlumb.EndpointDropHandler({\n                        getEndpoint:function() { return _ep; },\n                        jsPlumb:_jsPlumb,\n                        enabled:function() {\n                            return endpoint != null ? endpoint.isEnabled() : true;\n                        },\n                        isFull:function() {\n                            return endpoint.isFull();\n                        },\n                        element:this.element,\n                        elementId:this.elementId,\n                        isSource:this.isSource,\n                        isTarget:this.isTarget,\n                        addClass:function(clazz) {\n                            _ep.addClass(clazz);\n                        },\n                        removeClass:function(clazz) {\n                            _ep.removeClass(clazz);\n                        },\n                        isDropAllowed:function() {\n                            return _ep.isDropAllowed.apply(_ep, arguments);\n                        }\n                    });\n                \n                dropOptions[dropEvent] = _ju.wrap(dropOptions[dropEvent], drop);\n                dropOptions[overEvent] = _ju.wrap(dropOptions[overEvent], function() {\t\t\t\t\t\n                    var draggable = jsPlumb.getDragObject(arguments),\n                        id = _jsPlumb.getAttribute(jsPlumb.getDOMElement(draggable), \"dragId\"),\n                        _jpc = _jsPlumb.floatingConnections[id];\n                        \n                    if (_jpc != null) {\t\t\t\t\t\t\t\t\n                        var idx = _jsPlumb.getFloatingAnchorIndex(_jpc);\n                        // here we should fire the 'over' event if we are a target and this is a new connection,\n                        // or we are the same as the floating endpoint.\t\t\t\t\t\t\t\t\n                        var _cont = (this.isTarget && idx !== 0) || (_jpc.suspendedEndpoint && this.referenceEndpoint && this.referenceEndpoint.id == _jpc.suspendedEndpoint.id);\n                        if (_cont) {\n                            var bb = _jsPlumb.checkCondition(\"checkDropAllowed\", { \n                                sourceEndpoint:_jpc.endpoints[idx], \n                                targetEndpoint:this,\n                                connection:_jpc\n                            }); \n                            this[(bb ? \"add\" : \"remove\") + \"Class\"](_jsPlumb.endpointDropAllowedClass);\n                            this[(bb ? \"remove\" : \"add\") + \"Class\"](_jsPlumb.endpointDropForbiddenClass);\n                            _jpc.endpoints[idx].anchor.over(this.anchor, this);\n                        }\n                    }\t\t\t\t\t\t\n                }.bind(this));\t\n\n                dropOptions[outEvent] = _ju.wrap(dropOptions[outEvent], function() {\t\t\t\t\t\n                    var draggable = jsPlumb.getDragObject(arguments),\n                        id = draggable == null ? null : _jsPlumb.getAttribute( jsPlumb.getDOMElement(draggable), \"dragId\"),\n                        _jpc = id? _jsPlumb.floatingConnections[id] : null;\n                        \n                    if (_jpc != null) {\n                        var idx = _jsPlumb.getFloatingAnchorIndex(_jpc);\n                        var _cont = (this.isTarget && idx !== 0) || (_jpc.suspendedEndpoint && this.referenceEndpoint && this.referenceEndpoint.id == _jpc.suspendedEndpoint.id);\n                        if (_cont) {\n                            this.removeClass(_jsPlumb.endpointDropAllowedClass);\n                            this.removeClass(_jsPlumb.endpointDropForbiddenClass);\n                            _jpc.endpoints[idx].anchor.out();\n                        }\n                    }\n                }.bind(this));\n\n                _jsPlumb.initDroppable(canvas, dropOptions, \"internal\", isTransient);\n            }\n        }.bind(this);\n        \n        // initialise the endpoint's canvas as a drop target.  this will be ignored if the endpoint is not a target or drag is not supported.\n        if (!this.anchor.isFloating)\n            _initDropTarget(_gel(this.canvas), true, !(params._transient || this.anchor.isFloating), this);\n\n        // finally, set type if it was provided\n         if (params.type)\n            this.addType(params.type, params.data, _jsPlumb.isSuspendDrawing());\n\n        return this;        \t\t\t\t\t\n    };\n\n    jsPlumbUtil.extend(jsPlumb.Endpoint, OverlayCapableJsPlumbUIComponent, {\n        getTypeDescriptor : function() { return \"endpoint\"; },        \n        isVisible : function() { return this._jsPlumb.visible; },\n        setVisible : function(v, doNotChangeConnections, doNotNotifyOtherEndpoint) {\n            this._jsPlumb.visible = v;\n            if (this.canvas) this.canvas.style.display = v ? \"block\" : \"none\";\n            this[v ? \"showOverlays\" : \"hideOverlays\"]();\n            if (!doNotChangeConnections) {\n                for (var i = 0; i < this.connections.length; i++) {\n                    this.connections[i].setVisible(v);\n                    if (!doNotNotifyOtherEndpoint) {\n                        var oIdx = this === this.connections[i].endpoints[0] ? 1 : 0;\n                        // only change the other endpoint if this is its only connection.\n                        if (this.connections[i].endpoints[oIdx].connections.length == 1) this.connections[i].endpoints[oIdx].setVisible(v, true, true);\n                    }\n                }\n            }\n        },\n        getAttachedElements : function() {\n            return this.connections;\n        },\n        applyType : function(t) {\n            this.setPaintStyle(t.endpointStyle || t.paintStyle);\n            this.setHoverPaintStyle(t.endpointHoverStyle || t.hoverPaintStyle);\n            if (t.maxConnections != null) this._jsPlumb.maxConnections = t.maxConnections;\n            if (t.scope) this.scope = t.scope;\n            jsPlumb.extend(this, t, typeParameters);\n            if (t.anchor) {\n                this.anchor = this._jsPlumb.instance.makeAnchor(t.anchor);\n            }\n            if (t.cssClass != null && this.canvas) this._jsPlumb.instance.addClass(this.canvas, t.cssClass);\n        },\n        isEnabled : function() { return this._jsPlumb.enabled; },\n        setEnabled : function(e) { this._jsPlumb.enabled = e; },\n        cleanup : function() {            \n            jsPlumbAdapter.removeClass(this.element, this._jsPlumb.instance.endpointAnchorClassPrefix + \"_\" + this._jsPlumb.currentAnchorClass);            \n            this.anchor = null;\n            this.endpoint.cleanup();\n            this.endpoint.destroy();\n            this.endpoint = null;\n            // drag/drop\n            var i = jsPlumb.getElementObject(this.canvas);              \n            this._jsPlumb.instance.destroyDraggable(i, \"internal\");\n            this._jsPlumb.instance.destroyDroppable(i, \"internal\");\n        },\n        setHover : function(h) {\n            if (this.endpoint && this._jsPlumb && !this._jsPlumb.instance.isConnectionBeingDragged())\n                this.endpoint.setHover(h);            \n        },\n        isFull : function() {\n            return !(this.isFloating() || this._jsPlumb.maxConnections < 1 || this.connections.length < this._jsPlumb.maxConnections);              \n        },\n        /**\n         * private but needs to be exposed.\n         */\n        isFloating : function() {\n            return this.anchor != null && this.anchor.isFloating;\n        },\n        isConnectedTo : function(endpoint) {\n            var found = false;\n            if (endpoint) {\n                for ( var i = 0; i < this.connections.length; i++) {\n                    if (this.connections[i].endpoints[1] == endpoint || this.connections[i].endpoints[0] == endpoint) {\n                        found = true;\n                        break;\n                    }\n                }\n            }\n            return found;\n        },\n        getConnectionCost : function() { return this._jsPlumb.connectionCost; },\n        setConnectionCost : function(c) {\n            this._jsPlumb.connectionCost = c; \n        },\n        areConnectionsDirected : function() { return this._jsPlumb.connectionsDirected; },\n        setConnectionsDirected : function(b) { this._jsPlumb.connectionsDirected = b; },\n        setElementId : function(_elId) {\n            this.elementId = _elId;\n            this.anchor.elementId = _elId;\n        },        \n        setReferenceElement : function(_el) {\n            this.element = jsPlumb.getDOMElement(_el);\n        },\n        setDragAllowedWhenFull : function(allowed) {\n            this.dragAllowedWhenFull = allowed;\n        },\n        equals : function(endpoint) {\n            return this.anchor.equals(endpoint.anchor);\n        },\n        getUuid : function() {\n            return this._jsPlumb.uuid;\n        },\n        computeAnchor : function(params) {\n            return this.anchor.compute(params);\n        }\n    });\n\n    jsPlumbInstance.prototype.EndpointDropHandler = function(dhParams) {\n        return function(e) {\n\n            var _jsPlumb = dhParams.jsPlumb;\n\n            // remove the classes that are added dynamically. drop is neither forbidden nor allowed now that\n            // the drop is finishing.\n            // makeTarget:probably keep these. 'this' would refer to the DOM element though\n            dhParams.removeClass(_jsPlumb.endpointDropAllowedClass);\n            dhParams.removeClass(_jsPlumb.endpointDropForbiddenClass);\n\n            var originalEvent = _jsPlumb.getDropEvent(arguments),\n                draggable = _jsPlumb.getDOMElement(_jsPlumb.getDragObject(arguments)),\n                id = _jsPlumb.getAttribute(draggable, \"dragId\"),\n                elId = _jsPlumb.getAttribute(draggable, \"elId\"),\n                scope = _jsPlumb.getAttribute(draggable, \"originalScope\"),\n                jpc = _jsPlumb.floatingConnections[id];\n\n            if (jpc == null) return;\n            var _ep = dhParams.getEndpoint(jpc);\n\n            if (dhParams.onDrop) dhParams.onDrop(jpc);\n\n            // if this is a drop back where the connection came from, mark it force rettach and\n            // return; the stop handler will reattach. without firing an event.\n            var redrop = jpc.suspendedEndpoint && (jpc.suspendedEndpoint.id == _ep.id ||\n                _ep.referenceEndpoint && jpc.suspendedEndpoint.id == _ep.referenceEndpoint.id) ;\n            if (redrop) {\n                jpc._forceReattach = true;\n                jpc.setHover(false);\n                return;\n            }\n\n            var idx = _jsPlumb.getFloatingAnchorIndex(jpc);\n\n            // restore the original scope if necessary (issue 57)\n            if (scope) _jsPlumb.setDragScope(draggable, scope);\n\n            // if the target of the drop is full, fire an event (we abort below)\n            // makeTarget: keep.\n            if (dhParams.isFull(e)) {\n                _ep.fire(\"maxConnections\", {\n                    endpoint:this,\n                    connection:jpc,\n                    maxConnections:_ep._jsPlumb.maxConnections\n                }, originalEvent);\n            }\n\n            if (!dhParams.isFull() && !(idx === 0 && !dhParams.isSource) && !(idx == 1 && !dhParams.isTarget) && dhParams.enabled()) {\n                var _doContinue = true;\n                // if this is an existing connection and detach is not allowed we won't continue. The connection's\n                // endpoints have been reinstated; everything is back to how it was.\n                if (jpc.suspendedEndpoint && jpc.suspendedEndpoint.id != _ep.id) {\n\n                    if (!jpc.isDetachAllowed(jpc) || !jpc.endpoints[idx].isDetachAllowed(jpc) || !jpc.suspendedEndpoint.isDetachAllowed(jpc) || !_jsPlumb.checkCondition(\"beforeDetach\", jpc))\n                        _doContinue = false;\n                }\n\n                // these have to be set before testing for beforeDrop.\n                if (idx === 0) {\n                    jpc.source = dhParams.element;\n                    jpc.sourceId = dhParams.elementId;\n                } else {\n                    jpc.target = dhParams.element;\n                    jpc.targetId = dhParams.elementId;\n                }\n\n// ------------ wrap the execution path in a function so we can support asynchronous beforeDrop\n\n                var continueFunction = function() {\n                    // remove this jpc from the current endpoint, which is a floating endpoint that we will\n                    // subsequently discard.\n                    jpc.endpoints[idx].detachFromConnection(jpc);\n\n                    // if there's a suspended endpoint, detach it from the connection.\n                    if (jpc.suspendedEndpoint) jpc.suspendedEndpoint.detachFromConnection(jpc);\n                    // TODO why?\n\n                    jpc.endpoints[idx] = _ep;\n                    _ep.addConnection(jpc);\n\n                    // copy our parameters in to the connection:\n                    var params = _ep.getParameters();\n                    for (var aParam in params)\n                        jpc.setParameter(aParam, params[aParam]);\n\n                    if (!jpc.suspendedEndpoint) {\n                        // if not an existing connection and\n                        if (params.draggable)\n                            _jsPlumb.initDraggable(this.element, dragOptions, \"internal\", _jsPlumb);\n                    }\n                    else {\n                        var suspendedElementId = jpc.suspendedEndpoint.elementId;\n                        _jsPlumb.fireMoveEvent({\n                            index:idx,\n                            originalSourceId:idx === 0 ? suspendedElementId : jpc.sourceId,\n                            newSourceId:idx === 0 ? _ep.elementId : jpc.sourceId,\n                            originalTargetId:idx == 1 ? suspendedElementId : jpc.targetId,\n                            newTargetId:idx == 1 ? _ep.elementId : jpc.targetId,\n                            originalSourceEndpoint:idx === 0 ? jpc.suspendedEndpoint : jpc.endpoints[0],\n                            newSourceEndpoint:idx === 0 ? _ep : jpc.endpoints[0],\n                            originalTargetEndpoint:idx == 1 ? jpc.suspendedEndpoint : jpc.endpoints[1],\n                            newTargetEndpoint:idx == 1 ? _ep : jpc.endpoints[1],\n                            connection:jpc\n                        }, originalEvent);\n                    }\n\n                    if (idx == 1)\n                        _jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId, jpc.suspendedElementId, jpc.targetId, jpc);\n                    else\n                        _jsPlumb.anchorManager.sourceChanged(jpc.suspendedEndpoint.elementId, jpc.sourceId, jpc);\n\n                    // when makeSource has uniqueEndpoint:true, we want to create connections with new endpoints\n                    // that are subsequently deleted. So makeSource sets `finalEndpoint`, which is the Endpoint to\n                    // which the connection should be attached. The `detachFromConnection` call below results in the\n                    // temporary endpoint being cleaned up.\n                    if (jpc.endpoints[0].finalEndpoint) {\n                        var _toDelete = jpc.endpoints[0];\n                        _toDelete.detachFromConnection(jpc);\n                        jpc.endpoints[0] = jpc.endpoints[0].finalEndpoint;\n                        jpc.endpoints[0].addConnection(jpc);\n                    }\n\n                    // finalise will inform the anchor manager and also add to\n                    // connectionsByScope if necessary.\n                    // TODO if this is not set to true, then dragging a connection's target to a new\n                    // target causes the connection to be forgotten. however if it IS set to true, then\n                    // the opposite happens: dragging by source causes the connection to get forgotten\n                    // about and then if you delete it jsplumb breaks.\n                    _jsPlumb.finaliseConnection(jpc, null, originalEvent/*, true*/);\n                    jpc.setHover(false);\n\n                }.bind(this);\n\n                var dontContinueFunction = function() {\n                    // otherwise just put it back on the endpoint it was on before the drag.\n                    if (jpc.suspendedEndpoint) {\n                        jpc.endpoints[idx] = jpc.suspendedEndpoint;\n                        jpc.setHover(false);\n                        jpc._forceDetach = true;\n                        if (idx === 0) {\n                            jpc.source = jpc.suspendedEndpoint.element;\n                            jpc.sourceId = jpc.suspendedEndpoint.elementId;\n                        } else {\n                            jpc.target = jpc.suspendedEndpoint.element;\n                            jpc.targetId = jpc.suspendedEndpoint.elementId;\n                        }\n                        jpc.suspendedEndpoint.addConnection(jpc);\n\n                        _jsPlumb.repaint(jpc.sourceId);\n                        jpc._forceDetach = false;\n                    }\n                };\n\n// --------------------------------------\n                // now check beforeDrop.  this will be available only on Endpoints that are setup to\n                // have a beforeDrop condition (although, secretly, under the hood all Endpoints and\n                // the Connection have them, because they are on jsPlumbUIComponent.  shhh!), because\n                // it only makes sense to have it on a target endpoint.\n                _doContinue = _doContinue && dhParams.isDropAllowed(jpc.sourceId, jpc.targetId, jpc.scope, jpc, _ep);// && jpc.pending;\n\n                if (_doContinue) {\n                    continueFunction();\n                }\n                else {\n                    dontContinueFunction();\n                }\n            }\n            _jsPlumb.currentlyDragging = false;\n        };\n    };\n})();\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the code for Connections.\n *\n * Copyright (c) 2010 - 2014 jsPlumb (hello@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://jsplumb.org\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n    \n    \"use strict\";\n\n    var makeConnector = function(_jsPlumb, renderMode, connectorName, connectorArgs, forComponent) {\n            if (!_jsPlumb.Defaults.DoNotThrowErrors && jsPlumb.Connectors[renderMode][connectorName] == null)\n                    throw { msg:\"jsPlumb: unknown connector type '\" + connectorName + \"'\" };\n\n            return new jsPlumb.Connectors[renderMode][connectorName](connectorArgs, forComponent);\n        },\n        _makeAnchor = function(anchorParams, elementId, _jsPlumb) {\n            return (anchorParams) ? _jsPlumb.makeAnchor(anchorParams, elementId, _jsPlumb) : null;\n        };\n    \n    jsPlumb.Connection = function(params) {\n        var _newEndpoint = params.newEndpoint, _ju = jsPlumbUtil;\n\n        this.connector = null;\n        this.idPrefix = \"_jsplumb_c_\";\n        this.defaultLabelLocation = 0.5;\n        this.defaultOverlayKeys = [\"Overlays\", \"ConnectionOverlays\"];\n        // if a new connection is the result of moving some existing connection, params.previousConnection\n        // will have that Connection in it. listeners for the jsPlumbConnection event can look for that\n        // member and take action if they need to.\n        this.previousConnection = params.previousConnection;\n        this.source = jsPlumb.getDOMElement(params.source);\n        this.target = jsPlumb.getDOMElement(params.target);\n        // sourceEndpoint and targetEndpoint override source/target, if they are present. but \n        // source is not overridden if the Endpoint has declared it is not the final target of a connection;\n        // instead we use the source that the Endpoint declares will be the final source element.\n        if (params.sourceEndpoint) this.source = params.sourceEndpoint.endpointWillMoveTo || params.sourceEndpoint.getElement();            \n        if (params.targetEndpoint) this.target = params.targetEndpoint.getElement();        \n\n        OverlayCapableJsPlumbUIComponent.apply(this, arguments);\n\n        this.sourceId = this._jsPlumb.instance.getId(this.source);\n        this.targetId = this._jsPlumb.instance.getId(this.target);\n        this.scope = params.scope; // scope may have been passed in to the connect call. if it wasn't, we will pull it from the source endpoint, after having initialised the endpoints.            \n        this.endpoints = [];\n        this.endpointStyles = [];\n            \n        var _jsPlumb = this._jsPlumb.instance;\n\n        _jsPlumb.manage(this.sourceId, this.source);\n        _jsPlumb.manage(this.targetId, this.target);\n\n        this._jsPlumb.visible = true;\n        this._jsPlumb.editable = params.editable === true;    \n        this._jsPlumb.params = {\n            cssClass:params.cssClass,\n            container:params.container,\n            \"pointer-events\":params[\"pointer-events\"],\n            editorParams:params.editorParams\n        };   \n        this._jsPlumb.lastPaintedAt = null;\n        this.getDefaultType = function() {\n            return {\n                parameters:{},\n                scope:null,\n                detachable:this._jsPlumb.instance.Defaults.ConnectionsDetachable,\n                rettach:this._jsPlumb.instance.Defaults.ReattachConnections,\n                paintStyle:this._jsPlumb.instance.Defaults.PaintStyle || jsPlumb.Defaults.PaintStyle,\n                connector:this._jsPlumb.instance.Defaults.Connector || jsPlumb.Defaults.Connector,\n                hoverPaintStyle:this._jsPlumb.instance.Defaults.HoverPaintStyle || jsPlumb.Defaults.HoverPaintStyle,\n                overlays:this._jsPlumb.instance.Defaults.ConnectorOverlays || jsPlumb.Defaults.ConnectorOverlays\n            };\n        };\n\n\t// listen to mouseover and mouseout events passed from the container delegate.\n        this.bind(\"mouseover\", function() { this.setHover(true);}.bind(this));\n        this.bind(\"mouseout\", function() { this.setHover(false);}.bind(this));\n        \n// INITIALISATION CODE\t\t\t\n                            \n        // wrapped the main function to return null if no input given. this lets us cascade defaults properly.\n        \n        this.makeEndpoint = function(isSource, el, elId, ep) {\n            elId = elId ||  this._jsPlumb.instance.getId(el);\n            return this.prepareEndpoint(_jsPlumb, _newEndpoint, this, ep, isSource ? 0 : 1, params, el, elId);\n        };\n        \n        var eS = this.makeEndpoint(true, this.source, this.sourceId, params.sourceEndpoint),\n            eT = this.makeEndpoint(false, this.target, this.targetId, params.targetEndpoint);\n        \n        if (eS) _ju.addToList(params.endpointsByElement, this.sourceId, eS);\n        if (eT) _ju.addToList(params.endpointsByElement, this.targetId, eT);\n        // if scope not set, set it to be the scope for the source endpoint.\n        if (!this.scope) this.scope = this.endpoints[0].scope;\n                \n        // if explicitly told to (or not to) delete endpoints on detach, override endpoint's preferences\n        if (params.deleteEndpointsOnDetach != null) {\n            this.endpoints[0]._deleteOnDetach = params.deleteEndpointsOnDetach;\n            this.endpoints[1]._deleteOnDetach = params.deleteEndpointsOnDetach;\n        }\n        else {\n            // otherwise, unless the endpoints say otherwise, mark them for deletion.\n            if (!this.endpoints[0]._doNotDeleteOnDetach) this.endpoints[0]._deleteOnDetach = true;\n            if (!this.endpoints[1]._doNotDeleteOnDetach) this.endpoints[1]._deleteOnDetach = true;\n        }   \n                    \n        // TODO these could surely be refactored into some method that tries them one at a time until something exists\n        this.setConnector(this.endpoints[0].connector || \n                          this.endpoints[1].connector || \n                          params.connector || \n                          _jsPlumb.Defaults.Connector || \n                          jsPlumb.Defaults.Connector, true, true);\n\n        if (params.path)\n            this.connector.setPath(params.path);\n        \n        this.setPaintStyle(this.endpoints[0].connectorStyle || \n                           this.endpoints[1].connectorStyle || \n                           params.paintStyle || \n                           _jsPlumb.Defaults.PaintStyle || \n                           jsPlumb.Defaults.PaintStyle, true);\n                    \n        this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle || \n                                this.endpoints[1].connectorHoverStyle || \n                                params.hoverPaintStyle || \n                                _jsPlumb.Defaults.HoverPaintStyle || \n                                jsPlumb.Defaults.HoverPaintStyle, true);\n        \n        this._jsPlumb.paintStyleInUse = this.getPaintStyle();\n        \n        var _suspendedAt = _jsPlumb.getSuspendedAt();\n//*\n        if(!_jsPlumb.isSuspendDrawing()) {                    \n            // paint the endpoints\n            var myInfo = _jsPlumb.getCachedData(this.sourceId),\n                myOffset = myInfo.o, myWH = myInfo.s,\n                otherInfo = _jsPlumb.getCachedData(this.targetId),\n                otherOffset = otherInfo.o,\n                otherWH = otherInfo.s,\n                initialTimestamp = _suspendedAt || _jsPlumb.timestamp(),\n                anchorLoc = this.endpoints[0].anchor.compute( {\n                    xy : [ myOffset.left, myOffset.top ], wh : myWH, element : this.endpoints[0],\n                    elementId:this.endpoints[0].elementId,\n                    txy : [ otherOffset.left, otherOffset.top ], twh : otherWH, tElement : this.endpoints[1],\n                    timestamp:initialTimestamp\n                });\n\n            this.endpoints[0].paint( { anchorLoc : anchorLoc, timestamp:initialTimestamp });\n\n            anchorLoc = this.endpoints[1].anchor.compute( {\n                xy : [ otherOffset.left, otherOffset.top ], wh : otherWH, element : this.endpoints[1],\n                elementId:this.endpoints[1].elementId,\t\t\t\t\n                txy : [ myOffset.left, myOffset.top ], twh : myWH, tElement : this.endpoints[0],\n                timestamp:initialTimestamp\t\t\t\t\n            });\n            this.endpoints[1].paint({ anchorLoc : anchorLoc, timestamp:initialTimestamp });\n        }\n        //*/\n                                \n// END INITIALISATION CODE\t\t\t\n        \n// DETACHABLE \t\t\t\t\n        this._jsPlumb.detachable = _jsPlumb.Defaults.ConnectionsDetachable;\n        if (params.detachable === false) this._jsPlumb.detachable = false;\n        if(this.endpoints[0].connectionsDetachable === false) this._jsPlumb.detachable = false;\n        if(this.endpoints[1].connectionsDetachable === false) this._jsPlumb.detachable = false;                \n// REATTACH\n        this._jsPlumb.reattach = params.reattach || this.endpoints[0].reattachConnections || this.endpoints[1].reattachConnections || _jsPlumb.Defaults.ReattachConnections;\n// COST + DIRECTIONALITY\n        // if cost not supplied, try to inherit from source endpoint\n        this._jsPlumb.cost = params.cost || this.endpoints[0].getConnectionCost();\t\t\t        \n        this._jsPlumb.directed = params.directed;\n        // inherit directed flag if set no source endpoint\n        if (params.directed == null) this._jsPlumb.directed = this.endpoints[0].areConnectionsDirected();        \n// END COST + DIRECTIONALITY\n                    \n// PARAMETERS\t\t\t\t\t\t\n        // merge all the parameters objects into the connection.  parameters set\n        // on the connection take precedence; then source endpoint params, then\n        // finally target endpoint params.\n        // TODO jsPlumb.extend could be made to take more than two args, and it would\n        // apply the second through nth args in order.\n        var _p = jsPlumb.extend({}, this.endpoints[1].getParameters());\n        jsPlumb.extend(_p, this.endpoints[0].getParameters());\n        jsPlumb.extend(_p, this.getParameters());\n        this.setParameters(_p);\n// END PARAMETERS\n\n// PAINTING\n                  \n        // the very last thing we do is apply types, if there are any.\n        var _types = [params.type, this.endpoints[0].connectionType, this.endpoints[1].connectionType ].join(\" \");\n        if (/[^\\s]/.test(_types))\n            this.addType(_types, params.data, true);\n        \n// END PAINTING    \n    };\n\n    jsPlumbUtil.extend(jsPlumb.Connection, OverlayCapableJsPlumbUIComponent, {\n        applyType : function(t, doNotRepaint) {            \n            if (t.detachable != null) this.setDetachable(t.detachable);\n            if (t.reattach != null) this.setReattach(t.reattach);\n            if (t.scope) this.scope = t.scope;\n            this.setConnector(t.connector, doNotRepaint);\n            if (t.cssClass != null && this.canvas) this._jsPlumb.instance.addClass(this.canvas, t.cssClass);\n            if (t.anchor) {\n                this.endpoints[0].anchor = this._jsPlumb.instance.makeAnchor(t.anchor);\n                this.endpoints[1].anchor = this._jsPlumb.instance.makeAnchor(t.anchor);\n            }\n            else if (t.anchors) {\n                this.endpoints[0].anchor = this._jsPlumb.instance.makeAnchor(t.anchors[0]);\n                this.endpoints[1].anchor = this._jsPlumb.instance.makeAnchor(t.anchors[1]);\n            }\n        },\n        getTypeDescriptor : function() { return \"connection\"; },\n        getAttachedElements : function() {\n            return this.endpoints;\n        },\n        addClass : function(c, informEndpoints) {        \n            if (informEndpoints) {\n                this.endpoints[0].addClass(c);\n                this.endpoints[1].addClass(c); \n                if (this.suspendedEndpoint) this.suspendedEndpoint.addClass(c);                   \n            }\n            if (this.connector) {\n                this.connector.addClass(c);\n            }\n        },\n        removeClass : function(c, informEndpoints) {            \n            if (informEndpoints) {\n                this.endpoints[0].removeClass(c);\n                this.endpoints[1].removeClass(c);                    \n                if (this.suspendedEndpoint) this.suspendedEndpoint.removeClass(c);\n            }\n            if (this.connector) {\n                this.connector.removeClass(c);\n            }\n        },\n        isVisible : function() { return this._jsPlumb.visible; },\n        setVisible : function(v) {\n            this._jsPlumb.visible = v;\n            if (this.connector) \n                this.connector.setVisible(v);\n            this.repaint();\n        },\n        cleanup:function() {\n            this.endpoints = null;\n            this.source = null;\n            this.target = null;                    \n            if (this.connector != null) {\n                this.connector.cleanup();            \n                this.connector.destroy();\n            }\n            this.connector = null;\n        },\n        isDetachable : function() {\n            return this._jsPlumb.detachable === true;\n        },\n        setDetachable : function(detachable) {\n          this._jsPlumb.detachable = detachable === true;\n        },\n        isReattach : function() {\n            return this._jsPlumb.reattach === true;\n        },        \n        setReattach : function(reattach) {\n          this._jsPlumb.reattach = reattach === true;\n        },\n        setHover : function(state) {\n            if (this.connector && this._jsPlumb && !this._jsPlumb.instance.isConnectionBeingDragged()) {\n                this.connector.setHover(state);\n                jsPlumbAdapter[state ? \"addClass\" : \"removeClass\"](this.source, this._jsPlumb.instance.hoverSourceClass);\n                jsPlumbAdapter[state ? \"addClass\" : \"removeClass\"](this.target, this._jsPlumb.instance.hoverTargetClass);\n            }\n        },\n        getCost : function() { return this._jsPlumb.cost; },\n        setCost : function(c) { this._jsPlumb.cost = c; },\n        isDirected : function() { return this._jsPlumb.directed === true; },\n        getConnector : function() { return this.connector; },\n        setConnector : function(connectorSpec, doNotRepaint, doNotChangeListenerComponent) {\n            var _ju = jsPlumbUtil;\n            if (this.connector != null) {\n                this.connector.cleanup();\n                this.connector.destroy();\n            }\n\n            var connectorArgs = { \n                    _jsPlumb:this._jsPlumb.instance, \n                    cssClass:this._jsPlumb.params.cssClass, \n                    container:this._jsPlumb.params.container,                 \n                    \"pointer-events\":this._jsPlumb.params[\"pointer-events\"]\n                },\n                renderMode = this._jsPlumb.instance.getRenderMode();\n            \n            if (_ju.isString(connectorSpec)) \n                this.connector = makeConnector(this._jsPlumb.instance, renderMode, connectorSpec, connectorArgs, this); // lets you use a string as shorthand.\n            else if (_ju.isArray(connectorSpec)) {\n                if (connectorSpec.length == 1)\n                    this.connector = makeConnector(this._jsPlumb.instance, renderMode, connectorSpec[0], connectorArgs, this);\n                else\n                    this.connector = makeConnector(this._jsPlumb.instance, renderMode, connectorSpec[0], _ju.merge(connectorSpec[1], connectorArgs), this);\n            }\n            \n            this.canvas = this.connector.canvas;\n            this.bgCanvas = this.connector.bgCanvas;\n\n            // new: instead of binding listeners per connector, we now just have one delegate on the container.\n            // so for that handler we set the connection as the '_jsPlumb' member of the canvas element, and\n            // bgCanvas, if it exists, which it does right now in the VML renderer, so it won't from v 2.0.0 onwards.\n            if(this.canvas) this.canvas._jsPlumb = this;\n            if(this.bgCanvas) this.bgCanvas._jsPlumb = this;\n\n            if (!doNotChangeListenerComponent) this.setListenerComponent(this.connector);\n            if (!doNotRepaint) this.repaint();\n        },\n        paint : function(params) {\n                    \n            if (!this._jsPlumb.instance.isSuspendDrawing() && this._jsPlumb.visible) {\n                params = params || {};\n                var timestamp = params.timestamp,\n                    // if the moving object is not the source we must transpose the two references.\n                    swap = false,\n                    tId = swap ? this.sourceId : this.targetId, sId = swap ? this.targetId : this.sourceId,                    \n                    tIdx = swap ? 0 : 1, sIdx = swap ? 1 : 0;\n\n                if (timestamp == null || timestamp != this._jsPlumb.lastPaintedAt) {                        \n                    var sourceInfo = this._jsPlumb.instance.getOffset(sId),\n                        targetInfo = this._jsPlumb.instance.getOffset(tId),\n                        sE = this.endpoints[sIdx], tE = this.endpoints[tIdx];\n\n                    var sAnchorP = sE.anchor.getCurrentLocation({xy:[sourceInfo.left,sourceInfo.top], wh:[sourceInfo.width, sourceInfo.height], element:sE, timestamp:timestamp}),              \n                        tAnchorP = tE.anchor.getCurrentLocation({xy:[targetInfo.left,targetInfo.top], wh:[targetInfo.width, targetInfo.height], element:tE, timestamp:timestamp});                                                 \n                        \n                    this.connector.resetBounds();\n\n                    this.connector.compute({\n                        sourcePos:sAnchorP,\n                        targetPos:tAnchorP, \n                        sourceEndpoint:this.endpoints[sIdx],\n                        targetEndpoint:this.endpoints[tIdx],\n                        lineWidth:this._jsPlumb.paintStyleInUse.lineWidth,                                          \n                        sourceInfo:sourceInfo,\n                        targetInfo:targetInfo\n                    });\n\n                    var overlayExtents = { minX:Infinity, minY:Infinity, maxX:-Infinity, maxY:-Infinity };\n\n                    // compute overlays. we do this first so we can get their placements, and adjust the\n                    // container if needs be (if an overlay would be clipped)\n                    for ( var i = 0; i < this._jsPlumb.overlays.length; i++) {\n                        var o = this._jsPlumb.overlays[i];\n                        if (o.isVisible()) {                            \n                            this._jsPlumb.overlayPlacements[i] = o.draw(this.connector, this._jsPlumb.paintStyleInUse, this.getAbsoluteOverlayPosition(o));\n                            overlayExtents.minX = Math.min(overlayExtents.minX, this._jsPlumb.overlayPlacements[i].minX);\n                            overlayExtents.maxX = Math.max(overlayExtents.maxX, this._jsPlumb.overlayPlacements[i].maxX);\n                            overlayExtents.minY = Math.min(overlayExtents.minY, this._jsPlumb.overlayPlacements[i].minY);\n                            overlayExtents.maxY = Math.max(overlayExtents.maxY, this._jsPlumb.overlayPlacements[i].maxY);\n                        }\n                    }\n\n                    var lineWidth = parseFloat(this._jsPlumb.paintStyleInUse.lineWidth || 1) / 2,\n                        outlineWidth = parseFloat(this._jsPlumb.paintStyleInUse.lineWidth || 0),\n                        extents = {\n                            xmin : Math.min(this.connector.bounds.minX - (lineWidth + outlineWidth), overlayExtents.minX),\n                            ymin : Math.min(this.connector.bounds.minY - (lineWidth + outlineWidth), overlayExtents.minY),\n                            xmax : Math.max(this.connector.bounds.maxX + (lineWidth + outlineWidth), overlayExtents.maxX),\n                            ymax : Math.max(this.connector.bounds.maxY + (lineWidth + outlineWidth), overlayExtents.maxY)\n                        };\n                    // paint the connector.\n                    this.connector.paint(this._jsPlumb.paintStyleInUse, null, extents);\n                    // and then the overlays\n                    for ( var j = 0; j < this._jsPlumb.overlays.length; j++) {\n                        var p = this._jsPlumb.overlays[j];\n                        if (p.isVisible()) {\n                            p.paint(this._jsPlumb.overlayPlacements[j], extents);    \n                        }\n                    }\n                }\n                this._jsPlumb.lastPaintedAt = timestamp;\n            }\n        },\n        repaint : function(params) {\n            params = params || {};            \n            this.paint({ elId : this.sourceId, recalc : !(params.recalc === false), timestamp:params.timestamp});\n        },\n        prepareEndpoint : function(_jsPlumb, _newEndpoint, conn, existing, index, params, element, elementId) {\n            var e;\n            if (existing) {\n                conn.endpoints[index] = existing;\n                existing.addConnection(conn);                   \n            } else {\n                if (!params.endpoints) params.endpoints = [ null, null ];\n                var ep = params.endpoints[index]  || params.endpoint || _jsPlumb.Defaults.Endpoints[index] || jsPlumb.Defaults.Endpoints[index] || _jsPlumb.Defaults.Endpoint || jsPlumb.Defaults.Endpoint;\n                if (!params.endpointStyles) params.endpointStyles = [ null, null ];\n                if (!params.endpointHoverStyles) params.endpointHoverStyles = [ null, null ];\n                var es = params.endpointStyles[index] || params.endpointStyle || _jsPlumb.Defaults.EndpointStyles[index] || jsPlumb.Defaults.EndpointStyles[index] || _jsPlumb.Defaults.EndpointStyle || jsPlumb.Defaults.EndpointStyle;\n                // Endpoints derive their fillStyle from the connector's strokeStyle, if no fillStyle was specified.\n                if (es.fillStyle == null && params.paintStyle != null)\n                    es.fillStyle = params.paintStyle.strokeStyle;\n                \n                // TODO: decide if the endpoint should derive the connection's outline width and color.  currently it does:\n                //*\n                if (es.outlineColor == null && params.paintStyle != null) \n                    es.outlineColor = params.paintStyle.outlineColor;\n                if (es.outlineWidth == null && params.paintStyle != null) \n                    es.outlineWidth = params.paintStyle.outlineWidth;\n                //*/\n                \n                var ehs = params.endpointHoverStyles[index] || params.endpointHoverStyle || _jsPlumb.Defaults.EndpointHoverStyles[index] || jsPlumb.Defaults.EndpointHoverStyles[index] || _jsPlumb.Defaults.EndpointHoverStyle || jsPlumb.Defaults.EndpointHoverStyle;\n                // endpoint hover fill style is derived from connector's hover stroke style.  TODO: do we want to do this by default? for sure?\n                if (params.hoverPaintStyle != null) {\n                    if (ehs == null) ehs = {};\n                    if (ehs.fillStyle == null) {\n                        ehs.fillStyle = params.hoverPaintStyle.strokeStyle;\n                    }\n                }\n                var a = params.anchors ? params.anchors[index] : \n                        params.anchor ? params.anchor :\n                        _makeAnchor(_jsPlumb.Defaults.Anchors[index], elementId, _jsPlumb) || \n                        _makeAnchor(jsPlumb.Defaults.Anchors[index], elementId,_jsPlumb) || \n                        _makeAnchor(_jsPlumb.Defaults.Anchor, elementId,_jsPlumb) || \n                        _makeAnchor(jsPlumb.Defaults.Anchor, elementId, _jsPlumb),                  \n                    u = params.uuids ? params.uuids[index] : null;\n                    \n                e = _newEndpoint({ \n                    paintStyle : es,  hoverPaintStyle:ehs,  endpoint : ep,  connections : [ conn ], \n                    uuid : u,  anchor : a,  source : element, scope  : params.scope,\n                    reattach:params.reattach || _jsPlumb.Defaults.ReattachConnections,\n                    detachable:params.detachable || _jsPlumb.Defaults.ConnectionsDetachable\n                });\n                conn.endpoints[index] = e;\n                \n                if (params.drawEndpoints === false) e.setVisible(false, true, true);\n                                    \n            }\n            return e;\n        }\n        \n    }); // END Connection class            \n})();\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the code for creating and manipulating anchors.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\t\n\n    \"use strict\";\n\n    //\n\t// manages anchors for all elements.\n\t//\n\tjsPlumb.AnchorManager = function(params) {\n\t\tvar _amEndpoints = {},\n            continuousAnchors = {},\n            continuousAnchorLocations = {},\n            userDefinedContinuousAnchorLocations = {},        \n            continuousAnchorOrientations = {},\n            Orientation = { HORIZONTAL : \"horizontal\", VERTICAL : \"vertical\", DIAGONAL : \"diagonal\", IDENTITY:\"identity\" },\n            axes = [\"left\", \"top\", \"right\", \"bottom\"],\n\t\t\tconnectionsByElementId = {},\n\t\t\tself = this,\n            anchorLists = {},\n            jsPlumbInstance = params.jsPlumbInstance,\n            floatingConnections = {},            \n            calculateOrientation = function(sourceId, targetId, sd, td, sourceAnchor, targetAnchor) {\n        \n                if (sourceId === targetId) return {\n                    orientation:Orientation.IDENTITY,\n                    a:[\"top\", \"top\"]\n                };        \n\n                var theta = Math.atan2((td.centery - sd.centery) , (td.centerx - sd.centerx)),\n                    theta2 = Math.atan2((sd.centery - td.centery) , (sd.centerx - td.centerx));\n\n// --------------------------------------------------------------------------------------\n\n\t\t\t\t// improved face calculation. get midpoints of each face for source and target, then put in an array with all combinations of\n\t\t\t\t// source/target faces. sort this array by distance between midpoints. the entry at index 0 is our preferred option. we can \n\t\t\t\t// go through the array one by one until we find an entry in which each requested face is supported.\n\t\t\t\tvar candidates = [], midpoints = { };\n\t\t\t\t(function(types, dim) {\n\t\t\t\t\tfor (var i = 0; i < types.length; i++) {\n\t\t\t\t\t\tmidpoints[types[i]] = {\n\t\t\t\t\t\t\t\"left\":[ dim[i].left, dim[i].centery ],\n\t\t\t\t\t\t\t\"right\":[ dim[i].right, dim[i].centery ],\n\t\t\t\t\t\t\t\"top\":[ dim[i].centerx, dim[i].top ],\n\t\t\t\t\t\t\t\"bottom\":[ dim[i].centerx , dim[i].bottom]\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t})([ \"source\", \"target\" ], [ sd, td ]);\n\n\t\t\t\tfor (var sf = 0; sf < axes.length; sf++) {\n\t\t\t\t\tfor (var tf = 0; tf < axes.length; tf++) {\n\t\t\t\t\t\tif (sf != tf) {\n\t\t\t\t\t\t\tcandidates.push({ \n\t\t\t\t\t\t\t\tsource:axes[sf], \n\t\t\t\t\t\t\t\ttarget:axes[tf], \n\t\t\t\t\t\t\t\tdist:Biltong.lineLength(midpoints.source[axes[sf]], midpoints.target[axes[tf]]) \n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcandidates.sort(function(a, b) {\n\t\t\t\t\treturn a.dist < b.dist ? -1 : a.dist > b.dist ? 1 : 0;\n\t\t\t\t});\n\n\t\t\t\t// now go through this list and try to get an entry that satisfies both (there will be one, unless one of the anchors\n\t\t\t\t// declares no available faces)\n\t\t\t\tvar sourceEdge = candidates[0].source, targetEdge = candidates[0].target;\n\t\t\t\tfor (var i = 0; i < candidates.length; i++) {\n\t\t\t\t\t\n\t\t\t\t\tif (!sourceAnchor.isContinuous || sourceAnchor.isEdgeSupported(candidates[i].source))\n\t\t\t\t\t\tsourceEdge = candidates[i].source;\n\t\t\t\t\telse\n\t\t\t\t\t\tsourceEdge = null;\n\n\t\t\t\t\tif (!targetAnchor.isContinuous || targetAnchor.isEdgeSupported(candidates[i].target))\n\t\t\t\t\t\ttargetEdge = candidates[i].target;\n\t\t\t\t\telse {\n\t\t\t\t\t\ttargetEdge = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sourceEdge != null && targetEdge != null) break;\n\t\t\t\t}\t\t\t\t\n\n// --------------------------------------------------------------------------------------\n\n                return {\n                \ta : [ sourceEdge, targetEdge ],\n                    theta:theta,\n                    theta2:theta2\n                };\n            },\n                // used by placeAnchors function\n            placeAnchorsOnLine = function(desc, elementDimensions, elementPosition,\n                            connections, horizontal, otherMultiplier, reverse) {\n                var a = [], step = elementDimensions[horizontal ? 0 : 1] / (connections.length + 1);\n        \n                for (var i = 0; i < connections.length; i++) {\n                    var val = (i + 1) * step, other = otherMultiplier * elementDimensions[horizontal ? 1 : 0];\n                    if (reverse)\n                      val = elementDimensions[horizontal ? 0 : 1] - val;\n        \n                    var dx = (horizontal ? val : other), x = elementPosition[0] + dx,  xp = dx / elementDimensions[0],\n                        dy = (horizontal ? other : val), y = elementPosition[1] + dy, yp = dy / elementDimensions[1];\n        \n                    a.push([ x, y, xp, yp, connections[i][1], connections[i][2] ]);\n                }\n        \n                return a;\n            },\n            // used by edgeSortFunctions        \n            currySort = function(reverseAngles) {\n                return function(a,b) {\n                    var r = true;\n                    if (reverseAngles) {\n                        r = a[0][0] < b[0][0];\n                    }\n                    else {                        \n                        r = a[0][0] > b[0][0];\n                    }\n                    return r === false ? -1 : 1;\n                };\n            },\n                // used by edgeSortFunctions\n            leftSort = function(a,b) {\n                // first get adjusted values\n                var p1 = a[0][0] < 0 ? -Math.PI - a[0][0] : Math.PI - a[0][0],\n                p2 = b[0][0] < 0 ? -Math.PI - b[0][0] : Math.PI - b[0][0];\n                if (p1 > p2) return 1;\n                else return a[0][1] > b[0][1] ? 1 : -1;\n            },\n                // used by placeAnchors\n            edgeSortFunctions = {\n                \"top\":function(a, b) { return a[0] > b[0] ? 1 : -1; },\n                \"right\":currySort(true),\n                \"bottom\":currySort(true),\n                \"left\":leftSort\n            },\n                // used by placeAnchors\n            _sortHelper = function(_array, _fn) { return _array.sort(_fn); },\n                // used by AnchorManager.redraw\n            placeAnchors = function(elementId, _anchorLists) {\t\t\n                var cd = jsPlumbInstance.getCachedData(elementId), sS = cd.s, sO = cd.o,\n                placeSomeAnchors = function(desc, elementDimensions, elementPosition, unsortedConnections, isHorizontal, otherMultiplier, orientation) {\n                    if (unsortedConnections.length > 0) {\n                        var sc = _sortHelper(unsortedConnections, edgeSortFunctions[desc]), // puts them in order based on the target element's pos on screen\n                            reverse = desc === \"right\" || desc === \"top\",\n                            anchors = placeAnchorsOnLine(desc, elementDimensions,\n                                                     elementPosition, sc,\n                                                     isHorizontal, otherMultiplier, reverse );\n        \n                        // takes a computed anchor position and adjusts it for parent offset and scroll, then stores it.\n                        var _setAnchorLocation = function(endpoint, anchorPos) {                            \n                            continuousAnchorLocations[endpoint.id] = [ anchorPos[0], anchorPos[1], anchorPos[2], anchorPos[3] ];\n                            continuousAnchorOrientations[endpoint.id] = orientation;\n                        };\n        \n                        for (var i = 0; i < anchors.length; i++) {\n                            var c = anchors[i][4], weAreSource = c.endpoints[0].elementId === elementId, weAreTarget = c.endpoints[1].elementId === elementId;\n                            if (weAreSource)\n                                _setAnchorLocation(c.endpoints[0], anchors[i]);\n                            else if (weAreTarget)\n                                _setAnchorLocation(c.endpoints[1], anchors[i]);\n                        }\n                    }\n                };\n        \n                placeSomeAnchors(\"bottom\", sS, [sO.left,sO.top], _anchorLists.bottom, true, 1, [0,1]);\n                placeSomeAnchors(\"top\", sS, [sO.left,sO.top], _anchorLists.top, true, 0, [0,-1]);\n                placeSomeAnchors(\"left\", sS, [sO.left,sO.top], _anchorLists.left, false, 0, [-1,0]);\n                placeSomeAnchors(\"right\", sS, [sO.left,sO.top], _anchorLists.right, false, 1, [1,0]);\n            };\n\n        this.reset = function() {\n            _amEndpoints = {};\n            connectionsByElementId = {};\n            anchorLists = {};\n        };\t\t\t\n        this.addFloatingConnection = function(key, conn) {\n            floatingConnections[key] = conn;\n        };\n        this.removeFloatingConnection = function(key) {\n            delete floatingConnections[key];\n        };                                                 \n        this.newConnection = function(conn) {\n\t\t\tvar sourceId = conn.sourceId, targetId = conn.targetId,\n\t\t\t\tep = conn.endpoints,\n                doRegisterTarget = true,\n                registerConnection = function(otherIndex, otherEndpoint, otherAnchor, elId, c) {\n\t\t\t\t\tif ((sourceId == targetId) && otherAnchor.isContinuous){\n                       // remove the target endpoint's canvas.  we dont need it.\n                        conn._jsPlumb.instance.removeElement(ep[1].canvas);\n                        doRegisterTarget = false;\n                    }\n\t\t\t\t\tjsPlumbUtil.addToList(connectionsByElementId, elId, [c, otherEndpoint, otherAnchor.constructor == jsPlumb.DynamicAnchor]);\n\t\t\t    };\n\n\t\t\tregisterConnection(0, ep[0], ep[0].anchor, targetId, conn);\n            if (doRegisterTarget)\n            \tregisterConnection(1, ep[1], ep[1].anchor, sourceId, conn);\n\t\t};\n        var removeEndpointFromAnchorLists = function(endpoint) {\n            (function(list, eId) {\n                if (list) {  // transient anchors dont get entries in this list.\n                    var f = function(e) { return e[4] == eId; };\n                    jsPlumbUtil.removeWithFunction(list.top, f);\n                    jsPlumbUtil.removeWithFunction(list.left, f);\n                    jsPlumbUtil.removeWithFunction(list.bottom, f);\n                    jsPlumbUtil.removeWithFunction(list.right, f);\n                }\n            })(anchorLists[endpoint.elementId], endpoint.id);\n        };\n\t\tthis.connectionDetached = function(connInfo) {\n            var connection = connInfo.connection || connInfo,\n\t\t\t    sourceId = connInfo.sourceId,\n                targetId = connInfo.targetId,\n\t\t\t\tep = connection.endpoints,\n\t\t\t\tremoveConnection = function(otherIndex, otherEndpoint, otherAnchor, elId, c) {\n\t\t\t\t\tif (otherAnchor != null && otherAnchor.constructor == jsPlumb.FloatingAnchor) {\n\t\t\t\t\t\t// no-op\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tjsPlumbUtil.removeWithFunction(connectionsByElementId[elId], function(_c) {\n\t\t\t\t\t\t\treturn _c[0].id == c.id;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\tremoveConnection(1, ep[1], ep[1].anchor, sourceId, connection);\n\t\t\tremoveConnection(0, ep[0], ep[0].anchor, targetId, connection);\n\n            // remove from anchorLists            \n            removeEndpointFromAnchorLists(connection.endpoints[0]);\n            removeEndpointFromAnchorLists(connection.endpoints[1]);\n\n            self.redraw(connection.sourceId);\n            self.redraw(connection.targetId);\n\t\t};\n\t\tthis.add = function(endpoint, elementId) {\n\t\t\tjsPlumbUtil.addToList(_amEndpoints, elementId, endpoint);\n\t\t};\n\t\tthis.changeId = function(oldId, newId) {\n\t\t\tconnectionsByElementId[newId] = connectionsByElementId[oldId];\n\t\t\t_amEndpoints[newId] = _amEndpoints[oldId];\n\t\t\tdelete connectionsByElementId[oldId];\n\t\t\tdelete _amEndpoints[oldId];\t\n\t\t};\n\t\tthis.getConnectionsFor = function(elementId) {\n\t\t\treturn connectionsByElementId[elementId] || [];\n\t\t};\n\t\tthis.getEndpointsFor = function(elementId) {\n\t\t\treturn _amEndpoints[elementId] || [];\n\t\t};\n\t\tthis.deleteEndpoint = function(endpoint) {\n\t\t\tjsPlumbUtil.removeWithFunction(_amEndpoints[endpoint.elementId], function(e) {\n\t\t\t\treturn e.id == endpoint.id;\n\t\t\t});\n            removeEndpointFromAnchorLists(endpoint);\n\t\t};\n\t\tthis.clearFor = function(elementId) {\n\t\t\tdelete _amEndpoints[elementId];\n\t\t\t_amEndpoints[elementId] = [];\n\t\t};\n        // updates the given anchor list by either updating an existing anchor's info, or adding it. this function\n        // also removes the anchor from its previous list, if the edge it is on has changed.\n        // all connections found along the way (those that are connected to one of the faces this function\n        // operates on) are added to the connsToPaint list, as are their endpoints. in this way we know to repaint\n        // them wthout having to calculate anything else about them.\n        var _updateAnchorList = function(lists, theta, order, conn, aBoolean, otherElId, idx, reverse, edgeId, elId, connsToPaint, endpointsToPaint) {        \n            // first try to find the exact match, but keep track of the first index of a matching element id along the way.s\n            var exactIdx = -1,\n                firstMatchingElIdx = -1,\n                endpoint = conn.endpoints[idx],\n                endpointId = endpoint.id,\n                oIdx = [1,0][idx],\n                values = [ [ theta, order ], conn, aBoolean, otherElId, endpointId ],\n                listToAddTo = lists[edgeId],\n                listToRemoveFrom = endpoint._continuousAnchorEdge ? lists[endpoint._continuousAnchorEdge] : null,\n                i;\n\n            if (listToRemoveFrom) {\n                var rIdx = jsPlumbUtil.findWithFunction(listToRemoveFrom, function(e) { return e[4] == endpointId; });\n                if (rIdx != -1) {\n                    listToRemoveFrom.splice(rIdx, 1);\n                    // get all connections from this list\n                    for (i = 0; i < listToRemoveFrom.length; i++) {\n                        jsPlumbUtil.addWithFunction(connsToPaint, listToRemoveFrom[i][1], function(c) { return c.id == listToRemoveFrom[i][1].id; });\n                        jsPlumbUtil.addWithFunction(endpointsToPaint, listToRemoveFrom[i][1].endpoints[idx], function(e) { return e.id == listToRemoveFrom[i][1].endpoints[idx].id; });\n                        jsPlumbUtil.addWithFunction(endpointsToPaint, listToRemoveFrom[i][1].endpoints[oIdx], function(e) { return e.id == listToRemoveFrom[i][1].endpoints[oIdx].id; });\n                    }\n                }\n            }\n\n            for (i = 0; i < listToAddTo.length; i++) {\n                if (params.idx == 1 && listToAddTo[i][3] === otherElId && firstMatchingElIdx == -1)\n                    firstMatchingElIdx = i;\n                jsPlumbUtil.addWithFunction(connsToPaint, listToAddTo[i][1], function(c) { return c.id == listToAddTo[i][1].id; });                \n                jsPlumbUtil.addWithFunction(endpointsToPaint, listToAddTo[i][1].endpoints[idx], function(e) { return e.id == listToAddTo[i][1].endpoints[idx].id; });\n                jsPlumbUtil.addWithFunction(endpointsToPaint, listToAddTo[i][1].endpoints[oIdx], function(e) { return e.id == listToAddTo[i][1].endpoints[oIdx].id; });\n            }\n            if (exactIdx != -1) {\n                listToAddTo[exactIdx] = values;\n            }\n            else {\n                var insertIdx = reverse ? firstMatchingElIdx != -1 ? firstMatchingElIdx : 0 : listToAddTo.length; // of course we will get this from having looked through the array shortly.\n                listToAddTo.splice(insertIdx, 0, values);\n            }\n\n            // store this for next time.\n            endpoint._continuousAnchorEdge = edgeId;\n        };\n\n        //\n        // find the entry in an endpoint's list for this connection and update its target endpoint\n        // with the current target in the connection.\n        // \n        //\n        this.updateOtherEndpoint = function(elId, oldTargetId, newTargetId, connection) {\n            var sIndex = jsPlumbUtil.findWithFunction(connectionsByElementId[elId], function(i) {\n                    return i[0].id === connection.id;\n                }),\n                tIndex = jsPlumbUtil.findWithFunction(connectionsByElementId[oldTargetId], function(i) {\n                    return i[0].id === connection.id;\n                });\n\n            // update or add data for source\n            if (sIndex != -1) {\n                connectionsByElementId[elId][sIndex][0] = connection;\n                connectionsByElementId[elId][sIndex][1] = connection.endpoints[1];\n                connectionsByElementId[elId][sIndex][2] = connection.endpoints[1].anchor.constructor == jsPlumb.DynamicAnchor;\n            }\n\n            // remove entry for previous target (if there)\n            if (tIndex > -1) {\n                connectionsByElementId[oldTargetId].splice(tIndex, 1);\n                // add entry for new target\n                jsPlumbUtil.addToList(connectionsByElementId, newTargetId, [connection, connection.endpoints[0], connection.endpoints[0].anchor.constructor == jsPlumb.DynamicAnchor]);         \n            }\n        };       \n        \n        //\n        // notification that the connection given has changed source from the originalId to the newId.\n        // This involves:\n        // 1. removing the connection from the list of connections stored for the originalId\n        // 2. updating the source information for the target of the connection\n        // 3. re-registering the connection in connectionsByElementId with the newId\n        //\n        this.sourceChanged = function(originalId, newId, connection) {        \n            if (originalId !== newId) {    \n                // remove the entry that points from the old source to the target\n                jsPlumbUtil.removeWithFunction(connectionsByElementId[originalId], function(info) {\n                    return info[0].id === connection.id;\n                });\n                // find entry for target and update it\n                var tIdx = jsPlumbUtil.findWithFunction(connectionsByElementId[connection.targetId], function(i) {\n                    return i[0].id === connection.id;\n                });\n                if (tIdx > -1) {\n                    connectionsByElementId[connection.targetId][tIdx][0] = connection;\n                    connectionsByElementId[connection.targetId][tIdx][1] = connection.endpoints[0];\n                    connectionsByElementId[connection.targetId][tIdx][2] = connection.endpoints[0].anchor.constructor == jsPlumb.DynamicAnchor;\n                }\n                // add entry for new source\n                jsPlumbUtil.addToList(connectionsByElementId, newId, [connection, connection.endpoints[1], connection.endpoints[1].anchor.constructor == jsPlumb.DynamicAnchor]);         \n            }\n        };\n\n        //\n        // moves the given endpoint from `currentId` to `element`.\n        // This involves:\n        //\n        // 1. changing the key in _amEndpoints under which the endpoint is stored\n        // 2. changing the source or target values in all of the endpoint's connections\n        // 3. changing the array in connectionsByElementId in which the endpoint's connections\n        //    are stored (done by either sourceChanged or updateOtherEndpoint)\n        //\n        this.rehomeEndpoint = function(ep, currentId, element) {\n            var eps = _amEndpoints[currentId] || [], \n                elementId = jsPlumbInstance.getId(element);\n                \n            if (elementId !== currentId) {\n                var idx = jsPlumbUtil.indexOf(eps, ep);\n                if (idx > -1) {\n                    var _ep = eps.splice(idx, 1)[0];\n                    self.add(_ep, elementId);\n                }\n            }\n\n            for (var i = 0; i < ep.connections.length; i++) {                \n                if (ep.connections[i].sourceId == currentId) {\n                    ep.connections[i].sourceId = ep.elementId;\n                    ep.connections[i].source = ep.element;                  \n                    self.sourceChanged(currentId, ep.elementId, ep.connections[i]);\n                }\n                else if(ep.connections[i].targetId == currentId) {\n                    ep.connections[i].targetId = ep.elementId;\n                    ep.connections[i].target = ep.element;   \n                    self.updateOtherEndpoint(ep.connections[i].sourceId, currentId, ep.elementId, ep.connections[i]);               \n                }\n            }   \n        };\n\n\t\tthis.redraw = function(elementId, ui, timestamp, offsetToUI, clearEdits, doNotRecalcEndpoint) {\n\t\t\n\t\t\tif (!jsPlumbInstance.isSuspendDrawing()) {\n\t\t\t\t// get all the endpoints for this element\n\t\t\t\tvar ep = _amEndpoints[elementId] || [],\n\t\t\t\t\tendpointConnections = connectionsByElementId[elementId] || [],\n\t\t\t\t\tconnectionsToPaint = [],\n\t\t\t\t\tendpointsToPaint = [],\n\t                anchorsToUpdate = [];\n\t            \n\t\t\t\ttimestamp = timestamp || jsPlumbInstance.timestamp();\n\t\t\t\t// offsetToUI are values that would have been calculated in the dragManager when registering\n\t\t\t\t// an endpoint for an element that had a parent (somewhere in the hierarchy) that had been\n\t\t\t\t// registered as draggable.\n\t\t\t\toffsetToUI = offsetToUI || {left:0, top:0};\n\t\t\t\tif (ui) {\n\t\t\t\t\tui = {\n\t\t\t\t\t\tleft:ui.left + offsetToUI.left,\n\t\t\t\t\t\ttop:ui.top + offsetToUI.top\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// valid for one paint cycle.\n\t\t\t\tvar myOffset = jsPlumbInstance.updateOffset( { elId : elementId, offset : ui, recalc : false, timestamp : timestamp }),\n\t                orientationCache = {};\n\t\t\t\t\n\t\t\t\t// actually, first we should compute the orientation of this element to all other elements to which\n\t\t\t\t// this element is connected with a continuous anchor (whether both ends of the connection have\n\t\t\t\t// a continuous anchor or just one)\n\n\t            for (var i = 0; i < endpointConnections.length; i++) {\n\t                var conn = endpointConnections[i][0],\n\t\t\t\t\t\tsourceId = conn.sourceId,\n\t                    targetId = conn.targetId,\n\t                    sourceContinuous = conn.endpoints[0].anchor.isContinuous,\n\t                    targetContinuous = conn.endpoints[1].anchor.isContinuous;\n\t\n\t                if (sourceContinuous || targetContinuous) {\n\t\t                var oKey = sourceId + \"_\" + targetId,\n\t\t                    oKey2 = targetId + \"_\" + sourceId,\n\t\t                    o = orientationCache[oKey],\n\t\t                    oIdx = conn.sourceId == elementId ? 1 : 0;\n\t\n\t\t                if (sourceContinuous && !anchorLists[sourceId]) anchorLists[sourceId] = { top:[], right:[], bottom:[], left:[] };\n\t\t                if (targetContinuous && !anchorLists[targetId]) anchorLists[targetId] = { top:[], right:[], bottom:[], left:[] };\n\t\n\t\t                if (elementId != targetId) jsPlumbInstance.updateOffset( { elId : targetId, timestamp : timestamp }); \n\t\t                if (elementId != sourceId) jsPlumbInstance.updateOffset( { elId : sourceId, timestamp : timestamp }); \n\t\n\t\t                var td = jsPlumbInstance.getCachedData(targetId),\n\t\t\t\t\t\t\tsd = jsPlumbInstance.getCachedData(sourceId);\n\t\n\t\t                if (targetId == sourceId && (sourceContinuous || targetContinuous)) {\n\t\t                    // here we may want to improve this by somehow determining the face we'd like\n\t\t\t\t\t\t    // to put the connector on.  ideally, when drawing, the face should be calculated\n\t\t\t\t\t\t    // by determining which face is closest to the point at which the mouse button\n\t\t\t\t\t\t\t// was released.  for now, we're putting it on the top face.                            \n\t\t                    _updateAnchorList(\n                                anchorLists[sourceId], \n                                -Math.PI / 2, \n                                0, \n                                conn, \n                                false, \n                                targetId, \n                                0, false, \"top\", sourceId, connectionsToPaint, endpointsToPaint);\n\t\t\t\t\t\t}\n\t\t                else {\n\t\t                    if (!o) {\n\t\t                        o = calculateOrientation(sourceId, targetId, sd.o, td.o, conn.endpoints[0].anchor, conn.endpoints[1].anchor);\n\t\t                        orientationCache[oKey] = o;\n\t\t                        // this would be a performance enhancement, but the computed angles need to be clamped to\n\t\t                        //the (-PI/2 -> PI/2) range in order for the sorting to work properly.\n\t\t                    /*  orientationCache[oKey2] = {\n\t\t                            orientation:o.orientation,\n\t\t                            a:[o.a[1], o.a[0]],\n\t\t                            theta:o.theta + Math.PI,\n\t\t                            theta2:o.theta2 + Math.PI\n\t\t                        };*/\n\t\t                    }\n\t\t                    if (sourceContinuous) _updateAnchorList(anchorLists[sourceId], o.theta, 0, conn, false, targetId, 0, false, o.a[0], sourceId, connectionsToPaint, endpointsToPaint);\n\t\t                    if (targetContinuous) _updateAnchorList(anchorLists[targetId], o.theta2, -1, conn, true, sourceId, 1, true, o.a[1], targetId, connectionsToPaint, endpointsToPaint);\n\t\t                }\n\t\n\t\t                if (sourceContinuous) jsPlumbUtil.addWithFunction(anchorsToUpdate, sourceId, function(a) { return a === sourceId; });\n\t\t                if (targetContinuous) jsPlumbUtil.addWithFunction(anchorsToUpdate, targetId, function(a) { return a === targetId; });\n\t\t                jsPlumbUtil.addWithFunction(connectionsToPaint, conn, function(c) { return c.id == conn.id; });\n\t\t                if ((sourceContinuous && oIdx === 0) || (targetContinuous && oIdx === 1))\n\t\t                \tjsPlumbUtil.addWithFunction(endpointsToPaint, conn.endpoints[oIdx], function(e) { return e.id == conn.endpoints[oIdx].id; });\n\t\t            }\n\t            }\n\n\t\t\t\t// place Endpoints whose anchors are continuous but have no Connections\n\t\t\t\tfor (i = 0; i < ep.length; i++) {\n\t\t\t\t\tif (ep[i].connections.length === 0 && ep[i].anchor.isContinuous) {\n\t\t\t\t\t\tif (!anchorLists[elementId]) anchorLists[elementId] = { top:[], right:[], bottom:[], left:[] };\n                        _updateAnchorList(anchorLists[elementId], -Math.PI / 2, 0, {endpoints:[ep[i], ep[i]], paint:function(){}}, false, elementId, 0, false, ep[i].anchor.getDefaultFace(), elementId, connectionsToPaint, endpointsToPaint);\n\t\t\t\t\t\tjsPlumbUtil.addWithFunction(anchorsToUpdate, elementId, function(a) { return a === elementId; });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t            // now place all the continuous anchors we need to;\n\t            for (i = 0; i < anchorsToUpdate.length; i++) {\n\t\t\t\t\tplaceAnchors(anchorsToUpdate[i], anchorLists[anchorsToUpdate[i]]);\n\t\t\t\t}\n\n\t\t\t\t// now that continuous anchors have been placed, paint all the endpoints for this element\n\t            // TODO performance: add the endpoint ids to a temp array, and then when iterating in the next\n\t            // loop, check that we didn't just paint that endpoint. we can probably shave off a few more milliseconds this way.\n\t\t\t\tfor (i = 0; i < ep.length; i++) {\t\t\t\t\n                    ep[i].paint( { timestamp : timestamp, offset : myOffset, dimensions : myOffset.s, recalc:doNotRecalcEndpoint !== true });\n\t\t\t\t}\n\n\t            // ... and any other endpoints we came across as a result of the continuous anchors.\n\t            for (i = 0; i < endpointsToPaint.length; i++) {\n                    var cd = jsPlumbInstance.getCachedData(endpointsToPaint[i].elementId);\n                    endpointsToPaint[i].paint( { timestamp : timestamp, offset : cd, dimensions : cd.s });\n\t\t\t\t}\n\n\t\t\t\t// paint all the standard and \"dynamic connections\", which are connections whose other anchor is\n\t\t\t\t// static and therefore does need to be recomputed; we make sure that happens only one time.\n\n\t\t\t\t// TODO we could have compiled a list of these in the first pass through connections; might save some time.\n\t\t\t\tfor (i = 0; i < endpointConnections.length; i++) {\n\t\t\t\t\tvar otherEndpoint = endpointConnections[i][1];\n\t\t\t\t\tif (otherEndpoint.anchor.constructor == jsPlumb.DynamicAnchor) {\t\t\t \t\t\t\t\t\t\t\n\t\t\t\t\t\totherEndpoint.paint({ elementWithPrecedence:elementId, timestamp:timestamp });\t\t\t\t\t\t\t\t\n\t                    jsPlumbUtil.addWithFunction(connectionsToPaint, endpointConnections[i][0], function(c) { return c.id == endpointConnections[i][0].id; });\n\t\t\t\t\t\t// all the connections for the other endpoint now need to be repainted\n\t\t\t\t\t\tfor (var k = 0; k < otherEndpoint.connections.length; k++) {\n\t\t\t\t\t\t\tif (otherEndpoint.connections[k] !== endpointConnections[i][0])\t\t\t\t\t\t\t\n\t                            jsPlumbUtil.addWithFunction(connectionsToPaint, otherEndpoint.connections[k], function(c) { return c.id == otherEndpoint.connections[k].id; });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (otherEndpoint.anchor.constructor == jsPlumb.Anchor) {\t\t\t\t\t\n\t                    jsPlumbUtil.addWithFunction(connectionsToPaint, endpointConnections[i][0], function(c) { return c.id == endpointConnections[i][0].id; });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// paint current floating connection for this element, if there is one.\n\t\t\t\tvar fc = floatingConnections[elementId];\n\t\t\t\tif (fc) \n\t\t\t\t\tfc.paint({timestamp:timestamp, recalc:false, elId:elementId});\n\n\t\t\t\t// paint all the connections\n\t\t\t\tfor (i = 0; i < connectionsToPaint.length; i++) {\n                    connectionsToPaint[i].paint({elId:elementId, timestamp:timestamp, recalc:false, clearEdits:clearEdits});\n\t\t\t\t}\n\t\t\t}\n\t\t};        \n        \n        var ContinuousAnchor = function(anchorParams) {\n            jsPlumbUtil.EventGenerator.apply(this);\n            this.type = \"Continuous\";\n            this.isDynamic = true;\n            this.isContinuous = true;\n            var faces = anchorParams.faces || [\"top\", \"right\", \"bottom\", \"left\"],\n                clockwise = !(anchorParams.clockwise === false),\n                availableFaces = { },\n                opposites = { \"top\":\"bottom\", \"right\":\"left\",\"left\":\"right\",\"bottom\":\"top\" },\n                clockwiseOptions = { \"top\":\"right\", \"right\":\"bottom\",\"left\":\"top\",\"bottom\":\"left\" },\n                antiClockwiseOptions = { \"top\":\"left\", \"right\":\"top\",\"left\":\"bottom\",\"bottom\":\"right\" },\n                secondBest = clockwise ? clockwiseOptions : antiClockwiseOptions,\n                lastChoice = clockwise ? antiClockwiseOptions : clockwiseOptions,\n                cssClass = anchorParams.cssClass || \"\";\n\n            for (var i = 0; i < faces.length; i++) { availableFaces[faces[i]] = true; }\n\n            this.getDefaultFace = function() {\n                return faces.length === 0 ? \"top\" : faces[0];\n            };\n\n            // if the given edge is supported, returns it. otherwise looks for a substitute that _is_\n            // supported. if none supported we also return the request edge.\n            this.verifyEdge = function(edge) {\n                if (availableFaces[edge]) return edge;\n                else if (availableFaces[opposites[edge]]) return opposites[edge];\n                else if (availableFaces[secondBest[edge]]) return secondBest[edge];\n                else if (availableFaces[lastChoice[edge]]) return lastChoice[edge];\n                return edge; // we have to give them something.\n            };\n\n            this.isEdgeSupported = function(edge) {\n            \treturn availableFaces[edge] === true;\n            };\n\n            this.compute = function(params) {\n                return userDefinedContinuousAnchorLocations[params.element.id] || continuousAnchorLocations[params.element.id] || [0,0];\n            };\n            this.getCurrentLocation = function(params) {\n                return userDefinedContinuousAnchorLocations[params.element.id] || continuousAnchorLocations[params.element.id] || [0,0];\n            };\n            this.getOrientation = function(endpoint) {\n                return continuousAnchorOrientations[endpoint.id] || [0,0];\n            };\n            this.clearUserDefinedLocation = function() {\n                delete userDefinedContinuousAnchorLocations[anchorParams.elementId];\n            };\n            this.setUserDefinedLocation = function(loc) {\n                userDefinedContinuousAnchorLocations[anchorParams.elementId] = loc;\n            };\n            this.getCssClass = function() { return cssClass; };\n            this.setCssClass = function(c) { cssClass = c; };\n        };\n        \n        // continuous anchors\n        jsPlumbInstance.continuousAnchorFactory = {\n            get:function(params) {\n                return new ContinuousAnchor(params);\n            },\n            clear:function(elementId) {\n                delete userDefinedContinuousAnchorLocations[elementId];\n                delete continuousAnchorLocations[elementId];\n            }\n        };\n\t};\n    \n    /**\n     * Anchors model a position on some element at which an Endpoint may be located.  They began as a first class citizen of jsPlumb, ie. a user\n     * was required to create these themselves, but over time this has been replaced by the concept of referring to them either by name (eg. \"TopMiddle\"),\n     * or by an array describing their coordinates (eg. [ 0, 0.5, 0, -1 ], which is the same as \"TopMiddle\").  jsPlumb now handles all of the\n     * creation of Anchors without user intervention.\n     */\n    jsPlumb.Anchor = function(params) {       \n        this.x = params.x || 0;\n        this.y = params.y || 0;\n        this.elementId = params.elementId;  \n        this.cssClass = params.cssClass || \"\";      \n        this.userDefinedLocation = null;\n        this.orientation = params.orientation || [ 0, 0 ];\n\n        jsPlumbUtil.EventGenerator.apply(this);\n        \n        var jsPlumbInstance = params.jsPlumbInstance;//,\n            //lastTimestamp = null;//, lastReturnValue = null;\n        \n        this.lastReturnValue = null;\n        this.offsets = params.offsets || [ 0, 0 ];\n        this.timestamp = null;        \n        this.compute = function(params) {\n\n\t\t\tvar xy = params.xy, wh = params.wh, element = params.element, timestamp = params.timestamp; \n\n\t\t\tif(params.clearUserDefinedLocation)\n\t\t\t\tthis.userDefinedLocation = null;\n\n\t\t\tif (timestamp && timestamp === self.timestamp)\n\t\t\t\treturn this.lastReturnValue;\n\n\t\t\tif (this.userDefinedLocation != null) {\n\t\t\t\tthis.lastReturnValue = this.userDefinedLocation;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.lastReturnValue = [ xy[0] + (this.x * wh[0]) + this.offsets[0], xy[1] + (this.y * wh[1]) + this.offsets[1] ];\n\t\t\t}\n\n\t\t\tthis.timestamp = timestamp;\n\t\t\treturn this.lastReturnValue;\n\t\t};\n\n        this.getCurrentLocation = function(params) { \n            return (this.lastReturnValue == null || (params.timestamp != null && this.timestamp != params.timestamp)) ? this.compute(params) : this.lastReturnValue; \n        };\n    };\n    jsPlumbUtil.extend(jsPlumb.Anchor, jsPlumbUtil.EventGenerator, {\n        equals : function(anchor) {\n            if (!anchor) return false;\n            var ao = anchor.getOrientation(),\n                o = this.getOrientation();\n            return this.x == anchor.x && this.y == anchor.y && this.offsets[0] == anchor.offsets[0] && this.offsets[1] == anchor.offsets[1] && o[0] == ao[0] && o[1] == ao[1];\n        },\n        getUserDefinedLocation : function() { \n            return this.userDefinedLocation;\n        },        \n        setUserDefinedLocation : function(l) {\n            this.userDefinedLocation = l;\n        },\n        clearUserDefinedLocation : function() {\n            this.userDefinedLocation = null;\n        },\n        getOrientation : function(_endpoint) { return this.orientation; },\n        getCssClass : function() { return this.cssClass; }\n    });\n\n    /**\n     * An Anchor that floats. its orientation is computed dynamically from\n     * its position relative to the anchor it is floating relative to.  It is used when creating \n     * a connection through drag and drop.\n     * \n     * TODO FloatingAnchor could totally be refactored to extend Anchor just slightly.\n     */\n    jsPlumb.FloatingAnchor = function(params) {\n        \n        jsPlumb.Anchor.apply(this, arguments);\n\n        // this is the anchor that this floating anchor is referenced to for\n        // purposes of calculating the orientation.\n        var ref = params.reference,\n            jsPlumbInstance = params.jsPlumbInstance,\n            // the canvas this refers to.\n            refCanvas = params.referenceCanvas,\n            size = jsPlumb.getSize(refCanvas),\n            // these are used to store the current relative position of our\n            // anchor wrt the reference anchor. they only indicate\n            // direction, so have a value of 1 or -1 (or, very rarely, 0). these\n            // values are written by the compute method, and read\n            // by the getOrientation method.\n            xDir = 0, yDir = 0,\n            // temporary member used to store an orientation when the floating\n            // anchor is hovering over another anchor.\n            orientation = null,\n            _lastResult = null;\n\n        // clear from parent. we want floating anchor orientation to always be computed.\n        this.orientation = null;\n\n        // set these to 0 each; they are used by certain types of connectors in the loopback case,\n        // when the connector is trying to clear the element it is on. but for floating anchor it's not\n        // very important.\n        this.x = 0; this.y = 0;\n\n        this.isFloating = true;\n\n\t\tthis.compute = function(params) {\n\t\t\tvar xy = params.xy, element = params.element,\n\t\t\t\tresult = [ xy[0] + (size[0] / 2), xy[1] + (size[1] / 2) ]; // return origin of the element. we may wish to improve this so that any object can be the drag proxy.\n\t\t\t_lastResult = result;\n\t\t\treturn result;\n\t\t};\n\n        this.getOrientation = function(_endpoint) {\n            if (orientation) return orientation;\n            else {\n                var o = ref.getOrientation(_endpoint);\n                // here we take into account the orientation of the other\n                // anchor: if it declares zero for some direction, we declare zero too. this might not be the most awesome. perhaps we can come\n                // up with a better way. it's just so that the line we draw looks like it makes sense. maybe this wont make sense.\n                return [ Math.abs(o[0]) * xDir * -1,\n                        Math.abs(o[1]) * yDir * -1 ];\n            }\n        };\n\n        /**\n         * notification the endpoint associated with this anchor is hovering\n         * over another anchor; we want to assume that anchor's orientation\n         * for the duration of the hover.\n         */\n        this.over = function(anchor, endpoint) { \n            orientation = anchor.getOrientation(endpoint); \n        };\n\n        /**\n         * notification the endpoint associated with this anchor is no\n         * longer hovering over another anchor; we should resume calculating\n         * orientation as we normally do.\n         */\n        this.out = function() { orientation = null; };\n\n        this.getCurrentLocation = function(params) { return _lastResult == null ? this.compute(params) : _lastResult; };\n    };\n    jsPlumbUtil.extend(jsPlumb.FloatingAnchor, jsPlumb.Anchor);\n\n    var _convertAnchor = function(anchor, jsPlumbInstance, elementId) { \n        return anchor.constructor == jsPlumb.Anchor ? anchor: jsPlumbInstance.makeAnchor(anchor, elementId, jsPlumbInstance); \n    };\n\n    /* \n     * A DynamicAnchor is an Anchor that contains a list of other Anchors, which it cycles\n     * through at compute time to find the one that is located closest to\n     * the center of the target element, and returns that Anchor's compute\n     * method result. this causes endpoints to follow each other with\n     * respect to the orientation of their target elements, which is a useful\n     * feature for some applications.\n     * \n     */\n    jsPlumb.DynamicAnchor = function(params) {\n        jsPlumb.Anchor.apply(this, arguments);\n        \n        this.isSelective = true;\n        this.isDynamic = true;\t\t\t\n        this.anchors = [];\n        this.elementId = params.elementId;\n        this.jsPlumbInstance = params.jsPlumbInstance;\n\n        for (var i = 0; i < params.anchors.length; i++) \n            this.anchors[i] = _convertAnchor(params.anchors[i], this.jsPlumbInstance, this.elementId);\t\t\t\n        this.addAnchor = function(anchor) { this.anchors.push(_convertAnchor(anchor, this.jsPlumbInstance, this.elementId)); };\n        this.getAnchors = function() { return this.anchors; };\n        this.locked = false;\n        var _curAnchor = this.anchors.length > 0 ? this.anchors[0] : null,\n            _curIndex = this.anchors.length > 0 ? 0 : -1,\n            _lastAnchor = _curAnchor,\n            self = this,\n        \n            // helper method to calculate the distance between the centers of the two elements.\n            _distance = function(anchor, cx, cy, xy, wh) {\n                var ax = xy[0] + (anchor.x * wh[0]), ay = xy[1] + (anchor.y * wh[1]),\t\t\t\t\n                    acx = xy[0] + (wh[0] / 2), acy = xy[1] + (wh[1] / 2);\n                return (Math.sqrt(Math.pow(cx - ax, 2) + Math.pow(cy - ay, 2)) +\n                        Math.sqrt(Math.pow(acx - ax, 2) + Math.pow(acy - ay, 2)));\n            },        \n            // default method uses distance between element centers.  you can provide your own method in the dynamic anchor\n            // constructor (and also to jsPlumb.makeDynamicAnchor). the arguments to it are four arrays: \n            // xy - xy loc of the anchor's element\n            // wh - anchor's element's dimensions\n            // txy - xy loc of the element of the other anchor in the connection\n            // twh - dimensions of the element of the other anchor in the connection.\n            // anchors - the list of selectable anchors\n            _anchorSelector = params.selector || function(xy, wh, txy, twh, anchors) {\n                var cx = txy[0] + (twh[0] / 2), cy = txy[1] + (twh[1] / 2);\n                var minIdx = -1, minDist = Infinity;\n                for ( var i = 0; i < anchors.length; i++) {\n                    var d = _distance(anchors[i], cx, cy, xy, wh);\n                    if (d < minDist) {\n                        minIdx = i + 0;\n                        minDist = d;\n                    }\n                }\n                return anchors[minIdx];\n            };\n        \n        this.compute = function(params) {\t\t\t\t\n            var xy = params.xy, wh = params.wh, timestamp = params.timestamp, txy = params.txy, twh = params.twh;\n\n            this.timestamp = timestamp;            \n            \n            var udl = self.getUserDefinedLocation();\n            if (udl != null) {\n                return udl;\n            }\n            \n            // if anchor is locked or an opposite element was not given, we\n            // maintain our state. anchor will be locked\n            // if it is the source of a drag and drop.\n            if (this.locked || txy == null || twh == null)\n                return _curAnchor.compute(params);\t\t\t\t\n            else\n                params.timestamp = null; // otherwise clear this, i think. we want the anchor to compute.\n            \n            _curAnchor = _anchorSelector(xy, wh, txy, twh, this.anchors);\n            this.x = _curAnchor.x;\n            this.y = _curAnchor.y;        \n\n            if (_curAnchor != _lastAnchor)\n                this.fire(\"anchorChanged\", _curAnchor);\n\n            _lastAnchor = _curAnchor;\n            \n            return _curAnchor.compute(params);\n        };\n\n        this.getCurrentLocation = function(params) {\n            return this.getUserDefinedLocation() || (_curAnchor != null ? _curAnchor.getCurrentLocation(params) : null);\n        };\n\n        this.getOrientation = function(_endpoint) { return _curAnchor != null ? _curAnchor.getOrientation(_endpoint) : [ 0, 0 ]; };\n        this.over = function(anchor, endpoint) { if (_curAnchor != null) _curAnchor.over(anchor, endpoint); };\n        this.out = function() { if (_curAnchor != null) _curAnchor.out(); };\n\n        this.getCssClass = function() { return (_curAnchor && _curAnchor.getCssClass()) || \"\"; };\n    };    \n    jsPlumbUtil.extend(jsPlumb.DynamicAnchor, jsPlumb.Anchor);        \n    \n// -------- basic anchors ------------------    \n    var _curryAnchor = function(x, y, ox, oy, type, fnInit) {\n        jsPlumb.Anchors[type] = function(params) {\n            var a = params.jsPlumbInstance.makeAnchor([ x, y, ox, oy, 0, 0 ], params.elementId, params.jsPlumbInstance);\n            a.type = type;\n            if (fnInit) fnInit(a, params);\n            return a;\n        };\n    };\n    \t\n\t_curryAnchor(0.5, 0, 0,-1, \"TopCenter\");\n    _curryAnchor(0.5, 1, 0, 1, \"BottomCenter\");\n    _curryAnchor(0, 0.5, -1, 0, \"LeftMiddle\");\n    _curryAnchor(1, 0.5, 1, 0, \"RightMiddle\");\n    // from 1.4.2: Top, Right, Bottom, Left\n    _curryAnchor(0.5, 0, 0,-1, \"Top\");\n    _curryAnchor(0.5, 1, 0, 1, \"Bottom\");\n    _curryAnchor(0, 0.5, -1, 0, \"Left\");\n    _curryAnchor(1, 0.5, 1, 0, \"Right\");\n    _curryAnchor(0.5, 0.5, 0, 0, \"Center\");\n    _curryAnchor(1, 0, 0,-1, \"TopRight\");\n    _curryAnchor(1, 1, 0, 1, \"BottomRight\");\n    _curryAnchor(0, 0, 0, -1, \"TopLeft\");\n    _curryAnchor(0, 1, 0, 1, \"BottomLeft\");\n    \n// ------- dynamic anchors -------------------    \n\t\t\t\n    // default dynamic anchors chooses from Top, Right, Bottom, Left\n\tjsPlumb.Defaults.DynamicAnchors = function(params) {\n\t\treturn params.jsPlumbInstance.makeAnchors([\"TopCenter\", \"RightMiddle\", \"BottomCenter\", \"LeftMiddle\"], params.elementId, params.jsPlumbInstance);\n\t};\n    \n    // default dynamic anchors bound to name 'AutoDefault'\n\tjsPlumb.Anchors.AutoDefault  = function(params) { \n\t\tvar a = params.jsPlumbInstance.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors(params));\n\t\ta.type = \"AutoDefault\";\n\t\treturn a;\n\t};\t\n    \n// ------- continuous anchors -------------------    \n    \n    var _curryContinuousAnchor = function(type, faces) {\n        jsPlumb.Anchors[type] = function(params) {\n            var a = params.jsPlumbInstance.makeAnchor([\"Continuous\", { faces:faces }], params.elementId, params.jsPlumbInstance);\n            a.type = type;\n            return a;\n        };\n    };\n    \n    jsPlumb.Anchors.Continuous = function(params) {\n\t\treturn params.jsPlumbInstance.continuousAnchorFactory.get(params);\n\t};\n                \n    _curryContinuousAnchor(\"ContinuousLeft\", [\"left\"]);    \n    _curryContinuousAnchor(\"ContinuousTop\", [\"top\"]);                 \n    _curryContinuousAnchor(\"ContinuousBottom\", [\"bottom\"]);                 \n    _curryContinuousAnchor(\"ContinuousRight\", [\"right\"]); \n    \n// ------- position assign anchors -------------------    \n    \n    // this anchor type lets you assign the position at connection time.\n\t_curryAnchor(0, 0, 0, 0, \"Assign\", function(anchor, params) {\n\t\t// find what to use as the \"position finder\". the user may have supplied a String which represents\n\t\t// the id of a position finder in jsPlumb.AnchorPositionFinders, or the user may have supplied the\n\t\t// position finder as a function.  we find out what to use and then set it on the anchor.\n\t\tvar pf = params.position || \"Fixed\";\n\t\tanchor.positionFinder = pf.constructor == String ? params.jsPlumbInstance.AnchorPositionFinders[pf] : pf;\n\t\t// always set the constructor params; the position finder might need them later (the Grid one does,\n\t\t// for example)\n\t\tanchor.constructorParams = params;\n\t});\t\n\n    // these are the default anchor positions finders, which are used by the makeTarget function.  supplying\n    // a position finder argument to that function allows you to specify where the resulting anchor will\n    // be located\n\tjsPlumbInstance.prototype.AnchorPositionFinders = {\n\t\t\"Fixed\": function(dp, ep, es, params) {\n\t\t\treturn [ (dp.left - ep.left) / es[0], (dp.top - ep.top) / es[1] ];\t\n\t\t},\n\t\t\"Grid\":function(dp, ep, es, params) {\n\t\t\tvar dx = dp.left - ep.left, dy = dp.top - ep.top,\n\t\t\t\tgx = es[0] / (params.grid[0]), gy = es[1] / (params.grid[1]),\n\t\t\t\tmx = Math.floor(dx / gx), my = Math.floor(dy / gy);\n\t\t\treturn [ ((mx * gx) + (gx / 2)) / es[0], ((my * gy) + (gy / 2)) / es[1] ];\n\t\t}\n\t};\n    \n// ------- perimeter anchors -------------------    \n\t\t\n\tjsPlumb.Anchors.Perimeter = function(params) {\n\t\tparams = params || {};\n\t\tvar anchorCount = params.anchorCount || 60,\n\t\t\tshape = params.shape;\n\t\t\n\t\tif (!shape) throw new Error(\"no shape supplied to Perimeter Anchor type\");\t\t\n\t\t\n\t\tvar _circle = function() {\n                var r = 0.5, step = Math.PI * 2 / anchorCount, current = 0, a = [];\n                for (var i = 0; i < anchorCount; i++) {\n                    var x = r + (r * Math.sin(current)),\n                        y = r + (r * Math.cos(current));                                \n                    a.push( [ x, y, 0, 0 ] );\n                    current += step;\n                }\n                return a;\t\n            },\n            _path = function(segments) {\n                var anchorsPerFace = anchorCount / segments.length, a = [],\n                    _computeFace = function(x1, y1, x2, y2, fractionalLength) {\n                        anchorsPerFace = anchorCount * fractionalLength;\n                        var dx = (x2 - x1) / anchorsPerFace, dy = (y2 - y1) / anchorsPerFace;\n                        for (var i = 0; i < anchorsPerFace; i++) {\n                            a.push( [\n                                x1 + (dx * i),\n                                y1 + (dy * i),\n                                0,\n                                0\n                            ]);\n                        }\n                    };\n\t\t\t\t\t\t\t\t\n                for (var i = 0; i < segments.length; i++)\n                    _computeFace.apply(null, segments[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n                return a;\t\t\t\t\t\n            },\n\t\t\t_shape = function(faces) {\t\t\t\t\t\t\t\t\t\t\t\t\n                var s = [];\n                for (var i = 0; i < faces.length; i++) {\n                    s.push([faces[i][0], faces[i][1], faces[i][2], faces[i][3], 1 / faces.length]);\n                }\n                return _path(s);\n\t\t\t},\n\t\t\t_rectangle = function() {\n\t\t\t\treturn _shape([\n\t\t\t\t\t[ 0, 0, 1, 0 ], [ 1, 0, 1, 1 ], [ 1, 1, 0, 1 ], [ 0, 1, 0, 0 ]\n\t\t\t\t]);\t\t\n\t\t\t};\n\t\t\n\t\tvar _shapes = {\n\t\t\t\"Circle\":_circle,\n\t\t\t\"Ellipse\":_circle,\n\t\t\t\"Diamond\":function() {\n\t\t\t\treturn _shape([\n\t\t\t\t\t\t[ 0.5, 0, 1, 0.5 ], [ 1, 0.5, 0.5, 1 ], [ 0.5, 1, 0, 0.5 ], [ 0, 0.5, 0.5, 0 ]\n\t\t\t\t]);\n\t\t\t},\n\t\t\t\"Rectangle\":_rectangle,\n\t\t\t\"Square\":_rectangle,\n\t\t\t\"Triangle\":function() {\n\t\t\t\treturn _shape([\n\t\t\t\t\t\t[ 0.5, 0, 1, 1 ], [ 1, 1, 0, 1 ], [ 0, 1, 0.5, 0]\n\t\t\t\t]);\t\n\t\t\t},\n\t\t\t\"Path\":function(params) {\n                var points = params.points, p = [], tl = 0;\n\t\t\t\tfor (var i = 0; i < points.length - 1; i++) {\n                    var l = Math.sqrt(Math.pow(points[i][2] - points[i][0]) + Math.pow(points[i][3] - points[i][1]));\n                    tl += l;\n\t\t\t\t\tp.push([points[i][0], points[i][1], points[i+1][0], points[i+1][1], l]);\t\t\t\t\t\t\n\t\t\t\t}\n                for (var j = 0; j < p.length; j++) {\n                    p[j][4] = p[j][4] / tl;\n                }\n\t\t\t\treturn _path(p);\n\t\t\t}\n\t\t},\n        _rotate = function(points, amountInDegrees) {\n            var o = [], theta = amountInDegrees / 180 * Math.PI ;\n            for (var i = 0; i < points.length; i++) {\n                var _x = points[i][0] - 0.5,\n                    _y = points[i][1] - 0.5;\n                    \n                o.push([\n                    0.5 + ((_x * Math.cos(theta)) - (_y * Math.sin(theta))),\n                    0.5 + ((_x * Math.sin(theta)) + (_y * Math.cos(theta))),\n                    points[i][2],\n                    points[i][3]\n                ]);\n            }\n            return o;\n        };\n\t\t\n\t\tif (!_shapes[shape]) throw new Error(\"Shape [\" + shape + \"] is unknown by Perimeter Anchor type\");\n\t\t\n\t\tvar da = _shapes[shape](params);\n        if (params.rotation) da = _rotate(da, params.rotation);\n        var a = params.jsPlumbInstance.makeDynamicAnchor(da);\n\t\ta.type = \"Perimeter\";\n\t\treturn a;\n\t};\n})();\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the default Connectors, Endpoint and Overlay definitions.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */  \n;(function() {\t\n\n\t\"use strict\";\n\n\tjsPlumb.Segments = {\n\n        /*\n         * Class: AbstractSegment\n         * A Connector is made up of 1..N Segments, each of which has a Type, such as 'Straight', 'Arc',\n         * 'Bezier'. This is new from 1.4.2, and gives us a lot more flexibility when drawing connections: things such\n         * as rounded corners for flowchart connectors, for example, or a straight line stub for Bezier connections, are\n         * much easier to do now.\n         *\n         * A Segment is responsible for providing coordinates for painting it, and also must be able to report its length.\n         * \n         */ \n        AbstractSegment : function(params) { \n            this.params = params;\n            \n            /**\n            * Function: findClosestPointOnPath\n            * Finds the closest point on this segment to the given [x, y], \n            * returning both the x and y of the point plus its distance from\n            * the supplied point, and its location along the length of the\n            * path inscribed by the segment.  This implementation returns\n            * Infinity for distance and null values for everything else;\n            * subclasses are expected to override.\n            */\n            this.findClosestPointOnPath = function(x, y) {\n                return {\n                    d:Infinity,\n                    x:null,\n                    y:null,\n                    l:null\n                };\n            };\n\n            this.getBounds = function() {\n                return {\n                    minX:Math.min(params.x1, params.x2),\n                    minY:Math.min(params.y1, params.y2),\n                    maxX:Math.max(params.x1, params.x2),\n                    maxY:Math.max(params.y1, params.y2)\n                };\n            };\n        },\n        Straight : function(params) {\n            var _super = jsPlumb.Segments.AbstractSegment.apply(this, arguments),\n                length, m, m2, x1, x2, y1, y2,\n                _recalc = function() {\n                    length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n                    m = Biltong.gradient({x:x1, y:y1}, {x:x2, y:y2});\n                    m2 = -1 / m;                \n                };\n                \n            this.type = \"Straight\";\n            \n            this.getLength = function() { return length; };\n            this.getGradient = function() { return m; };\n                \n            this.getCoordinates = function() {\n                return { x1:x1,y1:y1,x2:x2,y2:y2 };\n            };\n            this.setCoordinates = function(coords) {\n                x1 = coords.x1; y1 = coords.y1; x2 = coords.x2; y2 = coords.y2;\n                _recalc();\n            };\n            this.setCoordinates({x1:params.x1, y1:params.y1, x2:params.x2, y2:params.y2});\n\n            this.getBounds = function() {\n                return {\n                    minX:Math.min(x1, x2),\n                    minY:Math.min(y1, y2),\n                    maxX:Math.max(x1, x2),\n                    maxY:Math.max(y1, y2)\n                };\n            };\n            \n            /**\n             * returns the point on the segment's path that is 'location' along the length of the path, where 'location' is a decimal from\n             * 0 to 1 inclusive. for the straight line segment this is simple maths.\n             */\n             this.pointOnPath = function(location, absolute) {\n                if (location === 0 && !absolute)\n                    return { x:x1, y:y1 };\n                else if (location == 1 && !absolute)\n                    return { x:x2, y:y2 };\n                else {\n                    var l = absolute ? location > 0 ? location : length + location : location * length;\n                    return Biltong.pointOnLine({x:x1, y:y1}, {x:x2, y:y2}, l);\n                }\n            };\n            \n            /**\n             * returns the gradient of the segment at the given point - which for us is constant.\n             */\n            this.gradientAtPoint = function(_) {\n                return m;\n            };\n            \n            /**\n             * returns the point on the segment's path that is 'distance' along the length of the path from 'location', where \n             * 'location' is a decimal from 0 to 1 inclusive, and 'distance' is a number of pixels.\n             * this hands off to jsPlumbUtil to do the maths, supplying two points and the distance.\n             */            \n            this.pointAlongPathFrom = function(location, distance, absolute) {            \n                var p = this.pointOnPath(location, absolute),\n                    farAwayPoint = distance <= 0 ? {x:x1, y:y1} : {x:x2, y:y2 };\n\n                /*\n                location == 1 ? {\n                                        x:x1 + ((x2 - x1) * 10),\n                                        y:y1 + ((y1 - y2) * 10)\n                                    } : \n                */\n    \n                if (distance <= 0 && Math.abs(distance) > 1) distance *= -1;\n    \n                return Biltong.pointOnLine(p, farAwayPoint, distance);\n            };\n            \n            // is c between a and b?\n            var within = function(a,b,c) {\n                return c >= Math.min(a,b) && c <= Math.max(a,b); \n            };\n            // find which of a and b is closest to c\n            var closest = function(a,b,c) {\n                return Math.abs(c - a) < Math.abs(c - b) ? a : b;\n            };\n            \n            /**\n                Function: findClosestPointOnPath\n                Finds the closest point on this segment to [x,y]. See\n                notes on this method in AbstractSegment.\n            */\n            this.findClosestPointOnPath = function(x, y) {\n                var out = {\n                    d:Infinity,\n                    x:null,\n                    y:null,\n                    l:null,\n                    x1:x1,\n                    x2:x2,\n                    y1:y1,\n                    y2:y2\n                };\n\n                if (m === 0) {                  \n                    out.y = y1;\n                    out.x = within(x1, x2, x) ? x : closest(x1, x2, x);\n                }\n                else if (m == Infinity || m == -Infinity) {\n                    out.x = x1;                \n                    out.y = within(y1, y2, y) ? y : closest(y1, y2, y);\n                }\n                else {\n                    // closest point lies on normal from given point to this line.  \n                    var b = y1 - (m * x1),\n                        b2 = y - (m2 * x),                    \n                    // y1 = m.x1 + b and y1 = m2.x1 + b2\n                    // so m.x1 + b = m2.x1 + b2\n                    // x1(m - m2) = b2 - b\n                    // x1 = (b2 - b) / (m - m2)\n                        _x1 = (b2 -b) / (m - m2),\n                        _y1 = (m * _x1) + b;\n                                        \n                    out.x = within(x1,x2,_x1) ? _x1 : closest(x1,x2,_x1);//_x1;\n                    out.y = within(y1,y2,_y1) ? _y1 : closest(y1,y2,_y1);//_y1;                    \n                }\n\n                var fractionInSegment = Biltong.lineLength([ out.x, out.y ], [ x1, y1 ]);\n                out.d = Biltong.lineLength([x,y], [out.x, out.y]);\n                out.l = fractionInSegment / length;            \n                return out;\n            };        \n        },\n\t\n        /*\n            Arc Segment. You need to supply:\n    \n            r   -   radius\n            cx  -   center x for the arc\n            cy  -   center y for the arc\n            ac  -   whether the arc is anticlockwise or not. default is clockwise.\n    \n            and then either:\n    \n            startAngle  -   startAngle for the arc.\n            endAngle    -   endAngle for the arc.\n    \n            or:\n    \n            x1          -   x for start point\n            y1          -   y for start point\n            x2          -   x for end point\n            y2          -   y for end point\n    \n        */\n        Arc : function(params) {\n            var _super = jsPlumb.Segments.AbstractSegment.apply(this, arguments),\n                _calcAngle = function(_x, _y) {\n                    return Biltong.theta([params.cx, params.cy], [_x, _y]);    \n                },\n                _calcAngleForLocation = function(segment, location) {\n                    if (segment.anticlockwise) {\n                        var sa = segment.startAngle < segment.endAngle ? segment.startAngle + TWO_PI : segment.startAngle,\n                            s = Math.abs(sa - segment.endAngle);\n                        return sa - (s * location);                    \n                    }\n                    else {\n                        var ea = segment.endAngle < segment.startAngle ? segment.endAngle + TWO_PI : segment.endAngle,\n                            ss = Math.abs (ea - segment.startAngle);\n                    \n                        return segment.startAngle + (ss * location);\n                    }\n                },\n                TWO_PI = 2 * Math.PI;\n            \n            this.radius = params.r;\n            this.anticlockwise = params.ac;\t\t\t\n            this.type = \"Arc\";\n                \n            if (params.startAngle && params.endAngle) {\n                this.startAngle = params.startAngle;\n                this.endAngle = params.endAngle;            \n                this.x1 = params.cx + (this.radius * Math.cos(params.startAngle));     \n                this.y1 = params.cy + (this.radius * Math.sin(params.startAngle));            \n                this.x2 = params.cx + (this.radius * Math.cos(params.endAngle));     \n                this.y2 = params.cy + (this.radius * Math.sin(params.endAngle));                        \n            }\n            else {\n                this.startAngle = _calcAngle(params.x1, params.y1);\n                this.endAngle = _calcAngle(params.x2, params.y2);            \n                this.x1 = params.x1;\n                this.y1 = params.y1;\n                this.x2 = params.x2;\n                this.y2 = params.y2;            \n            }\n            \n            if (this.endAngle < 0) this.endAngle += TWO_PI;\n            if (this.startAngle < 0) this.startAngle += TWO_PI;   \n\n            // segment is used by vml     \n            this.segment = Biltong.quadrant([this.x1, this.y1], [this.x2, this.y2]);\n            \n            // we now have startAngle and endAngle as positive numbers, meaning the\n            // absolute difference (|d|) between them is the sweep (s) of this arc, unless the\n            // arc is 'anticlockwise' in which case 's' is given by 2PI - |d|.\n            \n            var ea = this.endAngle < this.startAngle ? this.endAngle + TWO_PI : this.endAngle;\n            this.sweep = Math.abs (ea - this.startAngle);\n            if (this.anticlockwise) this.sweep = TWO_PI - this.sweep;\n            var circumference = 2 * Math.PI * this.radius,\n                frac = this.sweep / TWO_PI,\n                length = circumference * frac;\n            \n            this.getLength = function() {\n                return length;\n            };\n\n            this.getBounds = function() {\n                return {\n                    minX:params.cx - params.r,\n                    maxX:params.cx + params.r,\n                    minY:params.cy - params.r,\n                    maxY:params.cy + params.r\n                };\n            };\n            \n            var VERY_SMALL_VALUE = 0.0000000001,\n                gentleRound = function(n) {\n                    var f = Math.floor(n), r = Math.ceil(n);\n                    if (n - f < VERY_SMALL_VALUE) \n                        return f;    \n                    else if (r - n < VERY_SMALL_VALUE)\n                        return r;\n                    return n;\n                };\n            \n            /**\n             * returns the point on the segment's path that is 'location' along the length of the path, where 'location' is a decimal from\n             * 0 to 1 inclusive. \n             */\n            this.pointOnPath = function(location, absolute) {            \n                \n                if (location === 0) {\n                    return { x:this.x1, y:this.y1, theta:this.startAngle };    \n                }\n                else if (location == 1) {\n                    return { x:this.x2, y:this.y2, theta:this.endAngle };                    \n                }\n                \n                if (absolute) {\n                    location = location / length;\n                }\n    \n                var angle = _calcAngleForLocation(this, location),\n                    _x = params.cx + (params.r * Math.cos(angle)),\n                    _y  = params.cy + (params.r * Math.sin(angle));\t\t\t\t\t\n    \n                return { x:gentleRound(_x), y:gentleRound(_y), theta:angle };\n            };\n            \n            /**\n             * returns the gradient of the segment at the given point.\n             */\n            this.gradientAtPoint = function(location, absolute) {\n                var p = this.pointOnPath(location, absolute);\n                var m = Biltong.normal( [ params.cx, params.cy ], [p.x, p.y ] );\n                if (!this.anticlockwise && (m == Infinity || m == -Infinity)) m *= -1;\n                return m;\n            };\t              \n                    \n            this.pointAlongPathFrom = function(location, distance, absolute) {\n                var p = this.pointOnPath(location, absolute),\n                    arcSpan = distance / circumference * 2 * Math.PI,\n                    dir = this.anticlockwise ? -1 : 1,\n                    startAngle = p.theta + (dir * arcSpan),\t\t\t\t\n                    startX = params.cx + (this.radius * Math.cos(startAngle)),\n                    startY = params.cy + (this.radius * Math.sin(startAngle));\t\n    \n                return {x:startX, y:startY};\n            };\t            \n        },\n\t\n        Bezier : function(params) {\n            this.curve = [\n                { x:params.x1, y:params.y1},\n                { x:params.cp1x, y:params.cp1y },\n                { x:params.cp2x, y:params.cp2y },\n                { x:params.x2, y:params.y2 }\n            ];\n\n            var _super = jsPlumb.Segments.AbstractSegment.apply(this, arguments);\n            // although this is not a strictly rigorous determination of bounds\n            // of a bezier curve, it works for the types of curves that this segment\n            // type produces.\n            this.bounds = {\n                minX:Math.min(params.x1, params.x2, params.cp1x, params.cp2x),\n                minY:Math.min(params.y1, params.y2, params.cp1y, params.cp2y),\n                maxX:Math.max(params.x1, params.x2, params.cp1x, params.cp2x),\n                maxY:Math.max(params.y1, params.y2, params.cp1y, params.cp2y)\n            };\n                \n            this.type = \"Bezier\";            \n            \n            var _translateLocation = function(_curve, location, absolute) {\n                if (absolute)\n                    location = jsBezier.locationAlongCurveFrom(_curve, location > 0 ? 0 : 1, location);\n    \n                return location;\n            };\t\t\n            \n            /**\n             * returns the point on the segment's path that is 'location' along the length of the path, where 'location' is a decimal from\n             * 0 to 1 inclusive. \n             */\n            this.pointOnPath = function(location, absolute) {\n                location = _translateLocation(this.curve, location, absolute);\n                return jsBezier.pointOnCurve(this.curve, location);\n            };\n            \n            /**\n             * returns the gradient of the segment at the given point.\n             */\n            this.gradientAtPoint = function(location, absolute) {\n                location = _translateLocation(this.curve, location, absolute);\n                return jsBezier.gradientAtPoint(this.curve, location);\n            };\t              \n            \n            this.pointAlongPathFrom = function(location, distance, absolute) {\n                location = _translateLocation(this.curve, location, absolute);\n                return jsBezier.pointAlongCurveFrom(this.curve, location, distance);\n            };\n            \n            this.getLength = function() {\n                return jsBezier.getLength(this.curve);\n            };\n\n            this.getBounds = function() {\n                return this.bounds;\n            };\n        }\n    };\n\n\t/*\n\t\tClass: AbstractComponent\n\t\tSuperclass for AbstractConnector and AbstractEndpoint.\n\t*/\n\tvar AbstractComponent = function() {\n\t\tthis.resetBounds = function() {\n\t\t\tthis.bounds = { minX:Infinity, minY:Infinity, maxX:-Infinity, maxY:-Infinity };\n\t\t};\n\t\tthis.resetBounds();\n\t};\n\n\t/*\n\t * Class: AbstractConnector\n\t * Superclass for all Connectors; here is where Segments are managed.  This is exposed on jsPlumb just so it\n\t * can be accessed from other files. You should not try to instantiate one of these directly.\n\t *\n\t * When this class is asked for a pointOnPath, or gradient etc, it must first figure out which segment to dispatch\n\t * that request to. This is done by keeping track of the total connector length as segments are added, and also\n\t * their cumulative ratios to the total length.  Then when the right segment is found it is a simple case of dispatching\n\t * the request to it (and adjusting 'location' so that it is relative to the beginning of that segment.)\n\t */ \n\tjsPlumb.Connectors.AbstractConnector = function(params) {\n\t\t\n\t\tAbstractComponent.apply(this, arguments);\n\n\t\tvar segments = [],\n\t\t\ttotalLength = 0,\n\t\t\tsegmentProportions = [],\n\t\t\tsegmentProportionalLengths = [],\n\t\t\tstub = params.stub || 0, \n\t\t\tsourceStub = jsPlumbUtil.isArray(stub) ? stub[0] : stub,\n\t\t\ttargetStub = jsPlumbUtil.isArray(stub) ? stub[1] : stub,\n\t\t\tgap = params.gap || 0,\n\t\t\tsourceGap = jsPlumbUtil.isArray(gap) ? gap[0] : gap,\n\t\t\ttargetGap = jsPlumbUtil.isArray(gap) ? gap[1] : gap,\n\t\t\tuserProvidedSegments = null,\n\t\t\tedited = false,\n\t\t\tpaintInfo = null;\n\n\t\t// to be overridden by subclasses.\n\t\tthis.getPath = function() { };\n\t\tthis.setPath = function(path) { };\n        \n        /**\n        * Function: findSegmentForPoint\n        * Returns the segment that is closest to the given [x,y],\n        * null if nothing found.  This function returns a JS \n        * object with:\n        *\n        *   d   -   distance from segment\n        *   l   -   proportional location in segment\n        *   x   -   x point on the segment\n        *   y   -   y point on the segment\n        *   s   -   the segment itself.\n        */ \n        this.findSegmentForPoint = function(x, y) {\n            var out = { d:Infinity, s:null, x:null, y:null, l:null };\n            for (var i = 0; i < segments.length; i++) {\n                var _s = segments[i].findClosestPointOnPath(x, y);\n                if (_s.d < out.d) {\n                    out.d = _s.d; \n                    out.l = _s.l; \n                    out.x = _s.x;\n                    out.y = _s.y; \n                    out.s = segments[i];\n                    out.x1 = _s.x1;\n                    out.x2 = _s.x2;\n                    out.y1 = _s.y1;\n                    out.y2 = _s.y2;\n                    out.index = i;\n                }\n            }\n            \n            return out;\n        };\n\n\t\tvar _updateSegmentProportions = function() {\n                var curLoc = 0;\n                for (var i = 0; i < segments.length; i++) {\n                    var sl = segments[i].getLength();\n                    segmentProportionalLengths[i] = sl / totalLength;\n                    segmentProportions[i] = [curLoc, (curLoc += (sl / totalLength)) ];\n                }\n            },\n\t\t\n            /**\n             * returns [segment, proportion of travel in segment, segment index] for the segment \n             * that contains the point which is 'location' distance along the entire path, where \n             * 'location' is a decimal between 0 and 1 inclusive. in this connector type, paths \n             * are made up of a list of segments, each of which contributes some fraction to\n             * the total length. \n             * From 1.3.10 this also supports the 'absolute' property, which lets us specify a location\n             * as the absolute distance in pixels, rather than a proportion of the total path. \n             */\n            _findSegmentForLocation = function(location, absolute) {\n\t\t\t\tif (absolute) {\n\t\t\t\t\tlocation = location > 0 ? location / totalLength : (totalLength + location) / totalLength;\n\t\t\t\t}\n\t\t\t\tvar idx = segmentProportions.length - 1, inSegmentProportion = 1;\n\t\t\t\tfor (var i = 0; i < segmentProportions.length; i++) {\n\t\t\t\t\tif (segmentProportions[i][1] >= location) {\n\t\t\t\t\t\tidx = i;\n\t\t\t\t\t\t// todo is this correct for all connector path types?\n\t\t\t\t\t\tinSegmentProportion = location == 1 ? 1 : location === 0 ? 0 : (location - segmentProportions[i][0]) / segmentProportionalLengths[i];                    \n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { segment:segments[idx], proportion:inSegmentProportion, index:idx };\n\t\t\t},\n\t\t\t_addSegment = function(conn, type, params) {\n\t\t\t\tif (params.x1 == params.x2 && params.y1 == params.y2) return;\n\t\t\t\tvar s = new jsPlumb.Segments[type](params);\n\t\t\t\tsegments.push(s);\n\t\t\t\ttotalLength += s.getLength();\n\t\t\t\tconn.updateBounds(s);\n\t\t\t},\n\t\t\t_clearSegments = function() {\n\t\t\t\ttotalLength = segments.length = segmentProportions.length = segmentProportionalLengths.length = 0;\n\t\t\t};\n\n\t\tthis.setSegments = function(_segs) {\n\t\t\tuserProvidedSegments = [];\n\t\t\ttotalLength = 0;\n\t\t\tfor (var i = 0; i < _segs.length; i++) {\n\t\t\t\tuserProvidedSegments.push(_segs[i]);\n\t\t\t\ttotalLength += _segs[i].getLength();\n\t\t\t}\n\t\t};\n\n        var _prepareCompute = function(params) {\n            this.lineWidth = params.lineWidth;\n            var segment = Biltong.quadrant(params.sourcePos, params.targetPos),\n                swapX = params.targetPos[0] < params.sourcePos[0],\n                swapY = params.targetPos[1] < params.sourcePos[1],\n                lw = params.lineWidth || 1,       \n                so = params.sourceEndpoint.anchor.getOrientation(params.sourceEndpoint), \n                to = params.targetEndpoint.anchor.getOrientation(params.targetEndpoint),\n                x = swapX ? params.targetPos[0] : params.sourcePos[0], \n                y = swapY ? params.targetPos[1] : params.sourcePos[1],\n                w = Math.abs(params.targetPos[0] - params.sourcePos[0]),\n                h = Math.abs(params.targetPos[1] - params.sourcePos[1]);\n\n            // if either anchor does not have an orientation set, we derive one from their relative\n            // positions.  we fix the axis to be the one in which the two elements are further apart, and\n            // point each anchor at the other element.  this is also used when dragging a new connection.\n            if (so[0] === 0 && so[1] === 0 || to[0] === 0 && to[1] === 0) {\n                var index = w > h ? 0 : 1, oIndex = [1,0][index];\n                so = []; to = [];\n                so[index] = params.sourcePos[index] > params.targetPos[index] ? -1 : 1;\n                to[index] = params.sourcePos[index] > params.targetPos[index] ? 1 : -1;\n                so[oIndex] = 0; to[oIndex] = 0;\n            }                    \n            \n            var sx = swapX ? w + (sourceGap * so[0])  : sourceGap * so[0], \n                sy = swapY ? h + (sourceGap * so[1])  : sourceGap * so[1], \n                tx = swapX ? targetGap * to[0] : w + (targetGap * to[0]),\n                ty = swapY ? targetGap * to[1] : h + (targetGap * to[1]),\n                oProduct = ((so[0] * to[0]) + (so[1] * to[1]));        \n            \n            var result = {\n                sx:sx, sy:sy, tx:tx, ty:ty, lw:lw, \n                xSpan:Math.abs(tx - sx),\n                ySpan:Math.abs(ty - sy),                \n                mx:(sx + tx) / 2,\n                my:(sy + ty) / 2,                \n                so:so, to:to, x:x, y:y, w:w, h:h,\n                segment : segment,\n                startStubX : sx + (so[0] * sourceStub), \n                startStubY : sy + (so[1] * sourceStub),\n                endStubX : tx + (to[0] * targetStub), \n                endStubY : ty + (to[1] * targetStub),\n                isXGreaterThanStubTimes2 : Math.abs(sx - tx) > (sourceStub + targetStub),\n                isYGreaterThanStubTimes2 : Math.abs(sy - ty) > (sourceStub + targetStub),\n                opposite:oProduct == -1,\n                perpendicular:oProduct === 0,\n                orthogonal:oProduct == 1,\n                sourceAxis : so[0] === 0 ? \"y\" : \"x\",\n                points:[x, y, w, h, sx, sy, tx, ty ]\n            };\n            result.anchorOrientation = result.opposite ? \"opposite\" : result.orthogonal ? \"orthogonal\" : \"perpendicular\";\n            return result;\n        };\n\t\t\n\t\tthis.getSegments = function() { return segments; };\n\n        this.updateBounds = function(segment) {\n            var segBounds = segment.getBounds();\n            this.bounds.minX = Math.min(this.bounds.minX, segBounds.minX);\n            this.bounds.maxX = Math.max(this.bounds.maxX, segBounds.maxX);\n            this.bounds.minY = Math.min(this.bounds.minY, segBounds.minY);\n            this.bounds.maxY = Math.max(this.bounds.maxY, segBounds.maxY);              \n        };\n        \n        var dumpSegmentsToConsole = function() {\n            console.log(\"SEGMENTS:\");\n            for (var i = 0; i < segments.length; i++) {\n                console.log(segments[i].type, segments[i].getLength(), segmentProportions[i]);\n            }\n        };\n\n\t\tthis.pointOnPath = function(location, absolute) {\n            var seg = _findSegmentForLocation(location, absolute);\n            return seg.segment && seg.segment.pointOnPath(seg.proportion, false) || [0,0];\n        };\n        \n        this.gradientAtPoint = function(location, absolute) {\n            var seg = _findSegmentForLocation(location, absolute);          \n            return seg.segment && seg.segment.gradientAtPoint(seg.proportion, false) || 0;\n        };\n        \n        this.pointAlongPathFrom = function(location, distance, absolute) {\n            var seg = _findSegmentForLocation(location, absolute);\n            // TODO what happens if this crosses to the next segment?\n            return seg.segment && seg.segment.pointAlongPathFrom(seg.proportion, distance, false) || [0,0];\n        };\n\t\t\n\t\tthis.compute = function(params)  {\n            if (!edited)\n                paintInfo = _prepareCompute.call(this, params);\n            \n            _clearSegments();\n            this._compute(paintInfo, params);\n            this.x = paintInfo.points[0];\n            this.y = paintInfo.points[1];\n            this.w = paintInfo.points[2];\n            this.h = paintInfo.points[3];               \n            this.segment = paintInfo.segment;         \n            _updateSegmentProportions();            \n\t\t};\n\t\t\n\t\treturn {\n\t\t\taddSegment:_addSegment,\n            prepareCompute:_prepareCompute,\n            sourceStub:sourceStub,\n            targetStub:targetStub,\n            maxStub:Math.max(sourceStub, targetStub),            \n            sourceGap:sourceGap,\n            targetGap:targetGap,\n            maxGap:Math.max(sourceGap, targetGap)\n\t\t};\t\t\n\t};\n    jsPlumbUtil.extend(jsPlumb.Connectors.AbstractConnector, AbstractComponent);\n\t\n    /**\n     * Class: Connectors.Straight\n     * The Straight connector draws a simple straight line between the two anchor points.  It does not have any constructor parameters.\n     */\n    var Straight = jsPlumb.Connectors.Straight = function() {\n    \tthis.type = \"Straight\";\n\t\tvar _super =  jsPlumb.Connectors.AbstractConnector.apply(this, arguments);\t\t\n\n        this._compute = function(paintInfo, _) {                        \n            _super.addSegment(this, \"Straight\", {x1:paintInfo.sx, y1:paintInfo.sy, x2:paintInfo.startStubX, y2:paintInfo.startStubY});                                                \n            _super.addSegment(this, \"Straight\", {x1:paintInfo.startStubX, y1:paintInfo.startStubY, x2:paintInfo.endStubX, y2:paintInfo.endStubY});                        \n            _super.addSegment(this, \"Straight\", {x1:paintInfo.endStubX, y1:paintInfo.endStubY, x2:paintInfo.tx, y2:paintInfo.ty});                                    \n        };                    \n    };\n    jsPlumbUtil.extend(jsPlumb.Connectors.Straight, jsPlumb.Connectors.AbstractConnector);\n    jsPlumb.registerConnectorType(Straight, \"Straight\");\n\n\n // ********************************* END OF CONNECTOR TYPES *******************************************************************\n    \n // ********************************* ENDPOINT TYPES *******************************************************************\n    \n    jsPlumb.Endpoints.AbstractEndpoint = function(params) {\n        AbstractComponent.apply(this, arguments);\n        var compute = this.compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {    \n            var out = this._compute.apply(this, arguments);\n            this.x = out[0];\n            this.y = out[1];\n            this.w = out[2];\n            this.h = out[3];\n            this.bounds.minX = this.x;\n            this.bounds.minY = this.y;\n            this.bounds.maxX = this.x + this.w;\n            this.bounds.maxY = this.y + this.h;\n            return out;\n        };\n        return {\n            compute:compute,\n            cssClass:params.cssClass\n        };\n    };\n    jsPlumbUtil.extend(jsPlumb.Endpoints.AbstractEndpoint, AbstractComponent);\n    \n    /**\n     * Class: Endpoints.Dot\n     * A round endpoint, with default radius 10 pixels.\n     */    \t\n    \t\n\t/**\n\t * Function: Constructor\n\t * \n\t * Parameters:\n\t * \n\t * \tradius\t-\tradius of the endpoint.  defaults to 10 pixels.\n\t */\n\tjsPlumb.Endpoints.Dot = function(params) {        \n\t\tthis.type = \"Dot\";\n\t\tvar _super = jsPlumb.Endpoints.AbstractEndpoint.apply(this, arguments);\n\t\tparams = params || {};\t\t\t\t\n\t\tthis.radius = params.radius || 10;\n\t\tthis.defaultOffset = 0.5 * this.radius;\n\t\tthis.defaultInnerRadius = this.radius / 3;\t\t\t\n\t\t\n\t\tthis._compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {\n\t\t\tthis.radius = endpointStyle.radius || this.radius;\n\t\t\tvar\tx = anchorPoint[0] - this.radius,\n\t\t\t\ty = anchorPoint[1] - this.radius,\n                w = this.radius * 2,\n                h = this.radius * 2;\n\n            if (endpointStyle.strokeStyle) {\n                var lw = endpointStyle.lineWidth || 1;\n                x -= lw;\n                y -= lw;\n                w += (lw * 2);\n                h += (lw * 2);\n            }\n\t\t\treturn [ x, y, w, h, this.radius ];\n\t\t};\n\t};\n    jsPlumbUtil.extend(jsPlumb.Endpoints.Dot, jsPlumb.Endpoints.AbstractEndpoint);\n\n\tjsPlumb.Endpoints.Rectangle = function(params) {\n\t\tthis.type = \"Rectangle\";\n\t\tvar _super = jsPlumb.Endpoints.AbstractEndpoint.apply(this, arguments);\n\t\tparams = params || {};\n\t\tthis.width = params.width || 20;\n\t\tthis.height = params.height || 20;\n\n\t\tthis._compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {\n\t\t\tvar width = endpointStyle.width || this.width,\n\t\t\t\theight = endpointStyle.height || this.height,\n\t\t\t\tx = anchorPoint[0] - (width/2),\n\t\t\t\ty = anchorPoint[1] - (height/2);\n\n\t\t\treturn [ x, y, width, height];\n\t\t};\n\t};\n\tjsPlumbUtil.extend(jsPlumb.Endpoints.Rectangle, jsPlumb.Endpoints.AbstractEndpoint);\n\n\tvar DOMElementEndpoint = function(params) {\n        jsPlumb.jsPlumbUIComponent.apply(this, arguments);\n\t\tthis._jsPlumb.displayElements = [];\n\t};\n\tjsPlumbUtil.extend(DOMElementEndpoint, jsPlumb.jsPlumbUIComponent, {\n\t\tgetDisplayElements : function() { \n\t\t\treturn this._jsPlumb.displayElements; \n\t\t},\n\t\tappendDisplayElement : function(el) {\n\t\t\tthis._jsPlumb.displayElements.push(el);\n\t\t}\n\t});\n\n\t/**\n\t * Class: Endpoints.Image\n\t * Draws an image as the Endpoint.\n\t */\n\t/**\n\t * Function: Constructor\n\t * \n\t * Parameters:\n\t * \n\t * \tsrc\t-\tlocation of the image to use.\n\n    TODO: multiple references to self. not sure quite how to get rid of them entirely. perhaps self = null in the cleanup\n    function will suffice\n\n    TODO this class still leaks memory.\n\n\t */\n\tjsPlumb.Endpoints.Image = function(params) {\n\n\t\tthis.type = \"Image\";\n\t\tDOMElementEndpoint.apply(this, arguments);\n\t\tjsPlumb.Endpoints.AbstractEndpoint.apply(this, arguments);\n\n\t\tvar _onload = params.onload, \n\t\t\tsrc = params.src || params.url,\n\t\t\tclazz = params.cssClass ? \" \" + params.cssClass : \"\";\n\n\t\tthis._jsPlumb.img = new Image();\n\t\tthis._jsPlumb.ready = false;\n\t\tthis._jsPlumb.initialized = false;\n\t\tthis._jsPlumb.deleted = false;\n\t\tthis._jsPlumb.widthToUse = params.width;\n\t\tthis._jsPlumb.heightToUse = params.height;\n\t\tthis._jsPlumb.endpoint = params.endpoint;\n\n\t\tthis._jsPlumb.img.onload = function() {\n\t\t\tif (this._jsPlumb != null) {\n\t\t\t\tthis._jsPlumb.ready = true;\n\t\t\t\tthis._jsPlumb.widthToUse = this._jsPlumb.widthToUse || this._jsPlumb.img.width;\n\t\t\t\tthis._jsPlumb.heightToUse = this._jsPlumb.heightToUse || this._jsPlumb.img.height;\n\t\t\t\tif (_onload) {\n\t\t\t\t\t_onload(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this);\n\n        /*\n            Function: setImage\n            Sets the Image to use in this Endpoint.  \n\n            Parameters:\n            img         -   may be a URL or an Image object\n            onload      -   optional; a callback to execute once the image has loaded.\n        */\n        this._jsPlumb.endpoint.setImage = function(_img, onload) {\n            var s = _img.constructor == String ? _img : _img.src;\n            _onload = onload; \n            this._jsPlumb.img.src = s;\n\n            if (this.canvas != null)\n                this.canvas.setAttribute(\"src\", this._jsPlumb.img.src);\n        }.bind(this);\n\n\t\tthis._jsPlumb.endpoint.setImage(src, _onload);\n\t\tthis._compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {\n\t\t\tthis.anchorPoint = anchorPoint;\n\t\t\tif (this._jsPlumb.ready) return [anchorPoint[0] - this._jsPlumb.widthToUse / 2, anchorPoint[1] - this._jsPlumb.heightToUse / 2, \n\t\t\t\t\t\t\t\t\tthis._jsPlumb.widthToUse, this._jsPlumb.heightToUse];\n\t\t\telse return [0,0,0,0];\n\t\t};\n\t\t\n\t\tthis.canvas = document.createElement(\"img\");\n\t\tthis.canvas.style.margin = 0;\n\t\tthis.canvas.style.padding = 0;\n\t\tthis.canvas.style.outline = 0;\n\t\tthis.canvas.style.position = \"absolute\";\t\t\n\t\tthis.canvas.className = this._jsPlumb.instance.endpointClass + clazz;\n\t\tif (this._jsPlumb.widthToUse) this.canvas.setAttribute(\"width\", this._jsPlumb.widthToUse);\n\t\tif (this._jsPlumb.heightToUse) this.canvas.setAttribute(\"height\", this._jsPlumb.heightToUse);\t\t\n\t\tthis._jsPlumb.instance.appendElement(this.canvas);\n\t\t\n\t\tthis.actuallyPaint = function(d, style, anchor) {\n\t\t\tif (!this._jsPlumb.deleted) {\n\t\t\t\tif (!this._jsPlumb.initialized) {\n\t\t\t\t\tthis.canvas.setAttribute(\"src\", this._jsPlumb.img.src);\n\t\t\t\t\tthis.appendDisplayElement(this.canvas);\n\t\t\t\t\tthis._jsPlumb.initialized = true;\n\t\t\t\t}\n\t\t\t\tvar x = this.anchorPoint[0] - (this._jsPlumb.widthToUse / 2),\n\t\t\t\t\ty = this.anchorPoint[1] - (this._jsPlumb.heightToUse / 2);\n\t\t\t\tjsPlumbUtil.sizeElement(this.canvas, x, y, this._jsPlumb.widthToUse, this._jsPlumb.heightToUse);\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.paint = function(style, anchor) {\n            if (this._jsPlumb != null) {  // may have been deleted\n    \t\t\tif (this._jsPlumb.ready) {\n        \t\t\tthis.actuallyPaint(style, anchor);\n    \t\t\t}\n    \t\t\telse { \n    \t\t\t\twindow.setTimeout(function() {\n    \t\t\t\t\tthis.paint(style, anchor);\n    \t\t\t\t}.bind(this), 200);\n    \t\t\t}\n            }\n\t\t};\t\t\t\t\n\t};\n    jsPlumbUtil.extend(jsPlumb.Endpoints.Image, [ DOMElementEndpoint, jsPlumb.Endpoints.AbstractEndpoint ], {\n        cleanup : function() {            \n            this._jsPlumb.deleted = true;\n            if (this.canvas) this.canvas.parentNode.removeChild(this.canvas);\n            this.canvas = null;\n        } \n    });\n\t\n\t/*\n\t * Class: Endpoints.Blank\n\t * An Endpoint that paints nothing (visible) on the screen.  Supports cssClass and hoverClass parameters like all Endpoints.\n\t */\n\tjsPlumb.Endpoints.Blank = function(params) {\n\t\tvar _super = jsPlumb.Endpoints.AbstractEndpoint.apply(this, arguments);\n\t\tthis.type = \"Blank\";\n\t\tDOMElementEndpoint.apply(this, arguments);\t\t\n\t\tthis._compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {\n\t\t\treturn [anchorPoint[0], anchorPoint[1],10,0];\n\t\t};\n\n        var clazz = params.cssClass ? \" \" + params.cssClass : \"\";\n\t\t\n\t\tthis.canvas = document.createElement(\"div\");\n\t\tthis.canvas.style.display = \"block\";\n\t\tthis.canvas.style.width = \"1px\";\n\t\tthis.canvas.style.height = \"1px\";\n\t\tthis.canvas.style.background = \"transparent\";\n\t\tthis.canvas.style.position = \"absolute\";\n\t\tthis.canvas.className = this._jsPlumb.instance.endpointClass + clazz;\n\t\tthis._jsPlumb.instance.appendElement(this.canvas);\n\t\t\n\t\tthis.paint = function(style, anchor) {\n\t\t\tjsPlumbUtil.sizeElement(this.canvas, this.x, this.y, this.w, this.h);\t\n\t\t};\n\t};\n    jsPlumbUtil.extend(jsPlumb.Endpoints.Blank, [jsPlumb.Endpoints.AbstractEndpoint, DOMElementEndpoint], {\n        cleanup:function() {\n            if (this.canvas && this.canvas.parentNode) {\n                this.canvas.parentNode.removeChild(this.canvas);\n            }\n        }\n    });\n\t\n\t/*\n\t * Class: Endpoints.Triangle\n\t * A triangular Endpoint.  \n\t */\n\t/*\n\t * Function: Constructor\n\t * \n\t * Parameters:\n\t * \n\t * \twidth\t-\twidth of the triangle's base.  defaults to 55 pixels.\n\t * \theight\t-\theight of the triangle from base to apex.  defaults to 55 pixels.\n\t */\n\tjsPlumb.Endpoints.Triangle = function(params) {        \n\t\tthis.type = \"Triangle\";\n        jsPlumb.Endpoints.AbstractEndpoint.apply(this, arguments);\n\t\tparams = params || {  };\n\t\tparams.width = params.width || 55;\n\t\tparams.height = params.height || 55;\n\t\tthis.width = params.width;\n\t\tthis.height = params.height;\n\t\tthis._compute = function(anchorPoint, orientation, endpointStyle, connectorPaintStyle) {\n\t\t\tvar width = endpointStyle.width || self.width,\n\t\t\theight = endpointStyle.height || self.height,\n\t\t\tx = anchorPoint[0] - (width/2),\n\t\t\ty = anchorPoint[1] - (height/2);\n\t\t\treturn [ x, y, width, height ];\n\t\t};\n\t};\n// ********************************* END OF ENDPOINT TYPES *******************************************************************\n\t\n\n// ********************************* OVERLAY DEFINITIONS ***********************************************************************    \n\n\tvar AbstractOverlay = jsPlumb.Overlays.AbstractOverlay = function(params) {\n\t\tthis.visible = true;\n        this.isAppendedAtTopLevel = true;\n\t\tthis.component = params.component;\n\t\tthis.loc = params.location == null ? 0.5 : params.location;\n        this.endpointLoc = params.endpointLocation == null ? [ 0.5, 0.5] : params.endpointLocation;\n\t};\n    AbstractOverlay.prototype = {\n        cleanup:function() {  \n           this.component = null;\n           this.canvas = null;\n           this.endpointLoc = null;\n        },\n        setVisible : function(val) { \n            this.visible = val;\n            this.component.repaint();\n        },\n        isVisible : function() { return this.visible; },\n        hide : function() { this.setVisible(false); },\n        show : function() { this.setVisible(true); },        \n        incrementLocation : function(amount) {\n            this.loc += amount;\n            this.component.repaint();\n        },\n        setLocation : function(l) {\n            this.loc = l;\n            this.component.repaint();\n        },\n        getLocation : function() {\n            return this.loc;\n        }\n    };\n\t\n\t\n\t/*\n\t * Class: Overlays.Arrow\n\t * \n\t * An arrow overlay, defined by four points: the head, the two sides of the tail, and a 'foldback' point at some distance along the length\n\t * of the arrow that lines from each tail point converge into.  The foldback point is defined using a decimal that indicates some fraction\n\t * of the length of the arrow and has a default value of 0.623.  A foldback point value of 1 would mean that the arrow had a straight line\n\t * across the tail.  \n\t */\n\t/*\n\t * Function: Constructor\n\t * \n\t * Parameters:\n\t * \n\t * \tlength - distance in pixels from head to tail baseline. default 20.\n\t * \twidth - width in pixels of the tail baseline. default 20.\n\t * \tfillStyle - style to use when filling the arrow.  defaults to \"black\".\n\t * \tstrokeStyle - style to use when stroking the arrow. defaults to null, which means the arrow is not stroked.\n\t * \tlineWidth - line width to use when stroking the arrow. defaults to 1, but only used if strokeStyle is not null.\n\t * \tfoldback - distance (as a decimal from 0 to 1 inclusive) along the length of the arrow marking the point the tail points should fold back to.  defaults to 0.623.\n\t * \tlocation - distance (as a decimal from 0 to 1 inclusive) marking where the arrow should sit on the connector. defaults to 0.5.\n\t * \tdirection - indicates the direction the arrow points in. valid values are -1 and 1; 1 is default.\n\t */\n\tjsPlumb.Overlays.Arrow = function(params) {\n\t\tthis.type = \"Arrow\";\n\t\tAbstractOverlay.apply(this, arguments);\n        this.isAppendedAtTopLevel = false;\n\t\tparams = params || {};\n\t\tvar _ju = jsPlumbUtil, _jg = Biltong;\n\t\t\n    \tthis.length = params.length || 20;\n    \tthis.width = params.width || 20;\n    \tthis.id = params.id;\n    \tvar direction = (params.direction || 1) < 0 ? -1 : 1,\n    \t    paintStyle = params.paintStyle || { lineWidth:1 },\n    \t    // how far along the arrow the lines folding back in come to. default is 62.3%.\n    \t    foldback = params.foldback || 0.623;\n    \t    \t\n    \tthis.computeMaxSize = function() { return self.width * 1.5; };    \t\n    \tthis.draw = function(component, currentConnectionPaintStyle) {\n\n            var hxy, mid, txy, tail, cxy;\n            if (component.pointAlongPathFrom) {\n\n                if (_ju.isString(this.loc) || this.loc > 1 || this.loc < 0) {                    \n                    var l = parseInt(this.loc, 10),\n                        fromLoc = this.loc < 0 ? 1 : 0;\n                    hxy = component.pointAlongPathFrom(fromLoc, l, false);\n                    mid = component.pointAlongPathFrom(fromLoc, l - (direction * this.length / 2), false);\n                    txy = _jg.pointOnLine(hxy, mid, this.length);\n                }\n                else if (this.loc == 1) {                \n\t\t\t\t\thxy = component.pointOnPath(this.loc);\t\t\t\t\t           \n                    mid = component.pointAlongPathFrom(this.loc, -(this.length));\n\t\t\t\t\ttxy = _jg.pointOnLine(hxy, mid, this.length);\n\t\t\t\t\t\n\t\t\t\t\tif (direction == -1) {\n\t\t\t\t\t\tvar _ = txy;\n\t\t\t\t\t\ttxy = hxy;\n\t\t\t\t\t\thxy = _;\n\t\t\t\t\t}\n                }\n                else if (this.loc === 0) {\t\t\t\t\t                    \n\t\t\t\t\ttxy = component.pointOnPath(this.loc);                    \n\t\t\t\t\tmid = component.pointAlongPathFrom(this.loc, this.length);                    \n\t\t\t\t\thxy = _jg.pointOnLine(txy, mid, this.length);                    \n\t\t\t\t\tif (direction == -1) {\n\t\t\t\t\t\tvar __ = txy;\n\t\t\t\t\t\ttxy = hxy;\n\t\t\t\t\t\thxy = __;\n\t\t\t\t\t}\n                }\n                else {                    \n    \t\t\t    hxy = component.pointAlongPathFrom(this.loc, direction * this.length / 2);\n                    mid = component.pointOnPath(this.loc);\n                    txy = _jg.pointOnLine(hxy, mid, this.length);\n                }\n\n                tail = _jg.perpendicularLineTo(hxy, txy, this.width);\n                cxy = _jg.pointOnLine(hxy, txy, foldback * this.length);    \t\t\t\n    \t\t\t\n    \t\t\tvar d = { hxy:hxy, tail:tail, cxy:cxy },\n    \t\t\t    strokeStyle = paintStyle.strokeStyle || currentConnectionPaintStyle.strokeStyle,\n    \t\t\t    fillStyle = paintStyle.fillStyle || currentConnectionPaintStyle.strokeStyle,\n    \t\t\t    lineWidth = paintStyle.lineWidth || currentConnectionPaintStyle.lineWidth;\n\n                return {\n                    component:component,\n                    d:d,\n                    lineWidth:lineWidth,\n                    strokeStyle:strokeStyle,\n                    fillStyle:fillStyle,\n                    minX:Math.min(hxy.x, tail[0].x, tail[1].x),\n                    maxX:Math.max(hxy.x, tail[0].x, tail[1].x),\n                    minY:Math.min(hxy.y, tail[0].y, tail[1].y),\n                    maxY:Math.max(hxy.y, tail[0].y, tail[1].y)\n                };\n            }\n            else return {component:component, minX:0,maxX:0,minY:0,maxY:0};\n    \t};\n    };    \n    jsPlumbUtil.extend(jsPlumb.Overlays.Arrow, AbstractOverlay);      \n    \n    /*\n     * Class: Overlays.PlainArrow\n\t * \n\t * A basic arrow.  This is in fact just one instance of the more generic case in which the tail folds back on itself to some\n\t * point along the length of the arrow: in this case, that foldback point is the full length of the arrow.  so it just does\n\t * a 'call' to Arrow with foldback set appropriately.       \n\t */\n    /*\n     * Function: Constructor\n     * See <Overlays.Arrow> for allowed parameters for this overlay.\n     */\n    jsPlumb.Overlays.PlainArrow = function(params) {\n    \tparams = params || {};    \t\n    \tvar p = jsPlumb.extend(params, {foldback:1});\n    \tjsPlumb.Overlays.Arrow.call(this, p);\n    \tthis.type = \"PlainArrow\";\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.PlainArrow, jsPlumb.Overlays.Arrow);\n        \n    /*\n     * Class: Overlays.Diamond\n     * \n\t * A diamond. Like PlainArrow, this is a concrete case of the more generic case of the tail points converging on some point...it just\n\t * happens that in this case, that point is greater than the length of the the arrow.    \n\t * \n\t *      this could probably do with some help with positioning...due to the way it reuses the Arrow paint code, what Arrow thinks is the\n\t *      center is actually 1/4 of the way along for this guy.  but we don't have any knowledge of pixels at this point, so we're kind of\n\t *      stuck when it comes to helping out the Arrow class. possibly we could pass in a 'transpose' parameter or something. the value\n\t *      would be -l/4 in this case - move along one quarter of the total length.\n\t */\n    /*\n     * Function: Constructor\n     * See <Overlays.Arrow> for allowed parameters for this overlay.\n     */\n    jsPlumb.Overlays.Diamond = function(params) {\n    \tparams = params || {};    \t\n    \tvar l = params.length || 40,\n    \t    p = jsPlumb.extend(params, {length:l/2, foldback:2});\n    \tjsPlumb.Overlays.Arrow.call(this, p);\n    \tthis.type = \"Diamond\";\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.Diamond, jsPlumb.Overlays.Arrow);\n\n    var _getDimensions = function(component, forceRefresh) {\n        if (component._jsPlumb.cachedDimensions == null || forceRefresh)\n            component._jsPlumb.cachedDimensions = component.getDimensions();\n        return component._jsPlumb.cachedDimensions;\n    };      \n\t\n\t// abstract superclass for overlays that add an element to the DOM.\n    var AbstractDOMOverlay = function(params) {\n        jsPlumb.jsPlumbUIComponent.apply(this, arguments);\n    \tAbstractOverlay.apply(this, arguments);\n\n        // hand off fired events to associated component.\n        var _f = this.fire;\n        this.fire = function() {\n            _f.apply(this, arguments);\n            if (this.component) this.component.fire.apply(this.component, arguments);\n        };\n\n\t\tthis.id = params.id;\n        this._jsPlumb.div = null;\n        this._jsPlumb.initialised = false;\n        this._jsPlumb.component = params.component;\n        this._jsPlumb.cachedDimensions = null;\n        this._jsPlumb.create = params.create;\n        this._jsPlumb.initiallyInvisible = params.visible === false;\n\n\t\tthis.getElement = function() {\n\t\t\tif (this._jsPlumb.div == null) {\n                var div = this._jsPlumb.div = jsPlumb.getDOMElement(this._jsPlumb.create(this._jsPlumb.component));\n                div.style.position   =   \"absolute\";     \n                div.className = this._jsPlumb.instance.overlayClass + \" \" +\n                    (this.cssClass ? this.cssClass :\n                        params.cssClass ? params.cssClass : \"\");\n                this._jsPlumb.instance.appendElement(div);\n                this._jsPlumb.instance.getId(div);\n                this.canvas = div;\n\n                // in IE the top left corner is what it placed at the desired location.  This will not\n                // be fixed. IE8 is not going to be supported for much longer.\n                var ts = \"translate(-50%, -50%)\";\n                div.style.webkitTransform = ts;\n                div.style.mozTransform = ts;\n                div.style.msTransform = ts;\n                div.style.oTransform = ts;\n                div.style.transform = ts;\n\n                // write the related component into the created element\n                div._jsPlumb = this;\n\n                if (params.visible === false)\n                    div.style.display = \"none\";\n\t\t\t}\n    \t\treturn this._jsPlumb.div;\n    \t};\n\n\t\tthis.draw = function(component, currentConnectionPaintStyle, absolutePosition) {\n\t    \tvar td = _getDimensions(this);\n\t    \tif (td != null && td.length == 2) {\n\t\t\t\tvar cxy = { x:0,y:0 };\n\n                // absolutePosition would have been set by a call to connection.setAbsoluteOverlayPosition.\n                if (absolutePosition) {\n                    cxy = { x:absolutePosition[0], y:absolutePosition[1] };\n                }\n                else if (component.pointOnPath) {\n                    var loc = this.loc, absolute = false;\n                    if (jsPlumbUtil.isString(this.loc) || this.loc < 0 || this.loc > 1) {\n                        loc = parseInt(this.loc, 10);\n                        absolute = true;\n                    }\n                    cxy = component.pointOnPath(loc, absolute);  // a connection\n                }\n                else {\n                    var locToUse = this.loc.constructor == Array ? this.loc : this.endpointLoc;\n                    cxy = { x:locToUse[0] * component.w,\n                            y:locToUse[1] * component.h };\n                } \n\n\t\t\t\tvar minx = cxy.x - (td[0] / 2),\n\t\t\t\t    miny = cxy.y - (td[1] / 2);\n\n                return {\n                    component:component, \n                    d:{ minx:minx, miny:miny, td:td, cxy:cxy },\n                    minX:minx, \n                    maxX:minx + td[0], \n                    minY:miny, \n                    maxY:miny + td[1]\n                };\n        \t}\n\t    \telse return {minX:0,maxX:0,minY:0,maxY:0};\n\t    };\n\t};\n    jsPlumbUtil.extend(AbstractDOMOverlay, [jsPlumb.jsPlumbUIComponent, AbstractOverlay], {\n        getDimensions : function() {\n// still support the old way, for now, for IE8. But from 2.0.0 this whole method will be gone. \n            return jsPlumbUtil.oldIE ? jsPlumb.getSize(this.getElement()) : [1,1];\n        },\n        setVisible : function(state) {\n            this._jsPlumb.div.style.display = state ? \"block\" : \"none\";\n            // if initially invisible, dimensions are 0,0 and never get updated\n            if (state && this._jsPlumb.initiallyInvisible) {\n                _getDimensions(this, true);\n                this.component.repaint();\n                this._jsPlumb.initiallyInvisible = false;\n            }\n        },\n        /*\n         * Function: clearCachedDimensions\n         * Clears the cached dimensions for the label. As a performance enhancement, label dimensions are\n         * cached from 1.3.12 onwards. The cache is cleared when you change the label text, of course, but\n         * there are other reasons why the text dimensions might change - if you make a change through CSS, for\n         * example, you might change the font size.  in that case you should explicitly call this method.\n         */\n        clearCachedDimensions : function() {\n            this._jsPlumb.cachedDimensions = null;\n        },\n        cleanup : function() {\n            if (this._jsPlumb.div != null) {\n                this._jsPlumb.div._jsPlumb = null;\n                this._jsPlumb.instance.removeElement(this._jsPlumb.div);\n            }\n        },\n        computeMaxSize : function() {\n            var td = _getDimensions(this);\n            return Math.max(td[0], td[1]);\n        },\n        paint : function(p, containerExtents) {\n            if (!this._jsPlumb.initialised) {\n                this.getElement();\n                p.component.appendDisplayElement(this._jsPlumb.div);\n                this._jsPlumb.initialised = true;\n            }\n            this._jsPlumb.div.style.left = (p.component.x + p.d.minx) + \"px\";\n            this._jsPlumb.div.style.top = (p.component.y + p.d.miny) + \"px\";\n        }\n    });\n\t\n\t/*\n     * Class: Overlays.Custom\n     * A Custom overlay. You supply a 'create' function which returns some DOM element, and jsPlumb positions it.\n     * The 'create' function is passed a Connection or Endpoint.\n     */\n    /*\n     * Function: Constructor\n     * \n     * Parameters:\n     * \tcreate - function for jsPlumb to call that returns a DOM element.\n     * \tlocation - distance (as a decimal from 0 to 1 inclusive) marking where the label should sit on the connector. defaults to 0.5.\n     * \tid - optional id to use for later retrieval of this overlay.\n     * \t\n     */\n    jsPlumb.Overlays.Custom = function(params) {\n    \tthis.type = \"Custom\";    \t\n    \tAbstractDOMOverlay.apply(this, arguments);\t\t    \t        \t\t    \t    \t\t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.Custom, AbstractDOMOverlay);\n\n    jsPlumb.Overlays.GuideLines = function() {\n        var self = this;\n        self.length = 50;\n        self.lineWidth = 5;\n        this.type = \"GuideLines\";\n        AbstractOverlay.apply(this, arguments);\n        jsPlumb.jsPlumbUIComponent.apply(this, arguments);\n        this.draw = function(connector, currentConnectionPaintStyle) {\n\n            var head = connector.pointAlongPathFrom(self.loc, self.length / 2),\n                mid = connector.pointOnPath(self.loc),\n                tail = Biltong.pointOnLine(head, mid, self.length),\n                tailLine = Biltong.perpendicularLineTo(head, tail, 40),\n                headLine = Biltong.perpendicularLineTo(tail, head, 20);\n\n            return {\n                connector:connector,\n                head:head,\n                tail:tail,\n                headLine:headLine,\n                tailLine:tailLine,                \n                minX:Math.min(head.x, tail.x, headLine[0].x, headLine[1].x), \n                minY:Math.min(head.y, tail.y, headLine[0].y, headLine[1].y), \n                maxX:Math.max(head.x, tail.x, headLine[0].x, headLine[1].x), \n                maxY:Math.max(head.y, tail.y, headLine[0].y, headLine[1].y)\n            };\n        };\n\n       // this.cleanup = function() { };  // nothing to clean up for GuideLines\n    };\n    \n    /*\n     * Class: Overlays.Label\n     \n     */\n    /*\n     * Function: Constructor\n     * \n     * Parameters:\n     * \tcssClass - optional css class string to append to css class. This string is appended \"as-is\", so you can of course have multiple classes\n     *             defined.  This parameter is preferred to using labelStyle, borderWidth and borderStyle.\n     * \tlabel - the label to paint.  May be a string or a function that returns a string.  Nothing will be painted if your label is null or your\n     *         label function returns null.  empty strings _will_ be painted.\n     * \tlocation - distance (as a decimal from 0 to 1 inclusive) marking where the label should sit on the connector. defaults to 0.5.\n     * \tid - optional id to use for later retrieval of this overlay.\n     * \n     * \t\n     */\n    jsPlumb.Overlays.Label =  function(params) {\t\t   \n\t\tthis.labelStyle = params.labelStyle;\n        \n        var labelWidth = null, labelHeight =  null, labelText = null, labelPadding = null;\n\t\tthis.cssClass = this.labelStyle != null ? this.labelStyle.cssClass : null;\n\t\tvar p = jsPlumb.extend({\n            create : function() {\n                return document.createElement(\"div\");\n            }}, params);\n    \tjsPlumb.Overlays.Custom.call(this, p);\n\t\tthis.type = \"Label\";    \t\n        this.label = params.label || \"\";\n        this.labelText = null;\n        if (this.labelStyle) {\n            var el = this.getElement();            \n            this.labelStyle.font = this.labelStyle.font || \"12px sans-serif\";\n            el.style.font = this.labelStyle.font;\n            el.style.color = this.labelStyle.color || \"black\";\n            if (this.labelStyle.fillStyle) el.style.background = this.labelStyle.fillStyle;\n            if (this.labelStyle.borderWidth > 0) {\n                var dStyle = this.labelStyle.borderStyle ? this.labelStyle.borderStyle : \"black\";\n                el.style.border = this.labelStyle.borderWidth  + \"px solid \" + dStyle;\n            }\n            if (this.labelStyle.padding) el.style.padding = this.labelStyle.padding;            \n        }\n\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.Label, jsPlumb.Overlays.Custom, {\n        cleanup:function() {\n            this.div = null;\n            this.label = null;\n            this.labelText = null;\n            this.cssClass = null;\n            this.labelStyle = null;\n        },\n        getLabel : function() {\n            return this.label;\n        },\n        /*\n         * Function: setLabel\n         * sets the label's, um, label.  you would think i'd call this function\n         * 'setText', but you can pass either a Function or a String to this, so\n         * it makes more sense as 'setLabel'. This uses innerHTML on the label div, so keep\n         * that in mind if you need escaped HTML.\n         */\n        setLabel : function(l) {\n            this.label = l;\n            this.labelText = null;\n            this.clearCachedDimensions();\n            this.update();\n            this.component.repaint();\n        },\n        getDimensions : function() {                \n            this.update();\n            return AbstractDOMOverlay.prototype.getDimensions.apply(this, arguments);\n        },\n        update : function() {\n            if (typeof this.label == \"function\") {\n                var lt = this.label(this);\n                this.getElement().innerHTML = lt.replace(/\\r\\n/g, \"<br/>\");\n            }\n            else {\n                if (this.labelText == null) {\n                    this.labelText = this.label;\n                    this.getElement().innerHTML = this.labelText.replace(/\\r\\n/g, \"<br/>\");\n                }\n            }\n        }\n    });\t\t\n\n // ********************************* END OF OVERLAY DEFINITIONS ***********************************************************************\n    \n})();\n\n/*\n * jsPlumb\n *\n * Title:jsPlumb 1.7.2\n *\n * Provides a way to visually connect elements on an HTML page, using SVG or VML.\n *\n * This file contains the base class for library adapters. From 1.7.2 onwards all event management internal to jsPlumb is handled\n * through Mottle, regardless of the underlying library. Dragging - and the events associated with it - is still handled\n * by the library.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n *\n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n *\n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n    \"use strict\";\n\n    var _getEventManager = function(instance) {\n        var e = instance._mottle;\n        if (!e) {\n            e = instance._mottle = new Mottle();\n        }\n        return e;\n    };\n\n    jsPlumb.extend(jsPlumbInstance.prototype, {\n        getEventManager:function() {\n            return _getEventManager(this);\n        },\n        //           EVENTS\n        // e.originalEvent is for jQuery; in Vanilla jsPlumb we get the native event.\n\n        on : function(el, event, callback) {\n            // TODO: here we would like to map the tap event if we know its\n            // an internal bind to a click. we have to know its internal because only\n            // then can we be sure that the UP event wont be consumed (tap is a synthesized\n            // event from a mousedown followed by a mouseup).\n            //event = { \"click\":\"tap\", \"dblclick\":\"dbltap\"}[event] || event;\n            this.getEventManager().on.apply(this, arguments);\n        },\n        off : function(el, event, callback) {\n            this.getEventManager().off.apply(this, arguments);\n        }\n    });\n\n\n}).call(this);\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the 'flowchart' connectors, consisting of vertical and horizontal line segments.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n    \n    \"use strict\";\n   \n    /**\n     * Function: Constructor\n     * \n     * Parameters:\n     * \tstub - minimum length for the stub at each end of the connector. This can be an integer, giving a value for both ends of the connections, \n     * or an array of two integers, giving separate values for each end. The default is an integer with value 30 (pixels). \n     *  gap  - gap to leave between the end of the connector and the element on which the endpoint resides. if you make this larger than stub then you will see some odd looking behaviour.  \n                Like stub, this can be an array or a single value. defaults to 0 pixels for each end.     \n     * cornerRadius - optional, defines the radius of corners between segments. defaults to 0 (hard edged corners).\n     * alwaysRespectStubs - defaults to false. whether or not the connectors should always draw the stub, or, if the two elements\n                            are in close proximity to each other (closer than the sum of the two stubs), to adjust the stubs.\n     */\n    var Flowchart = function(params) {\n        this.type = \"Flowchart\";\n        params = params || {};\n        params.stub = params.stub == null ? 30 : params.stub;\n        var self = this,\n            _super =  jsPlumb.Connectors.AbstractConnector.apply(this, arguments),\t\t\n            midpoint = params.midpoint == null ? 0.5 : params.midpoint,\n            points = [], segments = [],\n            grid = params.grid,\n            alwaysRespectStubs = params.alwaysRespectStubs,\n            userSuppliedSegments = null,\n            lastx = null, lasty = null, lastOrientation,\t\n            cornerRadius = params.cornerRadius != null ? params.cornerRadius : 0,\t\n            sgn = function(n) { return n < 0 ? -1 : n === 0 ? 0 : 1; },            \n            /**\n             * helper method to add a segment.\n             */\n            addSegment = function(segments, x, y, paintInfo) {\n                if (lastx == x && lasty == y) return;\n                var lx = lastx == null ? paintInfo.sx : lastx,\n                    ly = lasty == null ? paintInfo.sy : lasty,\n                    o = lx == x ? \"v\" : \"h\",\n                    sgnx = sgn(x - lx),\n                    sgny = sgn(y - ly);\n                    \n                lastx = x;\n                lasty = y;\t\t\t\t    \t\t                \n                segments.push([lx, ly, x, y, o, sgnx, sgny]);\n            },\n            segLength = function(s) {\n                return Math.sqrt(Math.pow(s[0] - s[2], 2) + Math.pow(s[1] - s[3], 2));    \n            },\n            _cloneArray = function(a) { var _a = []; _a.push.apply(_a, a); return _a;},\n            updateMinMax = function(a1) {\n                self.bounds.minX = Math.min(self.bounds.minX, a1[2]);\n                self.bounds.maxX = Math.max(self.bounds.maxX, a1[2]);\n                self.bounds.minY = Math.min(self.bounds.minY, a1[3]);\n                self.bounds.maxY = Math.max(self.bounds.maxY, a1[3]);    \n            },\n            writeSegments = function(conn, segments, paintInfo) {\n                var current, next;                \n                for (var i = 0; i < segments.length - 1; i++) {\n                    \n                    current = current || _cloneArray(segments[i]);\n                    next = _cloneArray(segments[i + 1]);\n                    if (cornerRadius > 0 && current[4] != next[4]) {\n                        var radiusToUse = Math.min(cornerRadius, segLength(current), segLength(next));\n                        // right angle. adjust current segment's end point, and next segment's start point.\n                        current[2] -= current[5] * radiusToUse;\n                        current[3] -= current[6] * radiusToUse;\n                        next[0] += next[5] * radiusToUse;\n                        next[1] += next[6] * radiusToUse;\t\t\t\t\t\t\t\t\t\t\t\t\t\t                         \t\t\t\n                        var ac = (current[6] == next[5] && next[5] == 1) ||\n                                 ((current[6] == next[5] && next[5] === 0) && current[5] != next[6]) ||\n                                 (current[6] == next[5] && next[5] == -1),\n                            sgny = next[1] > current[3] ? 1 : -1,\n                            sgnx = next[0] > current[2] ? 1 : -1,\n                            sgnEqual = sgny == sgnx,\n                            cx = (sgnEqual && ac || (!sgnEqual && !ac)) ? next[0] : current[2],\n                            cy = (sgnEqual && ac || (!sgnEqual && !ac)) ? current[3] : next[1];                                                        \n                        \n                        _super.addSegment(conn, \"Straight\", {\n                            x1:current[0], y1:current[1], x2:current[2], y2:current[3]\n                        });\n                            \n                        _super.addSegment(conn, \"Arc\", {\n                            r:radiusToUse, \n                            x1:current[2], \n                            y1:current[3], \n                            x2:next[0], \n                            y2:next[1],\n                            cx:cx,\n                            cy:cy,\n                            ac:ac\n                        });\t                                            \n                    }\n                    else {                 \n                        // dx + dy are used to adjust for line width.\n                        var dx = (current[2] == current[0]) ? 0 : (current[2] > current[0]) ? (paintInfo.lw / 2) : -(paintInfo.lw / 2),\n                            dy = (current[3] == current[1]) ? 0 : (current[3] > current[1]) ? (paintInfo.lw / 2) : -(paintInfo.lw / 2);\n                        _super.addSegment(conn, \"Straight\", {\n                            x1:current[0]- dx, y1:current[1]-dy, x2:current[2] + dx, y2:current[3] + dy\n                        });\n                    }                    \n                    current = next;\n                }\n                if (next != null) {\n                    // last segment\n                    _super.addSegment(conn, \"Straight\", {\n                        x1:next[0], y1:next[1], x2:next[2], y2:next[3]\n                    });                             \n                }\n            };\n        \n        this.setSegments = function(s) {\n            userSuppliedSegments = s;\n        };\n        \n        this.isEditable = function() { return true; };\n        \n        /*\n            Function: getOriginalSegments\n            Gets the segments before the addition of rounded corners. This is used by the flowchart\n            connector editor, since it only wants to concern itself with the original segments.\n        */\n        this.getOriginalSegments = function() {\n            return userSuppliedSegments || segments;\n        };\n        \n        this._compute = function(paintInfo, params) {\n            \n            if (params.clearEdits)\n                userSuppliedSegments = null;\n            \n            if (userSuppliedSegments != null) {\n                writeSegments(this, userSuppliedSegments, paintInfo);                \n                return;\n            }\n            \n            segments = [];\n            lastx = null; lasty = null;\n            lastOrientation = null;          \n            \n            var midx = paintInfo.startStubX + ((paintInfo.endStubX - paintInfo.startStubX) * midpoint),\n                midy = paintInfo.startStubY + ((paintInfo.endStubY - paintInfo.startStubY) * midpoint);                                                                                                    \n    \n            var findClearedLine = function(start, mult, anchorPos, dimension) {\n                    return start + (mult * (( 1 - anchorPos) * dimension) + _super.maxStub);\n                },\n                orientations = { x:[ 0, 1 ], y:[ 1, 0 ] },\n                commonStubCalculator = function(axis) {\n                    return [ paintInfo.startStubX, paintInfo.startStubY, paintInfo.endStubX, paintInfo.endStubY ];                    \n                },\n                stubCalculators = {\n                    perpendicular:commonStubCalculator,\n                    orthogonal:commonStubCalculator,\n                    opposite:function(axis) {  \n                        var pi = paintInfo,\n                            idx = axis == \"x\" ? 0 : 1, \n                            areInProximity = {\n                                \"x\":function() {                                    \n                                    return ( (pi.so[idx] == 1 && ( \n                                        ( (pi.startStubX > pi.endStubX) && (pi.tx > pi.startStubX) ) ||\n                                        ( (pi.sx > pi.endStubX) && (pi.tx > pi.sx))))) ||\n\n                                        ( (pi.so[idx] == -1 && ( \n                                            ( (pi.startStubX < pi.endStubX) && (pi.tx < pi.startStubX) ) ||\n                                            ( (pi.sx < pi.endStubX) && (pi.tx < pi.sx)))));\n                                },\n                                \"y\":function() {                                     \n                                    return ( (pi.so[idx] == 1 && ( \n                                        ( (pi.startStubY > pi.endStubY) && (pi.ty > pi.startStubY) ) ||\n                                        ( (pi.sy > pi.endStubY) && (pi.ty > pi.sy))))) ||\n\n                                        ( (pi.so[idx] == -1 && ( \n                                        ( (pi.startStubY < pi.endStubY) && (pi.ty < pi.startStubY) ) ||\n                                        ( (pi.sy < pi.endStubY) && (pi.ty < pi.sy)))));\n                                }\n                            };\n\n                        if (!alwaysRespectStubs && areInProximity[axis]()) {                   \n                            return {\n                                \"x\":[(paintInfo.sx + paintInfo.tx) / 2, paintInfo.startStubY, (paintInfo.sx + paintInfo.tx) / 2, paintInfo.endStubY],\n                                \"y\":[paintInfo.startStubX, (paintInfo.sy + paintInfo.ty) / 2, paintInfo.endStubX, (paintInfo.sy + paintInfo.ty) / 2]\n                            }[axis];\n                        }\n                        else {\n                            return [ paintInfo.startStubX, paintInfo.startStubY, paintInfo.endStubX, paintInfo.endStubY ];   \n                        }\n                    }\n                },\n                lineCalculators = {\n                    perpendicular : function(axis, ss, oss, es, oes) {\n                        var pi = paintInfo, \n                            sis = {\n                                x:[ [ [ 1,2,3,4 ], null, [ 2,1,4,3 ] ], null, [ [ 4,3,2,1 ], null, [ 3,4,1,2 ] ] ],\n                                y:[ [ [ 3,2,1,4 ], null, [ 2,3,4,1 ] ], null, [ [ 4,1,2,3 ], null, [ 1,4,3,2 ] ] ]\n                            },\n                            stubs = { \n                                x:[ [ pi.startStubX, pi.endStubX ] , null, [ pi.endStubX, pi.startStubX ] ],\n                                y:[ [ pi.startStubY, pi.endStubY ] , null, [ pi.endStubY, pi.startStubY ] ]\n                            },\n                            midLines = {\n                                x:[ [ midx, pi.startStubY ], [ midx, pi.endStubY ] ],\n                                y:[ [ pi.startStubX, midy ], [ pi.endStubX, midy ] ]\n                            },\n                            linesToEnd = {\n                                x:[ [ pi.endStubX, pi.startStubY ] ],\n                                y:[ [ pi.startStubX, pi.endStubY ] ]\n                            },\n                            startToEnd = {\n                                x:[ [ pi.startStubX, pi.endStubY ], [ pi.endStubX, pi.endStubY ] ],        \n                                y:[ [ pi.endStubX, pi.startStubY ], [ pi.endStubX, pi.endStubY ] ]\n                            },\n                            startToMidToEnd = {\n                                x:[ [ pi.startStubX, midy ], [ pi.endStubX, midy ], [ pi.endStubX, pi.endStubY ] ],\n                                y:[ [ midx, pi.startStubY ], [ midx, pi.endStubY ], [ pi.endStubX, pi.endStubY ] ]\n                            },\n                            otherStubs = {\n                                x:[ pi.startStubY, pi.endStubY ],\n                                y:[ pi.startStubX, pi.endStubX ]                                    \n                            },\n                            soIdx = orientations[axis][0], toIdx = orientations[axis][1],\n                            _so = pi.so[soIdx] + 1,\n                            _to = pi.to[toIdx] + 1,\n                            otherFlipped = (pi.to[toIdx] == -1 && (otherStubs[axis][1] < otherStubs[axis][0])) || (pi.to[toIdx] == 1 && (otherStubs[axis][1] > otherStubs[axis][0])),\n                            stub1 = stubs[axis][_so][0],\n                            stub2 = stubs[axis][_so][1],\n                            segmentIndexes = sis[axis][_so][_to];\n\n                        if (pi.segment == segmentIndexes[3] || (pi.segment == segmentIndexes[2] && otherFlipped)) {\n                            return midLines[axis];       \n                        }\n                        else if (pi.segment == segmentIndexes[2] && stub2 < stub1) {\n                            return linesToEnd[axis];\n                        }\n                        else if ((pi.segment == segmentIndexes[2] && stub2 >= stub1) || (pi.segment == segmentIndexes[1] && !otherFlipped)) {\n                            return startToMidToEnd[axis];\n                        }\n                        else if (pi.segment == segmentIndexes[0] || (pi.segment == segmentIndexes[1] && otherFlipped)) {\n                            return startToEnd[axis];  \n                        }                                \n                    },\n                    orthogonal : function(axis, startStub, otherStartStub, endStub, otherEndStub) {                    \n                        var pi = paintInfo,                                            \n                            extent = {\n                                \"x\":pi.so[0] == -1 ? Math.min(startStub, endStub) : Math.max(startStub, endStub),\n                                \"y\":pi.so[1] == -1 ? Math.min(startStub, endStub) : Math.max(startStub, endStub)\n                            }[axis];\n                                                \n                        return {\n                            \"x\":[ [ extent, otherStartStub ],[ extent, otherEndStub ], [ endStub, otherEndStub ] ],\n                            \"y\":[ [ otherStartStub, extent ], [ otherEndStub, extent ], [ otherEndStub, endStub ] ]\n                        }[axis];                    \n                    },\n                    opposite : function(axis, ss, oss, es, oes) {                                                \n                        var pi = paintInfo,\n                            otherAxis = {\"x\":\"y\",\"y\":\"x\"}[axis], \n                            dim = {\"x\":\"height\",\"y\":\"width\"}[axis],\n                            comparator = pi[\"is\" + axis.toUpperCase() + \"GreaterThanStubTimes2\"];\n\n                        if (params.sourceEndpoint.elementId == params.targetEndpoint.elementId) {\n                            var _val = oss + ((1 - params.sourceEndpoint.anchor[otherAxis]) * params.sourceInfo[dim]) + _super.maxStub;\n                            return {\n                                \"x\":[ [ ss, _val ], [ es, _val ] ],\n                                \"y\":[ [ _val, ss ], [ _val, es ] ]\n                            }[axis];\n                            \n                        }                                                        \n                        else if (!comparator || (pi.so[idx] == 1 && ss > es) || (pi.so[idx] == -1 && ss < es)) {                                            \n                            return {\n                                \"x\":[[ ss, midy ], [ es, midy ]],\n                                \"y\":[[ midx, ss ], [ midx, es ]]\n                            }[axis];\n                        }\n                        else if ((pi.so[idx] == 1 && ss < es) || (pi.so[idx] == -1 && ss > es)) {\n                            return {\n                                \"x\":[[ midx, pi.sy ], [ midx, pi.ty ]],\n                                \"y\":[[ pi.sx, midy ], [ pi.tx, midy ]]\n                            }[axis];\n                        }                        \n                    }\n                };\n\n            var stubs = stubCalculators[paintInfo.anchorOrientation](paintInfo.sourceAxis),\n                idx = paintInfo.sourceAxis == \"x\" ? 0 : 1,\n                oidx = paintInfo.sourceAxis == \"x\" ? 1 : 0,                            \n                ss = stubs[idx],\n                oss = stubs[oidx],\n                es = stubs[idx + 2],\n                oes = stubs[oidx + 2];\n\n            // add the start stub segment.\n            addSegment(segments, stubs[0], stubs[1], paintInfo);           \n\n            // compute the rest of the line\n            var p = lineCalculators[paintInfo.anchorOrientation](paintInfo.sourceAxis, ss, oss, es, oes);            \n            if (p) {\n                for (var i = 0; i < p.length; i++) {                \t\n                    addSegment(segments, p[i][0], p[i][1], paintInfo);\n                }\n            }          \n            \n            // line to end stub\n            addSegment(segments, stubs[2], stubs[3], paintInfo);\n    \n            // end stub to end\n            addSegment(segments, paintInfo.tx, paintInfo.ty, paintInfo);               \n            \n            writeSegments(this, segments, paintInfo);                            \n        };\t\n\n        this.getPath = function() {\n            var _last = null, _lastAxis = null, s = [], segs = userSuppliedSegments || segments;\n            for (var i = 0; i < segs.length; i++) {\n                var seg = segs[i], axis = seg[4], axisIndex = (axis == \"v\" ? 3 : 2);\n                if (_last != null && _lastAxis === axis) {\n                    _last[axisIndex] = seg[axisIndex];                            \n                }\n                else {\n                    if (seg[0] != seg[2] || seg[1] != seg[3]) {\n                        s.push({\n                            start:[ seg[0], seg[1] ],\n                            end:[ seg[2], seg[3] ]\n                        });                    \n                        _last = seg;\n                        _lastAxis = seg[4];\n                    }\n                }\n            }\n            return s;\n        };\t\n\n        this.setPath = function(path) {\n            userSuppliedSegments = [];\n            for (var i = 0; i < path.length; i++) {\n                 var lx = path[i].start[0],\n                    ly = path[i].start[1],\n                    x = path[i].end[0],\n                    y = path[i].end[1],\n                    o = lx == x ? \"v\" : \"h\",\n                    sgnx = sgn(x - lx),\n                    sgny = sgn(y - ly);\n\n                userSuppliedSegments.push([lx, ly, x, y, o, sgnx, sgny]);\n            }\n        };\n    };\n\n    jsPlumbUtil.extend(Flowchart, jsPlumb.Connectors.AbstractConnector);\n    jsPlumb.registerConnectorType(Flowchart, \"Flowchart\");\n})();\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the state machine connectors.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n ;(function() {\n\t \n\t\"use strict\";\n\n\tvar Line = function(x1, y1, x2, y2) {\n\n\t\tthis.m = (y2 - y1) / (x2 - x1);\n\t\tthis.b = -1 * ((this.m * x1) - y1);\n\t\n\t\tthis.rectIntersect = function(x,y,w,h) {\n\t\t\tvar results = [], xInt, yInt;\n\t\t\n\t\t\t// \ttry top face\n\t\t\t// \tthe equation of the top face is y = (0 * x) + b; y = b.\n\t\t\txInt = (y - this.b) / this.m;\n\t\t\t// test that the X value is in the line's range.\n\t\t\tif (xInt >= x && xInt <= (x + w)) results.push([ xInt, (this.m * xInt) + this.b ]);\n\t\t\n\t\t\t// try right face\n\t\t\tyInt = (this.m * (x + w)) + this.b;\n\t\t\tif (yInt >= y && yInt <= (y + h)) results.push([ (yInt - this.b) / this.m, yInt ]);\n\t\t\n\t\t\t// \tbottom face\n\t\t\txInt = ((y + h) - this.b) / this.m;\n\t\t\t// test that the X value is in the line's range.\n\t\t\tif (xInt >= x && xInt <= (x + w)) results.push([ xInt, (this.m * xInt) + this.b ]);\n\t\t\n\t\t\t// try left face\n\t\t\tyInt = (this.m * x) + this.b;\n\t\t\tif (yInt >= y && yInt <= (y + h)) results.push([ (yInt - this.b) / this.m, yInt ]);\n\n\t\t\tif (results.length == 2) {\n\t\t\t\tvar midx = (results[0][0] + results[1][0]) / 2, midy = (results[0][1] + results[1][1]) / 2;\n\t\t\t\tresults.push([ midx,midy ]);\n\t\t\t\t// now calculate the segment inside the rectangle where the midpoint lies.\n\t\t\t\tvar xseg = midx <= x + (w / 2) ? -1 : 1,\n\t\t\t\t\tyseg = midy <= y + (h / 2) ? -1 : 1;\n\t\t\t\tresults.push([xseg, yseg]);\n\t\t\t\treturn results;\n\t\t\t}\n\t\t\n\t\t\treturn null;\n\n\t\t};\n\t},\n\t_segment = function(x1, y1, x2, y2) {\n\t\tif (x1 <= x2 && y2 <= y1) return 1;\n\t\telse if (x1 <= x2 && y1 <= y2) return 2;\n\t\telse if (x2 <= x1 && y2 >= y1) return 3;\n\t\treturn 4;\n\t},\n\t\t\n\t\t// the control point we will use depends on the faces to which each end of the connection is assigned, specifically whether or not the\n\t\t// two faces are parallel or perpendicular.  if they are parallel then the control point lies on the midpoint of the axis in which they\n\t\t// are parellel and varies only in the other axis; this variation is proportional to the distance that the anchor points lie from the\n\t\t// center of that face.  if the two faces are perpendicular then the control point is at some distance from both the midpoints; the amount and\n\t\t// direction are dependent on the orientation of the two elements. 'seg', passed in to this method, tells you which segment the target element\n\t\t// lies in with respect to the source: 1 is top right, 2 is bottom right, 3 is bottom left, 4 is top left.\n\t\t//\n\t\t// sourcePos and targetPos are arrays of info about where on the source and target each anchor is located.  their contents are:\n\t\t//\n\t\t// 0 - absolute x\n\t\t// 1 - absolute y\n\t\t// 2 - proportional x in element (0 is left edge, 1 is right edge)\n\t\t// 3 - proportional y in element (0 is top edge, 1 is bottom edge)\n\t\t// \t\n\t_findControlPoint = function(midx, midy, segment, sourceEdge, targetEdge, dx, dy, distance, proximityLimit) {\n        // TODO (maybe)\n        // - if anchor pos is 0.5, make the control point take into account the relative position of the elements.\n        if (distance <= proximityLimit) return [midx, midy];\n\n        if (segment === 1) {\n            if (sourceEdge[3] <= 0 && targetEdge[3] >= 1) return [ midx + (sourceEdge[2] < 0.5 ? -1 * dx : dx), midy ];\n            else if (sourceEdge[2] >= 1 && targetEdge[2] <= 0) return [ midx, midy + (sourceEdge[3] < 0.5 ? -1 * dy : dy) ];\n            else return [ midx + (-1 * dx) , midy + (-1 * dy) ];\n        }\n        else if (segment === 2) {\n            if (sourceEdge[3] >= 1 && targetEdge[3] <= 0) return [ midx + (sourceEdge[2] < 0.5 ? -1 * dx : dx), midy ];\n            else if (sourceEdge[2] >= 1 && targetEdge[2] <= 0) return [ midx, midy + (sourceEdge[3] < 0.5 ? -1 * dy : dy) ];\n            else return [ midx + (1 * dx) , midy + (-1 * dy) ];\n        }\n        else if (segment === 3) {\n            if (sourceEdge[3] >= 1 && targetEdge[3] <= 0) return [ midx + (sourceEdge[2] < 0.5 ? -1 * dx : dx), midy ];\n            else if (sourceEdge[2] <= 0 && targetEdge[2] >= 1) return [ midx, midy + (sourceEdge[3] < 0.5 ? -1 * dy : dy) ];\n            else return [ midx + (-1 * dx) , midy + (-1 * dy) ];\n        }\n        else if (segment === 4) {\n            if (sourceEdge[3] <= 0 && targetEdge[3] >= 1) return [ midx + (sourceEdge[2] < 0.5 ? -1 * dx : dx), midy ];\n            else if (sourceEdge[2] <= 0 && targetEdge[2] >= 1) return [ midx, midy + (sourceEdge[3] < 0.5 ? -1 * dy : dy) ];\n            else return [ midx + (1 * dx) , midy + (-1 * dy) ];\n        }\n\n\t};\t\n\t\n\t/**\n     * Class: Connectors.StateMachine\n     * Provides 'state machine' connectors.\n     */\n\t/*\n\t * Function: Constructor\n\t * \n\t * Parameters:\n\t * curviness -\tmeasure of how \"curvy\" the connectors will be.  this is translated as the distance that the\n     *                Bezier curve's control point is from the midpoint of the straight line connecting the two\n     *              endpoints, and does not mean that the connector is this wide.  The Bezier curve never reaches\n     *              its control points; they act as gravitational masses. defaults to 10.\n\t * margin\t-\tdistance from element to start and end connectors, in pixels.  defaults to 5.\n\t * proximityLimit  -   sets the distance beneath which the elements are consider too close together to bother\n\t *\t\t\t\t\t\twith fancy curves. by default this is 80 pixels.\n\t * loopbackRadius\t-\tthe radius of a loopback connector.  optional; defaults to 25.\n\t * showLoopback   -   If set to false this tells the connector that it is ok to paint connections whose source and target is the same element with a connector running through the element. The default value for this is true; the connector always makes a loopback connection loop around the element rather than passing through it.\n\t*/\n\tvar StateMachine = function(params) {\n\t\tparams = params || {};\n\t\tthis.type = \"StateMachine\";\n\n\t\tvar self = this,\n\t\t\t_super =  jsPlumb.Connectors.AbstractConnector.apply(this, arguments),\n\t\t\tcurviness = params.curviness || 10,\n\t\t\tmargin = params.margin || 5,\n\t\t\tproximityLimit = params.proximityLimit || 80,\n\t\t\tclockwise = params.orientation && params.orientation === \"clockwise\",\n\t\t\tloopbackRadius = params.loopbackRadius || 25,\n\t\t\tshowLoopback = params.showLoopback !== false;\n\t\t\n\t\tthis._compute = function(paintInfo, params) {\n\t\t\tvar w = Math.abs(params.sourcePos[0] - params.targetPos[0]),\n\t\t\t\th = Math.abs(params.sourcePos[1] - params.targetPos[1]),\n\t\t\t\tx = Math.min(params.sourcePos[0], params.targetPos[0]),\n\t\t\t\ty = Math.min(params.sourcePos[1], params.targetPos[1]);\t\t\t\t\n\t\t\n\t\t\tif (!showLoopback || (params.sourceEndpoint.elementId !== params.targetEndpoint.elementId)) {                            \n\t\t\t\tvar _sx = params.sourcePos[0] < params.targetPos[0] ? 0  : w,\n\t\t\t\t\t_sy = params.sourcePos[1] < params.targetPos[1] ? 0:h,\n\t\t\t\t\t_tx = params.sourcePos[0] < params.targetPos[0] ? w : 0,\n\t\t\t\t\t_ty = params.sourcePos[1] < params.targetPos[1] ? h : 0;\n            \n\t\t\t\t// now adjust for the margin\n\t\t\t\tif (params.sourcePos[2] === 0) _sx -= margin;\n            \tif (params.sourcePos[2] === 1) _sx += margin;\n            \tif (params.sourcePos[3] === 0) _sy -= margin;\n            \tif (params.sourcePos[3] === 1) _sy += margin;\n            \tif (params.targetPos[2] === 0) _tx -= margin;\n            \tif (params.targetPos[2] === 1) _tx += margin;\n            \tif (params.targetPos[3] === 0) _ty -= margin;\n            \tif (params.targetPos[3] === 1) _ty += margin;\n\n            \t//\n\t            // these connectors are quadratic bezier curves, having a single control point. if both anchors \n    \t        // are located at 0.5 on their respective faces, the control point is set to the midpoint and you\n        \t    // get a straight line.  this is also the case if the two anchors are within 'proximityLimit', since\n           \t \t// it seems to make good aesthetic sense to do that. outside of that, the control point is positioned \n           \t \t// at 'curviness' pixels away along the normal to the straight line connecting the two anchors.\n\t            // \n   \t        \t// there may be two improvements to this.  firstly, we might actually support the notion of avoiding nodes\n            \t// in the UI, or at least making a good effort at doing so.  if a connection would pass underneath some node,\n            \t// for example, we might increase the distance the control point is away from the midpoint in a bid to\n            \t// steer it around that node.  this will work within limits, but i think those limits would also be the likely\n            \t// limits for, once again, aesthetic good sense in the layout of a chart using these connectors.\n            \t//\n            \t// the second possible change is actually two possible changes: firstly, it is possible we should gradually\n            \t// decrease the 'curviness' as the distance between the anchors decreases; start tailing it off to 0 at some\n            \t// point (which should be configurable).  secondly, we might slightly increase the 'curviness' for connectors\n            \t// with respect to how far their anchor is from the center of its respective face. this could either look cool,\n            \t// or stupid, and may indeed work only in a way that is so subtle as to have been a waste of time.\n            \t//\n\n\t\t\t\tvar _midx = (_sx + _tx) / 2, _midy = (_sy + _ty) / 2, \n            \t    m2 = (-1 * _midx) / _midy, theta2 = Math.atan(m2),\n            \t    dy =  (m2 == Infinity || m2 == -Infinity) ? 0 : Math.abs(curviness / 2 * Math.sin(theta2)),\n\t\t\t\t    dx =  (m2 == Infinity || m2 == -Infinity) ? 0 : Math.abs(curviness / 2 * Math.cos(theta2)),\n\t\t\t\t    segment = _segment(_sx, _sy, _tx, _ty),\n\t\t\t\t    distance = Math.sqrt(Math.pow(_tx - _sx, 2) + Math.pow(_ty - _sy, 2)),\t\t\t\n\t            \t// calculate the control point.  this code will be where we'll put in a rudimentary element avoidance scheme; it\n\t            \t// will work by extending the control point to force the curve to be, um, curvier.\n\t\t\t\t\t_controlPoint = _findControlPoint(_midx,\n                                                  _midy,\n                                                  segment,\n                                                  params.sourcePos,\n                                                  params.targetPos,\n                                                  curviness, curviness,\n                                                  distance,\n                                                  proximityLimit);\n\n\t\t\t\t_super.addSegment(this, \"Bezier\", {\n\t\t\t\t\tx1:_tx, y1:_ty, x2:_sx, y2:_sy,\n\t\t\t\t\tcp1x:_controlPoint[0], cp1y:_controlPoint[1],\n\t\t\t\t\tcp2x:_controlPoint[0], cp2y:_controlPoint[1]\n\t\t\t\t});\t\t\t\t\n            }\n            else {\n            \t// a loopback connector.  draw an arc from one anchor to the other.            \t\n        \t\tvar x1 = params.sourcePos[0], x2 = params.sourcePos[0], y1 = params.sourcePos[1] - margin, y2 = params.sourcePos[1] - margin, \t\t\t\t\n\t\t\t\t\tcx = x1, cy = y1 - loopbackRadius,\t\t\t\t\n\t\t\t\t\t// canvas sizing stuff, to ensure the whole painted area is visible.\n\t\t\t\t\t_w = 2 * loopbackRadius, \n\t\t\t\t\t_h = 2 * loopbackRadius,\n\t\t\t\t\t_x = cx - loopbackRadius, \n\t\t\t\t\t_y = cy - loopbackRadius;\n\n\t\t\t\tpaintInfo.points[0] = _x;\n\t\t\t\tpaintInfo.points[1] = _y;\n\t\t\t\tpaintInfo.points[2] = _w;\n\t\t\t\tpaintInfo.points[3] = _h;\n\t\t\t\t\n\t\t\t\t// ADD AN ARC SEGMENT.\n\t\t\t\t_super.addSegment(this, \"Arc\", {\n\t\t\t\t\tloopback:true,\n\t\t\t\t\tx1:(x1 - _x) + 4,\n\t\t\t\t\ty1:y1 - _y,\n\t\t\t\t\tstartAngle:0,\n\t\t\t\t\tendAngle: 2 * Math.PI,\n\t\t\t\t\tr:loopbackRadius,\n\t\t\t\t\tac:!clockwise,\n\t\t\t\t\tx2:(x1 - _x) - 4,\n\t\t\t\t\ty2:y1 - _y,\n\t\t\t\t\tcx:cx - _x,\n\t\t\t\t\tcy:cy - _y\n\t\t\t\t});\n            }                           \n        };                        \n\t};\n\tjsPlumb.registerConnectorType(StateMachine, \"StateMachine\");\n})();\n\n/*\n    \t// a possible rudimentary avoidance scheme, old now, perhaps not useful.\n        //      if (avoidSelector) {\n\t\t//\t\t    var testLine = new Line(sourcePos[0] + _sx,sourcePos[1] + _sy,sourcePos[0] + _tx,sourcePos[1] + _ty);\n\t\t//\t\t    var sel = jsPlumb.getSelector(avoidSelector);\n\t\t//\t\t    for (var i = 0; i < sel.length; i++) {\n\t\t//\t\t\t    var id = jsPlumb.getId(sel[i]);\n\t\t//\t\t\t    if (id != sourceEndpoint.elementId && id != targetEndpoint.elementId) {\n\t\t//\t\t\t\t    o = jsPlumb.getOffset(id), s = jsPlumb.getSize(id);\n//\n//\t\t\t\t\t\t    if (o && s) {\n//\t\t\t\t\t\t\t    var collision = testLine.rectIntersect(o.left,o.top,s[0],s[1]);\n//\t\t\t\t\t\t\t    if (collision) {\n\t\t\t\t\t\t\t\t    // set the control point to be a certain distance from the midpoint of the two points that\n\t\t\t\t\t\t\t\t    // the line crosses on the rectangle.\n\t\t\t\t\t\t\t\t    // TODO where will this 75 number come from?\n\t\t\t\t\t//\t\t\t    _controlX = collision[2][0] + (75 * collision[3][0]);\n\t\t\t\t//\t/\t\t\t    _controlY = collision[2][1] + (75 * collision[3][1]);\n//\t\t\t\t\t\t\t    }\n//\t\t\t\t\t\t    }\n\t\t\t\t\t//  }\n\t//\t\t\t    }\n              //}\n    */\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the code for the Bezier connector type.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n\n\tvar Bezier = function(params) {\n\t\tparams = params || {};\n\n\t\tvar _super =  jsPlumb.Connectors.AbstractConnector.apply(this, arguments),\n\t\t\tstub = params.stub || 50,\n\t\t\tmajorAnchor = params.curviness || 150,\n\t\t\tminorAnchor = 10;\n\n\t\tthis.type = \"Bezier\";\n\t\tthis.getCurviness = function() { return majorAnchor; };\n\n\t\tthis._findControlPoint = function(point, sourceAnchorPosition, targetAnchorPosition, sourceEndpoint, targetEndpoint) {\n\t\t\t// determine if the two anchors are perpendicular to each other in their orientation.  we swap the control \n\t\t\t// points around if so (code could be tightened up)\n\t\t\tvar soo = sourceEndpoint.anchor.getOrientation(sourceEndpoint),\n\t\t\t\ttoo = targetEndpoint.anchor.getOrientation(targetEndpoint),\n\t\t\t\tperpendicular = soo[0] != too[0] || soo[1] == too[1],\n\t\t\t\tp = [];\n\n\t\t\tif (!perpendicular) {\n\t\t\t\tif (soo[0] === 0) // X\n\t\t\t\t\tp.push(sourceAnchorPosition[0] < targetAnchorPosition[0] ? point[0] + minorAnchor : point[0] - minorAnchor);\n\t\t\t\telse p.push(point[0] - (majorAnchor * soo[0]));\n\n\t\t\t\tif (soo[1] === 0) // Y\n\t\t\t\t\tp.push(sourceAnchorPosition[1] < targetAnchorPosition[1] ? point[1] + minorAnchor : point[1] - minorAnchor);\n\t\t\t\telse p.push(point[1] + (majorAnchor * too[1]));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (too[0] === 0) // X\n\t\t\t\t\tp.push(targetAnchorPosition[0] < sourceAnchorPosition[0] ? point[0] + minorAnchor : point[0] - minorAnchor);\n\t\t\t\telse p.push(point[0] + (majorAnchor * too[0]));\n\n\t\t\t\tif (too[1] === 0) // Y\n\t\t\t\t\tp.push(targetAnchorPosition[1] < sourceAnchorPosition[1] ? point[1] + minorAnchor : point[1] - minorAnchor);\n\t\t\t\telse p.push(point[1] + (majorAnchor * soo[1]));\n\t\t\t}\n\n\t\t\treturn p;\n\t\t};\n\n\t\tthis._compute = function(paintInfo, p) {\n\n\t\t\tvar sp = p.sourcePos,\n\t\t\t\ttp = p.targetPos,\n\t\t\t\t_w = Math.abs(sp[0] - tp[0]),\n\t\t\t\t_h = Math.abs(sp[1] - tp[1]),\n\t\t\t\t_sx = sp[0] < tp[0] ? _w : 0,\n\t\t\t\t_sy = sp[1] < tp[1] ? _h : 0,\n\t\t\t\t_tx = sp[0] < tp[0] ? 0 : _w,\n\t\t\t\t_ty = sp[1] < tp[1] ? 0 : _h,\n\t\t\t\t_CP = this._findControlPoint([_sx, _sy], sp, tp, p.sourceEndpoint, p.targetEndpoint, paintInfo.so, paintInfo.to),\n\t\t\t\t_CP2 = this._findControlPoint([_tx, _ty], tp, sp, p.targetEndpoint, p.sourceEndpoint, paintInfo.so, paintInfo.to);\n\n\t\t\t_super.addSegment(this, \"Bezier\", {\n\t\t\t\tx1:_sx, y1:_sy, x2:_tx, y2:_ty,\n\t\t\t\tcp1x:_CP[0], cp1y:_CP[1], cp2x:_CP2[0], cp2y:_CP2[1]\n\t\t\t});\n\t\t};\n\t};\n\n\tjsPlumbUtil.extend(Bezier, jsPlumb.Connectors.AbstractConnector);\n\tjsPlumb.registerConnectorType(Bezier, \"Bezier\");\n\n})();\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the SVG renderers.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n;(function() {\n\t\n// ************************** SVG utility methods ********************************************\t\n\n\t\"use strict\";\n\t\n\tvar svgAttributeMap = {\n\t\t\"joinstyle\":\"stroke-linejoin\",\n\t\t\"stroke-linejoin\":\"stroke-linejoin\",\t\t\n\t\t\"stroke-dashoffset\":\"stroke-dashoffset\",\n\t\t\"stroke-linecap\":\"stroke-linecap\"\n\t},\n\tSTROKE_DASHARRAY = \"stroke-dasharray\",\n\tDASHSTYLE = \"dashstyle\",\n\tLINEAR_GRADIENT = \"linearGradient\",\n\tRADIAL_GRADIENT = \"radialGradient\",\n\tDEFS = \"defs\",\n\tFILL = \"fill\",\n\tSTOP = \"stop\",\n\tSTROKE = \"stroke\",\n\tSTROKE_WIDTH = \"stroke-width\",\n\tSTYLE = \"style\",\n\tNONE = \"none\",\n\tJSPLUMB_GRADIENT = \"jsplumb_gradient_\",\n\tLINE_WIDTH = \"lineWidth\",\n\tns = {\n\t\tsvg:\"http://www.w3.org/2000/svg\",\n\t\txhtml:\"http://www.w3.org/1999/xhtml\"\n\t},\n\t_attr = function(node, attributes) {\n\t\tfor (var i in attributes)\n\t\t\tnode.setAttribute(i, \"\" + attributes[i]);\n\t},\t\n\t_node = function(name, attributes) {\n\t\tvar n = document.createElementNS(ns.svg, name);\n\t\tattributes = attributes || {};\n\t\tattributes.version = \"1.1\";\n\t\tattributes.xmlns = ns.xhtml;\n\t\t_attr(n, attributes);\n\t\treturn n;\n\t},\n\t_pos = function(d) { return \"position:absolute;left:\" + d[0] + \"px;top:\" + d[1] + \"px\"; },\t\n\t_clearGradient = function(parent) {\n        // TODO use querySelectorAll here instead?\n\t\tfor (var i = 0; i < parent.childNodes.length; i++) {\n\t\t\tif (parent.childNodes[i].tagName == DEFS || parent.childNodes[i].tagName == LINEAR_GRADIENT || parent.childNodes[i].tagName == RADIAL_GRADIENT)\n\t\t\t\tparent.removeChild(parent.childNodes[i]);\n\t\t}\n\t},\t\t\n\t_updateGradient = function(parent, node, style, dimensions, uiComponent) {\n\t\tvar id = JSPLUMB_GRADIENT + uiComponent._jsPlumb.instance.idstamp();\n\t\t// first clear out any existing gradient\n\t\t_clearGradient(parent);\n\t\t// this checks for an 'offset' property in the gradient, and in the absence of it, assumes\n\t\t// we want a linear gradient. if it's there, we create a radial gradient.\n\t\t// it is possible that a more explicit means of defining the gradient type would be\n\t\t// better. relying on 'offset' means that we can never have a radial gradient that uses\n\t\t// some default offset, for instance.\n\t\t// issue 244 suggested the 'gradientUnits' attribute; without this, straight/flowchart connectors with gradients would\n\t\t// not show gradients when the line was perfectly horizontal or vertical.\n\t\tvar g;\n\t\tif (!style.gradient.offset)\n\t\t\tg = _node(LINEAR_GRADIENT, {id:id, gradientUnits:\"userSpaceOnUse\"});\n\t\telse\n\t\t\tg = _node(RADIAL_GRADIENT, { id:id });\n\t\t\n\t\tvar defs = _node(DEFS);\n\t\tparent.appendChild(defs);\n\t\tdefs.appendChild(g);\n\t\t//parent.appendChild(g);\n\t\t\n\t\t// the svg radial gradient seems to treat stops in the reverse \n\t\t// order to how canvas does it.  so we want to keep all the maths the same, but\n\t\t// iterate the actual style declarations in reverse order, if the x indexes are not in order.\n\t\tfor (var i = 0; i < style.gradient.stops.length; i++) {\n\t\t\tvar styleToUse = uiComponent.segment == 1 ||  uiComponent.segment == 2 ? i: style.gradient.stops.length - 1 - i,\t\t\t\n\t\t\t\tstopColor = jsPlumbUtil.convertStyle(style.gradient.stops[styleToUse][1], true),\n\t\t\t\ts = _node(STOP, {\"offset\":Math.floor(style.gradient.stops[i][0] * 100) + \"%\", \"stop-color\":stopColor});\n\n\t\t\tg.appendChild(s);\n\t\t}\n\t\tvar applyGradientTo = style.strokeStyle ? STROKE : FILL;\n        //node.setAttribute(STYLE, applyGradientTo + \":url(\" + /[^#]+/.exec(document.location.toString()) + \"#\" + id + \")\");\n\t\t//node.setAttribute(STYLE, applyGradientTo + \":url(#\" + id + \")\");\n\t\t//node.setAttribute(applyGradientTo,  \"url(\" + /[^#]+/.exec(document.location.toString()) + \"#\" + id + \")\");\n\t\tnode.setAttribute(applyGradientTo,  \"url(#\" + id + \")\");\n\t},\n\t_applyStyles = function(parent, node, style, dimensions, uiComponent) {\n\t\t\n\t\tnode.setAttribute(FILL, style.fillStyle ? jsPlumbUtil.convertStyle(style.fillStyle, true) : NONE);\n\t\tnode.setAttribute(STROKE, style.strokeStyle ? jsPlumbUtil.convertStyle(style.strokeStyle, true) : NONE);\n\t\t\t\n\t\tif (style.gradient) {\n\t\t\t_updateGradient(parent, node, style, dimensions, uiComponent);\t\t\t\n\t\t}\n\t\telse {\n\t\t\t// make sure we clear any existing gradient\n\t\t\t_clearGradient(parent);\n\t\t\tnode.setAttribute(STYLE, \"\");\n\t\t}\n\t\t\n\t\t\n\t\tif (style.lineWidth) {\n\t\t\tnode.setAttribute(STROKE_WIDTH, style.lineWidth);\n\t\t}\n\t\n\t\t// in SVG there is a stroke-dasharray attribute we can set, and its syntax looks like\n\t\t// the syntax in VML but is actually kind of nasty: values are given in the pixel\n\t\t// coordinate space, whereas in VML they are multiples of the width of the stroked\n\t\t// line, which makes a lot more sense.  for that reason, jsPlumb is supporting both\n\t\t// the native svg 'stroke-dasharray' attribute, and also the 'dashstyle' concept from\n\t\t// VML, which will be the preferred method.  the code below this converts a dashstyle\n\t\t// attribute given in terms of stroke width into a pixel representation, by using the\n\t\t// stroke's lineWidth. \n\t\tif (style[DASHSTYLE] && style[LINE_WIDTH] && !style[STROKE_DASHARRAY]) {\n\t\t\tvar sep = style[DASHSTYLE].indexOf(\",\") == -1 ? \" \" : \",\",\n\t\t\tparts = style[DASHSTYLE].split(sep),\n\t\t\tstyleToUse = \"\";\n\t\t\tparts.forEach(function(p) {\n\t\t\t\tstyleToUse += (Math.floor(p * style.lineWidth) + sep);\n\t\t\t});\n\t\t\tnode.setAttribute(STROKE_DASHARRAY, styleToUse);\n\t\t}\t\t\n\t\telse if(style[STROKE_DASHARRAY]) {\n\t\t\tnode.setAttribute(STROKE_DASHARRAY, style[STROKE_DASHARRAY]);\n\t\t}\n\t\t\n\t\t// extra attributes such as join type, dash offset.\n\t\tfor (var i in svgAttributeMap) {\n\t\t\tif (style[i]) {\n\t\t\t\tnode.setAttribute(svgAttributeMap[i], style[i]);\n\t\t\t}\n\t\t}\n\t},\n\t_decodeFont = function(f) {\n\t\tvar r = /([0-9].)(p[xt])\\s(.*)/, \n\t\t\tbits = f.match(r);\n\n\t\treturn {size:bits[1] + bits[2], font:bits[3]};\t\t\n\t},\n\t_appendAtIndex = function(svg, path, idx) {\n\t\tif (svg.childNodes.length > idx) {\n\t\t\tsvg.insertBefore(path, svg.childNodes[idx]);\n\t\t}\n\t\telse svg.appendChild(path);\n\t};\n\t\n\t/**\n\t\tutility methods for other objects to use.\n\t*/\n\tjsPlumbUtil.svg = {\n\t\tnode:_node,\n\t\tattr:_attr,\n\t\tpos:_pos\n\t};\n\t\n // ************************** / SVG utility methods ********************************************\t\n\t\n\t/*\n\t * Base class for SVG components.\n\t */\t\n\tvar SvgComponent = function(params) {\n\t\tvar pointerEventsSpec = params.pointerEventsSpec || \"all\", renderer = {};\n\t\t\t\n\t\tjsPlumb.jsPlumbUIComponent.apply(this, params.originalArgs);\n\t\tthis.canvas = null;this.path = null;this.svg = null; this.bgCanvas = null;\n\t\n\t\tvar clazz = params.cssClass + \" \" + (params.originalArgs[0].cssClass || \"\"),\t\t\n\t\t\tsvgParams = {\n\t\t\t\t\"style\":\"\",\n\t\t\t\t\"width\":0,\n\t\t\t\t\"height\":0,\n\t\t\t\t\"pointer-events\":pointerEventsSpec,\n\t\t\t\t\"position\":\"absolute\"\n\t\t\t};\t\t\t\t\n\t\t\n\t\tthis.svg = _node(\"svg\", svgParams);\n\t\t\n\t\tif (params.useDivWrapper) {\n\t\t\tthis.canvas = document.createElement(\"div\");\n\t\t\tthis.canvas.style.position = \"absolute\";\n\t\t\tjsPlumbUtil.sizeElement(this.canvas,0,0,1,1);\n\t\t\tthis.canvas.className = clazz;\n\t\t}\n\t\telse {\n\t\t\t_attr(this.svg, { \"class\":clazz });\n\t\t\tthis.canvas = this.svg;\n\t\t}\n\t\t\t\n\t\tparams._jsPlumb.appendElement(this.canvas, params.originalArgs[0].parent);\n\t\tif (params.useDivWrapper) this.canvas.appendChild(this.svg);\n\t\t\n\t\t// TODO this displayElement stuff is common between all components, across all\n\t\t// renderers.  would be best moved to jsPlumbUIComponent.\n\t\tvar displayElements = [ this.canvas ];\n\t\tthis.getDisplayElements = function() { \n\t\t\treturn displayElements; \n\t\t};\n\t\t\n\t\tthis.appendDisplayElement = function(el) {\n\t\t\tdisplayElements.push(el);\n\t\t};\t\n\t\t\n\t\tthis.paint = function(style, anchor, extents) {\t   \t\t\t\n\t\t\tif (style != null) {\n\t\t\t\t\n\t\t\t\tvar xy = [ this.x, this.y ], wh = [ this.w, this.h ], p;\n\t\t\t\tif (extents != null) {\n\t\t\t\t\tif (extents.xmin < 0) xy[0] += extents.xmin;\n\t\t\t\t\tif (extents.ymin < 0) xy[1] += extents.ymin;\n\t\t\t\t\twh[0] = extents.xmax + ((extents.xmin < 0) ? -extents.xmin : 0);\n\t\t\t\t\twh[1] = extents.ymax + ((extents.ymin < 0) ? -extents.ymin : 0);\n\t\t\t\t}\n\n\t\t\t\tif (params.useDivWrapper) {\t\t\t\t\t\n\t\t\t\t\tjsPlumbUtil.sizeElement(this.canvas, xy[0], xy[1], wh[0], wh[1]);\n\t\t\t\t\txy[0] = 0; xy[1] = 0;\n\t\t\t\t\tp = _pos([ 0, 0 ]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tp = _pos([ xy[0], xy[1] ]);\n                \n                renderer.paint.apply(this, arguments);\t\t    \t\t\t    \t\n                \n\t\t    \t_attr(this.svg, {\n\t    \t\t\t\"style\":p,\n\t    \t\t\t\"width\": wh[0],\n\t    \t\t\t\"height\": wh[1]\n\t    \t\t});\t\t    \t\t    \t\t    \t\n\t\t\t}\n\t    };\n\t\t\n\t\treturn {\n\t\t\trenderer:renderer\n\t\t};\n\t};\n\t\n\tjsPlumbUtil.extend(SvgComponent, jsPlumb.jsPlumbUIComponent, {\n\t\tcleanup:function() {\n            if (this.canvas) this.canvas._jsPlumb = null;\n            if (this.svg) this.svg._jsPlumb = null;\n            if (this.bgCanvas) this.bgCanvas._jsPlumb = null;\n\n\t\t\tif (this.canvas && this.canvas.parentNode) this.canvas.parentNode.removeChild(this.canvas);\n            if (this.bgCanvas && this. bgCanvas.parentNode) this.canvas.parentNode.removeChild(this.canvas);\n\n\t\t\tthis.svg = null;\n\t\t\tthis.canvas = null;\n\t\t\tthis.path = null;\t\t\t\n\t\t\tthis.group = null;\n\t\t},\n\t\tsetVisible:function(v) {\n\t\t\tif (this.canvas) {\n\t\t\t\tthis.canvas.style.display = v ? \"block\" : \"none\";\n\t\t\t}\n\t\t}\n\t});\n\t\n\t/*\n\t * Base class for SVG connectors.\n\t */ \n\tjsPlumb.ConnectorRenderers.svg = function(params) {\n\t\tvar self = this,\n\t\t\t_super = SvgComponent.apply(this, [ { \n\t\t\t\tcssClass:params._jsPlumb.connectorClass, \n\t\t\t\toriginalArgs:arguments, \n\t\t\t\tpointerEventsSpec:\"none\", \n\t\t\t\t_jsPlumb:params._jsPlumb\n\t\t\t} ]);\t\n\n\t\t/*this.pointOnPath = function(location, absolute) {\n\t\t\tif (!self.path) return [0,0];\n\t\t\tvar p = absolute ? location : location * self.path.getTotalLength();\n\t\t\treturn self.path.getPointAtLength(p);\n\t\t};*/\t\t\t\n\n\t\t_super.renderer.paint = function(style, anchor, extents) {\n\t\t\t\n\t\t\tvar segments = self.getSegments(), p = \"\", offset = [0,0];\t\t\t\n\t\t\tif (extents.xmin < 0) offset[0] = -extents.xmin;\n\t\t\tif (extents.ymin < 0) offset[1] = -extents.ymin;\t\t\t\n\n\t\t\tif (segments.length > 0) {\n\t\t\t\n\t\t\t\t// create path from segments.\t\n\t\t\t\tfor (var i = 0; i < segments.length; i++) {\n\t\t\t\t\tp += jsPlumb.Segments.svg.SegmentRenderer.getPath(segments[i]);\n\t\t\t\t\tp += \" \";\n\t\t\t\t}\t\t\t\n\t\t\t\t\n\t\t\t\tvar a = { \n\t\t\t\t\t\td:p,\n\t\t\t\t\t\ttransform:\"translate(\" + offset[0] + \",\" + offset[1] + \")\",\n\t\t\t\t\t\t\"pointer-events\":params[\"pointer-events\"] || \"visibleStroke\"\n\t\t\t\t\t}, \n\t                outlineStyle = null,\n\t                d = [self.x,self.y,self.w,self.h];\n\n\t\t\t\t// outline style.  actually means drawing an svg object underneath the main one.\n\t\t\t\tif (style.outlineColor) {\n\t\t\t\t\tvar outlineWidth = style.outlineWidth || 1,\n\t\t\t\t\t\toutlineStrokeWidth = style.lineWidth + (2 * outlineWidth);\n\t\t\t\t\toutlineStyle = jsPlumb.extend({}, style);\n                    delete outlineStyle.gradient;\n\t\t\t\t\toutlineStyle.strokeStyle = jsPlumbUtil.convertStyle(style.outlineColor);\n\t\t\t\t\toutlineStyle.lineWidth = outlineStrokeWidth;\n\t\t\t\t\t\n\t\t\t\t\tif (self.bgPath == null) {\n\t\t\t\t\t\tself.bgPath = _node(\"path\", a);\n                        _appendAtIndex(self.svg, self.bgPath, 0);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t_attr(self.bgPath, a);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_applyStyles(self.svg, self.bgPath, outlineStyle, d, self);\n\t\t\t\t}\t\t\t\n\t\t\t\t\n\t\t    \tif (self.path == null) {\n\t\t\t    \tself.path = _node(\"path\", a);\n                    _appendAtIndex(self.svg, self.path, style.outlineColor ? 1 : 0);\n\t\t    \t}\n\t\t    \telse {\n\t\t    \t\t_attr(self.path, a);\n\t\t    \t}\n\t\t    \t\t    \t\n\t\t    \t_applyStyles(self.svg, self.path, style, d, self);\n\t\t    }\n\t\t};\t\t\n\t};\n\tjsPlumbUtil.extend(jsPlumb.ConnectorRenderers.svg, SvgComponent);\n\n// ******************************* svg segment renderer *****************************************************\t\n\t\t\n\tjsPlumb.Segments.svg = {\n\t\tSegmentRenderer : {\t\t\n\t\t\tgetPath : function(segment) {\n\t\t\t\treturn ({\n\t\t\t\t\t\"Straight\":function() {\n\t\t\t\t\t\tvar d = segment.getCoordinates();\n\t\t\t\t\t\treturn \"M \" + d.x1 + \" \" + d.y1 + \" L \" + d.x2 + \" \" + d.y2;\t\n\t\t\t\t\t},\n\t\t\t\t\t\"Bezier\":function() {\n\t\t\t\t\t\tvar d = segment.params;\n\t\t\t\t\t\treturn \"M \" + d.x1 + \" \" + d.y1 + \n\t\t\t\t\t\t\t\" C \" + d.cp1x + \" \" + d.cp1y + \" \" + d.cp2x + \" \" + d.cp2y + \" \" + d.x2 + \" \" + d.y2;\t\t\t\n\t\t\t\t\t},\n\t\t\t\t\t\"Arc\":function() {\n\t\t\t\t\t\tvar d = segment.params,\n\t\t\t\t\t\t\tlaf = segment.sweep > Math.PI ? 1 : 0,\n\t\t\t\t\t\t\tsf = segment.anticlockwise ? 0 : 1;\t\t\t\n\n\t\t\t\t\t\treturn \"M\" + segment.x1 + \" \" + segment.y1 + \" A \" + segment.radius + \" \" + d.r + \" 0 \" + laf + \",\" + sf + \" \" + segment.x2 + \" \" + segment.y2;\n\t\t\t\t\t}\n\t\t\t\t})[segment.type]();\t\n\t\t\t}\n\t\t}\n\t};\n\t\n// ******************************* /svg segments *****************************************************\n   \n    /*\n\t * Base class for SVG endpoints.\n\t */\n\tvar SvgEndpoint = window.SvgEndpoint = function(params) {\n\t\tvar _super = SvgComponent.apply(this, [ {\n\t\t\t\tcssClass:params._jsPlumb.endpointClass, \n\t\t\t\toriginalArgs:arguments, \n\t\t\t\tpointerEventsSpec:\"all\",\n\t\t\t\tuseDivWrapper:true,\n\t\t\t\t_jsPlumb:params._jsPlumb\n\t\t\t} ]);\n\t\t\t\n\t\t_super.renderer.paint = function(style) {\n\t\t\tvar s = jsPlumb.extend({}, style);\n\t\t\tif (s.outlineColor) {\n\t\t\t\ts.strokeWidth = s.outlineWidth;\n\t\t\t\ts.strokeStyle = jsPlumbUtil.convertStyle(s.outlineColor, true);\n\t\t\t}\n\t\t\t\n\t\t\tif (this.node == null) {\n\t\t\t\tthis.node = this.makeNode(s);\n\t\t\t\tthis.svg.appendChild(this.node);\n\t\t\t}\n\t\t\telse if (this.updateNode != null) {\n\t\t\t\tthis.updateNode(this.node);\n\t\t\t}\n\t\t\t_applyStyles(this.svg, this.node, s, [ this.x, this.y, this.w, this.h ], this);\n\t\t\t_pos(this.node, [ this.x, this.y ]);\n\t\t}.bind(this);\n\t\t\t\t\n\t};\n\tjsPlumbUtil.extend(SvgEndpoint, SvgComponent);\n\t\n\t/*\n\t * SVG Dot Endpoint\n\t */\n\tjsPlumb.Endpoints.svg.Dot = function() {\n\t\tjsPlumb.Endpoints.Dot.apply(this, arguments);\n\t\tSvgEndpoint.apply(this, arguments);\t\t\n\t\tthis.makeNode = function(style) { \n\t\t\treturn _node(\"circle\", {\n                \"cx\"\t:\tthis.w / 2,\n                \"cy\"\t:\tthis.h / 2,\n                \"r\"\t\t:\tthis.radius\n            });\t\t\t\n\t\t};\n\t\tthis.updateNode = function(node) {\n\t\t\t_attr(node, {\n\t\t\t\t\"cx\":this.w / 2,\n\t\t\t\t\"cy\":this.h  / 2,\n\t\t\t\t\"r\":this.radius\n\t\t\t});\n\t\t};\n\t};\n\tjsPlumbUtil.extend(jsPlumb.Endpoints.svg.Dot, [jsPlumb.Endpoints.Dot, SvgEndpoint]);\n\t\n\t/*\n\t * SVG Rectangle Endpoint \n\t */\n\tjsPlumb.Endpoints.svg.Rectangle = function() {\n\t\tjsPlumb.Endpoints.Rectangle.apply(this, arguments);\n\t\tSvgEndpoint.apply(this, arguments);\t\t\n\t\tthis.makeNode = function(style) {\n\t\t\treturn _node(\"rect\", {\n\t\t\t\t\"width\"     :   this.w,\n\t\t\t\t\"height\"    :   this.h\n\t\t\t});\n\t\t};\n\t\tthis.updateNode = function(node) {\n\t\t\t_attr(node, {\n\t\t\t\t\"width\":this.w,\n\t\t\t\t\"height\":this.h\n\t\t\t});\n\t\t};\t\t\t\n\t};\t\t\n\tjsPlumbUtil.extend(jsPlumb.Endpoints.svg.Rectangle, [jsPlumb.Endpoints.Rectangle, SvgEndpoint]);\n\t\n\t/*\n\t * SVG Image Endpoint is the default image endpoint.\n\t */\n\tjsPlumb.Endpoints.svg.Image = jsPlumb.Endpoints.Image;\n\t/*\n\t * Blank endpoint in svg renderer is the default Blank endpoint.\n\t */\n\tjsPlumb.Endpoints.svg.Blank = jsPlumb.Endpoints.Blank;\t\n\t/*\n\t * Label overlay in svg renderer is the default Label overlay.\n\t */\n\tjsPlumb.Overlays.svg.Label = jsPlumb.Overlays.Label;\n\t/*\n\t * Custom overlay in svg renderer is the default Custom overlay.\n\t */\n\tjsPlumb.Overlays.svg.Custom = jsPlumb.Overlays.Custom;\n\t\t\n\tvar AbstractSvgArrowOverlay = function(superclass, originalArgs) {\n    \tsuperclass.apply(this, originalArgs);\n    \tjsPlumb.jsPlumbUIComponent.apply(this, originalArgs);\n        this.isAppendedAtTopLevel = false;\n    \tvar self = this;\n    \tthis.path = null;\n    \tthis.paint = function(params, containerExtents) {\n    \t\t// only draws on connections, not endpoints.\n    \t\tif (params.component.svg && containerExtents) {\n\t    \t\tif (this.path == null) {\n\t    \t\t\tthis.path = _node(\"path\", {\n\t    \t\t\t\t\"pointer-events\":\"all\"\t\n\t    \t\t\t});\n\t    \t\t\tparams.component.svg.appendChild(this.path);\n\t    \t\t\t\n\t    \t\t\tthis.canvas = params.component.svg; // for the sake of completeness; this behaves the same as other overlays\n\t    \t\t}\n\t    \t\tvar clazz = originalArgs && (originalArgs.length == 1) ? (originalArgs[0].cssClass || \"\") : \"\",\n\t    \t\t\toffset = [0,0];\n\n\t    \t\tif (containerExtents.xmin < 0) offset[0] = -containerExtents.xmin;\n\t    \t\tif (containerExtents.ymin < 0) offset[1] = -containerExtents.ymin;\n\t    \t\t\n\t    \t\t_attr(this.path, { \n\t    \t\t\t\"d\"\t\t\t:\tmakePath(params.d),\n\t    \t\t\t\"class\" \t:\tclazz,\n\t    \t\t\tstroke \t\t: \tparams.strokeStyle ? params.strokeStyle : null,\n\t    \t\t\tfill \t\t: \tparams.fillStyle ? params.fillStyle : null,\n\t    \t\t\ttransform\t: \t\"translate(\" + offset[0] + \",\" + offset[1] + \")\"\n\t    \t\t});    \t\t\n\t    \t}\n    \t};\n    \tvar makePath = function(d) {\n    \t\treturn \"M\" + d.hxy.x + \",\" + d.hxy.y +\n    \t\t\t\t\" L\" + d.tail[0].x + \",\" + d.tail[0].y + \n    \t\t\t\t\" L\" + d.cxy.x + \",\" + d.cxy.y + \n    \t\t\t\t\" L\" + d.tail[1].x + \",\" + d.tail[1].y + \n    \t\t\t\t\" L\" + d.hxy.x + \",\" + d.hxy.y;\n    \t};\n    };\n    jsPlumbUtil.extend(AbstractSvgArrowOverlay, [jsPlumb.jsPlumbUIComponent, jsPlumb.Overlays.AbstractOverlay], {\n    \tcleanup : function() {\n    \t\tif (this.path != null) this._jsPlumb.instance.removeElement(this.path);\n    \t},\n    \tsetVisible:function(v) {\n    \t\tif(this.path != null) (this.path.style.display = (v ? \"block\" : \"none\"));\n    \t}\n    });\n    \n    jsPlumb.Overlays.svg.Arrow = function() {\n    \tAbstractSvgArrowOverlay.apply(this, [jsPlumb.Overlays.Arrow, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.svg.Arrow, [ jsPlumb.Overlays.Arrow, AbstractSvgArrowOverlay ]);\n    \n    jsPlumb.Overlays.svg.PlainArrow = function() {\n    \tAbstractSvgArrowOverlay.apply(this, [jsPlumb.Overlays.PlainArrow, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.svg.PlainArrow, [ jsPlumb.Overlays.PlainArrow, AbstractSvgArrowOverlay ]);\n    \n    jsPlumb.Overlays.svg.Diamond = function() {\n    \tAbstractSvgArrowOverlay.apply(this, [jsPlumb.Overlays.Diamond, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.svg.Diamond, [ jsPlumb.Overlays.Diamond, AbstractSvgArrowOverlay ]);\n\n    // a test\n    jsPlumb.Overlays.svg.GuideLines = function() {\n        var path = null, self = this, p1_1, p1_2;        \n        jsPlumb.Overlays.GuideLines.apply(this, arguments);\n        this.paint = function(params, containerExtents) {\n    \t\tif (path == null) {\n    \t\t\tpath = _node(\"path\");\n    \t\t\tparams.connector.svg.appendChild(path);\n    \t\t\tself.attachListeners(path, params.connector);\n    \t\t\tself.attachListeners(path, self);\n\n                p1_1 = _node(\"path\");\n    \t\t\tparams.connector.svg.appendChild(p1_1);\n    \t\t\tself.attachListeners(p1_1, params.connector);\n    \t\t\tself.attachListeners(p1_1, self);\n\n                p1_2 = _node(\"path\");\n    \t\t\tparams.connector.svg.appendChild(p1_2);\n    \t\t\tself.attachListeners(p1_2, params.connector);\n    \t\t\tself.attachListeners(p1_2, self);\n    \t\t}\n\n    \t\tvar offset =[0,0];\n    \t\tif (containerExtents.xmin < 0) offset[0] = -containerExtents.xmin;\n    \t\tif (containerExtents.ymin < 0) offset[1] = -containerExtents.ymin;\n\n    \t\t_attr(path, {\n    \t\t\t\"d\"\t\t:\tmakePath(params.head, params.tail),\n    \t\t\tstroke \t: \t\"red\",\n    \t\t\tfill \t: \tnull,\n    \t\t\ttransform:\"translate(\" + offset[0] + \",\" + offset[1] + \")\"\n    \t\t});\n\n            _attr(p1_1, {\n    \t\t\t\"d\"\t\t:\tmakePath(params.tailLine[0], params.tailLine[1]),\n    \t\t\tstroke \t: \t\"blue\",\n    \t\t\tfill \t: \tnull,\n    \t\t\ttransform:\"translate(\" + offset[0] + \",\" + offset[1] + \")\"\n    \t\t});\n\n            _attr(p1_2, {\n    \t\t\t\"d\"\t\t:\tmakePath(params.headLine[0], params.headLine[1]),\n    \t\t\tstroke \t: \t\"green\",\n    \t\t\tfill \t: \tnull,\n    \t\t\ttransform:\"translate(\" + offset[0] + \",\" + offset[1] + \")\"\n    \t\t});\n    \t};\n\n        var makePath = function(d1, d2) {\n            return \"M \" + d1.x + \",\" + d1.y +\n                   \" L\" + d2.x + \",\" + d2.y;\n        };        \n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.svg.GuideLines, jsPlumb.Overlays.GuideLines);\n})();\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the VML renderers.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */\n\n;(function() {\n\t\n\t\"use strict\";\n\t\n\t// http://ajaxian.com/archives/the-vml-changes-in-ie-8\n\t// http://www.nczonline.net/blog/2010/01/19/internet-explorer-8-document-and-browser-modes/\n\t// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/\n\t\n\tvar vmlAttributeMap = {\n\t\t\"stroke-linejoin\":\"joinstyle\",\n\t\t\"joinstyle\":\"joinstyle\",\t\t\n\t\t\"endcap\":\"endcap\",\n\t\t\"miterlimit\":\"miterlimit\"\n\t},\n\tjsPlumbStylesheet = null;\n\t\n\tif (document.createStyleSheet && document.namespaces) {\t\t\t\n\t\t\n\t\tvar ruleClasses = [\n\t\t\t\t\".jsplumb_vml\", \"jsplumb\\\\:textbox\", \"jsplumb\\\\:oval\", \"jsplumb\\\\:rect\", \n\t\t\t\t\"jsplumb\\\\:stroke\", \"jsplumb\\\\:shape\", \"jsplumb\\\\:group\"\n\t\t\t],\n\t\t\trule = \"behavior:url(#default#VML);position:absolute;\";\n\n\t\tjsPlumbStylesheet = document.createStyleSheet();\n\n\t\tfor (var i = 0; i < ruleClasses.length; i++)\n\t\t\tjsPlumbStylesheet.addRule(ruleClasses[i], rule);\n\n\t\t// in this page it is also mentioned that IE requires the extra arg to the namespace\n\t\t// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/\n\t\t// but someone commented saying they didn't need it, and it seems jsPlumb doesnt need it either.\n\t\t// var iev = document.documentMode;\n\t\t//if (!iev || iev < 8)\n\t\t\tdocument.namespaces.add(\"jsplumb\", \"urn:schemas-microsoft-com:vml\");\n\t\t//else\n\t\t//\tdocument.namespaces.add(\"jsplumb\", \"urn:schemas-microsoft-com:vml\", \"#default#VML\");\n\t}\n\t\n\tjsPlumb.vml = {};\n\t\n\tvar scale = 1000,\n    \n\t_atts = function(o, atts) {\n\t\tfor (var i in atts) { \n\t\t\t// IE8 fix: setattribute does not work after an element has been added to the dom!\n\t\t\t// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/\n\t\t\t//o.setAttribute(i, atts[i]);\n\n\t\t\t/*There is an additional problem when accessing VML elements by using get/setAttribute. The simple solution is following:\n\n\t\t\tif (document.documentMode==8) {\n\t\t\tele.opacity=1;\n\t\t\t} else {\n\t\t\tele.setAttribute(‘opacity’,1);\n\t\t\t}\n\t\t\t*/\n\n\t\t\to[i] = atts[i];\n\t\t}\n\t},\n\t_node = function(name, d, atts, parent, _jsPlumb, deferToJsPlumbContainer) {\n\t\tatts = atts || {};\n\t\tvar o = document.createElement(\"jsplumb:\" + name);\n\t\tif (deferToJsPlumbContainer)\n\t\t\t_jsPlumb.appendElement(o, parent);\n\t\telse\n\t\t\t// TODO is this failing? that would be because parent is not a plain DOM element.\n\t\t\t// IF SO, uncomment the line below this one and remove this one.\n\t\t\tparent.appendChild(o);\n\t\t\t//jsPlumb.getDOMElement(parent).appendChild(o);\n\t\t\t\n\t\to.className = (atts[\"class\"] ? atts[\"class\"] + \" \" : \"\") + \"jsplumb_vml\";\n\t\t_pos(o, d);\n\t\t_atts(o, atts);\n\t\treturn o;\n\t},\n\t_pos = function(o,d, zIndex) {\n\t\to.style.left = d[0] + \"px\";\t\t\n\t\to.style.top =  d[1] + \"px\";\n\t\to.style.width= d[2] + \"px\";\n\t\to.style.height= d[3] + \"px\";\n\t\to.style.position = \"absolute\";\n\t\tif (zIndex)\n\t\t\to.style.zIndex = zIndex;\n\t},\n\t_conv = jsPlumb.vml.convertValue = function(v) {\n\t\treturn Math.floor(v * scale);\n\t},\t\n\t// tests if the given style is \"transparent\" and then sets the appropriate opacity node to 0 if so,\n\t// or 1 if not.  TODO in the future, support variable opacity.\n\t_maybeSetOpacity = function(styleToWrite, styleToCheck, type, component) {\n\t\tif (\"transparent\" === styleToCheck)\n\t\t\tcomponent.setOpacity(type, \"0.0\");\n\t\telse\n\t\t\tcomponent.setOpacity(type, \"1.0\");\n\t},\n\t_applyStyles = function(node, style, component, _jsPlumb) {\n\t\tvar styleToWrite = {};\n\t\tif (style.strokeStyle) {\n\t\t\tstyleToWrite.stroked = \"true\";\n\t\t\tvar strokeColor = jsPlumbUtil.convertStyle(style.strokeStyle, true);\n\t\t\tstyleToWrite.strokecolor = strokeColor;\n\t\t\t_maybeSetOpacity(styleToWrite, strokeColor, \"stroke\", component);\n\t\t\tstyleToWrite.strokeweight = style.lineWidth + \"px\";\n\t\t}\n\t\telse styleToWrite.stroked = \"false\";\n\t\t\n\t\tif (style.fillStyle) {\n\t\t\tstyleToWrite.filled = \"true\";\n\t\t\tvar fillColor = jsPlumbUtil.convertStyle(style.fillStyle, true);\n\t\t\tstyleToWrite.fillcolor = fillColor;\n\t\t\t_maybeSetOpacity(styleToWrite, fillColor, \"fill\", component);\n\t\t}\n\t\telse styleToWrite.filled = \"false\";\n\t\t\n\t\tif(style.dashstyle) {\n\t\t\tif (component.strokeNode == null) {\n\t\t\t\tcomponent.strokeNode = _node(\"stroke\", [0,0,0,0], { dashstyle:style.dashstyle }, node, _jsPlumb);\t\t\t\t\n\t\t\t}\n\t\t\telse\n\t\t\t\tcomponent.strokeNode.dashstyle = style.dashstyle;\n\t\t}\t\t\t\t\t\n\t\telse if (style[\"stroke-dasharray\"] && style.lineWidth) {\n\t\t\tvar sep = style[\"stroke-dasharray\"].indexOf(\",\") == -1 ? \" \" : \",\",\n\t\t\tparts = style[\"stroke-dasharray\"].split(sep),\n\t\t\tstyleToUse = \"\";\n\t\t\tfor(var i = 0; i < parts.length; i++) {\n\t\t\t\tstyleToUse += (Math.floor(parts[i] / style.lineWidth) + sep);\n\t\t\t}\n\t\t\tif (component.strokeNode == null) {\n\t\t\t\tcomponent.strokeNode = _node(\"stroke\", [0,0,0,0], { dashstyle:styleToUse }, node, _jsPlumb);\t\t\t\t\n\t\t\t}\n\t\t\telse\n\t\t\t\tcomponent.strokeNode.dashstyle = styleToUse;\n\t\t}\n\t\t\n\t\t_atts(node, styleToWrite);\n\t},\n\t/*\n\t * Base class for Vml endpoints and connectors. Extends jsPlumbUIComponent. \n\t */\n\tVmlComponent = function() {\t\t\t\t\n\t\tvar self = this, renderer = {};\n\t\tjsPlumb.jsPlumbUIComponent.apply(this, arguments);\t\n\n\t\tthis.opacityNodes = {\n\t\t\t\"stroke\":null,\n\t\t\t\"fill\":null\n\t\t};\n\t\tthis.initOpacityNodes = function(vml) {\n\t\t\tself.opacityNodes.stroke = _node(\"stroke\", [0,0,1,1], {opacity:\"0.0\"}, vml, self._jsPlumb.instance);\n\t\t\tself.opacityNodes.fill = _node(\"fill\", [0,0,1,1], {opacity:\"0.0\"}, vml, self._jsPlumb.instance);\t\t\t\t\t\t\t\n\t\t};\n\t\tthis.setOpacity = function(type, value) {\n\t\t\tvar node = self.opacityNodes[type];\n\t\t\tif (node) node.opacity = \"\" + value;\n\t\t};\n\t\tvar displayElements = [ ];\n\t\tthis.getDisplayElements = function() { \n\t\t\treturn displayElements; \n\t\t};\n\t\t\n\t\tthis.appendDisplayElement = function(el, doNotAppendToCanvas) {\n\t\t\tif (!doNotAppendToCanvas) self.canvas.parentNode.appendChild(el);\n\t\t\tdisplayElements.push(el);\n\t\t};\n\t};\n\tjsPlumbUtil.extend(VmlComponent, jsPlumb.jsPlumbUIComponent, {\n\t\tcleanup:function() {\t\t\t\n\t\t\tif (this.bgCanvas) this.bgCanvas.parentNode.removeChild(this.bgCanvas);\n\t\t\tif (this.canvas) this.canvas.parentNode.removeChild(this.canvas);\n\t\t}\n\t});\n\n\t/*\n\t * Base class for Vml connectors. extends VmlComponent.\n\t */\n\tvar VmlConnector = jsPlumb.ConnectorRenderers.vml = function(params, component) {\n\t\tthis.strokeNode = null;\n\t\tthis.canvas = null;\n\t\tVmlComponent.apply(this, arguments);\n\t\tvar clazz = this._jsPlumb.instance.connectorClass + (params.cssClass ? (\" \" + params.cssClass) : \"\");\n\t\tthis.paint = function(style) {\t\t\n\t\t\tif (style !== null) {\t\t\t\n\n\t\t\t\t// we need to be at least 1 pixel in each direction, because otherwise coordsize gets set to\n\t\t\t\t// 0 and overlays cannot paint.\n\t\t\t\tthis.w = Math.max(this.w, 1);\n\t\t\t\tthis.h = Math.max(this.h, 1);\n\n\t\t\t\tvar segments = this.getSegments(), p = { \"path\":\"\" },\n                    d = [this.x, this.y, this.w, this.h];\n\t\t\t\t\n\t\t\t\t// create path from segments.\t\n\t\t\t\tfor (var i = 0; i < segments.length; i++) {\n\t\t\t\t\tp.path += jsPlumb.Segments.vml.SegmentRenderer.getPath(segments[i]);\n\t\t\t\t\tp.path += \" \";\n\t\t\t\t}\n\n                //*\n\t\t\t\tif (style.outlineColor) {\n\t\t\t\t\tvar outlineWidth = style.outlineWidth || 1,\n\t\t\t\t\toutlineStrokeWidth = style.lineWidth + (2 * outlineWidth),\n\t\t\t\t\toutlineStyle = {\n\t\t\t\t\t\tstrokeStyle : jsPlumbUtil.convertStyle(style.outlineColor),\n\t\t\t\t\t\tlineWidth : outlineStrokeWidth\n\t\t\t\t\t};\n\t\t\t\t\tfor (var aa in vmlAttributeMap) outlineStyle[aa] = style[aa];\n\t\t\t\t\t\n\t\t\t\t\tif (this.bgCanvas == null) {\t\t\t\t\t\t\n\t\t\t\t\t\tp[\"class\"] = clazz;\n\t\t\t\t\t\tp.coordsize = (d[2] * scale) + \",\" + (d[3] * scale);\n\t\t\t\t\t\tthis.bgCanvas = _node(\"shape\", d, p, params.parent, this._jsPlumb.instance, true);\t\t\t\t\t\t\n\t\t\t\t\t\t_pos(this.bgCanvas, d);\n\t\t\t\t\t\tthis.appendDisplayElement(this.bgCanvas, true);\n\t\t\t\t\t\tthis.initOpacityNodes(this.bgCanvas, [\"stroke\"]);\n                        this.bgCanvas._jsPlumb = component;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.coordsize = (d[2] * scale) + \",\" + (d[3] * scale);\n\t\t\t\t\t\t_pos(this.bgCanvas, d);\n\t\t\t\t\t\t_atts(this.bgCanvas, p);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_applyStyles(this.bgCanvas, outlineStyle, this);\n\t\t\t\t}\n\t\t\t\t//*/\n\t\t\t\t\n\t\t\t\tif (this.canvas == null) {\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\tp[\"class\"] = clazz;\n\t\t\t\t\tp.coordsize = (d[2] * scale) + \",\" + (d[3] * scale);\t\t\t\t\t\n\t\t\t\t\tthis.canvas = _node(\"shape\", d, p, params.parent, this._jsPlumb.instance, true);\t\t\t\t\t                                    \n\t\t\t\t\tthis.appendDisplayElement(this.canvas, true);\n\t\t\t\t\tthis.initOpacityNodes(this.canvas, [\"stroke\"]);\n                    this.canvas._jsPlumb = component;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tp.coordsize = (d[2] * scale) + \",\" + (d[3] * scale);\n\t\t\t\t\t_pos(this.canvas, d);\n\t\t\t\t\t_atts(this.canvas, p);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t_applyStyles(this.canvas, style, this, this._jsPlumb.instance);\n\t\t\t}\n\t\t};\t\n\t\t\t\t\n\t};\n\tjsPlumbUtil.extend(VmlConnector, VmlComponent, {\n\t\tsetVisible:function(v) {\n\t\t\tif (this.canvas) {\n\t\t\t\tthis.canvas.style.display = v ? \"block\" : \"none\";\n\t\t\t}\n\t\t\tif (this.bgCanvas) {\n\t\t\t\tthis.bgCanvas.style.display = v ? \"block\" : \"none\";\n\t\t\t}\n\t\t}\n\t});\t\n\t\n\t/*\n\t * \n\t * Base class for Vml Endpoints. extends VmlComponent.\n\t * \n\t */\n\tvar VmlEndpoint = window.VmlEndpoint = function(params) {\n\t\tVmlComponent.apply(this, arguments);\n\t\tthis._jsPlumb.vml = null;//, opacityStrokeNode = null, opacityFillNode = null;\n\t\tthis.canvas = document.createElement(\"div\");\n\t\tthis.canvas.style.position = \"absolute\";\n\t\tthis._jsPlumb.clazz = this._jsPlumb.instance.endpointClass + (params.cssClass ? (\" \" + params.cssClass) : \"\");\n\n\t\t// TODO vml endpoint adds class to VML at constructor time.  but the addClass method adds VML\n\t\t// to the enclosing DIV. what to do?  seems like it would be better to just target the div.\n\t\t// HOWEVER...vml connection has no containing div.  why not? it feels like it should.\n\n\t\tparams._jsPlumb.appendElement(this.canvas, params.parent);\n\n\t\tthis.paint = function(style, anchor) {\n\t\t\tvar p = { }, vml = this._jsPlumb.vml;\t\t\t\t\n\t\t\t\n\t\t\tjsPlumbUtil.sizeElement(this.canvas, this.x, this.y, this.w, this.h);\n\t\t\tif (this._jsPlumb.vml == null) {\n\t\t\t\tp[\"class\"] = this._jsPlumb.clazz;\n\t\t\t\tvml = this._jsPlumb.vml = this.getVml([0,0, this.w, this.h], p, anchor, this.canvas, this._jsPlumb.instance);\t\t\t\t\n\n                this.appendDisplayElement(vml, true);\n\t\t\t\tthis.appendDisplayElement(this.canvas, true);\n\t\t\t\t\n\t\t\t\tthis.initOpacityNodes(vml, [\"fill\"]);\t\t\t\n\t\t\t}\n\t\t\telse {\t\t\t\t\n\t\t\t\t_pos(vml, [0,0, this.w, this.h]);\n\t\t\t\t_atts(vml, p);\n\t\t\t}\n\t\t\t\n\t\t\t_applyStyles(vml, style, this);\n\t\t};\t\t\n\t};\n\tjsPlumbUtil.extend(VmlEndpoint, VmlComponent);\n\t\n// ******************************* vml segments *****************************************************\t\n\t\t\n\tjsPlumb.Segments.vml = {\n\t\tSegmentRenderer : {\t\t\n\t\t\tgetPath : function(segment) {\n\t\t\t\treturn ({\n\t\t\t\t\t\"Straight\":function(segment) {\n\t\t\t\t\t\tvar d = segment.params;\n\t\t\t\t\t\treturn \"m\" + _conv(d.x1) + \",\" + _conv(d.y1) + \" l\" + _conv(d.x2) + \",\" + _conv(d.y2) + \" e\";\n\t\t\t\t\t},\n\t\t\t\t\t\"Bezier\":function(segment) {\n\t\t\t\t\t\tvar d = segment.params;\n\t\t\t\t\t\treturn \"m\" + _conv(d.x1) + \",\" + _conv(d.y1) + \n\t\t\t\t   \t\t\t\" c\" + _conv(d.cp1x) + \",\" + _conv(d.cp1y) + \",\" + _conv(d.cp2x) + \",\" + _conv(d.cp2y) + \",\" + _conv(d.x2) + \",\" + _conv(d.y2) + \" e\";\n\t\t\t\t\t},\n\t\t\t\t\t\"Arc\":function(segment) {\t\t\t\t\t\n\t\t\t\t\t\tvar d = segment.params,\n\t\t\t\t\t\t\txmin = Math.min(d.x1, d.x2),\n\t\t\t\t\t\t\txmax = Math.max(d.x1, d.x2),\n\t\t\t\t\t\t\tymin = Math.min(d.y1, d.y2),\n\t\t\t\t\t\t\tymax = Math.max(d.y1, d.y2),\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsf = segment.anticlockwise ? 1 : 0,\n\t\t\t\t\t\t\tpathType = (segment.anticlockwise ? \"at \" : \"wa \"),\n\t\t\t\t\t\t\tmakePosString = function() {\n\t\t\t\t\t\t\t\tif (d.loopback)\n\t\t\t\t\t\t\t\t\treturn \"0,0,\" + _conv(2*d.r) + \",\" + _conv(2 * d.r);\n\n\t\t\t\t\t\t\t\tvar xy = [\n\t\t\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\t\t\t[ function() { return [xmin, ymin ];}, function() { return [xmin - d.r, ymin - d.r ];}],\n\t\t\t\t\t\t\t\t\t\t[ function() { return [xmin - d.r, ymin ];}, function() { return [xmin, ymin - d.r ];}],\n\t\t\t\t\t\t\t\t\t\t[ function() { return [xmin - d.r, ymin - d.r ];}, function() { return [xmin, ymin ];}],\n\t\t\t\t\t\t\t\t\t\t[ function() { return [xmin, ymin - d.r ];}, function() { return [xmin - d.r, ymin ];}]\n\t\t\t\t\t\t\t\t\t][segment.segment][sf]();\n\n\t\t\t\t\t\t\t\treturn _conv(xy[0]) + \",\" + _conv(xy[1]) + \",\" + _conv(xy[0] + (2*d.r)) + \",\" + _conv(xy[1] + (2*d.r));\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn pathType + \" \" + makePosString() + \",\" + _conv(d.x1) + \",\" + _conv(d.y1) + \",\" + _conv(d.x2) + \",\" + _conv(d.y2) + \" e\";\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t})[segment.type](segment);\t\n\t\t\t}\n\t\t}\n\t};\n\t\n// ******************************* /vml segments *****************************************************\t\n\n// ******************************* vml endpoints *****************************************************\n\t\n\tjsPlumb.Endpoints.vml.Dot = function() {\n\t\tjsPlumb.Endpoints.Dot.apply(this, arguments);\n\t\tVmlEndpoint.apply(this, arguments);\n\t\tthis.getVml = function(d, atts, anchor, parent, _jsPlumb) { return _node(\"oval\", d, atts, parent, _jsPlumb); };\n\t};\n\tjsPlumbUtil.extend(jsPlumb.Endpoints.vml.Dot, VmlEndpoint);\n\t\n\tjsPlumb.Endpoints.vml.Rectangle = function() {\n\t\tjsPlumb.Endpoints.Rectangle.apply(this, arguments);\n\t\tVmlEndpoint.apply(this, arguments);\n\t\tthis.getVml = function(d, atts, anchor, parent, _jsPlumb) { return _node(\"rect\", d, atts, parent, _jsPlumb); };\n\t};\n\tjsPlumbUtil.extend(jsPlumb.Endpoints.vml.Rectangle, VmlEndpoint);\n\t\n\t/*\n\t * VML Image Endpoint is the same as the default image endpoint.\n\t */\n\tjsPlumb.Endpoints.vml.Image = jsPlumb.Endpoints.Image;\n\t\n\t/**\n\t * placeholder for Blank endpoint in vml renderer.\n\t */\n\tjsPlumb.Endpoints.vml.Blank = jsPlumb.Endpoints.Blank;\n\t\n// ******************************* /vml endpoints *****************************************************\t\n\n// ******************************* vml overlays *****************************************************\n\t\n\t/**\n\t * VML Label renderer. uses the default label renderer (which adds an element to the DOM)\n\t */\n\tjsPlumb.Overlays.vml.Label  = jsPlumb.Overlays.Label;\n\t\n\t/**\n\t * VML Custom renderer. uses the default Custom renderer (which adds an element to the DOM)\n\t */\n\tjsPlumb.Overlays.vml.Custom = jsPlumb.Overlays.Custom;\n\t\n\t/**\n\t * Abstract VML arrow superclass\n\t */\n\tvar AbstractVmlArrowOverlay = function(superclass, originalArgs) {\n    \tsuperclass.apply(this, originalArgs);\n    \tVmlComponent.apply(this, originalArgs);\n    \tvar self = this, path = null;\n    \tthis.canvas = null; \n    \tthis.isAppendedAtTopLevel = true;\n    \tvar getPath = function(d) {    \t\t\n    \t\treturn \"m \" + _conv(d.hxy.x) + \",\" + _conv(d.hxy.y) +\n    \t\t       \" l \" + _conv(d.tail[0].x) + \",\" + _conv(d.tail[0].y) + \n    \t\t       \" \" + _conv(d.cxy.x) + \",\" + _conv(d.cxy.y) + \n    \t\t       \" \" + _conv(d.tail[1].x) + \",\" + _conv(d.tail[1].y) + \n    \t\t       \" x e\";\n    \t};\n    \tthis.paint = function(params, containerExtents) {\n    \t\t// only draws for connectors, not endpoints.\n    \t\tif (params.component.canvas && containerExtents) {\n\t    \t\tvar p = {}, d = params.d, connector = params.component;\n\t\t\t\tif (params.strokeStyle) {\n\t\t\t\t\tp.stroked = \"true\";\n\t\t\t\t\tp.strokecolor = jsPlumbUtil.convertStyle(params.strokeStyle, true);    \t\t\t\t\n\t\t\t\t}\n\t\t\t\tif (params.lineWidth) p.strokeweight = params.lineWidth + \"px\";\n\t\t\t\tif (params.fillStyle) {\n\t\t\t\t\tp.filled = \"true\";\n\t\t\t\t\tp.fillcolor = params.fillStyle;\n\t\t\t\t}\t\t\t\n\n\t\t\t\tvar xmin = Math.min(d.hxy.x, d.tail[0].x, d.tail[1].x, d.cxy.x),\n\t\t\t\t\tymin = Math.min(d.hxy.y, d.tail[0].y, d.tail[1].y, d.cxy.y),\n\t\t\t\t\txmax = Math.max(d.hxy.x, d.tail[0].x, d.tail[1].x, d.cxy.x),\n\t\t\t\t\tymax = Math.max(d.hxy.y, d.tail[0].y, d.tail[1].y, d.cxy.y),\n\t\t\t\t\tw = Math.abs(xmax - xmin),\n\t\t\t\t\th = Math.abs(ymax - ymin),\n\t\t\t\t\tdim = [xmin, ymin, w, h];\n\n\t\t\t\t// for VML, we create overlays using shapes that have the same dimensions and\n\t\t\t\t// coordsize as their connector - overlays calculate themselves relative to the\n\t\t\t\t// connector (it's how it's been done since the original canvas implementation, because\n\t\t\t\t// for canvas that makes sense).\n\t\t\t\tp.path = getPath(d);\n\t\t\t\tp.coordsize = (connector.w * scale) + \",\" + (connector.h * scale);\t\t\t\n\t\t\t\t\n\t\t\t\tdim[0] = connector.x;\n\t\t\t\tdim[1] = connector.y;\n\t\t\t\tdim[2] = connector.w;\n\t\t\t\tdim[3] = connector.h;\n\t\t\t\t\n\t    \t\tif (self.canvas == null) {\n\t    \t\t\tvar overlayClass = connector._jsPlumb.overlayClass || \"\";\n\t    \t\t\tvar clazz = originalArgs && (originalArgs.length == 1) ? (originalArgs[0].cssClass || \"\") : \"\";\n\t    \t\t\tp[\"class\"] = clazz + \" \" + overlayClass;\n\t\t\t\t\tself.canvas = _node(\"shape\", dim, p, connector.canvas.parentNode, connector._jsPlumb.instance, true);\t\t\t\t\t\t\t\t\n\t\t\t\t\tconnector.appendDisplayElement(self.canvas, true);\n\t\t\t\t}\n\t\t\t\telse {\t\t\t\t\n\t\t\t\t\t_pos(self.canvas, dim);\n\t\t\t\t\t_atts(self.canvas, p);\n\t\t\t\t}    \t\t\n\t\t\t}\n    \t};\n\t\tthis.cleanup = function() {\n    \t\tif (this.canvas != null) this._jsPlumb.instance.removeElement(this.canvas);\n    \t};\n    };\n    jsPlumbUtil.extend(AbstractVmlArrowOverlay, [VmlComponent, jsPlumb.Overlays.AbstractOverlay], {\n    \tsetVisible : function(state) {\n    \t    this.canvas.style.display = state ? \"block\" : \"none\";\n    \t}\n    });\n\t\n\tjsPlumb.Overlays.vml.Arrow = function() {\n    \tAbstractVmlArrowOverlay.apply(this, [jsPlumb.Overlays.Arrow, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.vml.Arrow, [ jsPlumb.Overlays.Arrow, AbstractVmlArrowOverlay ]);\n    \n    jsPlumb.Overlays.vml.PlainArrow = function() {\n    \tAbstractVmlArrowOverlay.apply(this, [jsPlumb.Overlays.PlainArrow, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.vml.PlainArrow, [ jsPlumb.Overlays.PlainArrow, AbstractVmlArrowOverlay ]);\n    \n    jsPlumb.Overlays.vml.Diamond = function() {\n    \tAbstractVmlArrowOverlay.apply(this, [jsPlumb.Overlays.Diamond, arguments]);    \t\n    };\n    jsPlumbUtil.extend(jsPlumb.Overlays.vml.Diamond, [ jsPlumb.Overlays.Diamond, AbstractVmlArrowOverlay ]);\n    \n// ******************************* /vml overlays *****************************************************    \n    \n})();\n\n/*\n * jsPlumb\n * \n * Title:jsPlumb 1.7.2\n * \n * Provides a way to visually connect elements on an HTML page, using SVG or VML.  \n * \n * This file contains the jQuery adapter.\n *\n * Copyright (c) 2010 - 2014 Simon Porritt (simon@jsplumbtoolkit.com)\n * \n * http://jsplumbtoolkit.com\n * http://github.com/sporritt/jsplumb\n * \n * Dual licensed under the MIT and GPL2 licenses.\n */  \n;(function($) {\n\t\n\t\"use strict\";\n\n\tvar _getElementObject = function(el) {\n\t\treturn typeof(el) == \"string\" ? $(\"#\" + el) : $(el);\n\t};\n\n\t$.extend(jsPlumbInstance.prototype, {\n\n// ---------------------------- DOM MANIPULATION ---------------------------------------\t\t\n\t\t\t\t\n\t\t\n\t\t/**\n\t\t* gets a DOM element from the given input, which might be a string (in which case we just do document.getElementById),\n\t\t* a selector (in which case we return el[0]), or a DOM element already (we assume this if it's not either of the other\n\t\t* two cases).  this is the opposite of getElementObject below.\n\t\t*/\n\t\tgetDOMElement : function(el) {\n\t\t\tif (el == null) return null;\n\t\t\tif (typeof(el) == \"string\") return document.getElementById(el);\n\t\t\telse if (el.context || el.length != null) return el[0];\n\t\t\telse return el;\n\t\t},\n\t\t\n\t\t/**\n\t\t * gets an \"element object\" from the given input.  this means an object that is used by the\n\t\t * underlying library on which jsPlumb is running.  'el' may already be one of these objects,\n\t\t * in which case it is returned as-is.  otherwise, 'el' is a String, the library's lookup \n\t\t * function is used to find the element, using the given String as the element's id.\n\t\t * \n\t\t */\n\t\tgetElementObject : _getElementObject,\n\n\t\t/**\n\t\t* removes an element from the DOM.  doing it via the library is\n\t\t* safer from a memory perspective, as it ix expected that the library's \n\t\t* remove method will unbind any event listeners before removing the element from the DOM.\n\t\t*/\n\t\tremoveElement:function(element) {\n\t\t\t_getElementObject(element).remove();\n\t\t},\n\n// ---------------------------- END DOM MANIPULATION ---------------------------------------\n\n// ---------------------------- MISCELLANEOUS ---------------------------------------\n\n\t\t/**\n\t\t * animates the given element.\n\t\t */\n\t\tdoAnimate : function(el, properties, options) {\n\t\t\tel.animate(properties, options);\n\t\t},\t\n\t\tgetSelector : function(context, spec) {\n            if (arguments.length == 2)\n                return _getElementObject(context).find(spec);\n            else\n                return $(context);\n\t\t},\n\n// ---------------------------- END MISCELLANEOUS ---------------------------------------\t\t\n\n// -------------------------------------- DRAG/DROP\t---------------------------------\n\t\t\n\t\tdestroyDraggable : function(el) {\n\t\t\tif ($(el).data(\"draggable\"))\n\t\t\t\t$(el).draggable(\"destroy\");\n\t\t},\n\n\t\tdestroyDroppable : function(el) {\n\t\t\tif ($(el).data(\"droppable\"))\n\t\t\t\t$(el).droppable(\"destroy\");\n\t\t},\n\t\t/**\n\t\t * initialises the given element to be draggable.\n\t\t */\n\t\tinitDraggable : function(el, options, isPlumbedComponent) {\n\t\t\toptions = options || {};\n\t\t\tel = $(el);\n\n\t\t\toptions.start = jsPlumbUtil.wrap(options.start, function() {\n\t\t\t\t$(\"body\").addClass(this.dragSelectClass);\n\t\t\t}, false);\n\n\t\t\toptions.stop = jsPlumbUtil.wrap(options.stop, function() {\n\t\t\t\t$(\"body\").removeClass(this.dragSelectClass);\n\t\t\t});\n\n\t\t\t// remove helper directive if present and no override\n\t\t\tif (!options.doNotRemoveHelper)\n\t\t\t\toptions.helper = null;\n\n\n\t\t\tif (isPlumbedComponent == \"internal\")\n\t\t\t\toptions.scope = options.scope || jsPlumb.Defaults.Scope;\n\n\t\t\tel.draggable(options);\n\t\t},\n\t\t\n\t\t/**\n\t\t * initialises the given element to be droppable.\n\t\t */\n\t\tinitDroppable : function(el, options) {\n\t\t\toptions.scope = options.scope || jsPlumb.Defaults.Scope;\n            $(el).droppable(options);\n\t\t},\n\t\t\n\t\tisAlreadyDraggable : function(el) {\n\t\t\treturn $(el).hasClass(\"ui-draggable\");\n\t\t},\n\t\t\n\t\t/**\n\t\t * returns whether or not drag is supported (by the library, not whether or not it is disabled) for the given element.\n\t\t */\n\t\tisDragSupported : function(el, options) {\n\t\t\treturn $(el).draggable;\n\t\t},\n\n\t\t/**\n\t\t * returns whether or not drop is supported (by the library, not whether or not it is disabled) for the given element.\n\t\t */\n\t\tisDropSupported : function(el, options) {\n\t\t\treturn $(el).droppable;\n\t\t},\n\t\t/**\n\t\t * takes the args passed to an event function and returns you an object representing that which is being dragged.\n\t\t */\n\t\tgetDragObject : function(eventArgs) {\n\t\t\t//return eventArgs[1].draggable || eventArgs[1].helper;\n\t\t\treturn eventArgs[1].helper || eventArgs[1].draggable;\n\t\t},\n\t\t\n\t\tgetDragScope : function(el) {\n\t\t\treturn $(el).draggable(\"option\", \"scope\");\n\t\t},\n\n\t\tgetDropEvent : function(args) {\n\t\t\treturn args[0];\n\t\t},\n\t\t\n\t\tgetDropScope : function(el) {\n\t\t\treturn $(el).droppable(\"option\", \"scope\");\n\t\t},\n\t\t/**\n\t\t * takes the args passed to an event function and returns you an object that gives the\n\t\t * position of the object being moved, as a js object with the same params as the result of\n\t\t * getOffset, ie: { left: xxx, top: xxx }.\n\t\t * \n\t\t * different libraries have different signatures for their event callbacks.  \n\t\t * see getDragObject as well\n\t\t */\n\t\tgetUIPosition : function(eventArgs, zoom, dontAdjustHelper) {\n\t\t\tvar ret;\n\t\t\tzoom = zoom || 1;\n\t\t\tif (eventArgs.length == 1) {\n\t\t\t\tret = { left: eventArgs[0].pageX, top:eventArgs[0].pageY };\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar ui = eventArgs[1],\n\t\t\t\t  _offset = ui.position;//ui.offset;\n\t\t\t\t  \n\t\t\t\tret = _offset || ui.absolutePosition;\n\t\t\t\t\n\t\t\t\t// adjust ui position to account for zoom, because jquery ui does not do this.\n\t\t\t\tif (!dontAdjustHelper) {\n\t\t\t\t\tui.position.left /= zoom;\n\t\t\t\t\tui.position.top /= zoom;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn { left:ret.left, top: ret.top  };\n\t\t},\n\t\t\n\t\tisDragFilterSupported:function() { return true; },\n\t\t\n\t\tsetDragFilter : function(el, filter) {\n\t\t\tif (jsPlumb.isAlreadyDraggable(el))\n\t\t\t\t$(el).draggable(\"option\", \"cancel\", filter);\n\t\t},\n\t\t\n\t\tsetElementDraggable : function(el, draggable) {\n\t\t\t$(el).draggable(\"option\", \"disabled\", !draggable);\n\t\t},\n\t\t\n\t\tsetDragScope : function(el, scope) {\n\t\t\t$(el).draggable(\"option\", \"scope\", scope);\n\t\t},\n\t\t/**\n         * mapping of drag events for jQuery\n         */\n\t\tdragEvents : {\n\t\t\t'start':'start', 'stop':'stop', 'drag':'drag', 'step':'step',\n\t\t\t'over':'over', 'out':'out', 'drop':'drop', 'complete':'complete'\n\t\t},\n\t\tanimEvents:{\n\t\t\t'step':\"step\", 'complete':'complete'\n\t\t},\n        getOriginalEvent : function(e) { return e.originalEvent || e; },\n        /**\n         * note that jquery ignores the name of the event you wanted to trigger, and figures it out for itself.\n         * the other libraries do not.  yui, in fact, cannot even pass an original event.  we have to pull out stuff\n         * from the originalEvent to put in an options object for YUI.\n         * @param el\n         * @param event\n         * @param originalEvent\n         */\n        trigger : function(el, event, originalEvent) {\n            var h = jQuery._data(_getElementObject(el)[0], \"handle\");\n            h(originalEvent);\n        }\n\t\t\n// -------------------------------------- END DRAG/DROP\t---------------------------------\t\t\n\n\t});\n\n\t$(document).ready(jsPlumb.init);\n\n})(jQuery);\n\n"]}